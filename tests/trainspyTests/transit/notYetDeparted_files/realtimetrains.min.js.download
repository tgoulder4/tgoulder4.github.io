try {

	//global variable for async
	var propertag = propertag || {};
	propertag.cmd = propertag.cmd || [];
	var properSpecialOps = properSpecialOps || {};

	//Set Options
	(function(win, document) {

		var ad_code_domain = "global.proper.io" || "global.proper.io"; // domain to load ad code from
		var session_persistent = 1; // User keeps same version id throughout session
		var last_release_ts = "2023-08-07 09:36:23";  // Last time a file was released from split test
		var publisher = "realtimetrains";
		var proper_ad_block_message = 0; // Flag if proper ad block message should be enabled
		var multi_dfp = 0; // Whether or not to Load GTP (loads when multi_dfp is FALSE)

		var cookie_name = "proper_rtp_split_test";
		var cookieData  = {
			"version_id": null, // Session version id
			"release_ts": null  // Time this cookie was set
		}

		/**
		 * Rtp Files.
		 *
		 * If One Version:
		 *
		 * { version_id: config }
		 *
		 * If Split version:
		 *
		 * { version_id: rtp_version_id }
		 */

		// List of rtp files
		var rtp_files = {"24060":{"dfp_id":"21860136141","domain":"realtimetrains.co.uk","floors":{"mobile":{"backup":0.1},"desktop":{"backup":0.1}},"schain":{"ver":"1.0","nodes":[{"hp":1,"asi":"proper.io","sid":"4b3945ec-7dda-11ec-91ed-06ef03bc0096"}],"complete":1},"bidders":{"s2s":{"gumgum_s2s":{"test":false,"enabled":false,"site_id":"r42rrf97","tag_ids":{"desktop":[{"sticky_horizontal":["r42rrf97"]}]}}},"header":{"a9":{"enabled":true,"tag_ids":{"mobile":[{"320x50":["mobile-1","mobile-2","mobile-3"],"300x250":["mobile-2","mobile-3","mobile-4","mobile-5","mobile-6"],"320x100":["mobile-1","mobile-2","mobile-3"]}],"desktop":[{"728x90":["desktop-1","desktop-2","desktop-3"],"970x90":["desktop-1"],"160x600":["desktop-7","desktop-8","desktop-9"],"300x250":["desktop-4","desktop-5","desktop-6","desktop-9"],"300x600":["desktop-7","desktop-8","desktop-9"],"970x250":["desktop-1"]}]}},"index":{"enabled":true,"site_id":"796925-796931","tag_ids":{"mobile":[{"320x50":["320x50-1","320x50-2","320x50-3"],"300x250":["300x250-1","300x250-2","300x250-3","300x250-4","300x250-5"],"320x100":["320x100-1","320x100-2","320x100-3"]}],"desktop":[{"728x90":["728x90-1","728x90-2","728x90-3"],"300x250":["300x250-1","300x250-2","300x250-3"],"300x600":["300x600-1","300x600-2"],"970x250":["970x250-1"]}]}},"openx":{"enabled":true,"tag_ids":{"mobile":[{"320x50":["556665915","556665916","556665917"],"300x250":["556665916","556665917","556665918","556665919","556665920"],"320x100":["556665915","556665916","556665917"]}],"desktop":[{"728x90":["556665907","556665908","556665909"],"970x90":["556665908"],"160x600":["556665913","556665914"],"300x250":["556665910","556665911","556665912"],"300x600":["556665913","556665914"],"970x250":["556665907"]}]}},"sovrn":{"enabled":true,"tag_ids":{"mobile":[{"320x50":["1004782","1004783","1004784"],"300x250":["1004777","1004778","1004779","1004780","1004781"]}],"desktop":[{"728x90":["1004761","1004762","1004763"],"160x600":["1004770","1004771"],"300x250":["1004767","1004768","1004769"],"300x600":["1004772","1004773"],"970x250":["1004774"]}]}},"teads":{"enabled":true,"tag_ids":{"mobile":[{"320x50":["143198-157044-1","143198-157044-2","143198-157044-3"],"300x250":["143198-157044-2","143198-157044-3","143198-157044-4","143198-157044-5","143198-157044-6"],"320x100":["143198-157044-1","143198-157044-2","143198-157044-3"],"native_horizontal":["143197-157043-1","143197-157043-2","143197-157043-3"]}],"desktop":[{"728x90":["143198-157044-1","143198-157044-2","143198-157044-3"],"970x90":["143198-157044-1"],"160x600":["143198-157044-7","143198-157044-8"],"300x250":["143198-157044-4","143198-157044-5","143198-157044-6"],"300x600":["143198-157044-7","143198-157044-8"],"970x250":["143198-157044-1"],"native_horizontal":["143197-157043-1","143197-157043-2","143197-157043-3","143197-157043-4"]}]}},"yahoo":{"enabled":true,"site_id":"8a96953d017f7fbd461dbdae29c80022","tag_ids":{"mobile":[{"320x50":["8a9690c7017f7fbd4087bdb2c4a30036-1","8a9690c7017f7fbd4087bdb2c4a30036-2","8a9690c7017f7fbd4087bdb2c4a30036-3"],"300x250":["8a9690c7017f7fbd4087bdb2c4a30036-2","8a9690c7017f7fbd4087bdb2c4a30036-3","8a9690c7017f7fbd4087bdb2c4a30036-4","8a9690c7017f7fbd4087bdb2c4a30036-5","8a9690c7017f7fbd4087bdb2c4a30036-6"],"320x100":["8a9690c7017f7fbd4087bdb2c4a30036-1","8a9690c7017f7fbd4087bdb2c4a30036-2","8a9690c7017f7fbd4087bdb2c4a30036-3"]}],"desktop":[{"728x90":["8a9690c7017f7fbd4087bdb2c4a30036-1","8a9690c7017f7fbd4087bdb2c4a30036-2","8a9690c7017f7fbd4087bdb2c4a30036-3"],"970x90":["8a9690c7017f7fbd4087bdb2c4a30036-1"],"300x250":["8a9690c7017f7fbd4087bdb2c4a30036-4","8a9690c7017f7fbd4087bdb2c4a30036-5","8a9690c7017f7fbd4087bdb2c4a30036-6"],"300x600":["8a9690c7017f7fbd4087bdb2c4a30036-7","8a9690c7017f7fbd4087bdb2c4a30036-8"],"970x250":["8a9690c7017f7fbd4087bdb2c4a30036-1"]}]}},"adagio":{"enabled":true,"site_id":"realtimetrains-co-uk","tag_ids":{"mobile":[{"320x50":["mpu_atf-1","mpu_atf-2","mpu_atf-3","side_atf-1","side_atf-2","side_atf-3","lead_atf-1","lead_atf-2"],"300x250":["mpu_atf-1","mpu_atf-2","mpu_atf-3","side_atf-1","side_atf-2","side_atf-3","lead_atf-1","lead_atf-2"],"320x100":["mpu_atf-1","mpu_atf-2","mpu_atf-3","side_atf-1","side_atf-2","side_atf-3","lead_atf-1","lead_atf-2"]}],"desktop":[{"728x90":["mpu_atf-1","mpu_atf-2","mpu_atf-3","side_atf-1","side_atf-2","side_atf-3","lead_atf-1","lead_atf-2"],"970x90":["mpu_atf-1","mpu_atf-2","mpu_atf-3","side_atf-1","side_atf-2","side_atf-3","lead_atf-1","lead_atf-2"],"300x250":["mpu_atf-1","mpu_atf-2","mpu_atf-3","side_atf-1","side_atf-2","side_atf-3","lead_atf-1","lead_atf-2"],"300x600":["mpu_atf-1","mpu_atf-2","mpu_atf-3","side_atf-1","side_atf-2","side_atf-3","lead_atf-1","lead_atf-2"],"970x250":["mpu_atf-1","mpu_atf-2","mpu_atf-3","side_atf-1","side_atf-2","side_atf-3","lead_atf-1","lead_atf-2"]}]}},"criteo":{"enabled":true,"tag_ids":{"mobile":[{"320x50":["mobile-1","mobile-2","mobile-3"],"300x250":["mobile-2","mobile-3","mobile-4","mobile-5","mobile-6"],"320x100":["mobile-1","mobile-2","mobile-3"]}],"desktop":[{"728x90":["desktop-1","desktop-2","desktop-3"],"970x90":["desktop-1"],"160x600":["desktop-7","desktop-8"],"300x250":["desktop-4","desktop-5","desktop-6"],"300x600":["desktop-7","desktop-8"],"970x250":["desktop-1"]}]}},"gumgum":{"enabled":true,"tag_ids":{"mobile":[{"320x50":["r42rrf97-296720","r42rrf97-910386","r42rrf97-910387"],"300x250":["r42rrf97-296725","r42rrf97-910383","r42rrf97-910384","r42rrf97-910385"],"320x100":["r42rrf97-296721"],"sticky_horizontal":["r42rrf97"]}],"desktop":[{"728x90":["r42rrf97-296724","r42rrf97-910379","r42rrf97-910380"],"970x90":["r42rrf97-296725"],"160x600":["r42rrf97-296715"],"300x250":["r42rrf97-296718","r42rrf97-910377"],"300x600":["r42rrf97-296719","r42rrf97-910378"],"970x250":["r42rrf97-910382"],"sticky_horizontal":["r42rrf97"]}]}},"mantis":{"enabled":false,"site_id":"61eff20b93df0f5a71105f82","tag_ids":{"mobile":[{"320x50":["realtimetrains_320x50-1","realtimetrains_320x50-2","realtimetrains_320x50-3"],"300x250":["realtimetrains_300x250-1","realtimetrains_300x250-2","realtimetrains_300x250-3","realtimetrains_300x250-4","realtimetrains_300x250-5"],"320x100":["realtimetrains_320x100-1","realtimetrains_320x100-2","realtimetrains_320x100-3"]}],"desktop":[{"728x90":["realtimetrains_728x90-1","realtimetrains_728x90-2","realtimetrains_728x90-3"],"970x90":["realtimetrains_970x90-1"],"160x600":["realtimetrains_160x600-1","realtimetrains_160x600-1"],"300x250":["realtimetrains_300x250-1","realtimetrains_300x250-2","realtimetrains_300x250-3"],"300x600":["realtimetrains_300x600-1","realtimetrains_300x600-2"],"970x250":["realtimetrains_970x250-1"]}]}},"sonobi":{"enabled":true,"tag_ids":{"mobile":[{"320x50":["2961b097fba11245a54d","b5b60c4ccbf63e88dc03","4b370921a8a0d016a0ba"],"300x250":["362f8961a532bc8bea37","87866dd5126b70002f67","2b9118a22dd93d61b16b","b050ebb18dafbc4c6e9f","d2495e13e0521db433e2"]}],"desktop":[{"728x90":["a8f16305d12adb7256b6","e57ab9aca2f6ea6cee9e","62453ad27cb3293e3e99"],"160x600":["4970ccd648e55fdcfe42","7504ff9aa715ab19df64"],"300x250":["a33b33fe5a7754e5678b","2a5c87097f4c60dee74e","ecccd631877d38d365a5"],"300x600":["89b5d47f1d4d6271bf52","ac6fccb7c01fff0afcfd"],"970x250":["d108c56bc8a77f86cb4a"]}]}},"unruly":{"enabled":true,"site_id":"257870","tag_ids":{"mobile":[{"320x50":["mobile-1","mobile-2","mobile-3"],"300x250":["mobile-2","mobile-3","mobile-4","mobile-5","mobile-6"],"320x100":["mobile-1","mobile-2","mobile-3"]}],"desktop":[{"728x90":["desktop-1","desktop-2","desktop-3"],"970x90":["desktop-1"],"160x600":["desktop-7","desktop-8","desktop-9"],"300x250":["desktop-4","desktop-5","desktop-6","desktop-9"],"300x600":["desktop-7","desktop-8","desktop-9"],"970x250":["desktop-1"]}]}},"rubicon":{"enabled":true,"site_id":"411602","tag_ids":{"mobile":[{"320x50":["2314728-1","2314728-2","2314728-3"],"300x250":["2314728-2","2314728-3","2314728-4","2314728-5","2314728-6"],"320x100":["2314728-1","2314728-2","2314728-3"]}],"desktop":[{"728x90":["2314726-1","2314726-2","2314726-3"],"970x90":["2314726-1"],"160x600":["2314726-7","2314726-8"],"300x250":["2314726-4","2314726-5","2314726-6"],"300x600":["2314726-7","2314726-8"],"970x250":["2314726-1"]}]}},"appnexus":{"enabled":true,"tag_ids":{"mobile":[{"320x50":["24147948","24147949","24147950"],"300x250":["24147949","24147950","24147951","24147952","24147953"],"320x100":["24147948","24147949","24147950"]}],"desktop":[{"728x90":["24147811","24147940","24147941"],"970x90":["24147940"],"160x600":["24147945","24147946","24511258"],"300x250":["24147942","24147943","24147944","24511258"],"300x600":["24147945","24147946","24511258"],"970x250":["24147811"]}]}},"medianet":{"enabled":true,"tag_ids":{"mobile":[{"320x50":["mobile-1","mobile-2","mobile-3"],"300x250":["mobile-2","mobile-3","mobile-4","mobile-5","mobile-6"],"320x100":["mobile-1","mobile-2","mobile-3"]}],"desktop":[{"728x90":["desktop-1","desktop-2","desktop-3"],"970x90":["desktop-1"],"160x600":["desktop-7","desktop-8"],"300x250":["desktop-4","desktop-5","desktop-6"],"300x600":["desktop-7","desktop-8"],"970x250":["desktop-1"]}]}},"pubmatic":{"enabled":true,"tag_ids":{"mobile":[{"320x50":["mobile-1","mobile-2","mobile-3"],"300x250":["mobile-2","mobile-3","mobile-4","mobile-5","mobile-6"],"320x100":["mobile-1","mobile-2","mobile-3"]}],"desktop":[{"728x90":["desktop-1","desktop-2","desktop-3"],"970x90":["desktop-1"],"160x600":["desktop-7","desktop-8"],"300x250":["desktop-4","desktop-5","desktop-6"],"300x600":["desktop-7","desktop-8"],"970x250":["desktop-1"]}]}},"triplelift":{"enabled":true,"tag_ids":{"mobile":[{"320x50":["realtimetrains_mobile-1","realtimetrains_mobile-2","realtimetrains_mobile-3"],"300x250":["realtimetrains_mobile-2","realtimetrains_mobile-3","realtimetrains_mobile-4","realtimetrains_mobile-5","realtimetrains_mobile-6"],"320x100":["realtimetrains_mobile-1","realtimetrains_mobile-2","realtimetrains_mobile-3"],"native_horizontal":["realtimetrains_mobile_1"]}],"desktop":[{"728x90":["realtimetrains_desktop-1","realtimetrains_desktop-2","realtimetrains_desktop-3"],"970x90":["realtimetrains_desktop-1"],"160x600":["realtimetrains_desktop-7","realtimetrains_desktop-8"],"300x250":["realtimetrains_desktop-4","realtimetrains_desktop-5","realtimetrains_desktop-6"],"300x600":["realtimetrains_desktop-7","realtimetrains_desktop-8"],"970x250":["realtimetrains_desktop-1"],"native_vertical":["realtimetrains_desktop_300x600_1","realtimetrains_desktop_300x250_1"],"native_horizontal":["realtimetrains_desktop_728x90_1"]}]}},"sharethrough":{"enabled":true,"tag_ids":{"desktop":[{"728x90":["g0ahLswVgIdlKThiycZWRIBh","0HRIiMtz8vli7hl9jydiKniC","GBWimjPS4tDane35gyal2PCj"],"native_horizontal":["EOdiFZ3aTIz3QA6hElfuhIwY","T58xCzQqPmNuJB1FNrtf41pn","z8xN6SE2wJSnaM3Vejx13y06"]}]}},"thirtythreeacross":{"enabled":true,"tag_ids":{"mobile":[{"320x50":["cTVzU-IE8r7kuOrkHcnnVW","c1tqoMIE8r7kuOrkHcnnVW","c6tQ1gIE8r7kuOrkHcnnVW"],"300x250":["c1tqoMIE8r7kuOrkHcnnVW","c6tQ1gIE8r7kuOrkHcnnVW","c-_dMOIE8r7kuOrkHcnnVW","deaF-GIE8r7kuOrkHcnnVW","djRq0EIE8r7kuOrkHcnnVW"],"320x100":["cTVzU-IE8r7kuOrkHcnnVW","c1tqoMIE8r7kuOrkHcnnVW","c6tQ1gIE8r7kuOrkHcnnVW"]}],"desktop":[{"728x90":["do5iTkIE8r7kuOrkHcnnVW","dtXBocIE8r7kuOrkHcnnVW","dzuU-UIE8r7kuOrkHcnnVW"],"970x90":["dtXBocIE8r7kuOrkHcnnVW"],"160x600":["dTBWR-IE8r7kuOrkHcnnVW","dYsOnKIE8r7kuOrkHcnnVW"],"300x250":["dEz9YeIE8r7kuOrkHcnnVW","dJRtDiIE8r7kuOrkHcnnVW","dOVSTsIE8r7kuOrkHcnnVW"],"300x600":["dTBWR-IE8r7kuOrkHcnnVW","dYsOnKIE8r7kuOrkHcnnVW"],"970x250":["do5iTkIE8r7kuOrkHcnnVW"]}]}}}},"refresh":{"mobile":{"max":15,"enabled":1,"interval":30000,"exclude_dfp":0,"inview_interval":3000},"desktop":{"max":15,"enabled":1,"interval":30000,"exclude_dfp":0,"inview_interval":3000},"device_specific":true},"userIds":{"identityAdapters":{"id5id":{"name":"id5Id","config":{"enabled":true},"storage":{"name":"id5id","type":"localstorage","expiresInDays":90,"refreshInSeconds":28800}},"publink":{"name":"pubLink","config":{"apiKey":null,"siteId":null,"enabled":true},"storage":{"name":"publink","type":"cookie","expiresInDays":30}},"sharedid":{"name":"sharedId","config":{"enabled":true},"storage":{"name":"sharedid","type":"cookie","expiresInDays":30,"refreshInSeconds":86400}},"pubcommonid":{"name":"pubCommonId","config":{"enabled":true},"storage":{"name":"_pubcid","type":"localstorage","expiresInDays":365}},"identitylink":{"name":"identityLink","config":{"enabled":true,"logging":"","urlRegex":"","atsEnabled":false,"rootDomain":"","cssSelectors":"","urlParameter":"","detectionType":"","detectionSubject":"","detectionInterval":0,"detectDynamicNodes":false,"detectionEventType":""},"storage":{"name":"idl_env","type":"cookie","expiresInDays":30}},"verizonmediaid":{"name":"verizonMediaId","config":{"enabled":true},"storage":{"name":"connectid","type":"localstorage","expiresInDays":15}}}},"ad_slots":{"display":{"realtimetrains_adhesion":{"gam_id":5376056,"number":3,"slider":false,"sticky":true,"refresh":{"mobile":{"enabled":true},"desktop":{"enabled":true}},"mcm_type":"mcm","sticky_settings":{"brand":false,"close_btn":true},"resolution_size_map":{"0":["320x50","sticky_horizontal"],"764":["728x90","sticky_horizontal"],"1020":["728x90","sticky_horizontal"]}},"realtimetrains_leaderboard_atf":{"gam_id":5376056,"number":1,"slider":false,"sticky":false,"refresh":{"mobile":{"enabled":true},"desktop":{"enabled":true}},"mcm_type":"mcm","disable_adx":{"mobile":true,"desktop":false},"resolution_size_map":{"0":["320x50","320x100"],"764":["728x90"]}},"realtimetrains_leaderboard_btf":{"gam_id":5376056,"number":2,"slider":false,"sticky":false,"refresh":{"mobile":{"enabled":true},"desktop":{"enabled":true}},"lazyload":{"mobile":{"enabled":true},"desktop":{"enabled":false},"device_specific":true},"mcm_type":"mcm","resolution_size_map":{"0":[],"764":["728x90","native_horizontal"],"1024":["970x250","970x90","native_horizontal"]}},"realtimetrains_sticky_rightrail":{"gam_id":5376056,"number":4,"slider":false,"sticky":false,"dynamic":{"mobile":{"enabled":true,"cssselector":".realtimetrains_sticky_rightrail"},"desktop":{"enabled":true,"cssselector":".realtimetrains_sticky_rightrail"}},"refresh":{"mobile":{"enabled":false},"desktop":{"enabled":false},"device_specific":true},"mcm_type":"mcm","sticky_settings":{"brand":false,"close_btn":false},"resolution_size_map":{"0":[],"1200":["300x600","160x600"]}},"realtimetrains_leaderboard_atf_2":{"gam_id":5376056,"number":6,"slider":false,"sticky":false,"dynamic":{"mobile":{"enabled":true,"cssselector":".sovrn-lb-2-atf"},"desktop":{"enabled":true,"cssselector":".sovrn-lb-2-atf"}},"refresh":{"mobile":{"enabled":true},"desktop":{"enabled":true}},"mcm_type":"mcm","min_height":50,"resolution_size_map":{"0":["320x50"],"764":["728x90"]}},"realtimetrains_sticky_rightrail_300x250":{"gam_id":5376056,"number":5,"slider":false,"sticky":false,"dynamic":{"mobile":{"enabled":true,"cssselector":".realtimetrains_sticky_rightrail_300x250"},"desktop":{"enabled":true,"cssselector":".realtimetrains_sticky_rightrail_300x250"}},"refresh":{"mobile":{"enabled":false},"desktop":{"enabled":false},"device_specific":true},"mcm_type":"mcm","resolution_size_map":[["300x250","native_vertical"]]}}},"auctions":{"mobile":{"max":15,"rounds":1,"timeout":28000},"desktop":{"max":15,"rounds":1,"timeout":28000},"resolution_size_map":{"0":["320x50","sticky_horizontal","320x100","300x250","native_vertical"],"764":["728x90","sticky_horizontal","native_horizontal"],"1020":["728x90","sticky_horizontal"],"1024":["970x250","970x90","native_horizontal"],"1200":["300x600","160x600"]}},"confiant":false,"lazyload":{"mobile":{"enabled":false,"fetchMarginPercent":200,"renderMarginPercent":150},"desktop":{"enabled":false,"fetchMarginPercent":200,"renderMarginPercent":150},"device_specific":false},"mcm_type":"mcm","extra_css":".proper-ad-unit.ad-sticky:not(.for-mobile):not(.sticky-left):not(.sticky-right):not([class*='sticky-corner-']) .close{display:block !important}.proper-ad-unit.ad-sticky.for-mobile .close{display:block !important}\n","site_name":"realtimetrains","autoDelete":{"mobile":{"enabled":false,"autoDeleteMarginPercent":200},"desktop":{"enabled":false,"autoDeleteMarginPercent":200},"device_specific":false},"remote_gam":false,"adlightning":{"enabled":true,"clientId":"properio","reportAd":false},"default_tags":["main"],"dfp_per_slot":false,"isolated_urls":[],"report_ad_tool":false,"sandbox_iframe":1,"audience_pixels":{"enabled":false,"thresholds":[]},"remote_adx_data":false,"sandbox_options":["allow-pointer-lock","allow-popups","allow-same-origin","allow-scripts"],"rtp_file_version":24060,"audience_segments":{"networks":{"google":{"enabled":false},"taboola":{"range":{"max":0.22,"min":0.01,"exceptions":[]},"enabled":false},"twitter":{"enabled":false},"facebook":{"range":{"max":0.22,"min":0.01,"exceptions":[]},"enabled":false},"outbrain":{"range":{"max":0.22,"min":0.01,"exceptions":[]},"enabled":false}}},"domain_protection":false,"google_advertiser":42904576,"proper_advertiser":600883576,"rtp_file_revision":"3.0.0","additional_domains":[],"traffic_percentage":1}};

		// List of custom tags
		var rtp_default_tags = [];

		// Traffic Percentages
		var traffic_percentages = {"24060":1};
		var getVersionId = weightedRandom(traffic_percentages);

		function run() {

			// Check if ad project code has already been loaded
			if (typeof ProperMedia !== 'undefined' && typeof ProperMedia.ad_project !== 'undefined') {
				console.warn('Proper Media\'s ad code has already been loaded');
				return false;
			}

			if(!multi_dfp){
				window.googletag = window.googletag || {};
				window.googletag.cmd = window.googletag.cmd || [];

				if(!window.googletag._loadStarted_) {
				    (function() {
				    var gads = document.createElement('script');
				    gads.async = true;
				    gads.type = 'text/javascript';
				    var useSSL = 'https:' == document.location.protocol;
				    gads.src = (useSSL ? 'https:' : 'http:') +
				    '//securepubads.g.doubleclick.net/tag/js/gpt.js';
				    var node = document.getElementsByTagName('script')[0];
				    node.parentNode.insertBefore(gads, node);
				    })();
				}
			}

			// Check if Ad Blocker is enabled
			detectAdBlockPlugins()

			// Init version id
			var version_id   = null,
				clear_cookie = false,
				config 		 = null;

			// Check for clear cookie flag
			var get_vars = getUrlParameters(window.location.search.substring(1));
			if(typeof get_vars["vselect_clear"] !== "undefined" && get_vars["vselect_clear"] == 1) {
				clear_cookie = true;
			}
			// Check for version id in url
			if(typeof get_vars["vselect"] !== "undefined" && get_vars["vselect"] && rtp_files[get_vars["vselect"]]) {
				version_id = get_vars["vselect"];
			} else if (typeof get_vars["p_default_tag"] !== "undefined" && get_vars["p_default_tag"] && rtp_default_tags[get_vars["p_default_tag"]] && rtp_default_tags[get_vars["p_default_tag"]].length) {
				// get the first version listed if duplicate tags
				version_id = rtp_default_tags[get_vars["p_default_tag"]][0];
			}

			// Check for session persistent
			if(session_persistent) {
				// Get cookie data
				getSplitTestCookie();

				// Convert dates
				d1 = new Date(cookieData['release_ts']);
				d2 = new Date(last_release_ts);

				// Check if cookie data is out of date
				if(d1 < d2 || !cookieData['version_id'] || !rtp_files[cookieData['version_id']] || version_id || clear_cookie) {
					cookieData['version_id'] = version_id || getVersionId();  // Generate version id based on traffic share
					cookieData['release_ts'] = last_release_ts;   // Update release ts
				}
				// Set new cookie data
				setSplitTestCookie();

				version_id = cookieData['version_id'];
			} else {
				// Generate version id based on traffic share
				version_id = version_id || getVersionId();
			}

			// Check if proper ad block message should be enabled
			activateAdBlockMsg();

			var versions = Object.keys(rtp_files);
			// Find and Activate Config Object.
			if (rtp_files[version_id]) {
				if (versions.length == 1) {
					var config = rtp_files[version_id];
					activatePayload(config.rtp_file_revision);
					activateConfig(config);
				} else {
					var payload_name = rtp_files[version_id];
					activatePayload(payload_name);
					fetchConfig(version_id, function (config) {
						activateConfig(config);
					});
				}
			}
		}

		/**
		 * Activate the Config Object.
		 *
		 * @param {object} config RtpJ Config Object.
		 */
		function activateConfig(config) {
			if(config.amazon_advertiser) {
				config.aaba30b = "";
				config._0x4d3546 = "";
			}
			propertag.cmd.unshift(function () {
				ProperMedia.ad_project.set_options(config);
			});
		}

		/**
		 * Add event listener of ad blockers to show proper ad block message
		 */
		function activateAdBlockMsg() {
			if(proper_ad_block_message) {
				window.addEventListener("proper-ad-bidders-blocked", loadProperMessage);
			}
		}

		/**
         * Load Proper Ad Block Message
         */
        function loadProperMessage() {

            function showProperMessage() {
                try {
                    var ProperMediaMessage = window.ProperMediaMessage || {};
                    ProperMediaMessage.project.show_shield_message('', publisher);
                } catch(e) {
                    console.error(e);
                }
            }

            if(
                !window.ProperMediaMessage ||
                !window.ProperMediaMessage.project ||
                !window.ProperMediaMessage.show_shield_message
            ) {
                var script = document.createElement("script");
                script.type = "text/javascript";
                script.src = "https://propermessage.io/design/assets/bundle-message.js";
                script.onload = showProperMessage;
                document.getElementsByTagName("head")[0].appendChild(script);
            } else {
                showProperMessage()
            }
        }

		/**
		 * Grab the Config from the remote server.
		 *
		 * @param {*} version_id The Version Id to fetch.
		 * @param {*} callback Function that will be passed the parsed config.
		 */
		function fetchConfig(version_id, callback) {
			var req = new XMLHttpRequest();

			var listener = function () {
				var config = safeJsonParse(this.responseText);
				if(typeof callback == 'function') {
					callback(config);
				}
			};

			req.addEventListener("load", listener);
			req.open("GET", "https://" + ad_code_domain + "/config/" + publisher + "." + version_id + '.json');
			req.send();
		}

		/**
		 * Activate the Payload!
		 *
		 * @param {string} payload_name The Payload Release Name.
		 */
		function activatePayload(payload_name) {
			// Main ad code file
			var script = document.createElement("script");

			script.onerror = function() {
				payload_loaded = false;
                // Payload was blocked, trigger this event
                var event = new CustomEvent('proper-ad-bidders-blocked', {});
                window.dispatchEvent(event);
            }

        	payload_loaded = true;
			var payload = 'https://' + ad_code_domain + '/payloads/' + payload_name + '.js';
			script.type = "text/javascript";
			script.src = payload;
			document.getElementsByTagName("head")[0].appendChild(script);
		}

		// Weighted Random @see https://stackoverflow.com/questions/8435183/generate-a-weighted-random-number
		function weightedRandom(spec) {
			if (!spec) {
				return function() {};
			}

			var ids = Object.keys(spec);

			if (ids.length == 1) {
				return function () { return ids[0] };
			}

			var i, j, table = [];
			for (i in spec) {
				// The constant 10000 below should be computed based on the
				// weights in the spec for a correct and optimal table size.
				// E.g. the spec {0:0.999, 1:0.001} will break this impl.
				for (j=0; j<spec[i]*10000; j++) {
					table.push(i);
				}
			}
			return function() {
				return table[Math.floor(Math.random() * table.length)];
			}
		}

		function getSplitTestCookie() {
			// Get cookie value
			var cookie_string_value = getCookieValue(cookie_name) || '{}';

			// Set settion object
			var cookieSplitTestData = safeJsonParse(cookie_string_value) || {};
			cookieData = {
				"version_id": cookieSplitTestData['version_id'] || null,
				"release_ts": cookieSplitTestData['release_ts'] || null
			}
		}

		function setSplitTestCookie() {
			// stringify data
			var encoded_cookie_value = JSON.stringify(cookieData);
			// save session cookie
			setCookieValue(encoded_cookie_value);
		}

		function getCookieValue(a) {
			var b = document.cookie.match('(^|;)\\s*' + a + '\\s*=\\s*([^;]+)');
			return b ? b.pop() : undefined;
		}

		function setCookieValue(value) {
			document.cookie = cookie_name + "=" + value + "; path=/;";
		}

		function getUrlParameters(url) {
			var data = decodeURIComponent(url).split('&');
			var res = {};
			for (var i = 0; i < data.length; i++) {
				var parm = data[i].split('=');
				res[parm[0]] = parm[1];
			}
			return res;
		}

		/**
		* Detect if a user has an ad block plugin by loading pixels
		*/
		function detectAdBlockPlugins() {
			window.properSpecialOps = window.properSpecialOps || {};

			var checksRemain = 2,
			error1  = false,
			error2  = false,
			px      = 'https://abcheck.proper.io/px.gif?ch=*&rn=*',
			adblock = {
				'detected': false,
				'acceptable_ads': false
			};

			function checkImages() {
				if (--checksRemain) return;
				if(error2) {
					adblock.detected = true;
					if(!error1) {
						adblock.acceptable_ads = true;
					} else {
						adblock.acceptable_ads = false;
					}

					window.properSpecialOps.adblock = adblock;

					// Enough bidders were blocked, must be an adblocker
					var event = new CustomEvent('proper-adblock-pixels-blocked', {});
					window.dispatchEvent(event);
				}
			}

			//send request
			var random   = (Math.random() * 11).toString();
			var img1     = new Image;
			img1.onload  = checkImages;
			img1.onerror = function () {
				error1 = true;
				checkImages();
			};
			img1.src = px.replace(/\*/, '1').replace(/\*/, random);

			//send request
			var img2     = new Image;
			img2.onload  = checkImages;
			img2.onerror = function () {
				error2 = true;
				checkImages();
			};
			img2.src = px.replace(/\*/, '2').replace(/\*/, random);
		}

		/**
		 * safeJSONParse
		 *
		 * Makes an attempt to parse a JSON safely, but might fail miserably.
		 *
		 * @param {String} the json
		 *
		 * @returns {JSON|null} JSON is parsed, Null if not.
		 *
		 */
		function safeJsonParse(json) {
			try {
				return JSON.parse(json);
			} catch(e) {
				console.error(e);
			}
			return null;
		}

		/**
         * CustomEvent polyfill for IE
         */
        if(!window.CustomEvent !== "function" ) {
            window.CustomEvent = function CustomEvent ( event, params ) {
                params = params || { bubbles: false, cancelable: false, detail: null };
                var evt = document.createEvent( 'CustomEvent' );
                evt.initCustomEvent( event, params.bubbles, params.cancelable, params.detail );
                return evt;
            }
		};

		// Placeholder for Google Funding Choices.
		


		run();

	})(window, document);
} catch (e) {
	console.error(e);
	if(typeof TraceKit !== "undefined") {
		TraceKit.report(e); //error with stack trace gets normalized and sent to subscriber
	}
}

window.properSpecialOps = window.properSpecialOps || {};
window.properSpecialOps.country='GB';
window.properSpecialOps.region='ENG';
window.properSpecialOps.uspcDoesApply = false;
window.properSpecialOps.gppDoesApply=true;
window.properSpecialOps.gppSection='EU';
window.properSpecialOps.gdprDoesApply=true;
