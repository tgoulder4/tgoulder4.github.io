function _0x22e6(_0xfd4f1f,_0x24a8e0){var _0x4cba8e=_0x4cba();return _0x22e6=function(_0x22e661,_0x20b4e6){_0x22e661=_0x22e661-0x112;var _0x41ec3e=_0x4cba8e[_0x22e661];return _0x41ec3e;},_0x22e6(_0xfd4f1f,_0x24a8e0);}var _0x284e95=_0x22e6;(function(_0x39550e,_0x56cd88){var _0xaa1308=_0x22e6,_0x583dfe=_0x39550e();while(!![]){try{var _0x421bda=parseInt(_0xaa1308(0x11f))/0x1+parseInt(_0xaa1308(0x11b))/0x2+parseInt(_0xaa1308(0x116))/0x3*(parseInt(_0xaa1308(0x113))/0x4)+parseInt(_0xaa1308(0x112))/0x5*(-parseInt(_0xaa1308(0x123))/0x6)+parseInt(_0xaa1308(0x114))/0x7*(-parseInt(_0xaa1308(0x11d))/0x8)+-parseInt(_0xaa1308(0x119))/0x9+parseInt(_0xaa1308(0x120))/0xa;if(_0x421bda===_0x56cd88)break;else _0x583dfe['push'](_0x583dfe['shift']());}catch(_0x151510){_0x583dfe['push'](_0x583dfe['shift']());}}}(_0x4cba,0xd320c));window[_0x284e95(0x122)]!==window[_0x284e95(0x118)]&&(propertag=propertag||{'cmd':[]},window['parent'][_0x284e95(0x115)](_0x284e95(0x11e),'*'),window[_0x284e95(0x117)]('message',function(_0x206f25){var _0x185546=_0x284e95;0x1+_0x206f25[_0x185546(0x11a)][_0x185546(0x11c)](_0x185546(0x11e))==0x1&&eval(_0x206f25[_0x185546(0x11a)][_0x185546(0x121)]('PROPERMEDIA',''));},![]));function _0x4cba(){var _0xb00f81=['addEventListener','top','12853494aBEaRp','data','480458plsRNQ','indexOf','13071256kDirlJ','PROPERMEDIA','212194dqfGpY','51466610KTKZqT','replace','self','1268526JZlrZl','40lHVhDL','4fZTLCh','7bgrwTq','postMessage','57411cXmglv'];_0x4cba=function(){return _0xb00f81;};return _0x4cba();}
(function(window,undefined){if(!window){return;}
var TraceKit={};var _oldTraceKit=window.top.TraceKit;var _slice=[].slice;var UNKNOWN_FUNCTION='?';var ERROR_TYPES_RE=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/;function _has(object,key){return Object.prototype.hasOwnProperty.call(object,key);}
function _isUndefined(what){return typeof what==='undefined';}
TraceKit.noConflict=function noConflict(){window.top.TraceKit=_oldTraceKit;return TraceKit;};TraceKit.wrap=function traceKitWrapper(func){function wrapped(){try{return func.apply(this,arguments);}catch(e){TraceKit.report(e);throw e;}}
return wrapped;};TraceKit.report=(function reportModuleWrapper(){var handlers=[],lastException=null,lastExceptionStack=null;function subscribe(handler){installGlobalHandler();installGlobalUnhandledRejectionHandler();handlers.push(handler);}
function unsubscribe(handler){for(var i=handlers.length-1;i>=0;--i){if(handlers[i]===handler){handlers.splice(i,1);}}
if(handlers.length===0){uninstallGlobalHandler();uninstallGlobalUnhandledRejectionHandler();}}
function notifyHandlers(stack,isWindowError,error){var exception=null;if(isWindowError&&!TraceKit.collectWindowErrors){return;}
for(var i in handlers){if(_has(handlers,i)){try{handlers[i](stack,isWindowError,error);}catch(inner){exception=inner;}}}
if(exception){throw exception;}}
var _oldOnerrorHandler,_onErrorHandlerInstalled;var _oldOnunhandledrejectionHandler,_onUnhandledRejectionHandlerInstalled;function traceKitWindowOnError(message,url,lineNo,columnNo,errorObj){var stack=null;if(lastExceptionStack){TraceKit.computeStackTrace.augmentStackTraceWithInitialElement(lastExceptionStack,url,lineNo,message);processLastException();}else if(errorObj){stack=TraceKit.computeStackTrace(errorObj);notifyHandlers(stack,true,errorObj);}else{var location={'url':url,'line':lineNo,'column':columnNo};var name;var msg=message;if({}.toString.call(message)==='[object String]'){var groups=message.match(ERROR_TYPES_RE);if(groups){name=groups[1];msg=groups[2];}}
location.func=TraceKit.computeStackTrace.guessFunctionName(location.url,location.line);location.context=TraceKit.computeStackTrace.gatherContext(location.url,location.line);stack={'name':name,'message':msg,'mode':'onerror','stack':[location]};notifyHandlers(stack,true,null);}
if(_oldOnerrorHandler){return _oldOnerrorHandler.apply(this,arguments);}
return false;}
function traceKitWindowOnUnhandledRejection(e){var stack=TraceKit.computeStackTrace(e.reason);notifyHandlers(stack,true,e.reason);}
function installGlobalHandler(){if(_onErrorHandlerInstalled===true){return;}
_oldOnerrorHandler=window.onerror;window.onerror=traceKitWindowOnError;_onErrorHandlerInstalled=true;}
function uninstallGlobalHandler(){if(_onErrorHandlerInstalled){window.onerror=_oldOnerrorHandler;_onErrorHandlerInstalled=false;}}
function installGlobalUnhandledRejectionHandler(){if(_onUnhandledRejectionHandlerInstalled===true){return;}
_oldOnunhandledrejectionHandler=window.onunhandledrejection;window.onunhandledrejection=traceKitWindowOnUnhandledRejection;_onUnhandledRejectionHandlerInstalled=true;}
function uninstallGlobalUnhandledRejectionHandler(){if(_onUnhandledRejectionHandlerInstalled){window.onerror=_oldOnunhandledrejectionHandler;_onUnhandledRejectionHandlerInstalled=false;}}
function processLastException(){var _lastExceptionStack=lastExceptionStack,_lastException=lastException;lastExceptionStack=null;lastException=null;notifyHandlers(_lastExceptionStack,false,_lastException);}
function report(ex){if(lastExceptionStack){if(lastException===ex){return;}else{processLastException();}}
var stack=TraceKit.computeStackTrace(ex);lastExceptionStack=stack;lastException=ex;setTimeout(function(){if(lastException===ex){processLastException();}},(stack.incomplete?2000:0));throw ex;}
report.subscribe=subscribe;report.unsubscribe=unsubscribe;return report;}());TraceKit.computeStackTrace=(function computeStackTraceWrapper(){var debug=false,sourceCache={};function loadSource(url){if(!TraceKit.remoteFetching){return '';}
try{var getXHR=function(){try{return new window.XMLHttpRequest();}catch(e){return new window.ActiveXObject('Microsoft.XMLHTTP');}};var request=getXHR();request.open('GET',url,false);request.send('');return request.responseText;}catch(e){return '';}}
function getSource(url){if(typeof url!=='string'){return[];}
if(!_has(sourceCache,url)){var source='';var domain='';try{domain=window.document.domain;}catch(e){}
var match=/(.*)\:\/\/([^:\/]+)([:\d]*)\/{0,1}([\s\S]*)/.exec(url);if(match&&match[2]===domain){source=loadSource(url);}
sourceCache[url]=source?source.split('\n'):[];}
return sourceCache[url];}
function guessFunctionName(url,lineNo){var reFunctionArgNames=/function ([^(]*)\(([^)]*)\)/,reGuessFunction=/['"]?([0-9A-Za-z$_]+)['"]?\s*[:=]\s*(function|eval|new Function)/,line='',maxLines=10,source=getSource(url),m;if(!source.length){return UNKNOWN_FUNCTION;}
for(var i=0;i<maxLines;++i){line=source[lineNo-i]+line;if(!_isUndefined(line)){if((m=reGuessFunction.exec(line))){return m[1];}else if((m=reFunctionArgNames.exec(line))){return m[1];}}}
return UNKNOWN_FUNCTION;}
function gatherContext(url,line){var source=getSource(url);if(!source.length){return null;}
var context=[],linesBefore=Math.floor(TraceKit.linesOfContext/2),linesAfter=linesBefore+(TraceKit.linesOfContext%2),start=Math.max(0,line-linesBefore-1),end=Math.min(source.length,line+linesAfter-1);line-=1;for(var i=start;i<end;++i){if(!_isUndefined(source[i])){context.push(source[i]);}}
return context.length>0?context:null;}
function escapeRegExp(text){return text.replace(/[\-\[\]{}()*+?.,\\\^$|#]/g,'\\$&');}
function escapeCodeAsRegExpForMatchingInsideHTML(body){return escapeRegExp(body).replace('<','(?:<|&lt;)').replace('>','(?:>|&gt;)').replace('&','(?:&|&amp;)').replace('"','(?:"|&quot;)').replace(/\s+/g,'\\s+');}
function findSourceInUrls(re,urls){var source,m;for(var i=0,j=urls.length;i<j;++i){if((source=getSource(urls[i])).length){source=source.join('\n');if((m=re.exec(source))){return{'url':urls[i],'line':source.substring(0,m.index).split('\n').length,'column':m.index-source.lastIndexOf('\n',m.index)-1};}}}
return null;}
function findSourceInLine(fragment,url,line){var source=getSource(url),re=new RegExp('\\b'+escapeRegExp(fragment)+'\\b'),m;line-=1;if(source&&source.length>line&&(m=re.exec(source[line]))){return m.index;}
return null;}
function findSourceByFunctionBody(func){if(_isUndefined(window&&window.document)){return;}
var urls=[window.location.href],scripts=window.document.getElementsByTagName('script'),body,code=''+func,codeRE=/^function(?:\s+([\w$]+))?\s*\(([\w\s,]*)\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,eventRE=/^function on([\w$]+)\s*\(event\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,re,parts,result;for(var i=0;i<scripts.length;++i){var script=scripts[i];if(script.src){urls.push(script.src);}}
if(!(parts=codeRE.exec(code))){re=new RegExp(escapeRegExp(code).replace(/\s+/g,'\\s+'));}
else{var name=parts[1]?'\\s+'+parts[1]:'',args=parts[2].split(',').join('\\s*,\\s*');body=escapeRegExp(parts[3]).replace(/;$/,';?');re=new RegExp('function'+name+'\\s*\\(\\s*'+args+'\\s*\\)\\s*{\\s*'+body+'\\s*}');}
if((result=findSourceInUrls(re,urls))){return result;}
if((parts=eventRE.exec(code))){var event=parts[1];body=escapeCodeAsRegExpForMatchingInsideHTML(parts[2]);re=new RegExp('on'+event+'=[\\\'"]\\s*'+body+'\\s*[\\\'"]','i');if((result=findSourceInUrls(re,urls[0]))){return result;}
re=new RegExp(body);if((result=findSourceInUrls(re,urls))){return result;}}
return null;}
function computeStackTraceFromStackProp(ex){if(!ex.stack){return null;}
var chrome=/^\s*at (.*?) ?\(((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,gecko=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|\[native).*?|[^@]*bundle)(?::(\d+))?(?::(\d+))?\s*$/i,winjs=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,isEval,geckoEval=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,chromeEval=/\((\S*)(?::(\d+))(?::(\d+))\)/,lines=ex.stack.split('\n'),stack=[],submatch,parts,element,reference=/^(.*) is undefined$/.exec(ex.message);for(var i=0,j=lines.length;i<j;++i){if((parts=chrome.exec(lines[i]))){var isNative=parts[2]&&parts[2].indexOf('native')===0;isEval=parts[2]&&parts[2].indexOf('eval')===0;if(isEval&&(submatch=chromeEval.exec(parts[2]))){parts[2]=submatch[1];parts[3]=submatch[2];parts[4]=submatch[3];}
element={'url':!isNative?parts[2]:null,'func':parts[1]||UNKNOWN_FUNCTION,'args':isNative?[parts[2]]:[],'line':parts[3]?+parts[3]:null,'column':parts[4]?+parts[4]:null};}else if(parts=winjs.exec(lines[i])){element={'url':parts[2],'func':parts[1]||UNKNOWN_FUNCTION,'args':[],'line':+parts[3],'column':parts[4]?+parts[4]:null};}else if((parts=gecko.exec(lines[i]))){isEval=parts[3]&&parts[3].indexOf(' > eval')>-1;if(isEval&&(submatch=geckoEval.exec(parts[3]))){parts[3]=submatch[1];parts[4]=submatch[2];parts[5]=null;}else if(i===0&&!parts[5]&&!_isUndefined(ex.columnNumber)){stack[0].column=ex.columnNumber+1;}
element={'url':parts[3],'func':parts[1]||UNKNOWN_FUNCTION,'args':parts[2]?parts[2].split(','):[],'line':parts[4]?+parts[4]:null,'column':parts[5]?+parts[5]:null};}else{continue;}
if(!element.func&&element.line){element.func=guessFunctionName(element.url,element.line);}
element.context=element.line?gatherContext(element.url,element.line):null;stack.push(element);}
if(!stack.length){return null;}
if(stack[0]&&stack[0].line&&!stack[0].column&&reference){stack[0].column=findSourceInLine(reference[1],stack[0].url,stack[0].line);}
return{'mode':'stack','name':ex.name,'message':ex.message,'stack':stack};}
function computeStackTraceFromStacktraceProp(ex){var stacktrace=ex.stacktrace;if(!stacktrace){return;}
var opera10Regex=/ line (\d+).*script (?:in )?(\S+)(?:: in function (\S+))?$/i,opera11Regex=/ line (\d+), column (\d+)\s*(?:in (?:<anonymous function: ([^>]+)>|([^\)]+))\((.*)\))? in (.*):\s*$/i,lines=stacktrace.split('\n'),stack=[],parts;for(var line=0;line<lines.length;line+=2){var element=null;if((parts=opera10Regex.exec(lines[line]))){element={'url':parts[2],'line':+parts[1],'column':null,'func':parts[3],'args':[]};}else if((parts=opera11Regex.exec(lines[line]))){element={'url':parts[6],'line':+parts[1],'column':+parts[2],'func':parts[3]||parts[4],'args':parts[5]?parts[5].split(','):[]};}
if(element){if(!element.func&&element.line){element.func=guessFunctionName(element.url,element.line);}
if(element.line){try{element.context=gatherContext(element.url,element.line);}catch(exc){}}
if(!element.context){element.context=[lines[line+1]];}
stack.push(element);}}
if(!stack.length){return null;}
return{'mode':'stacktrace','name':ex.name,'message':ex.message,'stack':stack};}
function computeStackTraceFromOperaMultiLineMessage(ex){var lines=ex.message.split('\n');if(lines.length<4){return null;}
var lineRE1=/^\s*Line (\d+) of linked script ((?:file|https?|blob)\S+)(?:: in function (\S+))?\s*$/i,lineRE2=/^\s*Line (\d+) of inline#(\d+) script in ((?:file|https?|blob)\S+)(?:: in function (\S+))?\s*$/i,lineRE3=/^\s*Line (\d+) of function script\s*$/i,stack=[],scripts=(window&&window.document&&window.document.getElementsByTagName('script')),inlineScriptBlocks=[],parts;for(var s in scripts){if(_has(scripts,s)&&!scripts[s].src){inlineScriptBlocks.push(scripts[s]);}}
for(var line=2;line<lines.length;line+=2){var item=null;if((parts=lineRE1.exec(lines[line]))){item={'url':parts[2],'func':parts[3],'args':[],'line':+parts[1],'column':null};}else if((parts=lineRE2.exec(lines[line]))){item={'url':parts[3],'func':parts[4],'args':[],'line':+parts[1],'column':null};var relativeLine=(+parts[1]);var script=inlineScriptBlocks[parts[2]-1];if(script){var source=getSource(item.url);if(source){source=source.join('\n');var pos=source.indexOf(script.innerText);if(pos>=0){item.line=relativeLine+source.substring(0,pos).split('\n').length;}}}}else if((parts=lineRE3.exec(lines[line]))){var url=window.location.href.replace(/#.*$/,'');var re=new RegExp(escapeCodeAsRegExpForMatchingInsideHTML(lines[line+1]));var src=findSourceInUrls(re,[url]);item={'url':url,'func':'','args':[],'line':src?src.line:parts[1],'column':null};}
if(item){if(!item.func){item.func=guessFunctionName(item.url,item.line);}
var context=gatherContext(item.url,item.line);var midline=(context?context[Math.floor(context.length/2)]:null);if(context&&midline.replace(/^\s*/,'')===lines[line+1].replace(/^\s*/,'')){item.context=context;}else{item.context=[lines[line+1]];}
stack.push(item);}}
if(!stack.length){return null;}
return{'mode':'multiline','name':ex.name,'message':lines[0],'stack':stack};}
function augmentStackTraceWithInitialElement(stackInfo,url,lineNo,message){var initial={'url':url,'line':lineNo};if(initial.url&&initial.line){stackInfo.incomplete=false;if(!initial.func){initial.func=guessFunctionName(initial.url,initial.line);}
if(!initial.context){initial.context=gatherContext(initial.url,initial.line);}
var reference=/ '([^']+)' /.exec(message);if(reference){initial.column=findSourceInLine(reference[1],initial.url,initial.line);}
if(stackInfo.stack.length>0){if(stackInfo.stack[0].url===initial.url){if(stackInfo.stack[0].line===initial.line){return false;}else if(!stackInfo.stack[0].line&&stackInfo.stack[0].func===initial.func){stackInfo.stack[0].line=initial.line;stackInfo.stack[0].context=initial.context;return false;}}}
stackInfo.stack.unshift(initial);stackInfo.partial=true;return true;}else{stackInfo.incomplete=true;}
return false;}
function computeStackTraceByWalkingCallerChain(ex,depth){var functionName=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,stack=[],funcs={},recursion=false,parts,item,source;for(var curr=computeStackTraceByWalkingCallerChain.caller;curr&&!recursion;curr=curr.caller){if(curr===computeStackTrace||curr===TraceKit.report){continue;}
item={'url':null,'func':UNKNOWN_FUNCTION,'args':[],'line':null,'column':null};if(curr.name){item.func=curr.name;}else if((parts=functionName.exec(curr.toString()))){item.func=parts[1];}
if(typeof item.func==='undefined'){try{item.func=parts.input.substring(0,parts.input.indexOf('{'));}catch(e){}}
if((source=findSourceByFunctionBody(curr))){item.url=source.url;item.line=source.line;if(item.func===UNKNOWN_FUNCTION){item.func=guessFunctionName(item.url,item.line);}
var reference=/ '([^']+)' /.exec(ex.message||ex.description);if(reference){item.column=findSourceInLine(reference[1],source.url,source.line);}}
if(funcs[''+curr]){recursion=true;}else{funcs[''+curr]=true;}
stack.push(item);}
if(depth){stack.splice(0,depth);}
var result={'mode':'callers','name':ex.name,'message':ex.message,'stack':stack};augmentStackTraceWithInitialElement(result,ex.sourceURL||ex.fileName,ex.line||ex.lineNumber,ex.message||ex.description);return result;}
function computeStackTrace(ex,depth){var stack=null;depth=(depth==null?0:+depth);try{stack=computeStackTraceFromStacktraceProp(ex);if(stack){if(_has(ex,'bidder')){stack.bidder=ex.bidder;}
return stack;}}catch(e){if(debug){throw e;}}
try{stack=computeStackTraceFromStackProp(ex);if(stack){if(_has(ex,'bidder')){stack.bidder=ex.bidder;}
return stack;}}catch(e){if(debug){throw e;}}
try{stack=computeStackTraceFromOperaMultiLineMessage(ex);if(stack){if(_has(ex,'bidder')){stack.bidder=ex.bidder;}
return stack;}}catch(e){if(debug){throw e;}}
try{stack=computeStackTraceByWalkingCallerChain(ex,depth+1);if(stack){if(_has(ex,'bidder')){stack.bidder=ex.bidder;}
return stack;}}catch(e){if(debug){throw e;}}
return{'name':ex.name,'message':ex.message,'mode':'failed'};}
function computeStackTraceOfCaller(depth){depth=(depth==null?0:+depth)+1;try{throw new Error();}catch(ex){return computeStackTrace(ex,depth+1);}}
computeStackTrace.augmentStackTraceWithInitialElement=augmentStackTraceWithInitialElement;computeStackTrace.computeStackTraceFromStackProp=computeStackTraceFromStackProp;computeStackTrace.guessFunctionName=guessFunctionName;computeStackTrace.gatherContext=gatherContext;computeStackTrace.ofCaller=computeStackTraceOfCaller;computeStackTrace.getSource=getSource;return computeStackTrace;}());TraceKit.extendToAsynchronousCallbacks=function(){var _helper=function _helper(fnName){var originalFn=window[fnName];window[fnName]=function traceKitAsyncExtension(){var args=_slice.call(arguments);var originalCallback=args[0];if(typeof(originalCallback)==='function'){args[0]=TraceKit.wrap(originalCallback);}
if(originalFn.apply){return originalFn.apply(this,args);}else{return originalFn(args[0],args[1]);}};};_helper('setTimeout');_helper('setInterval');};TraceKit.defaultSendError=function(error){'use strict';try{if(!error.stack){error.stack=(new Error('force-added stack')).stack;if(error.stack){error.stack=error.stack.toString();}}
if(!error.name){error.name='Unknown';}
if(!error.message){error.message='Unknown';}}catch(e){console.error("Error building error data");console.error(e);}
try{var postData={'client_timestamp':new Date().getTime(),'event_id':'','page_id':'','session_id':'','bidder':'','user_id':'','publisher':'','rtp_file_version':'','ad_project_tag':'','page_url':window.top.location.href||window.location.href||'','in_iframe':false,'is_https':('https:'==document.location.protocol)?true:false,'user_agent':navigator.userAgent||'','stack_trace':JSON.stringify(error.stack),'error_message':error.message.toString(),'error_name':error.name.toString()}
if(postData&&typeof(postData)==='object'){var y='',z=encodeURIComponent;for(var x in postData){y+='&'+z(x)+'='+z(postData[x]);}
postData=y.slice(1);}
var xhr=null;if(window.ActiveXObject){xhr=new ActiveXObject('Microsoft.XMLHTTP');}else if(window.XMLHttpRequest){xhr=new XMLHttpRequest();}
var request_url='https://events.proper.io/api/event';xhr.open("POST",request_url,1);xhr.withCredentials=false;xhr.timeout=2000;xhr.onload=function(){if(xhr.status==200){}else{console.error("Error sending exception data. xhr.status: "+xhr.status);}}
xhr.send(postData);}catch(e){console.error("Error sending exception data");console.error(e);}}
TraceKit.report.subscribe(TraceKit.defaultSendError);if(!TraceKit.remoteFetching){TraceKit.remoteFetching=false;}
if(!TraceKit.collectWindowErrors){TraceKit.collectWindowErrors=false;}
if(!TraceKit.linesOfContext||TraceKit.linesOfContext<1){TraceKit.linesOfContext=11;}
window.top.TraceKit=TraceKit;}(typeof window!=='undefined'?window:global));var ProperMedia=ProperMedia||{};ProperMedia.utils=(function(win,document){var TraceKit=window.top.TraceKit;function b64EncodeUnicode(str){return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,function toSolidBytes(match,p1){return String.fromCharCode('0x'+p1);}));}
function b64DecodeUnicode(str){return decodeURIComponent(atob(str).split('').map(function(c){return '%'+('00'+c.charCodeAt(0).toString(16)).slice(-2);}).join(''));}
function isBase64(str){try{return b64EncodeUnicode(b64DecodeUnicode(str))==str;}catch(err){return false;}}
function getDNT(){return navigator.doNotTrack==='1'||window.doNotTrack==='1'||navigator.msDoNoTrack==='1'||navigator.doNotTrack==='yes';}
function extractSlotName(identifier){try{var parts=identifier.replace(/^proper-ad-/,'').split('-');return parts[0];}catch(e){return false;}}
function safeJsonParse(json){try{return JSON.parse(json);}catch(e){console.error(e);}
return null;}
function indexOfObjectInArray(array,object){if(typeof object==='object'&&typeof array==='object'){object=JSON.stringify(object);for(var i=0;i<array.length;i++){if(typeof array[i]==='object'&&JSON.stringify(array[i])===object){return i;}}}
return-1;}
var properSetTimeout={selfCheck:true,setTimeout:function(vCallback,nDelay){var scope=typeof this.selfCheck!=='undefined'?window:this;var aArgs=Array.prototype.slice.call(arguments,2);if(nDelay>0){return window.setTimeout(function(){TraceKit.wrap(vCallback).apply(scope,aArgs);},nDelay);}else{TraceKit.wrap(vCallback).apply(scope,aArgs);return null;}},};var properSetInterval={selfCheck:true,setInterval:function(vCallback,nDelay){var scope=typeof this.selfCheck!=='undefined'?window:this;var aArgs=Array.prototype.slice.call(arguments,2);if(nDelay>0){return window.setInterval(function(){TraceKit.wrap(vCallback).apply(scope,aArgs);},nDelay);}else{TraceKit.wrap(vCallback).apply(scope,aArgs);return null;}},};function onElementHeightChange(elm,callback){var lastHeight=deepAccess(elm,'contentWindow.document.body.scrollHeight')||0,newHeight=deepAccess(elm,'contentWindow.document.body.scrollHeight')||0,count=0,max_count=10,iframe_def_height=150;function runElementHeightChange(){newHeight=deepAccess(elm,'contentWindow.document.body.scrollHeight')||0;if((lastHeight!=newHeight&&newHeight!=iframe_def_height)||count>=max_count){if(elm.onElementHeightChangeTimer){clearTimeout(elm.onElementHeightChangeTimer);}
callback(newHeight);return;}
lastHeight=newHeight;count++;if(elm.onElementHeightChangeTimer){clearTimeout(elm.onElementHeightChangeTimer);}
elm.onElementHeightChangeTimer=properSetTimeout.setTimeout(runElementHeightChange,200);}
runElementHeightChange();}
function mergeObject(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.hasOwn(source,key)){target[key]=source[key];}}}
return target;}
function mergeDeep(target,...sources){if(!sources.length)return target;var source=sources.shift();if(isPlainObject(target)&&isPlainObject(source)){for(const key in source){if(isPlainObject(source[key])){if(!target[key])Object.assign(target,{[key]:{}});mergeDeep(target[key],source[key]);}else if(isArray(source[key])){if(!target[key]){Object.assign(target,{[key]:source[key]});}else if(isArray(target[key])){target[key]=target[key].concat(source[key]);}}else{Object.assign(target,{[key]:source[key]});}}}
return mergeDeep(target,...sources);}
function deepCopy(obj){try{return JSON.parse(JSON.stringify(obj||{}));}catch(e){console.error(e);}
return null;}
function deepAccess(obj,path){if(!obj){return;}
path=String(path).split('.');for(var i=0;i<path.length;i++){obj=obj[path[i]];if(typeof obj==='undefined'||obj==null){return;}}
return obj;}
function deepSetValue(obj,path,value){var i;path=path.split('.');for(i=0;i<path.length-1;i++){if(i!==path.length-1&&typeof obj[path[i]]==='undefined'){obj[path[i]]={};}
obj=obj[path[i]];}
obj[path[i]]=value;}
var tArr='Array',tStr='String',tFn='Function',tNumb='Number',tObject='Object',tBoolean='Boolean',toString=Object.prototype.toString;function isA(object,_t){return toString.call(object)==='[object '+_t+']';}
function isFn(object){return isA(object,tFn);}
function isStr(object){return isA(object,tStr);}
function isArray(object){return isA(object,tArr);}
function isNumber(object){return isA(object,tNumb);}
function isPlainObject(object){return isA(object,tObject);}
function isBoolean(object){return isA(object,tBoolean);}
function formatSupplyChainString(schain){var ver=schain.ver||'1.0',complete=schain.complete||0,nodes=schain.nodes||[];var supplyChainObject=[ver.toString(),complete];var supplyChainString=supplyChainObject.join(',');if(isArray(nodes)){for(var i=0;i<nodes.length;i++){var asi=nodes[i].asi||'proper.io',sid=nodes[i].sid||'',hp=nodes[i].hp||1;var supplyChainNode=[asi,sid,hp];supplyChainString+='!'+supplyChainNode.join(',');}}else{supplyChainNode=['proper.io','',1];supplyChainString+='!'+supplyChainNode.join(',');}
return supplyChainString;}
function isIFrame(){try{return window.self!==window.top;}catch(e){return true;}}
function getPageRefreshed(){try{if(performance&&performance.navigation){return performance.navigation.type===performance.navigation.TYPE_RELOAD;}}catch(e){}
return false;}
function formatQueryString(data,cache){if(data&&typeof data==='object'){var y='',e=encodeURIComponent;for(x in data){if(Object.hasOwn(data,x)){if(data[x]){y+='&'+e(x)+'='+e(data[x]);}}}
data=y.slice(1)+(!cache?'&_t='+new Date():'');}
return data;}
function getCanonicalUrl(){try{return document.querySelector("link[rel='canonical']").href;}catch(e){return '';}}
function getPageUrl(){try{return window.top.location.href;}catch(e){return window.location.href;}}
function getPageDomain(){try{return window.location.hostname.replace(/^www\./,'');}catch(e){return '';}}
function getRootDomain(){try{return window.top.location.hostname.split('.').reverse().splice(0,2).reverse().join('.');}catch(e){return '';}}
function getPageReferrer(){try{return document.referrer;}catch(e){return '';}}
function matchDomain(domain,url){if(url.indexOf('/')!==-1){var a=url.split('/');if(typeof a[2]!=='undefined')url=a[2];}
if(url.indexOf('?')!==-1){var b=url.split('?');if(typeof b[0]!=='undefined')url=b[0];}
if(domain==url)return true;if(endsWith(domain,'.'+url)==true)return true;if(endsWith(url,'.'+domain)==true)return true;return false;}
function endsWith(str,suffix){return str.indexOf(suffix,str.length-suffix.length)!==-1;}
function getPagePath(){try{return window.top.location.pathname;}catch(e){return window.location.pathname;}}
function checkOutOfPage(ad_unit){var suffix='_oop';return ad_unit.toLowerCase().indexOf(suffix,ad_unit.length-suffix.length)!==-1;}
function isIOS(){var iDevices=['iPad Simulator','iPhone Simulator','iPod Simulator','iPad','iPhone','iPod'];if(navigator.platform){while(iDevices.length){if(navigator.platform===iDevices.pop()){return true;}}}
return false;}
function getUrlParameters(url){var data=decodeURIComponent(url).split('&');var res={};for(var i=0;i<data.length;i++){var parm=data[i].split('=');res[parm[0]]=parm[1];}
return res;}
function checkCookieSupport(){if(window.navigator.cookieEnabled||!!document.cookie.length){return true;}}
function getTimestampMs(){var d=new Date();return d.getTime();}
function getTimePassed(t1,t2){if(!t2){var d=new Date();t2=d.getTime();}
return t2-t1;}
function calcResponseMs(start,finish){return start>0&&finish>0&&finish>start?finish-start:-1;}
function formatDate(){now=new Date();year=''+now.getFullYear();month=''+(now.getMonth()+1);if(month.length==1){month='0'+month;}
day=''+now.getDate();if(day.length==1){day='0'+day;}
hour=''+now.getHours();if(hour.length==1){hour='0'+hour;}
minute=''+now.getMinutes();if(minute.length==1){minute='0'+minute;}
second=''+now.getSeconds();if(second.length==1){second='0'+second;}
return year+'-'+month+'-'+day+' '+hour+':'+minute+':'+second;}
function checkData(arr){if(typeof arr=='undefined'||(!(arr instanceof Array)&&!(arr instanceof Object)))arr=[];return arr;}
function generateUUID(){var d=new Date().getTime();if(window.performance&&typeof window.performance.now==='function'){d+=performance.now();}
var uuid='xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(c){var r=(d+Math.random()*16)%16|0;d=Math.floor(d/16);return(c=='x'?r:(r&0x3)|0x8).toString(16);});return uuid;}
function makeid(length){var result='';var characters='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';var charactersLength=characters.length;for(var i=0;i<length;i++){result+=characters.charAt(Math.floor(Math.random()*charactersLength));}
return result;}
function validateValue(variable,validation_rules){let default_val;if(validation_rules['type']==='string'){default_val=typeof validation_rules['default_val']==='string'?validation_rules['default_val']:'';var max_len=typeof validation_rules['max_len']==='number'?validation_rules['max_len']:256;var min_len=typeof validation_rules['min_len']==='number'?validation_rules['min_len']:0;if(typeof variable==='number'){variable=variable.toString();}
if(typeof variable!=='string'){variable=default_val;}
if(variable.length>max_len){variable=variable.substring(0,max_len);}}else if(validation_rules['type']==='number'){default_val=typeof validation_rules['default_val']==='number'?validation_rules['default_val']:0;var max=typeof validation_rules['max']==='number'?validation_rules['max']:99999;var min=typeof validation_rules['min']==='number'?validation_rules['min']:0;if(typeof variable==='string'&&/^(\d+)?(\.\d+)$/.test(variable)){variable=variable.indexOf('.')>-1?parseFloat(variable):parseInt(variable);}
if(typeof variable!=='number'){variable=default_val;}
if(variable>max){variable=max;}
if(variable<min){variable=min;}}else if(validation_rules['type']==='boolean'){default_val=typeof validation_rules['default_val']==='boolean'?validation_rules['default_val']:false;if(typeof variable==='number'){if(variable===0){variable=false;}else if(variable===1){variable=true;}}else if(typeof variable==='string'){if(variable==='false'||variable==='0'){variable=false;}else if(variable==='true'||variable==='1'){variable=true;}}
if(typeof variable!=='boolean'){variable=default_val;}}
return variable;}
function round(value,decimals){return Number(Math.round(value+'e'+decimals)+'e-'+decimals);}
function objectValues(obj){try{return Object.keys(obj).map(function(e){return obj[e];});}catch(e){return[];}}
function sortProperties(obj,sortedBy,isNumericSort,reverse){sortedBy=sortedBy||1;isNumericSort=isNumericSort||false;reverse=reverse||false;var reversed=reverse?-1:1;var sortable=[];for(const key in obj){if(Object.hasOwn(obj,key)){sortable.push([key,obj[key]]);}}
if(isNumericSort){sortable.sort(function(a,b){return reversed*(a[1][sortedBy]-b[1][sortedBy]);});}else{sortable.sort(function(a,b){var x=a[1][sortedBy].toLowerCase(),y=b[1][sortedBy].toLowerCase();return x<y?reversed*-1:x>y?reversed:0;});}
var newObject={};for(var i=0;i<sortable.length;i++){var key=sortable[i][0];var value=sortable[i][1];newObject[key]=value;}
return newObject;}
function parseVastVpaid(adtag){return{vast_type:adtag.match(/^http(s)?:\/\//gi)?'url':'tag',vpaid:!!adtag.match(/vpaid/gi),};}
function triggerPixel(url,done){var img=new Image();if(done&&isFn(done)){img.addEventListener('load',done);img.addEventListener('error',done);}
img.src=url;}
function createTrackPixel(nurl){return '<img src="'+nurl+'" width="1px" height="1px" style="display:none">';}
function insertHtmlIntoIframe(htmlCode){if(!htmlCode){return;}
var iframe=document.createElement('iframe');iframe.id=generateUUID();iframe.width=0;iframe.height=0;iframe.hspace='0';iframe.vspace='0';iframe.marginWidth='0';iframe.marginHeight='0';iframe.style.display='none';iframe.style.height='0px';iframe.style.width='0px';iframe.scrolling='no';iframe.frameBorder='0';iframe.allowtransparency='true';internal.insertElement(iframe,document,'body');iframe.contentWindow.document.open();iframe.contentWindow.document.write(htmlCode);iframe.contentWindow.document.close();}
function insertElement(elm,doc,target,asLastChildChild){doc=doc||document;var parentEl;if(target){parentEl=doc.getElementsByTagName(target);}else{parentEl=doc.getElementsByTagName('head');}
try{parentEl=parentEl.length?parentEl:doc.getElementsByTagName('body');if(parentEl.length){parentEl=parentEl[0];var insertBeforeEl=asLastChildChild?null:parentEl.firstChild;return parentEl.insertBefore(elm,insertBeforeEl);}}catch(e){}}
function getHeightAndWidth(slotSize){const heightxwidth=slotSize.split('x');if(heightxwidth.length===2&&!isNaN(parseInt(heightxwidth[0]))&&!isNaN(parseInt(heightxwidth[1]))&&heightxwidth.every((n)=>n>2))
return heightxwidth;else return '';}
if(!Object.keys){Object.keys=(function(){'use strict';var hasOwnProperty=Object.prototype.hasOwnProperty,hasDontEnumBug=!{toString:null}.propertyIsEnumerable('toString'),dontEnums=['toString','toLocaleString','valueOf','hasOwnProperty','isPrototypeOf','propertyIsEnumerable','constructor'],dontEnumsLength=dontEnums.length;return function(obj){if(typeof obj!=='object'&&(typeof obj!=='function'||obj===null)){throw new TypeError('Object.keys called on non-object');}
var result=[],prop,i;for(prop in obj){if(hasOwnProperty.call(obj,prop)){result.push(prop);}}
if(hasDontEnumBug){for(i=0;i<dontEnumsLength;i++){if(hasOwnProperty.call(obj,dontEnums[i])){result.push(dontEnums[i]);}}}
return result;};})();}
if(!deepAccess(window,'CSS.escape')){if(!window.CSS){window.CSS={};}
window.CSS.escape=function(value){if(arguments.length==0){throw new TypeError('`CSS.escape` requires an argument.');}
var string=String(value);var length=string.length;var index=-1;var codeUnit;var result='';var firstCodeUnit=string.charCodeAt(0);while(++index<length){codeUnit=string.charCodeAt(index);if(codeUnit==0x0000){result+='\uFFFD';continue;}
if((codeUnit>=0x0001&&codeUnit<=0x001f)||codeUnit==0x007f||(index==0&&codeUnit>=0x0030&&codeUnit<=0x0039)||(index==1&&codeUnit>=0x0030&&codeUnit<=0x0039&&firstCodeUnit==0x002d)){result+='\\'+codeUnit.toString(16)+' ';continue;}
if(index==0&&length==1&&codeUnit==0x002d){result+='\\'+string.charAt(index);continue;}
if(codeUnit>=0x0080||codeUnit==0x002d||codeUnit==0x005f||(codeUnit>=0x0030&&codeUnit<=0x0039)||(codeUnit>=0x0041&&codeUnit<=0x005a)||(codeUnit>=0x0061&&codeUnit<=0x007a)){result+=string.charAt(index);continue;}
result+='\\'+string.charAt(index);}
return result;};}
Object.filter=function(obj,predicate){var result={},key;for(key in obj){if(Object.hasOwn(obj,key)&&predicate(key)){result[key]=obj[key];}}
return result;};if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,'');};}
if(!String.prototype.includes){String.prototype.includes=function(search,start){'use strict';if(typeof start!=='number'){start=0;}
if(start+search.length>this.length){return false;}else{return this.indexOf(search,start)!==-1;}};}
Date.now=Date.now||function(){return+new Date();};if(!window.CustomEvent!=='function'){window.CustomEvent=function CustomEvent(event,params){params=params||{bubbles:false,cancelable:false,detail:null};var evt=document.createEvent('CustomEvent');evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail);return evt;};}
return{getDNT:getDNT,isBase64:isBase64,b64EncodeUnicode:b64EncodeUnicode,b64DecodeUnicode:b64DecodeUnicode,properSetTimeout:properSetTimeout,properSetInterval:properSetInterval,safeJsonParse:safeJsonParse,mergeObject:mergeObject,mergeDeep:mergeDeep,deepCopy:deepCopy,deepAccess:deepAccess,deepSetValue:deepSetValue,indexOfObjectInArray:indexOfObjectInArray,extractSlotName:extractSlotName,onElementHeightChange:onElementHeightChange,formatSupplyChainString:formatSupplyChainString,isIFrame:isIFrame,getRootDomain:getRootDomain,getCanonicalUrl:getCanonicalUrl,getPageRefreshed:getPageRefreshed,getPageUrl:getPageUrl,getPagePath:getPagePath,getPageDomain:getPageDomain,getPageReferrer:getPageReferrer,getUrlParameters:getUrlParameters,getTimestampMs:getTimestampMs,getTimePassed:getTimePassed,objectValues:objectValues,sortProperties:sortProperties,generateUUID:generateUUID,validateValue:validateValue,formatQueryString:formatQueryString,calcResponseMs:calcResponseMs,checkCookieSupport:checkCookieSupport,checkOutOfPage:checkOutOfPage,matchDomain:matchDomain,checkData:checkData,makeid:makeid,round:round,isFn:isFn,isStr:isStr,isArray:isArray,isNumber:isNumber,isPlainObject:isPlainObject,isBoolean:isBoolean,parseVastVpaid:parseVastVpaid,triggerPixel:triggerPixel,insertHtmlIntoIframe:insertHtmlIntoIframe,createTrackPixel:createTrackPixel,getHeightAndWidth:getHeightAndWidth,};})(window,document);var ProperMedia=ProperMedia||{};ProperMedia.jquery=(function(win,document){var TraceKit=window.top.TraceKit;var readyList=[];var readyFired=false;var readyEventHandlersInstalled=false;function ready(){if(!readyFired){readyFired=true;for(var i=0;i<readyList.length;i++){readyList[i].fn.call(win,readyList[i].ctx);}
readyList=[];}}
function readyStateChange(){if(document.readyState==='complete'){ready();}}
var docReady=function(callback,context){if(readyFired){ProperMedia.utils.properSetTimeout.setTimeout(function(){callback(context);},1);return;}else{readyList.push({fn:callback,ctx:context});}
if(document.readyState==='complete'){ProperMedia.utils.properSetTimeout.setTimeout(ready,1);}else if(!readyEventHandlersInstalled){if(document.addEventListener){document.addEventListener('DOMContentLoaded',TraceKit.wrap(ready),false);win.addEventListener('load',TraceKit.wrap(ready),false);}else{document.attachEvent('onreadystatechange',TraceKit.wrap(readyStateChange));win.attachEvent('onload',TraceKit.wrap(ready));}
readyEventHandlersInstalled=true;}};function setSseTimeout(timeout){sseTimeoutHandler=ProperMedia.utils.properSetTimeout.setTimeout(function(){var error=new Error('Server-Sent Events: timed out.');serverSentEventsError(error);},timeout||2000);}
var jquery_utils={obj:{},sel:function(val){if(typeof val==='function'){docReady(val);}else if(typeof val==='object')this.obj=val;else this.obj=document.querySelectorAll(val)[0];return this;},ready:function(func){docReady(func);return this;},remove:function(){if(typeof this.obj==='undefined')return false;this.obj.parentNode.removeChild(this.obj);return this;},hide:function(){if(typeof this.obj==='undefined')return false;this.obj.style.display='none';return this;},show:function(){if(typeof this.obj==='undefined')return false;this.obj.style.display='';return this;},addClass:function(className){if(typeof this.obj==='undefined')return false;var list=className.split(' ');for(var i=0;i<list.length;i++){if(this.obj.classList)this.obj.classList.add(list[i]);else this.obj.className+=' '+list[i];}
return this;},removeClass:function(className){if(typeof this.obj==='undefined')return false;if(this.obj.classList)this.obj.classList.remove(className);else{var newClassName='';var classes=this.className.split(' ');for(var i=0;i<classes.length;i++){if(classes[i]!==remove)newClassName+=classes[i]+' ';}
this.obj.className=newClassName;}
return this;},hasClass:function(className){if(typeof this.obj==='undefined')return false;if(this.obj.classList){return this.obj.classList.contains(className);}else{var regex=new RegExp('(?:^|\\s)'+className+'(?!\\S)');return this.obj.className.match(regex)!==null?true:false;}},removeStyle:function(){if(typeof this.obj==='undefined')return false;this.obj.style='';return this;},attr:function(key,val){if(typeof this.obj==='undefined')return false;if(typeof val==='undefined'){if(typeof this.obj.getAttribute==='undefined')return null;else return this.obj.getAttribute(key);}else{if(typeof this.obj.setAttribute==='undefined')return false;else{this.obj.setAttribute(key,val);return this;}}},after:function(htmlString){if(typeof this.obj==='undefined')return false;this.obj.insertAdjacentHTML('afterend',htmlString);return this;},before:function(htmlString){if(typeof this.obj==='undefined')return false;this.obj.insertAdjacentHTML('beforebegin',htmlString);return this;},insideBefore:function(htmlString){if(typeof this.obj==='undefined')return false;this.obj.insertAdjacentHTML('afterbegin',htmlString);return this;},append:function(newObj){if(typeof this.obj==='undefined')return false;if(typeof newObj==='string'){this.obj.innerHTML=this.obj.innerHTML+newObj;}else this.obj.appendChild(newObj);return this;},html:function(htmlString){if(typeof this.obj==='undefined')return false;if(typeof htmlString!=='undefined'){this.obj.innerHTML=htmlString;return this;}else{return this.obj.innerHTML;}},parent:function(){if(typeof this.obj==='undefined')return false;this.obj=this.obj.parentNode;return this;},closest:function(className){if(typeof this.obj==='undefined'||!className)return false;while((this.obj=this.obj.parentNode)){if(typeof this.obj.classList!=='undefined'&&this.obj.classList.contains(className)){return this;}}
return false;},wrap:function(wrapper){if(typeof this.obj==='undefined'||typeof wrapper==='undefined')return false;this.obj.parentNode.insertBefore(wrapper,this.obj);wrapper.appendChild(this.obj);return this;},unwrap:function(){if(typeof this.obj==='undefined')return false;const parent=this.obj.parentNode;if(typeof parent!=='undefined')parent.replaceWith(...parent.childNodes);return this;},getChildNodes:function(){if(typeof this.obj==='undefined')return false;return this.obj.children;},val:function(text){if(typeof this.obj==='undefined')return false;if(typeof text==='undefined')return this.obj.value;else{this.obj.value=text;return this;}},on:function(type,func){if(typeof this.obj==='undefined')return false;func=TraceKit.wrap(func);if(type=='click'){this.obj.onclick=func;}else if(type=='mouseover'||type=='mouseenter'){this.obj.addEventListener('mouseover',func,false);}else if(type=='mouseout'||type=='mouseleave'){this.obj.addEventListener('mouseout',func,false);}else{this.obj.addEventListener(type,func);}
return this;},contents:function(){if(typeof this.obj==='undefined')return false;this.obj=this.obj.contentDocument?this.obj.contentDocument:this.obj.contentWindow.document;return this;},contentWin:function(){if(typeof this.obj==='undefined')return false;if(this.obj.contentWindow)this.obj=this.obj.contentWindow;else if(this.obj.contentDocument)this.obj=this.obj.contentDocument.defaultView;return this;},find:function(val){if(typeof this.obj==='undefined')return false;this.obj=this.obj.querySelectorAll(val)[0];return this;},width:function(){return document.documentElement.clientWidth;},height:function(){return document.documentElement.clientHeight;},prev:function(){if(typeof this.obj==='undefined')return false;this.obj=this.obj.previousElementSibling;return this;},prop:function(type,val){if(typeof this.obj==='undefined')return false;this.obj.checked=val;return this;},};var jquery=function(val){return jquery_utils.sel(val);};jquery.window=window;jquery.createAuctionIframe=function(){try{if(!document.getElementById('proper-auction-iframe')){var ifr=document.createElement('iframe');ifr.id='proper-auction-iframe';ifr.frameborder='0';ifr.allowtransparency='true';ifr.marginheight='0';ifr.marginwidth='0';ifr.width='0';ifr.hspace='0';ifr.vspace='0';ifr.height='0';ifr.scrolling='no';ifr.style.display='none';ifr.style.width='0';ifr.style.height='0';ifr.sandbox='allow-scripts allow-same-origin';document.body.appendChild(ifr);jquery.window=ifr.contentWindow;}}catch(e){jquery.window=window;console.error(e);}};var req_id=0;var request_count=0;var bidder_req_cnt=0;var error_count=0;var wsTimeoutHandler=null;jquery.websocket=function(params){try{var wsTimeoutHandler=null;var websocket=new WebSocket(params.url);if(!websocket){var error=new Error("WebSocket: Server didn't accept WebSocket");websocketError(error);}
websocket.addEventListener('open',function(){websocket.send(params.data);});websocket.addEventListener('message',function(message){request_count++;if(params.bidder){bidder_req_cnt++;}
params.success(message.data);});websocket.addEventListener('close',function(message){clearTimeout(wsTimeoutHandler);});websocket.addEventListener('error',function(message){clearTimeout(wsTimeoutHandler);if(params.bidder){incrementErrorCount();}
var error=new Error('WebSocket: Something went wrong with the WebSocket. '+JSON.stringify(message,['message','name']));websocketError(error);});wsTimeoutHandler=ProperMedia.utils.properSetTimeout.setTimeout(function(){var error=new Error('WebSocket: timed out.');websocketError(error);},params.timeout||2000);}catch(error){websocketError(error);}
function websocketError(error){websocket.close();clearTimeout(wsTimeoutHandler);properSpecialOps.s2s_websockets=false;ProperMedia.ad_project.sendError(error);return;}};jquery.serverSentEvents=function(params){try{var sseTimeoutHandler=null;var sse_start_ts=ProperMedia.utils.getTimestampMs();var evtSource=new EventSource(params.url+'?data='+params.data,{withCredentials:true});evtSource.onmessage=function(message){if(params.timeout-ProperMedia.utils.getTimePassed(sse_start_ts)<100){sse_start_ts=ProperMedia.utils.getTimestampMs();clearTimeout(sseTimeoutHandler);setSseTimeout(100);}
request_count++;params.success(message.data);};evtSource.onopen=function(){console.log('Server-Sent Events: Opened');};evtSource.onerror=function(message){console.log('Server-Sent Events: Something went wrong. '+JSON.stringify(message,['message','name']));clearTimeout(sseTimeoutHandler);incrementErrorCount();var error=new Error('Server-Sent Events: Something went wrong. '+JSON.stringify(message,['message','name']));serverSentEventsError(error);};setSseTimeout(params.timeout);}catch(error){console.error(error);clearTimeout(sseTimeoutHandler);serverSentEventsError(error);}
function serverSentEventsError(error){evtSource.close();properSpecialOps.s2s_sse=false;ProperMedia.ad_project.sendError(error);return;}};jquery.ajax=function(parms){var url=parms.url||'',callback=parms.success||function(){},errFunc=parms.error||function(){},onloadFn=parms.onload||false,cache=parms.cache||false,data=parms.data||{},headers=parms.headers||{},method=parms.method||'GET',special=parms.special||'',contentType=parms.contentType||'',requestType=parms.requestType||'cors',timeout=parms.timeout||3000,edge=parms.edge||false,websocket=parms.websocket||false,sse=parms.sse||false,bidder=parms.bidder||'',withCredentials=typeof parms.withCredentials==='boolean'?parms.withCredentials:true;if(typeof TraceKit!=='undefined'){callback=TraceKit.wrap(callback);errFunc=TraceKit.wrap(errFunc);}
if(websocket){jquery.websocket(parms);}else if(sse){jquery.serverSentEvents(parms);}else if(requestType=='jsonp'){req_id++;request_count++;if(bidder){bidder_req_cnt++;}
if(callback){var separator='&';var mycallback='proper_'+guid()+'_'+req_id;jquery.window[mycallback]=function(e){callback(e);};var cname='callback';var callback_scope='window.';if(special&&special=='index'){cname='fn';}
url+=separator+cname+'='+callback_scope+mycallback;}
var script=jquery.window.document.createElement('script');script.async=true;script.src=url;if(onloadFn&&ProperMedia.utils.isFn(onloadFn)){script.onload=onloadFn();}
script.onerror=function(){if(bidder){bidderError({status:0});}
if(errFunc&&ProperMedia.utils.isFn(errFunc)){errFunc();}};jquery.window.document.getElementsByTagName('head')[0].appendChild(script);return true;}else{if(edge==true){var edge_request={url:url,name:bidder,method:method,payload:data,};edgeBidderObj.addRequest(edge_request,callback,errFunc);}else{var payload=ProperMedia.utils.formatQueryString(data);try{var xhr=null;if(jquery.window.ActiveXObject){xhr=new jquery.window.ActiveXObject('Microsoft.XMLHTTP');}else if(jquery.window.XMLHttpRequest){xhr=new jquery.window.XMLHttpRequest();}
xhr.open(method,url,1);if(requestType=='cors'){xhr.withCredentials=withCredentials;}else if(requestType=='fetch'){xhr.withCredentials=false;}
xhr.timeout=timeout;xhr.onload=function(){if(xhr.status==200){callback(xhr.responseText,xhr);}else{errFunc(xhr);if(bidder){bidderError(xhr);}}};xhr.onerror=function(){errFunc(xhr);if(bidder){bidderError(xhr);}};xhr.ontimeout=function(){errFunc(xhr);};for(var headerKey in headers){xhr.setRequestHeader(headerKey,headers[headerKey]);}
request_count++;if(bidder){bidder_req_cnt++;}
xhr.send(payload);}catch(e){errFunc({status:'error',statusText:e.message||'',timeout:timeout,});throw e;}}}};var bidderError=function(xhr){if(xhr.status==0){incrementErrorCount();}};var incrementErrorCount=function(){error_count++;checkErrorCount();};var checkErrorCount=function(){if(error_count>=30&&error_count/bidder_req_cnt>=0.69){ProperMedia.utils.deepSetValue(properSpecialOps,'adblock.detected',true);var event=new CustomEvent('proper-ad-requests-blocked',{});window.dispatchEvent(event);}};var edgeBidder=function(){var ENDPOINT_URL='https://eb.proper.io/v1/endpoint',timeout_handler=null,timeout_ms=250,max_batch_size=25,callback_map={},postData={bidders:[],cookies:{},};function addRequest(request,callback,errFunc){var callback_id=guid();callback_map[callback_id]={success:callback,error:errFunc,};var default_request={url:'',name:'',method:'',payload:{},callback_id:callback_id,};new_request=ProperMedia.utils.mergeObject(default_request,request);var cookie=ProperMedia.ad_project.cookieMatching.getBidderUserSyncValue(new_request.name+'_eb');if(cookie){postData.cookies[new_request.name+'_eb']=cookie;}
postData.bidders.push(new_request);if(postData.bidders.length>=max_batch_size){sendEdgeRequest();}else{clearTimeout(timeout_handler);timeout_handler=null;timeout_handler=ProperMedia.utils.properSetTimeout.setTimeout(sendEdgeRequest,timeout_ms);}}
function sendEdgeRequest(){clearTimeout(timeout_handler);timeout_handler=null;if(postData.bidders.length>0){jquery.ajax({url:ENDPOINT_URL,method:'POST',requestType:'cors',data:JSON.stringify(postData),success:function(resp){responses=ProperMedia.utils.safeJsonParse(resp);if(responses&&responses.bids&&responses.bids.length>0){for(var i=0;i<responses.bids.length;i++){var default_response={bidder:'',payload:{},callback_id:'',};var response=ProperMedia.utils.mergeObject(default_response,responses.bids[i]);if(typeof response.callback_id!=='undefined'&&typeof callback_map[response.callback_id]!=='undefined'&&typeof callback_map[response.callback_id].success=='function'){callback_map[response.callback_id].success(JSON.stringify(response.payload));delete callback_map[response.callback_id];}}}
if(response&&response.cookies){Object.keys(response.cookies).map(function(bidder){if(response.cookies[bidder]){cookieMatching.updateBidderUserSyncData(bidder,response.cookies[bidder]);}});}},error:function(e){console.error('HOLY SMOKES');},});postData={bidders:[],cookies:{},};}}
return{addRequest:addRequest,sendEdgeRequest:sendEdgeRequest,};};var edgeBidderObj=edgeBidder();function guid(){function s4(){return Math.floor((1+Math.random())*0x10000).toString(16).substring(1,5);}
return s4()+s4()+'_'+s4()+s4();}
return{$:jquery,};})(window,document);(function(window,undefined){'use strict';var LIBVERSION='0.7.31',EMPTY='',UNKNOWN='?',FUNC_TYPE='function',UNDEF_TYPE='undefined',OBJ_TYPE='object',STR_TYPE='string',MAJOR='major',MODEL='model',NAME='name',TYPE='type',VENDOR='vendor',VERSION='version',ARCHITECTURE='architecture',CONSOLE='console',MOBILE='mobile',TABLET='tablet',SMARTTV='smarttv',WEARABLE='wearable',EMBEDDED='embedded',UA_MAX_LENGTH=255;var AMAZON='Amazon',APPLE='Apple',ASUS='ASUS',BLACKBERRY='BlackBerry',BROWSER='Browser',CHROME='Chrome',EDGE='Edge',FIREFOX='Firefox',GOOGLE='Google',HUAWEI='Huawei',LG='LG',MICROSOFT='Microsoft',MOTOROLA='Motorola',OPERA='Opera',SAMSUNG='Samsung',SONY='Sony',XIAOMI='Xiaomi',ZEBRA='Zebra',FACEBOOK='Facebook';var extend=function(regexes,extensions){var mergedRegexes={};for(var i in regexes){if(extensions[i]&&extensions[i].length%2===0){mergedRegexes[i]=extensions[i].concat(regexes[i]);}else{mergedRegexes[i]=regexes[i];}}
return mergedRegexes;},enumerize=function(arr){var enums={};for(var i=0;i<arr.length;i++){enums[arr[i].toUpperCase()]=arr[i];}
return enums;},has=function(str1,str2){return typeof str1===STR_TYPE?lowerize(str2).indexOf(lowerize(str1))!==-1:false;},lowerize=function(str){return str.toLowerCase();},majorize=function(version){return typeof(version)===STR_TYPE?version.replace(/[^\d\.]/g,EMPTY).split('.')[0]:undefined;},trim=function(str,len){if(typeof(str)===STR_TYPE){str=str.replace(/^\s\s*/,EMPTY).replace(/\s\s*$/,EMPTY);return typeof(len)===UNDEF_TYPE?str:str.substring(0,UA_MAX_LENGTH);}};var rgxMapper=function(ua,arrays){var i=0,j,k,p,q,matches,match;while(i<arrays.length&&!matches){var regex=arrays[i],props=arrays[i+1];j=k=0;while(j<regex.length&&!matches){matches=regex[j++].exec(ua);if(!!matches){for(p=0;p<props.length;p++){match=matches[++k];q=props[p];if(typeof q===OBJ_TYPE&&q.length>0){if(q.length===2){if(typeof q[1]==FUNC_TYPE){this[q[0]]=q[1].call(this,match);}else{this[q[0]]=q[1];}}else if(q.length===3){if(typeof q[1]===FUNC_TYPE&&!(q[1].exec&&q[1].test)){this[q[0]]=match?q[1].call(this,match,q[2]):undefined;}else{this[q[0]]=match?match.replace(q[1],q[2]):undefined;}}else if(q.length===4){this[q[0]]=match?q[3].call(this,match.replace(q[1],q[2])):undefined;}}else{this[q]=match?match:undefined;}}}}
i+=2;}},strMapper=function(str,map){for(var i in map){if(typeof map[i]===OBJ_TYPE&&map[i].length>0){for(var j=0;j<map[i].length;j++){if(has(map[i][j],str)){return(i===UNKNOWN)?undefined:i;}}}else if(has(map[i],str)){return(i===UNKNOWN)?undefined:i;}}
return str;};var oldSafariMap={'1.0':'/8','1.2':'/1','1.3':'/3','2.0':'/412','2.0.2':'/416','2.0.3':'/417','2.0.4':'/419','?':'/'},windowsVersionMap={'ME':'4.90','NT 3.11':'NT3.51','NT 4.0':'NT4.0','2000':'NT 5.0','XP':['NT 5.1','NT 5.2'],'Vista':'NT 6.0','7':'NT 6.1','8':'NT 6.2','8.1':'NT 6.3','10':['NT 6.4','NT 10.0'],'RT':'ARM'};var regexes={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[VERSION,[NAME,'Chrome']],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[VERSION,[NAME,'Edge']],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[NAME,VERSION],[/opios[\/ ]+([\w\.]+)/i],[VERSION,[NAME,OPERA+' Mini']],[/\bopr\/([\w\.]+)/i],[VERSION,[NAME,OPERA]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[NAME,VERSION],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[VERSION,[NAME,'UC'+BROWSER]],[/\bqbcore\/([\w\.]+)/i],[VERSION,[NAME,'WeChat(Win) Desktop']],[/micromessenger\/([\w\.]+)/i],[VERSION,[NAME,'WeChat']],[/konqueror\/([\w\.]+)/i],[VERSION,[NAME,'Konqueror']],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[VERSION,[NAME,'IE']],[/yabrowser\/([\w\.]+)/i],[VERSION,[NAME,'Yandex']],[/(avast|avg)\/([\w\.]+)/i],[[NAME,/(.+)/,'$1 Secure '+BROWSER],VERSION],[/\bfocus\/([\w\.]+)/i],[VERSION,[NAME,FIREFOX+' Focus']],[/\bopt\/([\w\.]+)/i],[VERSION,[NAME,OPERA+' Touch']],[/coc_coc\w+\/([\w\.]+)/i],[VERSION,[NAME,'Coc Coc']],[/dolfin\/([\w\.]+)/i],[VERSION,[NAME,'Dolphin']],[/coast\/([\w\.]+)/i],[VERSION,[NAME,OPERA+' Coast']],[/miuibrowser\/([\w\.]+)/i],[VERSION,[NAME,'MIUI '+BROWSER]],[/fxios\/([-\w\.]+)/i],[VERSION,[NAME,FIREFOX]],[/\bqihu|(qi?ho?o?|360)browser/i],[[NAME,'360 '+BROWSER]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[NAME,/(.+)/,'$1 '+BROWSER],VERSION],[/(comodo_dragon)\/([\w\.]+)/i],[[NAME,/_/g,' '],VERSION],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[NAME,VERSION],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i],[NAME],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[NAME,FACEBOOK],VERSION],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[NAME,VERSION],[/\bgsa\/([\w\.]+) .*safari\//i],[VERSION,[NAME,'GSA']],[/headlesschrome(?:\/([\w\.]+)| )/i],[VERSION,[NAME,CHROME+' Headless']],[/ wv\).+(chrome)\/([\w\.]+)/i],[[NAME,CHROME+' WebView'],VERSION],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[VERSION,[NAME,'Android '+BROWSER]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[NAME,VERSION],[/version\/([\w\.]+) .*mobile\/\w+ (safari)/i],[VERSION,[NAME,'Mobile Safari']],[/version\/([\w\.]+) .*(mobile ?safari|safari)/i],[VERSION,NAME],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[NAME,[VERSION,strMapper,oldSafariMap]],[/(webkit|khtml)\/([\w\.]+)/i],[NAME,VERSION],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[NAME,'Netscape'],VERSION],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[VERSION,[NAME,FIREFOX+' Reality']],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[NAME,VERSION]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[ARCHITECTURE,'amd64']],[/(ia32(?=;))/i],[[ARCHITECTURE,lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[ARCHITECTURE,'ia32']],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[ARCHITECTURE,'arm64']],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[ARCHITECTURE,'armhf']],[/windows (ce|mobile); ppc;/i],[[ARCHITECTURE,'arm']],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[ARCHITECTURE,/ower/,EMPTY,lowerize]],[/(sun4\w)[;\)]/i],[[ARCHITECTURE,'sparc']],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[ARCHITECTURE,lowerize]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[MODEL,[VENDOR,SAMSUNG],[TYPE,TABLET]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[MODEL,[VENDOR,SAMSUNG],[TYPE,MOBILE]],[/\((ip(?:hone|od)[\w ]*);/i],[MODEL,[VENDOR,APPLE],[TYPE,MOBILE]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[MODEL,[VENDOR,APPLE],[TYPE,TABLET]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[MODEL,[VENDOR,HUAWEI],[TYPE,TABLET]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}-[atu]?[ln][01259x][012359][an]?)\b(?!.+d\/s)/i],[MODEL,[VENDOR,HUAWEI],[TYPE,MOBILE]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[MODEL,/_/g,' '],[VENDOR,XIAOMI],[TYPE,MOBILE]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[MODEL,/_/g,' '],[VENDOR,XIAOMI],[TYPE,TABLET]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[MODEL,[VENDOR,'OPPO'],[TYPE,MOBILE]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[MODEL,[VENDOR,'Vivo'],[TYPE,MOBILE]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[MODEL,[VENDOR,'Realme'],[TYPE,MOBILE]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[MODEL,[VENDOR,MOTOROLA],[TYPE,MOBILE]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[MODEL,[VENDOR,MOTOROLA],[TYPE,TABLET]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[MODEL,[VENDOR,LG],[TYPE,TABLET]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[MODEL,[VENDOR,LG],[TYPE,MOBILE]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[MODEL,[VENDOR,'Lenovo'],[TYPE,TABLET]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[MODEL,/_/g,' '],[VENDOR,'Nokia'],[TYPE,MOBILE]],[/(pixel c)\b/i],[MODEL,[VENDOR,GOOGLE],[TYPE,TABLET]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[MODEL,[VENDOR,GOOGLE],[TYPE,MOBILE]],[/droid.+ ([c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[MODEL,[VENDOR,SONY],[TYPE,MOBILE]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[MODEL,'Xperia Tablet'],[VENDOR,SONY],[TYPE,TABLET]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[MODEL,[VENDOR,'OnePlus'],[TYPE,MOBILE]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[MODEL,[VENDOR,AMAZON],[TYPE,TABLET]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[MODEL,/(.+)/g,'Fire Phone $1'],[VENDOR,AMAZON],[TYPE,MOBILE]],[/(playbook);[-\w\),; ]+(rim)/i],[MODEL,VENDOR,[TYPE,TABLET]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[MODEL,[VENDOR,BLACKBERRY],[TYPE,MOBILE]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[MODEL,[VENDOR,ASUS],[TYPE,TABLET]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[MODEL,[VENDOR,ASUS],[TYPE,MOBILE]],[/(nexus 9)/i],[MODEL,[VENDOR,'HTC'],[TYPE,TABLET]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony)[-_ ]?([-\w]*)/i],[VENDOR,[MODEL,/_/g,' '],[TYPE,MOBILE]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[MODEL,[VENDOR,'Acer'],[TYPE,TABLET]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[MODEL,[VENDOR,'Meizu'],[TYPE,MOBILE]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[MODEL,[VENDOR,'Sharp'],[TYPE,MOBILE]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[VENDOR,MODEL,[TYPE,MOBILE]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[VENDOR,MODEL,[TYPE,TABLET]],[/(surface duo)/i],[MODEL,[VENDOR,MICROSOFT],[TYPE,TABLET]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[MODEL,[VENDOR,'Fairphone'],[TYPE,MOBILE]],[/(u304aa)/i],[MODEL,[VENDOR,'AT&T'],[TYPE,MOBILE]],[/\bsie-(\w*)/i],[MODEL,[VENDOR,'Siemens'],[TYPE,MOBILE]],[/\b(rct\w+) b/i],[MODEL,[VENDOR,'RCA'],[TYPE,TABLET]],[/\b(venue[\d ]{2,7}) b/i],[MODEL,[VENDOR,'Dell'],[TYPE,TABLET]],[/\b(q(?:mv|ta)\w+) b/i],[MODEL,[VENDOR,'Verizon'],[TYPE,TABLET]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[MODEL,[VENDOR,'Barnes & Noble'],[TYPE,TABLET]],[/\b(tm\d{3}\w+) b/i],[MODEL,[VENDOR,'NuVision'],[TYPE,TABLET]],[/\b(k88) b/i],[MODEL,[VENDOR,'ZTE'],[TYPE,TABLET]],[/\b(nx\d{3}j) b/i],[MODEL,[VENDOR,'ZTE'],[TYPE,MOBILE]],[/\b(gen\d{3}) b.+49h/i],[MODEL,[VENDOR,'Swiss'],[TYPE,MOBILE]],[/\b(zur\d{3}) b/i],[MODEL,[VENDOR,'Swiss'],[TYPE,TABLET]],[/\b((zeki)?tb.*\b) b/i],[MODEL,[VENDOR,'Zeki'],[TYPE,TABLET]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[VENDOR,'Dragon Touch'],MODEL,[TYPE,TABLET]],[/\b(ns-?\w{0,9}) b/i],[MODEL,[VENDOR,'Insignia'],[TYPE,TABLET]],[/\b((nxa|next)-?\w{0,9}) b/i],[MODEL,[VENDOR,'NextBook'],[TYPE,TABLET]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[VENDOR,'Voice'],MODEL,[TYPE,MOBILE]],[/\b(lvtel\-)?(v1[12]) b/i],[[VENDOR,'LvTel'],MODEL,[TYPE,MOBILE]],[/\b(ph-1) /i],[MODEL,[VENDOR,'Essential'],[TYPE,MOBILE]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[MODEL,[VENDOR,'Envizen'],[TYPE,TABLET]],[/\b(trio[-\w\. ]+) b/i],[MODEL,[VENDOR,'MachSpeed'],[TYPE,TABLET]],[/\btu_(1491) b/i],[MODEL,[VENDOR,'Rotor'],[TYPE,TABLET]],[/(shield[\w ]+) b/i],[MODEL,[VENDOR,'Nvidia'],[TYPE,TABLET]],[/(sprint) (\w+)/i],[VENDOR,MODEL,[TYPE,MOBILE]],[/(kin\.[onetw]{3})/i],[[MODEL,/\./g,' '],[VENDOR,MICROSOFT],[TYPE,MOBILE]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[MODEL,[VENDOR,ZEBRA],[TYPE,TABLET]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[MODEL,[VENDOR,ZEBRA],[TYPE,MOBILE]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[VENDOR,MODEL,[TYPE,CONSOLE]],[/droid.+; (shield) bui/i],[MODEL,[VENDOR,'Nvidia'],[TYPE,CONSOLE]],[/(playstation [345portablevi]+)/i],[MODEL,[VENDOR,SONY],[TYPE,CONSOLE]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[MODEL,[VENDOR,MICROSOFT],[TYPE,CONSOLE]],[/smart-tv.+(samsung)/i],[VENDOR,[TYPE,SMARTTV]],[/hbbtv.+maple;(\d+)/i],[[MODEL,/^/,'SmartTV'],[VENDOR,SAMSUNG],[TYPE,SMARTTV]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[VENDOR,LG],[TYPE,SMARTTV]],[/(apple) ?tv/i],[VENDOR,[MODEL,APPLE+' TV'],[TYPE,SMARTTV]],[/crkey/i],[[MODEL,CHROME+'cast'],[VENDOR,GOOGLE],[TYPE,SMARTTV]],[/droid.+aft(\w)( bui|\))/i],[MODEL,[VENDOR,AMAZON],[TYPE,SMARTTV]],[/\(dtv[\);].+(aquos)/i],[MODEL,[VENDOR,'Sharp'],[TYPE,SMARTTV]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[VENDOR,trim],[MODEL,trim],[TYPE,SMARTTV]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[TYPE,SMARTTV]],[/((pebble))app/i],[VENDOR,MODEL,[TYPE,WEARABLE]],[/droid.+; (glass) \d/i],[MODEL,[VENDOR,GOOGLE],[TYPE,WEARABLE]],[/droid.+; (wt63?0{2,3})\)/i],[MODEL,[VENDOR,ZEBRA],[TYPE,WEARABLE]],[/(quest( 2)?)/i],[MODEL,[VENDOR,FACEBOOK],[TYPE,WEARABLE]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[VENDOR,[TYPE,EMBEDDED]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[MODEL,[TYPE,MOBILE]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[MODEL,[TYPE,TABLET]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[TYPE,TABLET]],[/(phone|mobile(?:[;\/]| safari)|pda(?=.+windows ce))/i],[[TYPE,MOBILE]],[/(android[-\w\. ]{0,9});.+buil/i],[MODEL,[VENDOR,'Generic']]],engine:[[/windows.+ edge\/([\w\.]+)/i],[VERSION,[NAME,EDGE+'HTML']],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[VERSION,[NAME,'Blink']],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[NAME,VERSION],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[VERSION,NAME]],os:[[/microsoft (windows) (vista|xp)/i],[NAME,VERSION],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[NAME,[VERSION,strMapper,windowsVersionMap]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[NAME,'Windows'],[VERSION,strMapper,windowsVersionMap]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[VERSION,/_/g,'.'],[NAME,'iOS']],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[NAME,'Mac OS'],[VERSION,/_/g,'.']],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[VERSION,NAME],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[NAME,VERSION],[/\(bb(10);/i],[VERSION,[NAME,BLACKBERRY]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[VERSION,[NAME,'Symbian']],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[VERSION,[NAME,FIREFOX+' OS']],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[VERSION,[NAME,'webOS']],[/crkey\/([\d\.]+)/i],[VERSION,[NAME,CHROME+'cast']],[/(cros) [\w]+ ([\w\.]+\w)/i],[[NAME,'Chromium OS'],VERSION],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[NAME,VERSION],[/(sunos) ?([\w\.\d]*)/i],[[NAME,'Solaris'],VERSION],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[NAME,VERSION]]};var UAParser=function(ua,extensions){if(typeof ua===OBJ_TYPE){extensions=ua;ua=undefined;}
if(!(this instanceof UAParser)){return new UAParser(ua,extensions).getResult();}
var _ua=ua||((typeof window!==UNDEF_TYPE&&window.navigator&&window.navigator.userAgent)?window.navigator.userAgent:EMPTY);var _rgxmap=extensions?extend(regexes,extensions):regexes;this.getBrowser=function(){var _browser={};_browser[NAME]=undefined;_browser[VERSION]=undefined;rgxMapper.call(_browser,_ua,_rgxmap.browser);_browser.major=majorize(_browser.version);return _browser;};this.getCPU=function(){var _cpu={};_cpu[ARCHITECTURE]=undefined;rgxMapper.call(_cpu,_ua,_rgxmap.cpu);return _cpu;};this.getDevice=function(){var _device={};_device[VENDOR]=undefined;_device[MODEL]=undefined;_device[TYPE]=undefined;rgxMapper.call(_device,_ua,_rgxmap.device);return _device;};this.getEngine=function(){var _engine={};_engine[NAME]=undefined;_engine[VERSION]=undefined;rgxMapper.call(_engine,_ua,_rgxmap.engine);return _engine;};this.getOS=function(){var _os={};_os[NAME]=undefined;_os[VERSION]=undefined;rgxMapper.call(_os,_ua,_rgxmap.os);return _os;};this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()};};this.getUA=function(){return _ua;};this.setUA=function(ua){_ua=(typeof ua===STR_TYPE&&ua.length>UA_MAX_LENGTH)?trim(ua,UA_MAX_LENGTH):ua;return this;};this.setUA(_ua);return this;};UAParser.VERSION=LIBVERSION;UAParser.BROWSER=enumerize([NAME,VERSION,MAJOR]);UAParser.CPU=enumerize([ARCHITECTURE]);UAParser.DEVICE=enumerize([MODEL,VENDOR,TYPE,CONSOLE,MOBILE,SMARTTV,TABLET,WEARABLE,EMBEDDED]);UAParser.ENGINE=UAParser.OS=enumerize([NAME,VERSION]);if(typeof(exports)!==UNDEF_TYPE){if(typeof module!==UNDEF_TYPE&&module.exports){exports=module.exports=UAParser;}
exports.UAParser=UAParser;}else{if(typeof(define)===FUNC_TYPE&&define.amd){define(function(){return UAParser;});}else if(typeof window!==UNDEF_TYPE){window.UAParser=UAParser;}}
var $=typeof window!==UNDEF_TYPE&&(window.jQuery||window.Zepto);if($&&!$.ua){var parser=new UAParser();$.ua=parser.getResult();$.ua.get=function(){return parser.getUA();};$.ua.set=function(ua){parser.setUA(ua);var result=parser.getResult();for(var prop in result){$.ua[prop]=result[prop];}};}})(typeof window==='object'?window:this);var properSpecialOps=properSpecialOps||{};var googletag=googletag||{};googletag.cmd=googletag.cmd||[];var propertag=propertag||{};propertag.cmd=propertag.cmd||[];var _qevents=_qevents||[];(function(){var elem=document.createElement('script');elem.src=(document.location.protocol=='https:'?'https://secure':'http://edge')+'.quantserve.com/quant.js';elem.async=true;elem.type='text/javascript';var scpt=document.getElementsByTagName('script')[0];scpt.parentNode.insertBefore(elem,scpt);})();try{_qevents.push({qacct:'p-mEzuYq24VEJ-3',});}catch(e){console.error('Error pushing Quantcast event');console.error(e);}
if(typeof console=='undefined'){console={log:function(m){},error:function(m){},info:function(m){},table:function(m){},};}
ProperMedia.ad_project=(function(win,document){var $=ProperMedia.jquery.$;var properSetTimeout=ProperMedia.utils.properSetTimeout;var properSetInterval=ProperMedia.utils.properSetInterval;var TraceKit=window.top.TraceKit;TraceKit.report.subscribe(sendError);TraceKit.report.unsubscribe(TraceKit.defaultSendError);function sendError(error){try{if(!error.stack){error.stack=new Error('force-added stack').stack;}
if(!error.name){error.name='Unknown';}
if(!error.message){error.message='Unknown';}}catch(e){console.error('Error building error data');console.error(e);}
try{var postData={client_timestamp:new Date().getTime(),event_type:error.event_type||'exception',event_id:ProperMedia.utils.generateUUID(),page_id:ProperMedia.utils.generateUUID(),session_id:ProperMedia.utils.generateUUID(),bidder:error.bidder||'',user_id:ProperMedia.utils.validateValue(properUser.pubcid,{type:'string'}),publisher:ProperMedia.utils.validateValue(properOps.site_name,{type:'string',default_val:'unknown',max_len:40,}),rtp_file_version:ProperMedia.utils.validateValue(properOps.rtp_file_version,{type:'string'}),ad_project_tag:ProperMedia.utils.validateValue(properOps.rtp_file_revision,{type:'string'}),page_url:ProperMedia.utils.getPageUrl()||'',in_iframe:false,is_https:'https:'==document.location.protocol?true:false,user_agent:navigator.userAgent||'',stack_trace:JSON.stringify(error.stack),error_message:error.message.toString()||'',error_name:error.name.toString()||'',};if(properPage.uuid&&properPage.uuid!==''){postData['page_id']=properPage.uuid;}
if(properSession&&properSession.sessionData&&properSession.sessionData.uuid&&properSession.sessionData.uuid!==''){postData['session_id']=properSession.sessionData.uuid;}
$.ajax({url:'https://events.proper.io/api/event',requestType:'fetch',method:'POST',data:JSON.stringify(postData),withCredentials:false,success:function(resp){console.log('Proper exception logged successfully.');},error:function(){console.error('Unable to log Proper exception.');},});}catch(e){console.error('Error sending exception data');console.error(e);}}
var storageObj=(function(){var moduleTypeWhiteList=['core'];function storageObj(){}
storageObj.prototype.isValid=function({gvlid,moduleName,bidderCode,moduleType}){if(moduleTypeWhiteList.indexOf(moduleType)!==-1){return true;}else{return!!gdprEnforcement.deviceAccessEnforcement(gvlid,bidderCode||moduleName);}}
storageObj.prototype.setCookie=function(key,value,expires,sameSite,domain,enforcementObj){if(this.isValid(enforcementObj)){var domainPortion=(domain&&domain!=='')?' ;domain='+encodeURIComponent(domain):'';var expiresPortion=(expires&&expires!=='')?' ;expires='+expires:'';var isNone=(sameSite!=null&&sameSite.toLowerCase()=='none');var secure=(isNone)?'; Secure':'';document.cookie=key+'='+encodeURIComponent(value)+expiresPortion+';path=/'+domainPortion+(sameSite?';SameSite='+sameSite:'')+secure;}};storageObj.prototype.deleteCookie=function(key,sameSite,domain,enforcementObj){var date=new Date();date.setTime(date.getTime()-(60*1000));var expires=date.toGMTString();this.setCookie(key,'',expires,sameSite,domain,enforcementObj);}
storageObj.prototype.getCookie=function(name,enforcementObj){if(this.isValid(enforcementObj)){var m=window.document.cookie.match('(^|;)\\s*'+name+'\\s*=\\s*([^;]*)\\s*(;|$)');return m?decodeURIComponent(m[2]):null;}
return null;};storageObj.prototype.localStorageIsEnabled=function(enforcementObj){if(this.isValid(enforcementObj)){try{localStorage.setItem('proper.cookieTest','1');return localStorage.getItem('proper.cookieTest')==='1';}catch(error){}finally{try{localStorage.removeItem('proper.cookieTest');}catch(error){}}}
return false;}
storageObj.prototype.cookiesAreEnabled=function(enforcementObj){if(this.isValid(enforcementObj)){if(ProperMedia.utils.checkCookieSupport()){return true;}
window.document.cookie='proper.cookieTest';return window.document.cookie.indexOf('proper.cookieTest')!==-1;}
return false;}
storageObj.prototype.setDataInLocalStorage=function(key,value,enforcementObj){if(this.isValid(enforcementObj)&&this.hasLocalStorage(enforcementObj)){window.localStorage.setItem(key,value);}}
storageObj.prototype.getDataFromLocalStorage=function(key,enforcementObj){if(this.isValid(enforcementObj)&&this.hasLocalStorage(enforcementObj)){return window.localStorage.getItem(key);}
return null;}
storageObj.prototype.removeDataFromLocalStorage=function(key,enforcementObj){if(this.isValid(enforcementObj)&&this.hasLocalStorage(enforcementObj)){window.localStorage.removeItem(key);}}
storageObj.prototype.hasLocalStorage=function(enforcementObj){if(this.isValid(enforcementObj)){try{return!!window.localStorage;}catch(e){properLog.mylog('Local storage api disabled');}}
return false;}
return storageObj;})();properStorage=new storageObj();var ViewabilityTracker=(function(){function ViewabilityTracker(){this.timer=null;this.elements={};this.supportsPassive=passiveEventSupport();this.activeTab=true;this.slotsInFetchZone=0;this.auctionCallback=null;consentManager.ready((function(){this.start();registerWindowViewabilityEventHandler(this);}).bind(this));}
ViewabilityTracker.prototype.addElement=function(settings,callback){if(settings.lazyload&&settings.fetchMarginPercent<settings.renderMarginPercent){sendError(new Error('Lazyload Fetch Margin has to be greater than or equal to Render Margin'));settings.fetchMarginPercent=settings.renderMarginPercent;}
var entry={"id":settings.id,"callback":callback,"lazyload":settings.lazyload||false,"viewability":settings.viewability||true,"autoDelete":settings.autoDelete||false,"fetchMarginPercent":settings.fetchMarginPercent||0,"renderMarginPercent":settings.renderMarginPercent||0,"autoDeleteMarginPercent":settings.autoDeleteMarginPercent||300,"minHeight":settings.minHeight||0,"activeTab":true,"viewable":false,"inFetchZone":false,"inRenderZone":false,"inDeleteZone":false};if(!entry.lazyload){this.incrementSlotsInFetchZone();}
this.elements[settings.id]=entry;if(this.started)this.runViewabilityCheck(entry.id);}
ViewabilityTracker.prototype.removeElement=function(id){if(this.elements[id]){this.killEntry(this.elements[id]);delete this.elements[id];}}
ViewabilityTracker.prototype.start=function(){this.activeTab=true;this.updateElelemtsActiveTab();var event=new CustomEvent('properActiveTab');window.dispatchEvent(event);if(this.started)return true;var obj=this;this.timer=properSetInterval.setInterval.call(obj,function(){Object.keys(obj.elements).forEach(function(id){obj.runViewabilityCheck(id);},obj);},200);this.started=true;}
ViewabilityTracker.prototype.stop=function(){clearInterval(this.timer);this.activeTab=false;this.updateElelemtsActiveTab();var event=new CustomEvent('properInactiveTab');window.dispatchEvent(event);Object.keys(this.elements).forEach(function(id){this.killEntry(this.elements[id]);},this);this.started=false;}
ViewabilityTracker.prototype.updateElelemtsActiveTab=function(){Object.keys(this.elements).forEach(function(id){this.elements[id].activeTab=this.activeTab;},this);}
ViewabilityTracker.prototype.runViewabilityCheck=function(id,forced){var entry=this.elements[id]||false;if(entry){var changed=false;if(entry.viewability){changed=isEntryViewableByArea(entry);}
if(entry.lazyload||entry.autoDelete){changed=this.checkMargins(entry)||changed;}
if(changed||forced){entry.callback(entry);}}}
ViewabilityTracker.prototype.calculateViewablePercentage=function(slot){var el=slot.getElement();if(el!==null){if(window.top.document.visibilityState==='visible'){var box=el.getBoundingClientRect();var intersects={};if(typeof box!=='undefined'){intersects.left=Math.max(box.left,0);intersects.right=Math.min(box.right,window.top.innerWidth);if(intersects.left>=intersects.right){return 0;}
intersects.top=Math.max(box.top,0);intersects.bottom=Math.min(box.bottom,window.top.innerHeight);if(intersects.top>=intersects.bottom){return 0;}
intersects.width=intersects.right-intersects.left;intersects.height=intersects.bottom-intersects.top;var elementInViewArea=intersects.width*intersects.height;var elementTotalArea=box.width*box.height;return((elementInViewArea/elementTotalArea)*100);}}else{return 0;}}
return 0;}
ViewabilityTracker.prototype.checkMargins=function(entry){entry.element=entry.element||document.getElementById(entry.id)
if(!entry.element)return false;var rect=entry.element.getBoundingClientRect(),inFetchZone=entry.inFetchZone,inRenderZone=entry.inRenderZone,height=rect.height||entry.minHeight,margin=rect.top+(height/2),above=false;if(margin>window.innerHeight){margin-=window.innerHeight;}else if(margin<0){above=true;margin=Math.abs(margin);}else{margin=0;}
var marginPercentage=(margin/window.innerHeight)*100;entry.inDeleteZone=(above&&entry.autoDelete&&marginPercentage>=entry.autoDeleteMarginPercent);inFetchZone=((marginPercentage<=entry.fetchMarginPercent||entry.fetchMarginPercent==-1)&&!entry.inDeleteZone);inRenderZone=((marginPercentage<=entry.renderMarginPercent||entry.fetchMarginPercent==-1)&&!entry.inDeleteZone);var changed=(inFetchZone!=entry.inFetchZone||inRenderZone!=entry.inRenderZone||entry.inDeleteZone);if(inFetchZone&&!entry.inFetchZone){this.incrementSlotsInFetchZone();}else if(!inFetchZone&&entry.inFetchZone){this.slotsInFetchZone=Math.max(0,--this.slotsInFetchZone);}
entry.inFetchZone=inFetchZone;entry.inRenderZone=inRenderZone;return changed;}
ViewabilityTracker.prototype.killEntry=function(entry){if(entry.inFetchZone){this.slotsInFetchZone=Math.max(0,--this.slotsInFetchZone);}
entry.activeTab=false;entry.viewable=false;entry.inFetchZone=false;entry.inRenderZone=false;entry.callback(entry);}
ViewabilityTracker.prototype.setCallback=function(callbackFn){this.auctionCallback=callbackFn;}
ViewabilityTracker.prototype.incrementSlotsInFetchZone=function(){this.slotsInFetchZone++;if(ProperMedia.utils.isFn(this.auctionCallback)){this.auctionCallback();this.auctionCallback.auctionCallback=null;}}
function isEntryViewableByArea(entry){var changed=false;var viewable=entry.viewable;entry.element=entry.element||document.getElementById(entry.id)
if(!entry.element)return false;var rect=entry.element.getBoundingClientRect();if(rect.height==0&&rect.top>0&&rect.top<window.innerHeight&&rect.left>0&&rect.right<window.innerWidth)
{return true;}
var rectArea=rect.width*rect.height;var intersectTop=Math.max(rect.top,0);var intersectBottom=Math.min(rect.bottom,window.innerHeight);var intersectRight=Math.min(rect.right,window.innerWidth);var intersectLeft=Math.max(rect.left,0);if(intersectTop<intersectBottom&&intersectRight>intersectLeft){var intersectArea=Math.abs(intersectBottom-intersectTop)*Math.abs(intersectRight-intersectLeft);viewable=(intersectArea/rectArea>0.5);}else{viewable=false;}
changed=viewable!=entry.viewable
entry.viewable=viewable;return changed;}
function registerWindowViewabilityEventHandler(tracker){var hidden='hidden';var onchange=function onchange(evt){if(document[hidden]){tracker.stop();}else{tracker.start();}};var hiddenFn=function(){tracker.stop();};var visibleFn=function(){tracker.start();};onchange=TraceKit.wrap(onchange);hiddenFn=TraceKit.wrap(hiddenFn);visibleFn=TraceKit.wrap(visibleFn);if(hidden in document){document.addEventListener('visibilitychange',onchange);}else if((hidden='mozHidden')in document){document.addEventListener('mozvisibilitychange',onchange);}else if((hidden='webkitHidden')in document){document.addEventListener('webkitvisibilitychange',onchange);}else if((hidden='msHidden')in document){document.addEventListener('msvisibilitychange',onchange);}else if('onfocusin'in document){document.onfocusin=visibleFn;document.onfocusout=hiddenFn;}else if('onpagehide'in window){window.addEventListener('pagehide',hiddenFn,false);window.addEventListener('pageshow',visibleFn,false);}else if('onblur'in window){window.onfocus=visibleFn;window.onblur=hiddenFn;}}
function passiveEventSupport(){try{var supported=false;var opts=Object.defineProperty({},'passive',{get:function(){supported=true;}});window.addEventListener("testPassive",null,opts);window.removeEventListener("testPassive",null,opts);return supported;}catch(e){sendError(TraceKit.computeStackTrace(e));return false;}}
return ViewabilityTracker;})();var pageObj=(function(){function pageObj(){(this.uuid=null),(this.use_ssl=false),(this.protocol='http:'),(this.url=''),(this.domain=''),(this.path=''),(this.get_vars={}),(this.canonical_url=''),(this.takeover={bidder:'',logged:false,price:0,}),(this.bidder_page_url=''),(this.referrer=''),(this.isolated=0),(this.width=0),(this.height=0),(this.post_id=''),(this.init_slots_build=0),(this.slots={display:{},video:{},interstitial:{},}),(this.sra_settings={slot_queue:{},timeout_handler:null,timeout_ms:100,}),(this.video_enabled=null),(this.video_player_count={instream:{possible:[],onpage:[],inview:[],},outstream:{possible:[],onpage:[],inview:[],},}),(this.video_script_loaded=false),(this.dynamic_css_class='proper-dynamic-insertion'),(this.start_ts=0),(this.dfp_init=false),(this.dfp_correlator=false),(this.dfp_enabled_services=false),(this.dont_send_bids=false),(this.viewability_tracker={}),(this.dynamic_ad_matches=[]),(this.spa_settings={enabled:false,prefetch:false,gallery_id:null,page_number:1,gallery_base_url:'',}),(this.page_meta={category:'',editor:'',writer:'',buyer:'',page_type:'',split:'',tags:[],custom:{},}),(this.dfp_targeting={});this.slot_level_auction='';}
pageObj.prototype.init=function(){this.start_ts=ProperMedia.utils.getTimestampMs();this.setBidPageUrl();this.viewability_tracker=new ViewabilityTracker();properLog.mylog('width: '+this.width);properSession.init();properLog.init_bid_data();consentManager.ready(function(){this.initDfp();this.buildSlots();properSetTimeout.setTimeout.call(this,function(){this.buildSlots();},850);properAdPool.startNewAuction();checkProperDebugConsole();}.bind(this));};pageObj.prototype.setBidPageUrl=function(){if(this.spa_settings['enabled']&&this.spa_settings['gallery_id']&&this.spa_settings['gallery_base_url']){this.bidder_page_url=this.spa_settings['gallery_base_url'];}else{this.bidder_page_url=this.url;}};pageObj.prototype.setPageVariables=function(){this.uuid=ProperMedia.utils.generateUUID();window.proper_ad_page_uuid=this.uuid;if('https:'==document.location.protocol){this.protocol='https:';this.use_ssl=true;}else this.protocol='http:';this.url=ProperMedia.utils.getPageUrl();this.path=ProperMedia.utils.getPagePath();this.domain=ProperMedia.utils.getPageDomain();this.root_domain=ProperMedia.utils.getRootDomain();this.get_vars=ProperMedia.utils.getUrlParameters(window.location.search.substring(1));this.referrer=ProperMedia.utils.getPageReferrer();this.canonical_url=ProperMedia.utils.getCanonicalUrl();this.width=$(window).width();this.height=$(window).height();this.takeover={bidder:'',logged:false,price:0,};this.checkDomainProtection();this.checkProperTestMode();this.checkPageIsolation();this.loadBidderInitScripts();this.setPageMeta();this.setPostId();this.setSPASettings();this.setVideoEnabled();this.setDynamicAdMatches();};pageObj.prototype.loadBidderInitScripts=function(){consentManager.ready(function(){Object.keys(properOps.bidders).forEach(function(header_s2s){Object.keys(properOps.bidders[header_s2s]).forEach(function(bidder){var bidderAdapterName=bidderToAdapterName(bidder);if(((properOps.testing_mode.enabled&&properOps.testing_mode.bidder==bidder)||ProperMedia.utils.deepAccess(properOps,'bidders.'+header_s2s+'.'+bidder+'.enabled'))&&typeof ProperMedia.utils.deepAccess(bidAdapters,bidderAdapterName+'.loadInitScripts')=='function'){let bidderConf=ProperMedia.utils.deepCopy(properOps.bidders[header_s2s][bidder]);bidAdapters[bidderAdapterName].loadInitScripts(bidder,bidderConf);}});});});};pageObj.prototype.getTimeOnPage=function(){if(this.start_ts==0)return 0;return Date.now()-this.start_ts;};pageObj.prototype.incrementVideoPlayerCount=function(slot,count_type){if(['instream','outstream'].indexOf(slot.video_type)!==-1&&this.video_player_count[slot.video_type][count_type].indexOf(slot.name)==-1){this.video_player_count[slot.video_type][count_type].push(slot.name);}};pageObj.prototype.decrementVideoPlayerCount=function(slot,count_type){if(['instream','outstream'].indexOf(slot.video_type)!==-1&&this.video_player_count[slot.video_type][count_type].indexOf(slot.name)!==-1){this.video_player_count[slot.video_type][count_type].splice(this.video_player_count[slot.video_type][count_type].indexOf(slot.name),1);}};pageObj.prototype.checkDomainProtection=function(){if(properOps.domain_protection){var domains=[properOps.domain].concat(properOps.additional_domains);var matches=domains.filter(function(domain){var regex=new RegExp('(^|\\.)'+domain.replace(/(http(s)?:\/\/)?(www\.)?/,'')+'$');return this.domain.match(regex);},this);if(matches.length==0){properLog.mylog("WARNING: Domains don't match. Bids wont be sent out for this page");this.dont_send_bids=true;}}
return this.dont_send_bids;};pageObj.prototype.checkProperTestMode=function(){if(typeof this.get_vars.proper_test!=='undefined'&&this.get_vars.proper_test!==''){properOps.testing_mode.bidder=this.get_vars.proper_test;properOps.testing_mode.ids=true;}else{if(typeof this.get_vars.proper_bidder!=='undefined'&&this.get_vars.proper_bidder!==''){properOps.testing_mode.bidder=this.get_vars.proper_bidder;}
if(typeof this.get_vars.proper_test_ids!=='undefined'&&this.get_vars.proper_test_ids!==''){properOps.testing_mode.ids=true;}}
if(properOps.testing_mode.bidder||properOps.testing_mode.ids){properLog.mylog('TESTING MODE');properOps.testing_mode.enabled=true;properOps.refresh.desktop.enabled=0;properOps.refresh.mobile.enabled=0;}};pageObj.prototype.checkPageIsolation=function(){this.isolated=0;if(properOps.isolated_urls.length>0){for(var i=0;i<properOps.isolated_urls.length;i++){var path=properOps.isolated_urls[i];if(path&&this.path==path){this.isolated=1;break;}}}
if(this.isolated==0&&(properOps.testing_mode.bidder||properOps.testing_mode.ids)&&!ProperMedia.utils.deepAccess(this,'get_vars.proper_dfp')){this.isolated=1;}
if(typeof properSpecialOps.isolated!=='undefined'&&this.isolated==0){this.isolated=properSpecialOps.isolated;}
consentManager.ready(function(){properLog.mylog('CMP resolved GDPR: Applies: '+gdprConsent.gdprApplies+', Consent String: '+gdprConsent.consentString);properLog.mylog('CMP resolved USPC: Applies: '+uspConsent.cmpApplies+', Consent String: '+uspConsent.usPrivacy);properLog.mylog('CMP resolved GPP: Applies: '+gppConsent.gppApplies+', Consent String: '+gppConsent.gppString);}.bind(this));};pageObj.prototype.setPageMeta=function(){var page_meta_defaults={category:'',editor:'',writer:'',buyer:'',page_type:'',split:'',tags:[],dfp_kv:{},custom:{set_as_kv_to_gam:false,dimension_1:'',dimension_2:'',dimension_3:'',dimension_4:'',dimension_5:'',dimension_6:'',dimension_7:'',dimension_8:'',dimension_9:'',dimension_10:'',},};this.page_meta=ProperMedia.utils.mergeDeep({},page_meta_defaults,properSpecialOps.page_meta||{});if(properOps.default_tags&&properOps.default_tags.length){this.page_meta.tags=this.page_meta.tags.concat(properOps.default_tags);}
if(properSpecialOps.tags&&properSpecialOps.tags.length){this.page_meta.tags=this.page_meta.tags.concat(properSpecialOps.tags);}
if(properSpecialOps.customGamKeyValues&&Object.keys(properSpecialOps.customGamKeyValues).length){this.page_meta.dfp_kv=ProperMedia.utils.mergeObject({},properSpecialOps.customGamKeyValues,this.page_meta.dfp_kv);}};pageObj.prototype.setPostId=function(){properOps.post_id=typeof properSpecialOps.post_id!='undefined'&&properSpecialOps.post_id!=null?properSpecialOps.post_id:properOps.post_id;this.post_id=properOps.post_id;};pageObj.prototype.setSPASettings=function(){ProperMedia.utils.mergeObject(this.spa_settings,ProperMedia.utils.deepCopy(properSpecialOps.spa_settings));};pageObj.prototype.setVideoEnabled=function(){this.video_enabled=typeof properSpecialOps.video_enabled!=='undefined'?!!properSpecialOps.video_enabled:this.video_enabled;};pageObj.prototype.loadVideoPlayerScript=function(){if(this.video_enabled===true&&this.video_script_loaded==false&&typeof window.ProperMediaVideo=='undefined'){window.propervideotag=window.propervideotag||[];var script=document.createElement('script');script.src='https://player.propervideo.io/new_rtp/main.js';script.async=true;window.top.document.getElementsByTagName('head')[0].appendChild(script);}
this.video_script_loaded=true;};pageObj.prototype.buildSlots=function(){let new_slots=[];Object.keys(properOps.ad_slots).reverse().forEach(function(slot_type){Object.keys(properOps.ad_slots[slot_type]).forEach(function(slot_name){if(slot_type!='dynamic'){new_slots=new_slots.concat(this.buildSlot(slot_type,slot_name));}},this);},this);for(a in this.dynamic_ad_matches){new_slots=new_slots.concat(this.buildSlot('dynamic',this.dynamic_ad_matches[a]));}
if(new_slots.length&&(this.init_slots_build||properOps.slot_level_auction)){properAdPool.sendAuction(true,new_slots);}
this.init_slots_build=1;};pageObj.prototype.buildSlot=function(slot_type,slot_name,flex_settings={is_flex:false}){const parent_name=flex_settings.is_flex?flex_settings.dfp_name:slot_name;if(!slot_type||!slot_name)return false;var device_type=properDevice.isMobile()?'mobile':'desktop';var slot_settings=ProperMedia.utils.deepCopy(ProperMedia.utils.deepAccess(properOps,`ad_slots.${slot_type}.${parent_name}`)||{});var dynamicSettings={...(ProperMedia.utils.deepAccess(slot_settings,'dynamic.'+device_type)||{enabled:false,}),};if(flex_settings.is_flex&&!properDevice.isMobile()){dynamicSettings=ProperMedia.utils.mergeObject(dynamicSettings,{enabled:true,cssselector:`#${slot_name}_flex`,cssplacement:'append',});slot_name=parent_name+'_flex';const flexDynamicSettings={...(properOps?.ad_slots?.display?.[slot_name]||{dynamic:{desktop:{enabled:true,},},}),};const flexInstances=flexDynamicSettings?.dynamic?.desktop?.instances||0;ProperMedia.utils.mergeDeep(flexDynamicSettings.dynamic?.[device_type],dynamicSettings);ProperMedia.utils.deepSetValue(flexDynamicSettings,`dynamic.${device_type}.instances`,flexInstances);ProperMedia.utils.mergeDeep(slot_settings,flexDynamicSettings);slot_settings.allowed_size=flex_settings.allowed_size;slot_settings.is_flex=true;dynamicSettings=ProperMedia.utils.deepAccess(slot_settings,'dynamic.'+device_type);}
let new_slots=[];if(dynamicSettings['enabled']){var cssselector=dynamicSettings['cssselector']+':not(.'+this.dynamic_css_class+')';var elements=document.querySelectorAll(cssselector);if(elements&&elements.length>0){for(var i=0;i<elements.length;i++){var element=elements[i];const instances_path=`ad_slots.${slot_type}.${parent_name}.dynamic.${device_type}.instances`;dynamicSettings['instances']=(ProperMedia.utils.deepAccess(properOps,instances_path)||0)+1;ProperMedia.utils.deepSetValue(properOps,instances_path,dynamicSettings['instances']);if(typeof dynamicSettings['max_instances']=='undefined'||dynamicSettings['instances']<=parseInt(dynamicSettings['max_instances'])){if(slot_settings.is_flex){slot_settings.parent_name=flex_settings.dfp_name;slot_settings.flex_ad=flex_settings.flex_ads.shift();}
var settings=ProperMedia.utils.deepCopy(slot_settings);ProperMedia.utils.deepSetValue(settings,'dynamic.'+device_type+'.instance_number',dynamicSettings['instances']);var demand_type=slot_type=='video'?'video':'display';let new_slot=new slotObj(demand_type,slot_name,settings,element);if(new_slot.initialized){new_slots.push(new_slot);}}}}}else{if(!ProperMedia.utils.deepAccess(this,'slots.'+slot_type+'.'+slot_name)){let new_slot=new slotObj(slot_type,slot_name,slot_settings);if(new_slot.initialized){new_slots.push(new_slot);}}else{ProperMedia.utils.deepAccess(this,'slots.'+slot_type+'.'+slot_name);}}
return new_slots;};pageObj.prototype.rebuildSlots=function(ignore_ids){ignore_ids=ignore_ids??[];Object.keys(this.slots).forEach(function(slot_type){Object.keys(this.slots[slot_type]).forEach(function(slot_name){if(!ignore_ids||!ignore_ids.includes(slot_name)){var slot=this.getSlotFromPageObject(slot_name,[slot_type]);if(slot&&slot.getElement()){slot.rebuildSlot();}}},this);},this);this.buildSlots();};pageObj.prototype.resetSlotsRefresh=function(ignore_ids){ignore_ids=ignore_ids??[];Object.keys(this.slots).forEach(function(slot_type){Object.keys(this.slots[slot_type]).forEach(function(slot_name){if(!ignore_ids||!ignore_ids.includes(slot_name)){var slot=this.getSlotFromPageObject(slot_name,[slot_type]);if(slot&&slot.getElement()){slot.resetSlotRefresh();}}},this);},this);this.buildSlots();};pageObj.prototype.updateDpfPageTargeting=function(){if(this.isolated==0&&this.dfp_init==1){googletag.cmd.push(function(){if(properOps.dfp_per_slot){if(Object.keys(this.slots.display).length){Object.keys(this.slots.display).forEach(function(slot_name){var slot=this.slots.display[slot_name];if(slot.googletag().pubads()){setDfpPageTargeting(slot.googletag().pubads());}}.bind(this));}}else{setDfpPageTargeting(googletag.pubads());}}.bind(this));}};pageObj.prototype.InfScrollNextPage=function(){properLog.mylog('========== New Infinite Scroll Page ==========');this.newPageView();this.init_slots_build=0;this.resetSlotsRefresh([]);this.buildSlots();properSetTimeout.setTimeout.call(this,function(){this.buildSlots();},850);properAdPool.startNewAuction();};pageObj.prototype.SpaNextPage=function(){properLog.mylog('========== New SPA Page ==========');this.newPageView();this.init_slots_build=0;this.rebuildSlots([]);properSetTimeout.setTimeout.call(this,function(){this.buildSlots();},850);properAdPool.startNewAuction();};pageObj.prototype.newPageView=function(){var event=new CustomEvent('properNewPageview');window.dispatchEvent(event);var time_on_page=this.getTimeOnPage();properLog.mylog('Time on page: '+time_on_page);this.spa_settings['page_number']++;this.start_ts=ProperMedia.utils.getTimestampMs();this.setPageVariables();if(ProperMedia.utils.deepAccess(this.spa_settings,'enabled')&&(!ProperMedia.utils.deepAccess(this.spa_settings,'gallery_id')||!ProperMedia.utils.deepAccess(properSpecialOps,'spa_settings.gallery_id')||ProperMedia.utils.deepAccess(this.spa_settings,'gallery_id')!==ProperMedia.utils.deepAccess(properSpecialOps,'spa_settings.gallery_id'))){properAdPool.clearCachedAds();}else{properAdPool.clearExpiredAds();}
this.setBidPageUrl();properSession.init();properLog.init_bid_data();properAdPool.auction_count=0;properAdPool.vid_auction_count=0;this.updateDpfPageTargeting();};pageObj.prototype.initDfp=function(){if(this.dfp_init==1||properPage.isolated==1||properOps.dfp_per_slot==1)return false;if(ProperMedia.utils.deepAccess(properOps,'confiant.enabled')||ProperMedia.utils.deepAccess(properSpecialOps,'confiant.enabled')){confiantWrapper.loadDFPTag(window);}else if(ProperMedia.utils.deepAccess(properOps,'adlightning.enabled')||ProperMedia.utils.deepAccess(properSpecialOps,'adlightning.enabled')){adLightningWrapper.loadDFPTag(window);}
if(!googletag._loadStarted_){(function(){var gads=document.createElement('script');gads.async=true;gads.type='text/javascript';var useSSL='https:'==document.location.protocol;gads.src=(useSSL?'https:':'http:')+'//securepubads.g.doubleclick.net/tag/js/gpt.js';var node=document.getElementsByTagName('script')[0];node.parentNode.insertBefore(gads,node);})();}
googletag.cmd.push(function(){if(gppConsentModule.isConsentDenied()||!gdprEnforcement.deviceAccessEnforcement(755,'gam')||!gdprConsentModule.hasPurpose4Consent()){properLog.mylog('DFP: disable personalized GPT ads');googletag.pubads().setPrivacySettings({nonPersonalizedAds:true,});}
googletag.pubads().addEventListener('slotOnload',function(event){var slot_name=ProperMedia.utils.extractSlotName(event.slot.getSlotElementId());var ad_unit_path=event.slot.getAdUnitPath();var slot=properPage.getSlotFromPageObject(slot_name)||properPage.getSlotFromPageObjectByAdUnitPath(ad_unit_path);properLog.mylog('DFP slotOnload: '+slot_name);if(slot){slot.dispatchCustomEvent('proper-ads-fired',{cpm:ProperMedia.utils.deepAccess(slot,'displayed_ad.price'),size:ProperMedia.utils.deepAccess(slot,'displayed_ad.size'),ad_type:slot.ad_type,});}});googletag.pubads().addEventListener('impressionViewable',function(event){var slot_name=ProperMedia.utils.extractSlotName(event.slot.getSlotElementId());var ad_unit_path=event.slot.getAdUnitPath();var slot=properPage.getSlotFromPageObject(slot_name)||properPage.getSlotFromPageObjectByAdUnitPath(ad_unit_path);properLog.mylog('DFP impressionViewable: '+slot_name);if(slot){if(slot&&slot.interstitial){proper_render_dfp_interstitial(slot);}
slot.dispatchCustomEvent('proper-impression-viewable',{cpm:ProperMedia.utils.deepAccess(slot,'displayed_ad.price'),size:ProperMedia.utils.deepAccess(slot,'displayed_ad.size'),ad_type:slot.ad_type,});}});googletag.pubads().addEventListener('slotRenderEnded',TraceKit.wrap(function(event){var slot_name=ProperMedia.utils.extractSlotName(event.slot.getSlotElementId());var ad_unit_path=event.slot.getAdUnitPath();var slot=properPage.getSlotFromPageObject(slot_name)||properPage.getSlotFromPageObjectByAdUnitPath(ad_unit_path);properLog.mylog('DFP slotRenderEnded: '+slot_name);if(slot){slot.tracking_times.dfp_returned_ts=ProperMedia.utils.getTimestampMs();if(slot.interstitial){if(event.isEmpty==false){proper_render_dfp(slot.name,event);}}else{if(event.advertiserId!=properOps.proper_advertiser&&event.advertiserId!=properOps.amazon_advertiser){if(!event.isEmpty){proper_render_dfp(slot.name,event);proper_inview(event.isEmpty,slot.name,event.size.join('x'),event.creativeId,event.lineItemId,event.advertiserId);}else{proper_render(slot.getElement(),slot.number,1);}}
if((!slot.sticky&&ProperMedia.utils.deepAccess(properSpecialOps,'adlightning.enabled')&&ProperMedia.utils.deepAccess(properSpecialOps,'adlightning.reportAd'))||(ProperMedia.utils.deepAccess(properOps,'adlightning.enabled')&&ProperMedia.utils.deepAccess(properOps,'adlightning.reportAd'))){adLightningWrapper.addReportAd(event);}}}}));googletag.pubads().addEventListener('slotOnload',TraceKit.wrap(function(event){let slot_name;try{slot_name=ProperMedia.utils.extractSlotName(event.slot.getSlotElementId());var ad_unit_path=event.slot.getAdUnitPath();var slot=properPage.getSlotFromPageObject(slot_name)||properPage.getSlotFromPageObjectByAdUnitPath(ad_unit_path);properLog.mylog('DFP slotOnload: '+slot_name);if(slot){if(window.top.document.getElementById(slot.dfpIframeId)){var googleIframeContentDocument=window.top.document.getElementById(slot.dfpIframeId).contentWindow.document;if(googleIframeContentDocument){if(googleIframeContentDocument.getElementById('common_15click_overlay')||googleIframeContentDocument.getElementById('common_15click_anchor')){sendError(new Error('Detected Google Confirmed Click: '+
slot.dfp_name+
' | '+
ProperMedia.utils.deepAccess(slot,'displayed_ad.size')));}}}}}catch(e){properLog.mylog('Error Detecting Google Confirmed Click: '+slot_name);}}));setDfpPageTargeting(googletag.pubads());googletag.pubads().setPrivacySettings({childDirectedTreatment:ProperMedia.utils.deepAccess(properSpecialOps,'coppa')?true:false,});googletag.pubads().disableInitialLoad();googletag.pubads().setPublisherProvidedId(properUser.pubcid);googletag.pubads().enableSingleRequest();googletag.enableServices();this.dfp_enabled_services=true;}.bind(this));this.dfp_init=1;};pageObj.prototype.dfpSraCall=function(){googletag.cmd.push(function(){clearTimeout(this.sra_settings.timeout_handler);this.sra_settings.timeout_handler=null;if(Object.keys(this.sra_settings.slot_queue).length>0){if(properSpecialOps.update_correlator==1&&this.dfp_correlator==false&&this.spa_settings.page_number>1){googletag.pubads().updateCorrelator();this.dfp_correlator=true;properLog.mylog('Correlator updated for page: '+this.spa_settings.page_number);}
var sra_dfp_slots=[];Object.keys(this.sra_settings.slot_queue).forEach(function(slot_name){var slot=this.sra_settings.slot_queue[slot_name];sra_dfp_slots.push(slot.dfp_slot);slot.tracking_times.dfp_sent_ts=ProperMedia.utils.getTimestampMs();properLog.mylog('DFP refresh called: '+slot.name);slot.dfp_refreshed=1;slot.auction_send_complete=true;},this);this.sra_settings.slot_queue={};googletag.pubads().refresh(sra_dfp_slots);}}.bind(this));};pageObj.prototype.getSlotFromPageObject=function(slot_name,slot_types){var slot=null;slot_types=slot_types||Object.keys(this.slots)||['display','video','interstitial'];slot_types.every(function(slot_type){if(this.slots[slot_type][slot_name]){slot=this.slots[slot_type][slot_name];return false;}
return true;},this);return slot;};pageObj.prototype.getSlotFromPageObjectByAdUnitPath=function(ad_unit_path,slot_types){var slot=null;slot_types=slot_types||Object.keys(this.slots)||['display','video','interstitial'];slot_types.every(function(slot_type){if(!slot&&this.slots[slot_type]&&Object.keys(this.slots[slot_type])){Object.keys(this.slots[slot_type]).every(function(slot_name){if(!slot&&this.slots[slot_type][slot_name].dfpAdUnitPath==ad_unit_path){slot=this.slots[slot_type][slot_name];return false;}
return true;},this);}
return!slot;},this);return slot;};pageObj.prototype.getSlotByNumber=function(slot_number,slot_types){var slot=null;slot_types=slot_types||Object.keys(this.slots);slot_types.every(function(slot_type){Object.keys(this.slots[slot_type]).every(function(slot_name){var temp_slot=this.slots[slot_type][slot_name];if(temp_slot.number==slot_number){slot=temp_slot;return false;}
return true;},this);return!slot;},this);return slot;};pageObj.prototype.getSlotFromPageObjectByDfpName=function(dfp_name,slot_types){try{var slot=false;var found=false;slot_types=slot_types||Object.keys(this.slots)||['display','video','interstitial'];slot_types.every(function(slot_type){found=Object.keys(this.slots[slot_type]).some(function(slot_name){if(this.slots[slot_type][slot_name].dfp_name==dfp_name){slot=this.slots[slot_type][slot_name];}
return!!(slot instanceof slotObj);},this);return!found;},this);return slot;}catch(e){return false;}};pageObj.prototype.deleteDynamicSlots=function(slot_types){slot_types=slot_types||Object.keys(this.slots);slot_types.forEach(function(slot_type){if(this.slots[slot_type]&&Object.keys(this.slots[slot_type]).length){Object.keys(this.slots[slot_type]).forEach(function(slot_name){var temp_slot=this.slots[slot_type][slot_name];if(ProperMedia.utils.deepAccess(temp_slot,'dynamic.enabled')){temp_slot.deleteSlot(true);var cssselector=ProperMedia.utils.deepAccess(temp_slot,'dynamic.cssselector')+'.'+this.dynamic_css_class;var elements=document.querySelectorAll(cssselector);if(elements&&elements.length>0){for(var i=0;i<elements.length;i++){var element=elements[i];element.classList.remove(this.dynamic_css_class);}}}},this);}},this);};pageObj.prototype.resetDynamicSlotInstanceCount=function(slot_types){slot_types=slot_types||Object.keys(this.slots);const device_type=properDevice.isMobile()?'mobile':'desktop';slot_types.forEach(function(slot_type){if(properOps.ad_slots[slot_type]&&Object.keys(properOps.ad_slots[slot_type]).length){Object.keys(properOps.ad_slots[slot_type]).forEach(function(slot_name){if(ProperMedia.utils.deepAccess(properOps,'ad_slots'+'.'+slot_type+'.'+slot_name+'.dynamic.'+device_type+'.instances')){ProperMedia.utils.deepSetValue(properOps,'ad_slots'+'.'+slot_type+'.'+slot_name+'.dynamic.'+device_type+'.instances',0);}},this);}},this);};pageObj.prototype.setDynamicAdMatches=function(){var ads_to_show=[];var url_str=this.url.substr(this.url.indexOf(this.domain)+this.domain.length,this.url.length-1).replace(window.location.hash,'');var utm_str=!url_str.includes('?')?false:url_str.split('?')[1];url_str=!utm_str?url_str:url_str.split('?')[0];for(group in properOps.page_groups){var draw_ads=false;var g=properOps.page_groups[group];for(url in g.url_matches){if(url_str==g.url_matches[url]||(g.url_matches[url].indexOf('*')>-1&&1+url_str.search(g.url_matches[url].split('/').join('/').split('=').join('\\=').split('*').join('.*')))){draw_ads=true;}}
if(!draw_ads)continue;for(url in g.url_exclude){if(url_str==g.url_exclude[url]||(g.url_exclude[url].indexOf('*')>-1&&1+url_str.search(g.url_exclude[url].split('/').join('/').split('=').join('\\=').split('*').join('.*')))){draw_ads=false;continue;}}
if(draw_ads){ads_to_show=ads_to_show.concat(g.ads);}
if(!utm_str)continue;for(utm_group in g.url_mods){for(utm in g.url_mods[utm_group].conditions){if(1+utm_str.search(g.url_mods[utm_group].conditions[utm])){ads_to_show=ads_to_show.concat(g.url_mods[utm_group].extra_ads);continue;}}}}
this.dynamic_ad_matches=ads_to_show;};return pageObj;})();var slotObj=(function(){function slotObj(type,name,settings,referenceNode){this.name='';this.dfp_name='';this.number=0;this.dfp_id=0;this.mcm_type='mcm';this.location='unknown';this.type='';this.div_id='';this.max_tier=0;this.size='0x0';this.sizes=[];this.defined_sizes=[];this.default_size=[0,0];this.min_width=0;this.min_height=0;this.specified_min_height=false;this.interstitial=false;this.last_displayed_ts=0;this.dfp_slot={};this.dfp_init=0;this.dfp_ready=0;this.dfp_sent=0;this.dfp_refreshed=0;this.google_tag=null;this.mapped_dfp_sizes=0;this.dfp_enabled_services=false;this.auction_send_complete=false;this.winning_ad={};this.displayed_ad={};this.displayed=0;this.delay_handle=null;this.auction_started_ts=null;this.max_timeout_handle=null;this.max_timeout_met=false;this.max_timeout=1200;this.wait_interval=50;this.wait_interval_handle=null;this.min_time_on_page=2000;this.rebuild_timeout_handle=null;this.exclude_advertiser=[];this.advertiserId=0;this.report_ad_tool=0;this.video_player=null;this.video_type='';this.ad_types=[];this.adl_blocked=false;this.disable_adx=false;this.gamTargeting={};this.customGamTargeting=[];this.slot_level_auction=false;this.url_restricted={values:[],enabled:false,};this.page_restricted_depth={enabled:false,};this.url_rules=[];this.is_flex_slot=false;this.parent_name='';this.flex_enabled=false;this.flex_ads=[];this.flex_map=null;this.flex_names=null;this.sticky=0;this.slider=0;this.sticky_settings={brand:0,close_btn:0,disable_on_close:0,freq_cap_enabled:0,freq_cap:0,position:'right',};this.slider_settings={close_button:true,adjustment_size:0.7,breakpoint:480,location:{desktop:['right','bottom'],mobile:['right','bottom'],},keep_on_close:false,};this.scrollable={enabled:false,percentage:10,dynamic_occurences:{enabled:false,incidences_to_target:[],},};this.refresh={enabled:0,max:5,count:0,interval:60000,min_interval:15000,current_interval:60000,inview_interval:15000,exclude_dfp:0,};this.floors={backup:0.15,sizes:{},};this.lazyload={enabled:1,inFetchZone:false,inRenderZone:false,fetchMarginPercent:0,renderMarginPercent:0,};this.autoDelete={enabled:false,inDeleteZone:false,autoDeleteMarginPercent:200,};this.viewability={viewable:false,activeTab:true,entered_inview_ts:0,total_time_inview:0,};this.dynamic={enabled:false,cssplacement:'after',cssselector:'',instance_number:0,child_name:'',css_ad:'',css_page:'',};this.tracking_times={built_ts:0,bids_ready_ts:0,dfp_sent_ts:0,dfp_returned_ts:0,creative_on_page:0,};this.advertisement_disclosure={enabled:false,location:'below',};this.kill_slot=false;this.initialized=this.buildSlot(type,name,settings,referenceNode);}
slotObj.prototype.getElement=function(){return(this.iframe_window||top).document.getElementById(this.div_id);};slotObj.prototype.addFlexWrapper=function(referenceNode){const flexWrapper=document.createElement('div');flexWrapper.classList.add('proper-flex-wrapper');flexWrapper.id=`${this.name}_flex_wrapper`;referenceNode.parentNode.insertBefore(flexWrapper,referenceNode);flexWrapper.appendChild(referenceNode);};slotObj.prototype.addFlexSlot=function(allowed_size){const element=this.getElement();const flex_id=`${this.name}_flex`;const number_of_flex_slots=this.flex_map[allowed_size];const min_width=Math.floor(100/number_of_flex_slots);if(element&&number_of_flex_slots>1){const flexWrapper=this.getFlexWrapper();if(flexWrapper?.className?.includes('proper-flex-wrapper')){for(let i=1;i<number_of_flex_slots;i++){const flexReferenceNode=document.createElement('div');flexReferenceNode.id=flex_id;flexReferenceNode.classList.add('proper-flex');flexReferenceNode.style=`min-width: ${min_width}%`;flexWrapper.appendChild(flexReferenceNode);}
propertag.cmd.push(function(){properLog.mylog('Adding Flex Slot '+this.name);const flex_slots=properPage.buildSlot(this.type,this.name,{is_flex:true,allowed_size:allowed_size,dfp_name:this.dfp_name,flex_ads:this.flex_ads,});this.flex_names=flex_slots.map((slot)=>slot.name);for(const child of flexWrapper.children){child.classList.add('proper-flex');child.style=`min-width: ${min_width}%`;}}.bind(this));}}};slotObj.prototype.hasFlexSlot=function(){return!!this.flex_names&&this.flex_names.length>0;};slotObj.prototype.removeFlexSlot=function(){for(const flex_name of this.flex_names){const flexSlot=properPage.getSlotFromPageObject(flex_name);if(!flexSlot){properLog.mylog(`Flex slot not found for ${flex_name}!`);continue;}
properLog.mylog(`Removing flex slot: ${flex_name}`);flexSlot?.clearWinningBid();flexSlot?.deleteSlot(true);}
const element=this.getElement();$(element?.parentNode).removeClass('proper-flex');$(element?.parentNode).removeStyle();this.flex_names.length=0;};slotObj.prototype.clearFlexBid=function(){if(this.hasFlexBids()){for(const flex_ad of this.flex_ads){if(flex_ad.displayed==0&&!flex_ad.checkIfExpired()){properAdPool.addBidToPool(flex_ad);}}
this.flex_ads.length=0;}};slotObj.prototype.getFlexWrapper=function(){let flexWrapper=document.getElementById(this.div_id);let i=0;while(!flexWrapper?.className?.includes('proper-flex-wrapper')&&i<7){flexWrapper=flexWrapper?.parentNode;i++;}
return flexWrapper;};slotObj.prototype.getContentDocument=function(){return this.iframe_window?this.iframe_window.document:this.iframe_id?window.top.document.getElementById(this.iframe_id).contentDocument:window.top.document.getElementById(this.properIframeId)?window.top.document.getElementById(this.properIframeId).contentDocument:window.top.document;};slotObj.prototype.setStickySettings=function(settings){try{if(this.sticky){var stickyObj=ProperMedia.utils.mergeObject({},this.sticky_settings,settings.sticky_settings||{});this.sticky_settings=ProperMedia.utils.deepCopy(stickyObj);}}catch(e){properLog.mylog('Error setting sticky settings: '+this.name);return false;}
return true;};slotObj.prototype.setSliderSettings=function(settings){try{if(this.slider){var sliderObj=ProperMedia.utils.mergeObject({},this.slider_settings,settings.slider_settings||{});this.slider_settings=ProperMedia.utils.deepCopy(sliderObj);}}catch(e){properLog.mylog('Error setting slider settings: '+this.name);return false;}
return true;};slotObj.prototype.setScrollableSettings=function(settings){try{if(this.type=='display'){var scrollableObj=ProperMedia.utils.mergeObject({},this.scrollable,settings.scrollable||{});this.scrollable=ProperMedia.utils.deepCopy(scrollableObj);}}catch(e){properLog.mylog('Error setting scrollable settings: '+this.name);return false;}
return true;};slotObj.prototype.setScrollableElemHeight=function(){try{var calc_height=parseInt(properPage.height*(parseInt(this.scrollable.percentage)/100));if(this.type=='display'&&properDevice.isMobile()&&this.scrollable.enabled&&parseInt(this.scrollable.percentage)>0&&calc_height>this.max_height){var elem=window.top.document.getElementById(this.div_id);if(elem){if(elem.parentNode.className.indexOf(properOps.slot_wrapper_class)!==-1){var elem2=elem.parentNode;elem2.style='min-height: '+calc_height+'px;';elem2.className+=' in-content-slider-cont';elem.className+=' in-content-slider-unit';}}}}catch(e){properLog.mylog('Error setting scrollable elem height: '+this.name);}};slotObj.prototype.setRefresh=function(settings){try{var device_type=properDevice.isMobile()?'mobile':'desktop';var refresh_settings=settings.refresh&&settings.refresh[device_type]?settings.refresh[device_type]:{};var refreshObj=ProperMedia.utils.mergeObject({},this.refresh,properOps.refresh[device_type],refresh_settings);if(properUser.checkAdBlockDetected()||this.is_flex_slot){refreshObj.enabled=0;}
this.refresh=ProperMedia.utils.deepCopy(refreshObj);}catch(e){properLog.mylog('Error setting refresh settings: '+this.name);return false;}
return true;};slotObj.prototype.setLazyload=function(settings){try{var device_type=properDevice.isMobile()?'mobile':'desktop';var lazyload_settings=settings.lazyload&&settings.lazyload[device_type]?settings.lazyload[device_type]:{};var lazyloadObj=ProperMedia.utils.mergeObject({},this.lazyload,properOps.lazyload[device_type],lazyload_settings);this.lazyload=ProperMedia.utils.deepCopy(lazyloadObj);if(this.sticky)this.lazyload.enabled=false;}catch(e){properLog.mylog('Error setting lazy-load settings: '+this.name);return false;}
return true;};slotObj.prototype.setAutoDelete=function(settings){try{var device_type=properDevice.isMobile()?'mobile':'desktop';var autoDelete_settings=ProperMedia.utils.deepAccess(settings,'autoDelete.'+device_type)||{};var autoDeleteObj=ProperMedia.utils.mergeObject({},this.autoDelete,properOps.autoDelete[device_type],autoDelete_settings);this.autoDelete=ProperMedia.utils.deepCopy(autoDeleteObj);if(this.sticky)this.autoDelete.enabled=false;}catch(e){properLog.mylog('Error setting auto delete settings: '+this.name);return false;}
return true;};slotObj.prototype.setPageRestrictions=function(settings){try{var pageRestriction_settings=ProperMedia.utils.deepAccess(settings,'page_restricted_depth')||{};var pageRestrictionObj=ProperMedia.utils.mergeObject({},this.page_restricted_depth,pageRestriction_settings);this.page_restricted_depth=ProperMedia.utils.deepCopy(pageRestrictionObj);var pageUrlRestriction_settings=ProperMedia.utils.deepAccess(settings,'url_restricted')||{};var pageUrlRestrictionObj=ProperMedia.utils.mergeObject({},this.url_restricted,pageUrlRestriction_settings);this.url_restricted=ProperMedia.utils.deepCopy(pageUrlRestrictionObj);}catch(e){properLog.mylog('Error setting page restriction settings: '+this.name);return false;}
return true;};slotObj.prototype.setUrlandPageviewRules=function(settings){try{var pageUrlRules_settings=ProperMedia.utils.deepAccess(settings,'url_rules')||[];if(ProperMedia.utils.isStr(pageUrlRules_settings)){pageUrlRules_settings=ProperMedia.utils.deepAccess(properOps,'ad_slots.display.'+pageUrlRules_settings+'.url_rules')||[];if(!ProperMedia.utils.isArray(pageUrlRules_settings))pageUrlRules_settings=[];}
var pageUrlRulesArr=pageUrlRules_settings||this.url_rules;this.url_rules=ProperMedia.utils.deepCopy(pageUrlRulesArr);}catch(e){properLog.mylog('Error setting slot url rules: '+this.name);return false;}
return true;};slotObj.prototype.setFloors=function(settings){try{var device_type=properDevice.isMobile()?'mobile':'desktop';var floor_settings=settings.floors&&settings.floors[device_type]?settings.floors[device_type]:{};var floorsObj=ProperMedia.utils.mergeObject({},this.floors,properOps.floors[device_type],floor_settings);this.floors=ProperMedia.utils.deepCopy(floorsObj);}catch(e){properLog.mylog('Error setting floors settings: '+this.name);return false;}
return true;};slotObj.prototype.setDynamic=function(settings){try{var device_type=properDevice.isMobile()?'mobile':'desktop';var dynamic_settings=settings.dynamic&&settings.dynamic[device_type]?settings.dynamic[device_type]:{};var dynamictObj=ProperMedia.utils.mergeObject({},this.dynamic,dynamic_settings);if(this.is_flex_slot)dynamictObj.cssplacement='replace';this.dynamic=ProperMedia.utils.deepCopy(dynamictObj);}catch(e){properLog.mylog('Error setting dynamic settings: '+this.name);return false;}
return true;};slotObj.prototype.setAdvertisementDisclosure=function(settings){try{var adDisclosureObj=ProperMedia.utils.mergeObject({},this.advertisement_disclosure,properOps.advertisement_disclosure,settings.advertisement_disclosure||{});this.advertisement_disclosure=ProperMedia.utils.deepCopy(adDisclosureObj);}catch(e){properLog.mylog('Error setting Advertisement Disclosure settings: '+this.name);return false;}
return true;};slotObj.prototype.getFloor=function(size){var floor=this.floors.sizes[size]||this.floors.backup||0;return parseFloat(floor);};slotObj.prototype.checkVideoInviewLimit=function(){return(this.video_type=='outstream'&&(!properOps.video_limit.enabled||properOps.video_limit.outstream_inview_limit<properPage.video_player_count.outstream.inview.length));};slotObj.prototype.checkStickyFreqCapMet=function(){return this.sticky==1&&((this.sticky_settings.disable_on_close&&properUser.stickyFreqCapHandler.getStickyClosedCookie()==true)||(this.sticky_settings.freq_cap_enabled&&properUser.stickyFreqCapHandler.getStickyUnitImps()>=this.sticky_settings.freq_cap))?true:false;};slotObj.prototype.checkPageDepthRestriction=function(){return!!((this.page_restricted_depth.enabled&&this.page_restricted_depth.qualifier=='is_greater'&&properSession.sessionData.depth>parseInt(this.page_restricted_depth.page))||(this.page_restricted_depth.qualifier=='is_lesser'&&properSession.sessionData.depth<parseInt(this.page_restricted_depth.page)));};slotObj.prototype.checkUrlRestriction=function(){var retVal=false;if(this.url_restricted.enabled&&this.url_restricted.values.length){retVal=true;for(var i=0;i<this.url_restricted.values.length;i++){var values=this.url_restricted.values[i];var regex=new RegExp(values.url_value);if((!values.url_value||!values.qualifier||(values.qualifier=='contains'&&properPage.url.match(regex))||(values.qualifier=='does_not_contain'&&!properPage.url.match(regex)))&&(!values.page_depth||!values.page_depth_qualifier||(values.page_depth_qualifier=='is_lesser'&&properSession.sessionData.depth<parseInt(values.page_depth))||(values.page_depth_qualifier=='is_greater'&&properSession.sessionData.depth>parseInt(values.page_depth)))){retVal=false;break;}}}
return retVal;};slotObj.prototype.checkUrlAndPageviewRules=function(){if(!this.url_rules[0])return false;for(var ruleset of this.url_rules){var passCount=0;for(var rule of ruleset){var condition=rule.condition;var params=ProperMedia.utils.isStr(rule.parameter)?rule.parameter.replace(/\s+/g,'').split(','):[rule.parameter];for(var param of params){if(condition=='is'&&properPage.path==param){passCount++;break;}
if(condition=='is_not'&&properPage.path!=param){passCount++;break;}
if(condition=='contains'&&properPage.path.indexOf(param)!=-1){passCount++;break;}
if(condition=='does_not_contain'&&properPage.path.indexOf(param)==-1){passCount++;break;}
if(condition=='has_parameter'){let[key,val]=param.split('=');if(ProperMedia.utils.deepAccess(properPage,'get_vars.'+key)==val){passCount++;}
break;}
if(condition=='does_not_have_parameter'){let[key,val]=param.split('=');if(ProperMedia.utils.deepAccess(properPage,'get_vars.'+key)!==val){passCount++;}
break;}
if(condition=='pageviews_greater'&&properSession.sessionData.depth>param){passCount++;break;}
if(condition=='pageviews_lesser'&&properSession.sessionData.depth<param){passCount++;break;}}}
if(passCount==ruleset.length)return false;}
properLog.mylog('Slot does not meet Url And Pageview Rules: '+this.name);return true;};slotObj.prototype.setViewabilityTracker=function(){var viewabilityConfig={id:this.div_id,lazyload:this.lazyload.enabled,viewability:true,fetchMarginPercent:this.lazyload.fetchMarginPercent,renderMarginPercent:this.lazyload.renderMarginPercent,minHeight:this.min_height,autoDelete:this.autoDelete.enabled,autoDeleteMarginPercent:this.autoDelete.autoDeleteMarginPercent,};properPage.viewability_tracker.addElement(viewabilityConfig,this.viewabilityChange.bind(this));};slotObj.prototype.insertDynamicSlot=function(referenceNode,cssplacement){var div1=document.createElement('div');var div2=document.createElement('div');div1.className=properOps.slot_wrapper_class;div2.id='proper-ad-'+this.name;if(this.sticky){div1.className+=' ad-sticky';div1.style='display: none;';}else if(this.type=='display'&&properDevice.isMobile()&&this.scrollable.enabled&&parseInt(this.scrollable.percentage)>0){var incidences_to_target=ProperMedia.utils.deepAccess(this.scrollable,'dynamic_occurences.incidences_to_target')||[];if(!ProperMedia.utils.deepAccess(this.scrollable,'dynamic_occurences.enabled')||incidences_to_target.indexOf(this.dynamic.instance_number)!==-1){var calc_height=parseInt(properPage.height*(parseInt(this.scrollable.percentage)/100));if(calc_height>this.max_height){div1.style='min-height: '+calc_height+'px;';div1.className+=' in-content-slider-cont';div2.className+=' in-content-slider-unit';}}}
var gamTargetingKey=referenceNode.getAttribute('data-gamTargetingKey')||'';var gamTargetingValue=referenceNode.getAttribute('data-gamTargetingValue')||'';if(gamTargetingKey){div2.setAttribute('data-gamTargetingKey',gamTargetingKey);}
if(gamTargetingValue){div2.setAttribute('data-gamTargetingValue',gamTargetingValue);}
if(this.dynamic.css_ad!=''){div1.style+=this.dynamic.css_ad;}
if(this.dynamic.css_page!=''){(head=document.head||document.getElementsByTagName('head')[0]),(style=document.createElement('style'));head.appendChild(style);style.type='text/css';if(style.styleSheet){style.styleSheet.cssText=this.dynamic.css_page;}else{style.appendChild(document.createTextNode(this.dynamic.css_page));}}
if(this.flex_enabled){this.addFlexWrapper(referenceNode);}
if(cssplacement=='after'){referenceNode.parentNode.insertBefore(div1,referenceNode.nextSibling);}else if(cssplacement=='before'){referenceNode.parentNode.insertBefore(div1,referenceNode);}else if(cssplacement=='append'){referenceNode.appendChild(div1);}else if(cssplacement=='prepend'){if(referenceNode.childNodes&&referenceNode.childNodes.length>0){referenceNode.insertBefore(div1,referenceNode.childNodes[0]);}else{referenceNode.appendChild(div1);}}else if(cssplacement=='replace'){referenceNode.parentNode.replaceChild(div1,referenceNode);referenceNode=div1;}
div1.appendChild(div2);$(referenceNode).addClass(properPage.dynamic_css_class);};slotObj.prototype.getGamTargetingAttr=function(){var elem=this.getElement();if(elem){var gamKey=elem.getAttribute('data-gamTargetingKey')||'tags';var gamValue=elem.getAttribute('data-gamTargetingValue')??undefined;if(ProperMedia.utils.isStr(gamValue)&&gamValue.includes(',')){gamValue=gamValue.split(',');}
if(typeof gamValue!=='undefined'&&gamValue!==''){this.gamTargeting={key:gamKey,value:gamValue,};}}};slotObj.prototype.buildSlot=function(type,name,settings,referenceNode){this.type=type||'display';this.name=name;this.dfp_name=name;this.parent_name=settings.parent_name;this.number=settings.number||0;this.location=settings.location||'unknown';this.sticky=settings.sticky||0;this.slider=settings.slider||0;this.min_height=settings.min_height||0;this.max_height=settings.max_height||0;this.specified_min_height=settings.min_height?true:false;this.slot_level_auction=!!properOps.slot_level_auction||!!settings.slot_level_auction;this.is_flex_slot=!!settings.is_flex;this.flex_enabled=(this.is_flex_slot?false:settings.flex)||false;this.size_map=settings.resolution_size_map||{};this.mcm_type=settings.mcm_type||properOps.mcm_type;this.dfp_id=this.mcm_type=='mcm'&&properOps.proper_dfp_id!==properOps.dfp_id?properOps.proper_dfp_id+','+properOps.dfp_id:properOps.dfp_id;this.div_id=this.type=='display'?'proper-ad-'+this.name:this.name;this.dfpAdUnitPath='/'+this.dfp_id+'/'+this.name;this.properIframeId=this.div_id+'-iframe';this.dfpIframeId='google_ads_iframe_'+this.dfpAdUnitPath+'_0';this.disable_adx=ProperMedia.utils.deepAccess(settings,'disable_adx.'+(properDevice.isMobile()?'mobile':'desktop'));if(!this.name||(this.type=='display'&&!this.number)){return false;}
if(this.is_flex_slot){this.winning_ad=new adObj(ProperMedia.utils.deepCopy(settings.flex_ad))||{};}
this.max_timeout=settings.max_timeout||ProperMedia.utils.deepAccess(properSpecialOps,'slot_max_timeouts.'+this.dfp_name)||this.max_timeout;this.setDynamic(settings);if(this.dynamic.enabled){this.child_name='dynamic_'+this.dynamic.instance_number;this.dfpAdUnitPath='/'+this.dfp_id+'/'+this.dfp_name+'/'+this.child_name;this.dfpIframeId='google_ads_iframe_'+this.dfpAdUnitPath+'_0';this.name=this.name+'_'+this.dynamic.instance_number;this.number=parseFloat(this.number+this.dynamic.instance_number/100);this.div_id='proper-ad-'+this.name;this.properIframeId=this.div_id+'-iframe';if(settings.custom_css){this.dynamic.css_ad=settings.custom_css[0]?settings.custom_css[0]:'';this.dynamic.css_page=settings.custom_css[1]?settings.custom_css[1]:'';}}
this.getMaxTier();this.parseTierSizes(settings.allowed_size);if(this.flex_enabled){this.setFlexMap(settings.flex_map);}
if(this.sizes.length==0){return false;}
this.setPageRestrictions(settings);if(this.checkPageDepthRestriction()){return false;}
if(this.checkUrlRestriction()){return false;}
this.setUrlandPageviewRules(settings);if(this.checkUrlAndPageviewRules()){return false;}
if(this.interstitial&&properOps.dfp_per_slot==1){return false;}
this.setFloors(settings);this.setLazyload(settings);this.setAutoDelete(settings);this.setScrollableSettings(settings);this.setAdvertisementDisclosure(settings);if(this.dynamic.enabled){this.insertDynamicSlot(referenceNode,this.dynamic.cssplacement);}
if(properUser.checkAdBlockDetected()&&(!properUser.adblock.deliver_to_adblock||['multiple','unknown'].indexOf(this.location)!==-1)){this.kill_slot=true;return false;}
if(!this.getElement()){return false;}
if(!this.sticky&&['sticky','skin'].indexOf(this.location)==-1&&!this.getElement().offsetParent){return false;}
const parentNode=this.getElement().parentNode;if(!this.dynamic.enabled&&this.flex_enabled){this.addFlexWrapper(parentNode);}
if(this.type=='display'&&properDevice.isMobile()&&this.scrollable.enabled&&!this.dynamic.enabled){this.setScrollableElemHeight();}
this.setSliderSettings(settings);if(settings.video_player&&properPage.video_enabled!==false){var player_settings=ProperMedia.utils.deepAccess(properOps,'video_players.'+settings.video_player)||{};if(Object.keys(player_settings).length>0){this.video_player=new videoPlayer(settings.video_player,player_settings,this);this.video_type=this.video_player.player_settings.video_type;properPage.incrementVideoPlayerCount(this,'possible');}}
if(this.type=='display'){this.setRefresh(settings);this.ad_types.push('display','native');if(this.video_player&&properPage.video_enabled!==false){this.ad_types.push('video');}}else if(this.type=='video'&&this.video_player instanceof videoPlayer&&properPage.video_enabled!==false){this.ad_types.push('video');}
this.checkVideoEnabled();if(this.sticky){this.setStickySettings(settings);if(this.checkStickyFreqCapMet()){return false;}
if(!this.getElement().parentNode.className.includes('sticky-inner')){parentNode.classList.add(this.name);const sticky_wrapper=document.createElement('div');sticky_wrapper.setAttribute('class','sticky-inner');sticky_wrapper.setAttribute('style','display:none');if(this.sticky_settings.brand||this.sticky_settings.close_btn){const sticky_left=document.createElement('div');sticky_left.setAttribute('class','inner-left');const sticky_right=document.createElement('div');sticky_right.setAttribute('class','inner-right');const logo_button=document.createElement('a');logo_button.setAttribute('class','brand');logo_button.setAttribute('target','_blank');logo_button.setAttribute('href','https://sovrn.com?ref=ms-sticky');if(this.sticky_settings.brand){logo_button.setAttribute('style','display:block');}
const close_button=document.createElement('div');close_button.setAttribute('class','close');if(this.sticky_settings.close_btn){close_button.setAttribute('style','display:block');}
close_button.onclick=function(e){e.preventDefault();parentNode.classList.remove('isOpen');parentNode.classList.add('close');if(this.sticky_settings.disable_on_close){properUser.stickyFreqCapHandler.setStickyClosedCookie();}
this.deleteSlot(true);}.bind(this);sticky_left.appendChild(logo_button);sticky_right.appendChild(close_button);sticky_wrapper.appendChild(sticky_left);sticky_wrapper.appendChild(sticky_right);}
parentNode.appendChild(sticky_wrapper);sticky_wrapper.insertAdjacentElement('beforeEnd',this.getElement());}}else if(this.slider){if(!this.getElement().parentNode.className.includes('slider_unit')&&this.type=='display'){parentNode.classList.add('slider_unit');if(properPage.width>this.slider_settings.breakpoint){parentNode.classList.add('slider_position_'+this.slider_settings.location.desktop[0]);parentNode.classList.add('slider_position_'+this.slider_settings.location.desktop[1]);}else{parentNode.classList.add('slider_position_'+this.slider_settings.location.mobile[0]);parentNode.classList.add('slider_position_'+this.slider_settings.location.mobile[1]);}
if(this.slider_settings.adjustment_size!=1){document.documentElement.style.setProperty('--slider_mobile_adjustment_size',this.slider_settings.adjustment_size);}
if(this.slider_settings.close_button){const close_button=document.createElement('div');close_button.setAttribute('id','close_button');close_button.setAttribute('name',this.name);close_button.onclick=function(e){e.preventDefault();try{$('.slider_unit #close_button').remove();parentNode.classList.remove('slider_unit');this.disableSlotRefresh();this.closeSliderSlot();}catch(e){console.error(e);}}.bind(this);const text=document.createTextNode('x');close_button.appendChild(text);parentNode.appendChild(close_button);}}}
properPage.slots[this.type][this.name]=this;this.setViewabilityTracker();if((this.type=='display'&&!this.lazyload.enabled)||(this.type=='video'&&ProperMedia.utils.deepAccess(this,'video_player.auto_insert'))){if(!this.checkBidsReady()){this.setWaitInterval();this.setMaxAuctionTimeout();}}
if(this.type=='display'){consentManager.ready(function(){if(properPage.isolated==0){if(properOps.dfp_per_slot==1&&!this.disable_adx){if(this.dfp_init==0){this.initDfp();}else if(this.mapped_dfp_sizes==0){this.buildDfpSizeMapping();}}else{if(properPage.dfp_init==0){properPage.initDfp();}
if(properPage.dfp_init==1){if(this.mapped_dfp_sizes==0&&!this.disable_adx){this.buildDfpSizeMapping();}}}}}.bind(this));}else if(this.interstitial){consentManager.ready(function(){if(!properOps.dfp_per_slot&&!properPage.isolated){if(properPage.dfp_init==0){properPage.initDfp();}
if(properPage.dfp_init==1){if(this.mapped_dfp_sizes==0){this.buildDfpSizeMapping();this.dfp_ready=1;}
if(this.mapped_dfp_sizes==1){if(this.dfp_ready==0){this.addBidToDfpSlot();}
if(this.dfp_ready==1){if(this.dfp_sent==0||this.dfp_refreshed==0){this.dfpDisplayOrRefresh();}}}}}}.bind(this));}
if(this.refresh.enabled&&properPage.init_slots_build==1&&Object.keys(properAdPool.auctions).length==0&&properAdPool.timeout_handle==null&&properAdPool.auction_count<properAdPool.max_auctions){properAdPool.startNewAuction();}
if(properSpecialOps.buildSlotCallback&&properSpecialOps.buildSlotCallback instanceof Function){properLog.mylog('Calling buildSlotCallback for slot: '+this.name);try{properSpecialOps.buildSlotCallback(this);}catch(e){properLog.mylog('Error calling buildSlotCallback for slot: '+this.name);e.name='buildSlotCallbackError';sendError(e);}}
properLog.mylog('Building slot: '+this.name);this.tracking_times.built_ts=ProperMedia.utils.getTimestampMs();return true;};slotObj.prototype.disableSlotRefresh=function(){this.refresh.enabled=0;this.removeRefreshTimeout();};slotObj.prototype.checkVideoEnabled=function(){if(this.ad_types.indexOf('video')!==-1||properPage.video_enabled==true){if(properPage.video_enabled===null){properPage.video_enabled=true;}
properPage.loadVideoPlayerScript();}};slotObj.prototype.resetSlotRefresh=function(){var slot_settings=ProperMedia.utils.deepAccess(properOps,'ad_slots'+'.'+this.type+'.'+this.name)||{};this.setRefresh(slot_settings);this.refresh.count=0;};slotObj.prototype.rebuildSlot=function(){if(this.rebuild_timeout_handle==null&&this.type=='display'){var timeout=Math.max(0,this.min_time_on_page-this.timeSinceDisplayed());properLog.mylog('Rebuilding slot: '+this.name+' ('+timeout+')');var slot_settings=ProperMedia.utils.deepAccess(properOps,'ad_slots'+'.'+this.type+'.'+this.name)||{};this.setRefresh(slot_settings);var last_max_tier=this.max_tier;this.getMaxTier();if(last_max_tier!==this.max_tier){this.parseTierSizes();}
this.rebuild_timeout_handle=properSetTimeout.setTimeout.call(this,function(){clearTimeout(this.rebuild_timeout_handle);this.rebuild_timeout_handle=null;this.refresh.count=0;this.resetBidData();if(this.sizes.length>0){consentManager.ready(function(){if(!this.checkBidsReady()){this.setWaitInterval();this.setMaxAuctionTimeout();}}.bind(this));}},timeout);}};slotObj.prototype.getMaxTier=function(){this.max_tier=0;Object.keys(this.size_map).forEach(function(tier){tier=parseInt(tier);if(properPage.width>=tier&&tier>=this.max_tier){this.max_tier=tier;}},this);};slotObj.prototype.parseTierSizes=function(allowed_size){var min=0;var sizes=this.size_map[this.max_tier]||[];if(this.is_flex_slot&&allowed_size){sizes=[allowed_size];}
if(sizes&&sizes.length>0){for(var i=0;i<sizes.length;i++){var s=sizes[i].split('x');s[0]=parseInt(s[0])||NaN;s[1]=parseInt(s[1])||NaN;if(properUser.checkAdBlockDetected()&&this.location=='in_content'&&(!s[1]||isNaN(s[1])||s[1]>150)){continue;}
this.sizes.push(sizes[i]);if(!isNaN(s[0])&&!isNaN(s[1])){if(s[0]!=1&&s[1]!=1){if(s[0]<this.min_width||this.min_width==0)this.min_width=s[0];if((s[1]<this.min_height||this.min_height==0)&&!this.specified_min_height)this.min_height=s[1];if(s[1]>this.max_height||this.max_height==0)this.max_height=s[1];if(s[0]*s[1]<min||min==0){this.default_size=sizes[i].split('x');min=s[0]*s[1];}}}else if(sizes[i]=='interstitial'){this.setInterstitial();break;}}
return true;}
return false;};slotObj.prototype.setInterstitial=function(){this.type='interstitial';this.ad_types=['interstitial'];this.sizes=['interstitial'];this.interstitial=true;this.min_width=1;this.min_height=1;this.default_size=[1,1];this.refresh.enabled=false;this.lazyload.enabled=false;};slotObj.prototype.googletag=function(){if(!this.google_tag){if(properOps.dfp_per_slot==1){this.google_tag={};}else{this.google_tag=googletag;}}
if(typeof this.google_tag.cmd=='undefined'){this.google_tag.cmd=[];}
return this.google_tag;};slotObj.prototype.buildDfpSizeMapping=function(){if(this.getElement()&&this.sizes.length>0&&this.mapped_dfp_sizes==0){this.googletag().cmd.push(function(){var sizes=[[1,1]];for(var i=0;i<this.sizes.length;i++){var size=this.sizes[i];if(size=='1x1')continue;if(['400x300','640x480'].indexOf(size)!==-1)continue;var w_h=size.split('x');w_h[0]=parseInt(w_h[0]);w_h[1]=parseInt(w_h[1]);if(!isNaN(w_h[0])&&!isNaN(w_h[1])){sizes.push(w_h);}else if(size=='fluid'){sizes.push(size);}}
if(this.interstitial){this.dfp_slot=this.googletag().defineOutOfPageSlot(this.dfpAdUnitPath,this.googletag().enums.OutOfPageFormat.INTERSTITIAL).addService(this.googletag().pubads());if(this.dfp_slot){this.div_id=this.dfp_slot.getSlotElementId();}}else if(ProperMedia.utils.checkOutOfPage(this.dfpAdUnitPath)){this.dfp_slot=this.googletag().defineOutOfPageSlot(this.dfpAdUnitPath,this.div_id).addService(this.googletag().pubads());}else if(this.sticky&&properSpecialOps.sliderHeader){this.dfp_slot=this.googletag().defineSlot(this.dfpAdUnitPath,sizes,this.div_id).setCollapseEmptyDiv(true).addService(this.googletag().pubads());}else{this.dfp_slot=this.googletag().defineSlot(this.dfpAdUnitPath,sizes,this.div_id).addService(this.googletag().pubads());}
this.dfp_slot.setTargeting('proper_slot',this.number);if(this.sticky){this.dfp_slot.setTargeting('proper_sticky',this.sticky.toString());}
if(Object.keys(this.floors.sizes).length>0){Object.keys(this.floors.sizes).map(function(size){if(this.sizes.indexOf(size)!==-1){var floor=this.floors.sizes[size];if(floor>this.floors.backup){var rounded_size_floor=round_floor(floor);this.dfp_slot.setTargeting('proper_floor_'+size,rounded_size_floor.toFixed(2).toString());}}},this);}
var rounded_slot_floor=round_floor(this.floors.backup);this.dfp_slot.setTargeting('proper_floor',rounded_slot_floor.toFixed(2).toString());}.bind(this));this.mapped_dfp_sizes=1;if(this.bids_ready&&!this.dfp_ready){this.addBidToDfpSlot();}}};slotObj.prototype.clearWinningBid=function(){if(this.hasWinningBid()){if(this.winning_ad.displayed==0&&!this.winning_ad.checkIfExpired()){properAdPool.addBidToPool(this.winning_ad);}
delete this.winning_ad;this.winning_ad={};if(this.hasFlexBids()){this.clearFlexBid();}}
return true;};slotObj.prototype.hasWinningBid=function(){return this.winning_ad instanceof adObj&&this.winning_ad.bidder!==''&&this.winning_ad.price>0&&this.winning_ad.id;};slotObj.prototype.hasFlexBids=function(){return(!this.is_flex_slot&&this.flex_enabled&&this.flex_ads.length&&this.flex_ads?.every((flex_ad)=>flex_ad instanceof adObj&&flex_ad.bidder!==''&&flex_ad.price>0&&flex_ad.id));};slotObj.prototype.getWinningBid=function(ad_types,video_type){ad_types=ad_types??this.ad_types;video_type=video_type??this.video_type;this.clearWinningBid();const{flex_ads,winning_ad}=properAdPool.getWinningBids(this,ad_types,video_type);this.winning_ad=winning_ad;this.flex_ads=[...flex_ads];if(this.hasFlexBids()){properLog.mylog(`FLEX WIN! (${this.name}, bidder=${this.winning_ad?.bidder} + ${this.flex_ads?.map((ad)=>ad.bidder).join(' + ')}, size=${
this.winning_ad?.size
}, price=${this.winning_ad?.price} + ${this.flex_ads?.map((ad)=>ad.price).join(' + ')})`);}
return this.hasWinningBid();};slotObj.prototype.getRunnerUp=function(ad_types,video_type){if(!this.hasWinningBid())return 0;ad_types=ad_types??this.ad_types;video_type=video_type??this.video_type;const ads=properAdPool.ads.filter((ad)=>ad.size===this.winning_ad.size);const runner_up=properAdPool.getWinningBid(this,ad_types,video_type,ads);return runner_up?.price??0;};slotObj.prototype.clearWinningAmazonBid=function(){if(this.hasWinningAmazonBid()){if(this.winning_amazon_ad.displayed==0&&!this.winning_amazon_ad.checkIfExpired()){properAdPool.addAmazonBidToPool(this.winning_amazon_ad);}
delete this.winning_amazon_ad;this.winning_amazon_ad={};}
return true;};slotObj.prototype.hasWinningAmazonBid=function(){if(this.winning_amazon_ad instanceof adObj&&this.winning_amazon_ad.bidder!==''&&this.winning_amazon_ad.price&&this.winning_amazon_ad.id){return true;}else{return false;}};slotObj.prototype.getWinningAmazonBid=function(ad_types,video_type){ad_types=ad_types??this.ad_types;video_type=video_type??this.video_type;this.clearWinningAmazonBid();properAdPool.getWinningAmazonBid(this,ad_types,video_type);return this.hasWinningAmazonBid();};slotObj.prototype.clearNonWinningBid=function(winning_ad){if(this.hasWinningAmazonBid()&&ProperMedia.utils.deepAccess(this,'winning_amazon_ad.id')!==ProperMedia.utils.deepAccess(winning_ad,'id')){this.clearWinningAmazonBid();}else if(this.hasWinningBid()&&ProperMedia.utils.deepAccess(this,'winning_ad.id')!==ProperMedia.utils.deepAccess(winning_ad,'id')){this.clearWinningBid();}
return true;};slotObj.prototype.checkBidsReady=function(){if(properUser.checkAdBlockDetected()&&(!properUser.adblock.deliver_to_adblock||['multiple','unknown'].indexOf(this.location)!==-1)){this.deleteSlot(true);return false;}
if(checkKillAllAds()||!this.getElement()||this.kill_slot==true||this.interstitial||this.dfp_ready||this.auction_send_complete||(this.lazyload.enabled&&!this.lazyload.inRenderZone)){return false;}
var time_to_next_auction_ms=properAdPool.calcTimeout();var auction_time_passed_ms=ProperMedia.utils.getTimePassed(this.auction_started_ts);var max_timeout_left_ms=this.max_timeout-auction_time_passed_ms;if(((time_to_next_auction_ms==0&&properAdPool.auction_count==0)||Object.keys(properAdPool.auctions).length>0||Object.keys(properAdPool.finished_auctions).length==0)&&!this.max_timeout_met){return false;}
if(this.getWinningBid(this.ad_types,this.video_type)||max_timeout_left_ms<time_to_next_auction_ms||this.max_timeout_met){this.bids_ready=1;this.tracking_times.bids_ready_ts=ProperMedia.utils.getTimestampMs();if(this.type=='display'&&((this.hasWinningBid()&&this.ad_types.indexOf(this.winning_ad.type)!==-1&&(['display','native'].indexOf(this.winning_ad.type)!==-1||(this.winning_ad.type=='video'&&this.winning_ad.video_type=='outstream')))||(!this.hasWinningBid()&&(max_timeout_left_ms<time_to_next_auction_ms||this.max_timeout_met)))){if(this.ad_types.indexOf('video')!==-1&&this.video_player instanceof videoPlayer){this.video_player.removePlayer();}
if(this.disable_adx==1||properPage.isolated==1||(this.refresh.count>0&&this.refresh.exclude_dfp==1)){if(!this.lazyload.enabled||this.lazyload.inRenderZone){if(this.videoAdCheck()){this.dispalyVideoAd();}else if(showWinningAd(this)){this.auction_send_complete=true;}}}else{if(properOps.dfp_per_slot==1){if(this.dfp_init==0){this.initDfp();}else if(this.mapped_dfp_sizes==0){this.buildDfpSizeMapping();}else if(this.dfp_ready==0){this.addBidToDfpSlot();}else if(!this.dfp_sent||!this.dfp_refreshed){this.dfpDisplayOrRefresh();}}else{if(properPage.dfp_init==0){properPage.initDfp();}
if(properPage.dfp_init==1){if(this.mapped_dfp_sizes==0){this.buildDfpSizeMapping();}
if(this.mapped_dfp_sizes==1){if(this.dfp_ready==0){this.addBidToDfpSlot();}
if(this.dfp_ready==1){if(this.dfp_sent==0||this.dfp_refreshed==0){this.dfpDisplayOrRefresh();}}}}}}}else if(this.videoAdCheck()){this.dispalyVideoAd();}
if(this.dfp_ready||this.auction_send_complete){this.clearWaitInterval();this.clearMaxAuctionTimeout();}
return true;}else{this.clearWinningBid();return false;}};slotObj.prototype.videoAdCheck=function(){return(this.checkVideoInviewLimit()&&((this.hasWinningBid()&&this.winning_ad.type=='video'&&this.ad_types.indexOf(this.winning_ad.type)!==-1)||(this.hasWinningAmazonBid()&&this.winning_amazon_ad.type=='video'&&this.ad_types.indexOf(this.winning_amazon_ad.type)!==-1)||(this.type=='video'&&this.max_timeout_met))&&this.video_player&&this.video_player instanceof videoPlayer);};slotObj.prototype.dispalyVideoAd=function(){if(this.hasFlexSlot()){this.removeFlexSlot();}
this.refresh.enabled=0;this.removeRefreshTimeout();this.auction_send_complete=true;this.video_player.removePlayer();this.video_player.insertPlayer();};slotObj.prototype.initDfp=function(){if(this.dfp_init==1||properPage.isolated==1)return false;var iframe_window,iframe_needs_dfp_script=false;if(this.iframe_window){iframe_window=this.iframe_window;iframe_needs_dfp_script=true;}else if(this.iframe_id){const iframe=document.getElementById(this.iframe_id);if(!iframe){properLog.mylog('ERROR: '+this.iframe_id+" doesn't exist in the DOM.");return;}
this.iframe_window=iframe.contentWindow;iframe_window=iframe.contentWindow;iframe_needs_dfp_script=true;}else{const doc=document.getElementById(this.div_id);if(!doc){properLog.mylog('WARNING: '+this.div_id+" doesn't exist in the DOM. This should re-run when proper_display is called");return;}
const iframe=document.createElement('iframe');doc.innerHTML='';doc.appendChild(iframe);iframe.id=this.properIframeId;iframe.frameBorder=0;iframe.scrolling='no';iframe.marginWidth='0';iframe.marginHeight='0';iframe.style.overflow='hidden';iframe.style.border='0px';iframe.style.width='1px';iframe.style.height='1px';iframe.style.verticalAlign='bottom';const html="<html><head><script src='https://securepubads.g.doubleclick.net/tag/js/gpt.js' async></script></head><body><div id='"+
this.div_id+
"'></div></body></html>";iframe.src='javascript:"'+html+'"';iframe.contentWindow.document.open();iframe.contentWindow.document.write(html);iframe.contentWindow.document.close();iframe_window=iframe.contentWindow;this.iframe_window=iframe_window;}
if(iframe_needs_dfp_script){var gads=document.createElement('script');gads.async=true;gads.type='text/javascript';var useSSL='https:'==document.location.protocol;gads.src=(useSSL?'https:':'http:')+'//securepubads.g.doubleclick.net/tag/js/gpt.js';iframe_window.document.getElementsByTagName('head')[0].appendChild(gads);}
if(ProperMedia.utils.deepAccess(properOps,'confiant.enabled')||ProperMedia.utils.deepAccess(properSpecialOps,'confiant.enabled')){confiantWrapper.loadDFPTag(iframe_window);}else if(ProperMedia.utils.deepAccess(properOps,'adlightning.enabled')||ProperMedia.utils.deepAccess(properSpecialOps,'adlightning.enabled')){adLightningWrapper.loadDFPTag(iframe_window);}
iframe_window.googletag=iframe_window.googletag||{};this.google_tag=iframe_window.googletag||{};if(typeof this.googletag().cmd=='undefined')this.googletag().cmd=[];this.googletag().cmd.push(function(){if(!gdprEnforcement.deviceAccessEnforcement(755,'gam')||!gdprConsentModule.hasPurpose4Consent()){properLog.mylog('DFP: disable personalized GPT ads');this.googletag().pubads().setPrivacySettings({nonPersonalizedAds:true,});}
if(uspConsent.restrictDataProcessing){this.googletag().pubads().setPrivacySettings({restrictDataProcessing:true,});}
this.googletag().pubads().addEventListener('slotOnload',function(event){var slot_name=ProperMedia.utils.extractSlotName(event.slot.getSlotElementId());var slot=properPage.getSlotFromPageObject(slot_name);properLog.mylog('DFP slotOnload: '+slot_name);if(slot){slot.dispatchCustomEvent('proper-ads-fired',{cpm:ProperMedia.utils.deepAccess(slot,'displayed_ad.price'),size:ProperMedia.utils.deepAccess(slot,'displayed_ad.size'),ad_type:ProperMedia.utils.deepAccess(slot,'displayed_ad.type'),});}});this.googletag().pubads().addEventListener('impressionViewable',function(event){var slot_name=ProperMedia.utils.extractSlotName(event.slot.getSlotElementId());var ad_unit_path=event.slot.getAdUnitPath();var slot=properPage.getSlotFromPageObject(slot_name)||properPage.getSlotFromPageObjectByAdUnitPath(ad_unit_path);if(slot){properLog.mylog('DFP impressionViewable: '+slot_name);slot.dispatchCustomEvent('proper-impression-viewable',{cpm:ProperMedia.utils.deepAccess(slot,'displayed_ad.price'),size:ProperMedia.utils.deepAccess(slot,'displayed_ad.size'),ad_type:ProperMedia.utils.deepAccess(slot,'displayed_ad.type'),});}});this.googletag().pubads().addEventListener('slotRenderEnded',TraceKit.wrap(function(event){var slot_id=event.slot.getSlotElementId();var slot_name=ProperMedia.utils.extractSlotName(slot_id);var slot=properPage.getSlotFromPageObject(slot_name);properLog.mylog('DFP slotRenderEnded: '+slot_name);if(slot){slot.tracking_times.dfp_returned_ts=ProperMedia.utils.getTimestampMs();if(event.advertiserId!==properOps.proper_advertiser&&event.advertiserId!=properOps.amazon_advertiser){if(!event.isEmpty){proper_render_dfp(slot_name,event);proper_inview(event.isEmpty,slot_name,event.size.join('x'),event.creativeId,event.lineItemId,event.advertiserId);}else{proper_render(slot.getElement(),slot.number,1);}}
if((!slot.sticky&&ProperMedia.utils.deepAccess(properSpecialOps,'adlightning.enabled')&&ProperMedia.utils.deepAccess(properSpecialOps,'adlightning.reportAd'))||(ProperMedia.utils.deepAccess(properOps,'adlightning.enabled')&&ProperMedia.utils.deepAccess(properOps,'adlightning.reportAd'))){adLightningWrapper.addReportAd(event);}}}));this.googletag().pubads().addEventListener('slotOnload',TraceKit.wrap(function(event){var slot_name;try{slot_name=ProperMedia.utils.extractSlotName(event.slot.getSlotElementId());var slot=properPage.getSlotFromPageObject(slot_name);properLog.mylog('DFP slotOnload: '+slot_name);if(slot){var properIframeContentDocument=slot.getContentDocument();if(properIframeContentDocument&&properIframeContentDocument.getElementById(slot.dfpIframeId)){var googleIframeContentDocument=properIframeContentDocument.getElementById(slot.dfpIframeId).contentWindow.document;if(googleIframeContentDocument){if(googleIframeContentDocument.getElementById('common_15click_overlay')||googleIframeContentDocument.getElementById('common_15click_anchor')){sendError(new Error('Detected Google Confirmed Click: '+
slot.dfp_name+
' | '+
ProperMedia.utils.deepAccess(slot,'displayed_ad.size')));}}}}}catch(e){properLog.mylog('Error Detecting Google Confirmed Click: '+slot_name);}}));setDfpPageTargeting(this.googletag().pubads());this.googletag().pubads().setPrivacySettings({childDirectedTreatment:ProperMedia.utils.deepAccess(properSpecialOps,'coppa')?true:false,});this.googletag().pubads().disableInitialLoad();this.googletag().pubads().setPublisherProvidedId(properUser.pubcid);this.googletag().pubads().enableSingleRequest();this.googletag().enableServices();this.dfp_enabled_services=true;}.bind(this));this.dfp_init=1;this.buildDfpSizeMapping();};slotObj.prototype.addBidToDfpSlot=function(){this.googletag().cmd.push(function(){if(this.dfp_ready||!this.mapped_dfp_sizes||!this.isSlotDefinedInGPT()){return false;}
if(this.dfp_slot.getTargeting('sovrn_amznbid').length>0){this.dfp_slot.clearTargeting('sovrn_amznbid');}
if(this.dfp_slot.getTargeting('sovrn_amzniid').length>0){this.dfp_slot.clearTargeting('sovrn_amzniid');}
if(this.hasWinningBid()&&(ProperMedia.utils.deepAccess(this,'winning_ad.type')!=='video'||ProperMedia.utils.deepAccess(this,'winning_ad.video_type')=='outstream')){if(this.hasFlexBids()){this.winning_ad.dfp_price=roundPriceToDfpBucket(parseFloat(this.winning_ad.dfp_price)+this.flex_ads.reduce((sum,ad)=>sum+parseFloat(ad.dfp_price),0));}else{this.winning_ad.dfp_price=roundPriceToDfpBucket(parseFloat(this.winning_ad.price));}
this.dfp_bid_price=this.winning_ad.dfp_price;properLog.mylog('Bid added to DFP request ('+
this.winning_ad.bidder+
', '+
this.name+
'@'+
this.winning_ad.size+
') = '+
this.winning_ad.dfp_price);this.dfp_slot.setTargeting('proper_bidder',properOps.site_name+'_'+this.winning_ad.bidder);this.dfp_slot.setTargeting('proper_bid',this.dfp_bid_price.toString());}else{this.dfp_bid_price=roundPriceToDfpBucket(ProperMedia.utils.deepAccess(this,'floors.backup'));if(this.dfp_slot.getTargeting('proper_bid').length>0){this.dfp_slot.clearTargeting('proper_bid');}
if(this.dfp_slot.getTargeting('proper_bidder').length>0){this.dfp_slot.clearTargeting('proper_bidder');}
properLog.mylog('Floor added to DFP request ( Floor, '+this.name+') = '+this.dfp_bid_price);}
if(this.getWinningAmazonBid()&&(ProperMedia.utils.deepAccess(this,'winning_amazon_ad.type')!=='video'||ProperMedia.utils.deepAccess(this,'winning_amazon_ad.video_type')=='outstream')){properLog.mylog('Amazon Bid added to DFP request ('+this.name+'@'+this.winning_amazon_ad.size+') = '+this.winning_amazon_ad.price);this.dfp_slot.setTargeting('sovrn_amznbid',ProperMedia.utils.deepAccess(this,'winning_amazon_ad.price'));this.dfp_slot.setTargeting('sovrn_amzniid',ProperMedia.utils.deepAccess(this,'winning_amazon_ad.ad_details.amzniid'));this.winning_amazon_ad.dfp_price=ProperMedia.utils.deepAccess(this,'winning_amazon_ad.price');this.dfp_bid_price=_0x4f6067(this);}
if(this.customGamTargeting.length){this.customGamTargeting.forEach(function(gamKey){this.dfp_slot.clearTargeting(gamKey);},this);this.customGamTargeting=[];}
this.getGamTargetingAttr();if(this.gamTargeting.key&&this.gamTargeting.value!==''&&typeof this.gamTargeting.value!=='undefined'){properLog.mylog(`DFP request slot targeting ${this.name}: ${this.gamTargeting.key} = ${this.gamTargeting.value}`);this.dfp_slot.setTargeting(this.gamTargeting.key,this.gamTargeting.value);this.customGamTargeting.push(this.gamTargeting.key);}
if(typeof this.refresh.count==='undefined'){this.dfp_slot.setTargeting('refresh_count',0);}else{this.dfp_slot.setTargeting('refresh_count',this.refresh.count.toString());}
this.dfp_ready=1;if(this.getElement()){this.dfpDisplayOrRefresh();}}.bind(this));};slotObj.prototype.dfpDisplayOrRefresh=function(){this.googletag().cmd.push(function(){if(!this.dfp_sent){this.dfp_sent=1;this.googletag().display(this.div_id);properLog.mylog('DFP display called: '+this.name);}
if(properOps.dfp_per_slot==1){this.dfpSraCall();}else{if(!ProperMedia.utils.deepAccess(properPage,'sra_settings.slot_queue.'+this.name)){properPage.sra_settings.slot_queue[this.name]=this;clearTimeout(properPage.sra_settings.timeout_handler);properPage.sra_settings.timeout_handler=null;properPage.sra_settings.timeout_handler=properSetTimeout.setTimeout.call(properPage,function(){properPage.dfpSraCall();},properSpecialOps.sra_timoeut_ms||properPage.sra_settings.timeout_ms);}}}.bind(this));};slotObj.prototype.dfpSraCall=function(){this.googletag().cmd.push(function(){if(properSpecialOps.update_correlator==1&&properPage.dfp_correlator==false&&properPage.spa_settings.page_number>1){this.googletag().pubads().updateCorrelator();properPage.dfp_correlator=true;properLog.mylog('Correlator updated for page: '+properPage.spa_settings.page_number);}
this.tracking_times.dfp_sent_ts=ProperMedia.utils.getTimestampMs();properLog.mylog('DFP refresh called: '+this.name);this.dfp_refreshed=1;this.auction_send_complete=true;this.googletag().pubads().refresh([this.dfp_slot]);}.bind(this));};slotObj.prototype.setWaitInterval=function(){properLog.mylog('Set wait interval for '+this.name+' ( '+this.wait_interval+' )');var obj=this;if(this.wait_interval_handle==null){this.wait_interval_handle=properSetInterval.setInterval.call(obj,function(){obj.checkBidsReady();},obj.wait_interval);}};slotObj.prototype.clearWaitInterval=function(){clearInterval(this.wait_interval_handle);this.wait_interval_handle=null;};slotObj.prototype.setMaxAuctionTimeout=function(){var obj=this;if(this.max_timeout_handle==null){this.auction_started_ts=ProperMedia.utils.getTimestampMs();this.max_timeout_handle=properSetTimeout.setTimeout.call(obj,function(){obj.max_timeout_met=true;obj.clearWaitInterval();obj.clearMaxAuctionTimeout();obj.checkBidsReady();},obj.max_timeout);}};slotObj.prototype.clearMaxAuctionTimeout=function(){clearTimeout(this.max_timeout_handle);this.max_timeout_handle=null;};slotObj.prototype.setRefreshInterval=function(){if(this.refresh.enabled==0||(ProperMedia.utils.deepAccess(this,'displayed_ad.displayed')==1&&ProperMedia.utils.deepAccess(properOps,'bidder_info.'+this.displayed_ad.bidder+'.dont_refresh')==1)){this.refresh.enabled=0;return false;}
var refresh_interval=Math.max(this.refresh.interval,this.refresh.min_interval);if(this.refresh.inview_interval!==-1&&!this.sticky){if(this.viewability.viewable){refresh_interval=Math.max(0,this.refresh.inview_interval-this.viewability.total_time_inview,refresh_interval-this.timeSinceDisplayed());}else{return false;}}else{refresh_interval=Math.max(0,refresh_interval-this.timeSinceDisplayed());}
this.refresh.current_interval=refresh_interval;this.addRefreshTimeout(this.refresh.current_interval);return true;};slotObj.prototype.addRefreshTimeout=function(refresh_interval){var obj=this;this.removeRefreshTimeout();this.refresh_handler=properSetTimeout.setTimeout.call(obj,function(){obj.removeRefreshTimeout();obj.refreshSlot();},refresh_interval);properLog.mylog(this.name+': Starting refresh timer. ms = '+refresh_interval);};slotObj.prototype.timeSinceDisplayed=function(){if(this.last_displayed_ts==0)return 0;return Date.now()-this.last_displayed_ts;};slotObj.prototype.removeRefreshTimeout=function(){if(this.refresh_handler){properLog.mylog(this.name+': Removing refresh timer.');clearTimeout(this.refresh_handler);this.refresh_handler=null;}};slotObj.prototype.resetBidData=function(){this.last_displayed_ts=0;this.bids_ready=0;this.dfp_ready=0;this.dfp_refreshed=0;this.dfp_bid_price=0;this.winning_ad={};this.exclude_advertiser=[];this.advertiserId=0;this.auction_started_ts=0;this.max_timeout_met=false;this.auction_send_complete=false;this.adl_blocked=false;this.viewability.entered_inview_ts=this.viewability.viewable?ProperMedia.utils.getTimestampMs():0;this.viewability.total_time_inview=0;this.clearWaitInterval();this.clearMaxAuctionTimeout();this.removeRefreshTimeout();};slotObj.prototype.refreshSlot=function(force){if(properUser.checkAdBlockDetected()){this.refresh.enabled=0;}
if((this.refresh.count<this.refresh.max&&this.refresh.enabled)||force){if(this.lazyload.enabled&&!this.lazyload.inFetchZone){return false;}
properLog.mylog('Refreshing slot: '+this.name);this.refresh.count++;this.resetBidData();if(this.slot_level_auction){properAdPool.sendAuction(true,[this]);this.setWaitInterval();this.setMaxAuctionTimeout();}else if(!this.checkBidsReady()){this.setWaitInterval();this.setMaxAuctionTimeout();}
return true;}else{return false;}};slotObj.prototype.getTimeInview=function(){if(this.viewability.entered_inview_ts==0)return 0;return Date.now()-this.viewability.entered_inview_ts;};slotObj.prototype.viewabilityChange=function(viewabilityObj){if(viewabilityObj.inDeleteZone){this.deleteSlot(true);return false;}
if(this.viewability.viewable!==viewabilityObj.viewable||this.viewability.activeTab!==viewabilityObj.activeTab){properLog.mylog(this.name+': Viewability Change. visible = '+viewabilityObj.viewable+' Active Tab = '+viewabilityObj.activeTab);this.viewability.viewable=viewabilityObj.viewable;if(this.displayed&&this.refresh.enabled&&this.refresh.count<this.refresh.max&&viewabilityObj.activeTab&&((viewabilityObj.viewable&&this.refresh.inview_interval!==-1)||this.refresh.inview_interval==-1||this.sticky)){this.setRefreshInterval();}else{this.removeRefreshTimeout();}
if(viewabilityObj.viewable){this.dispatchCustomEvent('inview');this.viewability.entered_inview_ts=ProperMedia.utils.getTimestampMs();if(ProperMedia.utils.deepAccess(this,'displayed_ad.type')=='video'){properPage.incrementVideoPlayerCount(this,'inview');}}else{this.dispatchCustomEvent('not-inview');this.viewability.total_time_inview+=this.getTimeInview();if(ProperMedia.utils.deepAccess(this,'displayed_ad.type')=='video'){properPage.decrementVideoPlayerCount(this,'inview');}}
this.viewability.activeTab=viewabilityObj.activeTab;}
if(!this.viewability.viewable&&!this.getElement()){this.deleteSlot(true);return false;}
if(this.lazyload.enabled){if(this.lazyload.inFetchZone!==viewabilityObj.inFetchZone){properLog.mylog(this.name+': LazyLoad Change. inFetchZone = '+viewabilityObj.inFetchZone);this.lazyload.inFetchZone=viewabilityObj.inFetchZone;if(this.lazyload.inFetchZone){if(!this.wait_interval_handle&&!this.max_timeout_met){this.setWaitInterval();}
if(!this.max_timeout_handle&&!this.max_timeout_met){this.setMaxAuctionTimeout();}}else{this.clearWaitInterval();}}
if(this.lazyload.inRenderZone!==viewabilityObj.inRenderZone){properLog.mylog(this.name+': LazyLoad Change. inRenderZone = '+viewabilityObj.inRenderZone);this.lazyload.inRenderZone=viewabilityObj.inRenderZone;if(this.lazyload.inRenderZone){this.checkBidsReady();}}}
return true;};slotObj.prototype.dispatchCustomEvent=function(event_type,ext){ext=ext||{};const detail=ProperMedia.utils.mergeObject({slot:this.name,event:event_type,},ext);const event=new CustomEvent('properEvents',{detail:detail});window.dispatchEvent(event);};slotObj.prototype.getGPTSlots=function(){var gpt_slots=[];if(properPage.isolated==0){this.googletag().cmd.push(function(){gpt_slots=this.googletag().pubads().getSlots().map(function(slot){return slot.getSlotElementId();});}.bind(this));}
return gpt_slots;};slotObj.prototype.isSlotDefinedInGPT=function(){if(!this.div_id)return false;return this.getGPTSlots().indexOf(this.div_id)!==-1;};slotObj.prototype.removeCreative=function(){if(this.refresh.count>0&&ProperMedia.utils.deepAccess(this,'displayed_ad.bidder')){if(typeof bidAdapters[this.displayed_ad.bid_adapter_name]!=='undefined'&&typeof bidAdapters[this.displayed_ad.bid_adapter_name].removeCreative=='function'){bidAdapters[this.displayed_ad.bid_adapter_name].removeCreative(this);}}};slotObj.prototype.closeSliderSlot=function(){if(!this.slider_settings.keep_on_close){this.deleteSlot(false);var elem=window.top.document.getElementById(this.div_id);if(elem){elem.innerHTML='';}}
return true;};slotObj.prototype.removeElemFromDOM=function(){try{var elem=this.sticky?window.top.document.getElementsByClassName('proper-ad-unit ad-sticky '+this.name)[0]:window.top.document.getElementById(this.div_id);if(elem){if(elem.parentNode.className.indexOf(properOps.slot_wrapper_class)!==-1){elem=elem.parentNode;}
elem.parentNode.removeChild(elem);if(this.is_flex_slot){const flex_id=this.dynamic?.cssselector;const flex_elem=window.top.document.querySelector(flex_id);flex_elem?.parentNode.removeChild(flex_elem);}}}catch(e){properLog.mylog('Error deleting slot: '+this.name);}};slotObj.prototype.deleteSlot=function(removeFromDOM){try{if(this.kill_slot==false){this.kill_slot=true;this.refresh.enabled=0;if(this.ad_types.indexOf('video')!==-1){properPage.decrementVideoPlayerCount(this,'possible');if(ProperMedia.utils.deepAccess(this,'displayed_ad.type')=='video'&&this.video_player instanceof videoPlayer){this.video_player.removePlayer();}}
this.resetBidData();this.lazyload.enabled=0;this.destroyDfpSlot();properPage.viewability_tracker.removeElement(this.div_id);if(removeFromDOM&&this.getElement()){this.removeElemFromDOM();}
if(properPage.getSlotFromPageObject(this.name,[this.type])){delete properPage.slots[this.type][this.name];}
properLog.mylog('Deleted Slot: '+this.name);}}catch(e){console.error(e);}};slotObj.prototype.destroyDfpSlot=function(){if(properPage.isolated==0&&this.isSlotDefinedInGPT()){this.googletag().cmd.push(function(){this.googletag().destroySlots([this.dfp_slot]);}.bind(this));(this.dfp_slot={}),(this.dfp_init=0),(this.dfp_ready=0),(this.dfp_sent=0),(this.dfp_refreshed=0),(this.mapped_dfp_sizes=0);}};slotObj.prototype.getDefinedSizes=function(){if(!this.defined_sizes.length){this.sizes.forEach((size)=>{const wxh=ProperMedia.utils.getHeightAndWidth(size);if(wxh)this.defined_sizes.push(wxh);});}
return this.defined_sizes;};slotObj.prototype.setFlexMap=function(flex_map){if(flex_map&&Object.keys(flex_map).length){this.flex_map=flex_map[this.max_tier]??{};}else{const defined_sizes=this.getDefinedSizes();this.flex_map=defined_sizes.reduce((acc,[width,height])=>{const parentSize=defined_sizes.find(([parentWidth,parentHeight])=>(+width*2<=+parentWidth&&+height<=+parentHeight)||(+height*2<=+parentHeight&&+width<=+parentWidth));if(parentSize){const[parentWidth,parentHeight]=parentSize;const widthMultiple=Math.floor(parentWidth/width);const heightMultiple=Math.floor(parentHeight/height);acc[`${width}x${height}`]=Math.max(widthMultiple,heightMultiple);}
return acc;},{});}
return this.flex_map;};return slotObj;})();var videoPlayer=function(player_id,settings,slot){this.slot=null,this.auto_insert=false,this.auto_inserted=false,this.player_settings={"id":'',"div_id":'',"dfp_ad_unit":'',"video_id":'',"video_type":'',"number_of_ads":10,"autoplay":1,"backfill":false,"backfill_id":'',"small_player":"desktop_ad","small_player_bottom":100,"ad_failure_limit":5,"vast_timeout":5000,"no_ads_no_player":false,"horizontal_slider":"right","vertical_slider":"bottom"},this.getElement=function(){return top.document.getElementById(this.player_settings.div_id);}
this.init=function(player_id,settings,slot){this.slot=slot;this.checkAutoInsert();this.setPlayerSettings(player_id,settings.player_settings)}
this.checkAutoInsert=function(){var elem=top.document.getElementById(this.slot.div_id);if(elem&&(elem.classList.contains("propervideo-main_player_container")||elem.hasAttribute("data-video-id"))){this.div_id=this.slot.div_id;this.auto_insert=false;}else{this.auto_insert=true;}}
this.setPlayerSettings=function(player_id,player_settings){if(this.slot.slider){var device_type=properDevice.isMobile()?'mobile':'desktop';var location=ProperMedia.utils.deepAccess(this.slot,'slider_settings.location.'+device_type)||['right','bottom'];player_settings["horizontal_slider"]=location[0]||'right';player_settings["vertical_slider"]=location[1]||'bottom';player_settings["close_button"]=ProperMedia.utils.deepAccess(this.slot,'slider_settings.close_button');player_settings["keep_on_close"]=ProperMedia.utils.deepAccess(this.slot,'slider_settings.keep_on_close');}
var div_id=(this.player_settings.div_id)?this.player_settings.div_id:player_id+"-"+ProperMedia.utils.makeid(10);var player_settings=ProperMedia.utils.mergeObject({},this.player_settings,(player_settings||{}),{"id":player_id,"div_id":div_id,"dfp_id":this.slot.dfp_id});player_settings.autoplay=player_settings.autoplay?1:0;this.player_settings=ProperMedia.utils.deepCopy(player_settings);}
this.insertPlayer=function(){var elem=top.document.getElementById(this.slot.div_id);if(this.slot.slider&&$(".slider_unit #close_button").obj){$(".slider_unit #close_button").remove();}
if(elem&&this.auto_insert){if(!document.getElementById(this.player_settings.div_id)){this.slot.getElement().innerHTML='';if(properOps.dfp_per_slot){var iframeElem=top.document.getElementById(this.slot.div_id+'-iframe');if(iframeElem){iframeElem.style.width='0px';iframeElem.style.height='0px';}}
var playerElem=this.buildPlayerElem();elem.prepend(playerElem);this.auto_inserted=true;}else{window.top.propervideotag=window.top.propervideotag||[];if(this.auto_inserted&&this.player_settings.video_type=='outstream'){window.top.propervideotag.push((function(){window.top.propervideo_display(this.player_settings.div_id,this.slot.name,properOps.site_name,"outstream_restart");}).bind(this));}else{window.top.propervideotag.push((function(){window.top.propervideo_display(this.player_settings.div_id,this.slot.name,properOps.site_name);}).bind(this));}}}
properPage.incrementVideoPlayerCount(this.slot,'onpage');if(this.slot.viewability.viewable){properPage.incrementVideoPlayerCount(this.slot,'inview');}}
this.removePlayer=function(){try{var elem=top.document.getElementById(this.player_settings.div_id);if(elem){this.auto_inserted=false;elem.remove();}
this.destroyVideoPlayerObj();properPage.decrementVideoPlayerCount(this.slot,'onpage');if(this.slot.viewability.viewable){properPage.decrementVideoPlayerCount(this.slot,'inview');}}catch(e){}}
this.destroyVideoPlayer=function(){this.removePlayer();var slot_settings=ProperMedia.utils.deepAccess(properOps,'ad_slots'+'.'+this.slot.type+'.'+this.slot.name)||{};this.slot.setRefresh(slot_settings);this.slot.refreshSlot();}
this.destroyVideoPlayerObj=function(){if(typeof ProperMediaVideo!=='undefined'&&ProperMedia.utils.deepAccess(ProperMediaVideo,'ad_project.applications')&&ProperMedia.utils.deepAccess(ProperMediaVideo,'ad_project.applications').length){for(var i=0;i<ProperMediaVideo.ad_project.applications.length;i++){if(ProperMedia.utils.deepAccess(ProperMediaVideo,'ad_project.applications.'+i+'.video_player.destroy_player')&&ProperMedia.utils.deepAccess(ProperMediaVideo,'ad_project.applications.'+i+'.div_name')==this.player_settings.div_id){ProperMediaVideo.ad_project.applications[i].video_player.destroy_player();break;}}}}
this.buildPlayerElem=function(){if(this.player_settings.video_type=='instream'){var playerElem=document.createElement('div');playerElem.id=this.player_settings.div_id;playerElem.setAttribute("data-video-id",this.player_settings.video_id);playerElem.setAttribute("data-small-player",this.player_settings.small_player);if(this.player_settings.number_of_ads){playerElem.setAttribute("data-number-of-ads",this.player_settings.number_of_ads);}
if(this.player_settings.autoplay){playerElem.setAttribute("data-autoplay",(this.player_settings.autoplay)?1:0);}
var code='var window.top.propervideotag = window.top.propervideotag || []; window.top.propervideotag.push(function(){ window.top.propervideo_display("'+this.player_settings.div_id+'", "'+this.slot.name+'", "'+this.slot.name+'"); });';var script=document.createElement('script');script.type='text/javascript';script.appendChild(document.createTextNode(code));playerElem.appendChild(script);return playerElem;}else if(this.player_settings.video_type=='outstream'){var playerElem=document.createElement('div');playerElem.id=this.player_settings.div_id;playerElem.setAttribute("data-auto-injected",true);playerElem.setAttribute("data-video-id",properOps.site_name+'-'+this.player_settings.video_type);playerElem.setAttribute("data-outstream",this.player_settings.video_type);playerElem.setAttribute("data-small-player",this.player_settings.small_player);playerElem.setAttribute("data-backfill",this.player_settings.backfill);if(this.player_settings.backfill&&this.player_settings.backfill_id){playerElem.setAttribute("data-backfill-id",this.player_settings.backfill_id);}
if(this.player_settings.number_of_ads){playerElem.setAttribute("data-number-of-ads",this.player_settings.number_of_ads);}
if(this.player_settings.autoplay){playerElem.setAttribute("data-autoplay",(this.player_settings.autoplay)?1:0);}
var code='window.top.propervideotag = window.top.propervideotag || []; window.top.propervideotag.push(function(){ window.top.propervideo_display("'+this.player_settings.div_id+'", "'+this.slot.name+'", "'+properOps.site_name+'", "outstream_restart"); });';var script=document.createElement('script');script.type='text/javascript';script.appendChild(document.createTextNode(code));playerElem.appendChild(script);return playerElem;}}
this.adSuccessCallback=function(){console.log("adSuccessCallback");}
this.adErrorCallback=function(){console.log("adErrorCallback");}
this.init(player_id,settings,slot);}
var bidObj=(function(){function bidObj(bidder_name,bidder_data,slot_bidder_data,auction){(this.bidder=bidder_name),(this.auction=auction),(this.sent=0),(this.returned=0),(this.requests=bidder_data),(this.slot_requests=slot_bidder_data),(this.responses=[]),(this.responses_no_bid=[]),(this.response_errors=[]);}
bidObj.prototype.incrementRequestsSent=function(count){this.sent+=!isNaN(parseInt(count))?parseInt(count):0;this.auction.incrementRequestsSent(count);};bidObj.prototype.incrementBidResponseCount=function(count){this.returned+=!isNaN(parseInt(count))?parseInt(count):0;this.auction.incrementBidResponseCount(count);};bidObj.prototype.logBidResponse=function(ad){var bid_adapter_name=bidderToAdapterName(this.bidder);var header_s2s=bid_adapter_name=='s2s'?'s2s':'header';var bidder=header_s2s=='s2s'?ad.bidder:this.bidder;var rev_share=ProperMedia.utils.deepAccess(properOps,'bidder_info.'+bidder+'.rev_share')||ProperMedia.utils.deepAccess(bidAdapters,bid_adapter_name+'.bidderInfo.rev_share')||1;if(ProperMedia.utils.deepAccess(properOps,'bidders.'+header_s2s+'.'+bidder+'.account_overrides.enabled')&&ProperMedia.utils.deepAccess(properOps,'bidders.'+header_s2s+'.'+bidder+'.account_overrides.rev_share')){rev_share=Math.round(ProperMedia.utils.deepAccess(properOps,'bidders.'+header_s2s+'.'+bidder+'.account_overrides.rev_share'))/100;}
ad.pub_demand=!!ProperMedia.utils.deepAccess(properOps,'bidders.'+header_s2s+'.'+bidder+'.account_overrides.enabled');ad.bid_adapter_name=bid_adapter_name;if(rev_share<1&&ProperMedia.utils.isNumber(ad.price)){ad.price=parseFloat(ad.price)*parseFloat(rev_share);}
if((bidder=='a9'||bid_adapter_name=='a9')&&ProperMedia.utils.isStr(ad.price)){ad.price=ad.price.replace(/(o_|v_)/,'');ad.gross=ad.gross.replace(/(o_|v_)/,'');}else if(ad.price&&ProperMedia.utils.isNumber(ad.price)){ad.dfp_price=roundPriceToDfpBucket(ad.price);}
if((ad.price&&!ad.nobid&&ad.type=='display'&&ad.adcode)||(ad.type=='video'&&ad.vast_tag)||(ad.type=='native'&&Object.keys(ad.native).length)){this.responses.push(ProperMedia.utils.deepCopy(ad));this.auction.logBidResponse(ad,this);properLog.log_bid(ad);}else{this.logNoBidResponse(ad);}};bidObj.prototype.logNoBidResponse=function(ad){this.responses_no_bid.push(ad);properLog.log_bid(ad);};bidObj.prototype.logBidResponseError=function(bid){this.response_errors.push(bid);};return bidObj;})();var adObj=(function(){function adObj(obj){(this.id=obj.id||ProperMedia.utils.generateUUID()),(this.type=obj.type||'display'),(this.gross=obj.gross||0),(this.price=obj.price||0),(this.displayed=obj.displayed||0),(this.dfp_price=obj.dfp_price||0),(this.floor=obj.floor||0),(this.bidder=obj.bidder||''),(this.bid_adapter_name=obj.bid_adapter_name||''),(this.size=obj.size||'1x1'),(this.adcode=obj.adcode||''),(this.nurl=obj.nurl||''),(this.burl=obj.burl||''),(this.vast_tag=obj.vast_tag||''),(this.vast_type=obj.vast_type||''),(this.vpaid=obj.vpaid||false),(this.video_type=obj.video_type||''),(this.tag_id=obj.tag_id||''),(this.ad_details=obj.ad_details||{}),(this.request_url=obj.request_url||''),(this.response=obj.response||{}),(this.response_ms=obj.response_ms||0),(this.received_ts=obj.received_ts||0),(this.ttl=obj.ttl||120000),(this.dealid=obj.dealid||''),(this.cid=obj.cid||''),(this.crid=obj.crid||''),(this.adid=obj.adid||''),(this.adomain=obj.adomain||[]),(this.cat=obj.cat||[]),(this.attr=obj.attr||[]),(this.ext=obj.ext||{}),(this.native=obj.native||{}),(this.nobid=obj.nobid||false),(this.pub_demand=obj.pub_demand||false),(this.target_slot=obj.target_slot||false),(this.uids=obj.uids||[]);}
adObj.prototype.timePassed=function(){var d=new Date();var ts=d.getTime();var ms=ts-this.received_ts;return ms;};adObj.prototype.checkIfExpired=function(){return this.timePassed()>this.ttl?true:false;};adObj.prototype.timeTillExpiration=function(){return this.ttl-this.timePassed();};adObj.prototype.onBidWon=function(slot){try{if(ProperMedia.utils.deepAccess(bidAdapters,this.bid_adapter_name+'.onBidWon')){bidAdapters[this.bid_adapter_name].onBidWon(this,slot);}
if(this.type=='native'){fireNativeTrackers('impression',this);}
if(this.size=='1x1'||this.type=='native'||properOps.native_sizes[this.size]){var properIframeContentDocument=slot.getContentDocument();if(properIframeContentDocument){var p=window.top.document.getElementById(slot.div_id).parentNode.parentNode,s=getComputedStyle(p),mt=parseInt(s.marginTop),mb=parseInt(s.marginBottom);h=parseInt(p.offsetHeight);var newHeight=h+mt+mb;var properIframe=window.top.document.getElementById(slot.properIframeId);if(properIframe){properIframe.style.height=newHeight+'px';}
var googleIframe=properIframeContentDocument.getElementById(slot.dfpIframeId);if(googleIframe){googleIframe.style.height=newHeight+'px';}}}}catch(e){}};return adObj;})();var deviceObj=function(){this.browser='',this.browser_version='',this.browser_group='',this.device_type='',this.os='',this.os_group='';this.init=function(){var uaParserMappings={'browser':{'IE':'Explorer','Chrome Headless':'Chrome','Chrome WebView':'Chrome'},'device':{'console':'desktop'}}
if(typeof UAParser!=='undefined'){(function(){var result=(new UAParser()).getResult();this.browser=result.browser.name;if(result.browser.version){this.browser_version=result.browser.version;}
this.browser_group=result.browser.name;if(typeof uaParserMappings.browser!=='undefined'&&typeof uaParserMappings.browser[this.browser_group]!=='undefined'){this.browser_group=uaParserMappings.browser[this.browser_group];}
this.device_type=result.device.type;if(!this.device_type){this.device_type='desktop';}
if(typeof uaParserMappings.device!=='undefined'&&typeof uaParserMappings.device[this.device_type]!=='undefined'){this.device_type=uaParserMappings.device[this.device_type];}
this.os=result.os.name;if(result.os.version){this.os+=' '+result.os.version;}
this.os_group=result.os.name;}.bind(this))();}
window.device={'browser':this.browser,'browser_group':this.browser_group,'device_type':this.device_type,'os':this.os,'os_group':this.os_group}}
this.isMobile=function(){return(this.device_type=='mobile')?true:false;}
this.init();}
var userIds=(function(){var COOKIE='cookie';var LOCAL_STORAGE='localstorage';PBJS_USER_ID_OPTOUT_NAME='_pbjs_id_optout';var identityAdapters={};var validStorageTypes=[];var eidsArray=[];var uidsObj={};var userIdData={};var started_matching=false;var done_matching=false;var timeout=150;var timeout_handle=null;var auctionCallback=null;var refreshNeededHem=false;var has_hem=false;var enforcement;var pendingCallbacks=0;var coreStorageObj={moduleType:'core',moduleName:'userid'};function init(){validStorageTypes=[properStorage.localStorageIsEnabled(coreStorageObj)?LOCAL_STORAGE:null,properStorage.cookiesAreEnabled(coreStorageObj)?COOKIE:null,].filter(function(i){return i!==null;});if(validStorageTypes.indexOf(COOKIE)!==-1&&properStorage.getCookie(PBJS_USER_ID_OPTOUT_NAME,coreStorageObj)){properLog.mylog('userIds - opt-out cookie found, exit module');return;}
if(validStorageTypes.indexOf(LOCAL_STORAGE)!==-1&&properStorage.getDataFromLocalStorage(PBJS_USER_ID_OPTOUT_NAME,coreStorageObj)){properLog.mylog('userIds - opt-out localStorage found, exit module');return;}
initUserIdData();}
function initUserIdData(){if(ProperMedia.utils.deepAccess(properSpecialOps,'userIdData')){userIdData=ProperMedia.utils.deepAccess(properSpecialOps,'userIdData');}else if(properStorage.getCookie('properUserIdData',coreStorageObj)){userIdData=properStorage.getCookie('properUserIdData',coreStorageObj);}
if(userIdData&&ProperMedia.utils.isStr(userIdData)){userIdData=ProperMedia.utils.safeJsonParse(userIdData);}
getEmailHashes();if(userIdData.emailHashes&&(userIdData.emailHashes.md5||userIdData.emailHashes.sha256||userIdData.emailHashes.sha1)){if(done_matching&&!has_hem){started_matching=false;refreshNeededHem=true;}
has_hem=true;}
runIdentityAdapters();}
function runIdentityAdapters(){if(started_matching)return;if(!properUser.sovrn_sync_done){properLog.mylog('UserIds: Wait for Sovrn Hashed Email Matching.');return;}
started_matching=true;var userIds=properOps.userIds;if(userIds&&userIds.identityAdapters&&Object.keys(userIds.identityAdapters).length){updateIdentityAdapters();}else{matchingDone();}}
function setUserIdDataValue(path,value){try{ProperMedia.utils.deepSetValue(userIdData,path,value);}catch(e){}}
function mergeUserIdDataValue(data){try{ProperMedia.utils.mergeObject(userIdData,data);}catch(e){}}
function updateIdentityAdapters(){var configs=ProperMedia.utils.objectValues(ProperMedia.utils.deepAccess(properOps,'userIds.identityAdapters')||{});if(!configs.length){return;}
if(gppConsentModule.enrichEidsDenied()){properLog.mylog('userIds - GPP User Syncs Denied');return[];}
enforcement=gdprEnforcement.userIdEnforcement(configs);if(!enforcement.hasValidated&&!gdprConsentModule.hasPurpose1Consent()){properLog.mylog('User Ids - gdpr permission not valid for local storage or cookies, exit module');return[];}
configs=enforcement.submodules||[];for(var i=0;i<configs.length;i++){var config=configs[i];if(config.name&&userIdAdapters[config.name]){var identityAdapter=userIdAdapters[config.name];if(!done_matching){if(config.config&&ProperMedia.utils.isPlainObject(config.config)){ProperMedia.utils.mergeObject(identityAdapter.config,config.config);}
if(config.storage&&ProperMedia.utils.isPlainObject(config.storage)){ProperMedia.utils.mergeObject(identityAdapter.storage,config.storage);}
if(identityAdapter.config.enabled){identityAdapters[config.name]=identityAdapter;}}
if(ProperMedia.utils.deepAccess(identityAdapters,config.name+'.initialize')&&ProperMedia.utils.isFn(identityAdapters[config.name].initialize)){identityAdapters[config.name].initialize(userIdData);}}else{properLog.mylog("Coudln't find identityAdapter with name: "+config.name);}}
if(Object.keys(identityAdapters).length>0){consentManager.ready(function(){Object.keys(identityAdapters).forEach(function(name){getIdentityAdapterValue(identityAdapters[name]);});addTimeout();processIdentityAdapterCallbacks();});}else{matchingDone();}}
function getIdentityAdapterValue(identityAdapter){if(identityAdapter.storage){var response;var storage=identityAdapter.storage;var storedId=getStoredValue(storage,undefined);var refreshNeeded=false;if(typeof storage.refreshInSeconds==='number'){var storedDate=new Date(getStoredValue(storage,'last'));refreshNeeded=storedDate&&Date.now()-storedDate.getTime()>storage.refreshInSeconds*1000;}
if(!storedId||refreshNeeded||refreshNeededHem){response=identityAdapter.getId(storedId);}else if(ProperMedia.utils.isFn(identityAdapter.extendId)){response=identityAdapter.extendId(storedId);}
if(ProperMedia.utils.isPlainObject(response)){if(response.id){setStoredValue(storage,response.id);storedId=response.id;}
if(ProperMedia.utils.isFn(response.callback)){identityAdapter.callback=response.callback;pendingCallbacks++;}}
if(storedId){identityAdapter.idObj=identityAdapter.decode(storedId);}}else if(identityAdapter.config.value){identityAdapter.idObj=identityAdapter.config.value;}else{response=identityAdapter.getId();if(ProperMedia.utils.isPlainObject(response)){if(ProperMedia.utils.isFn(response.callback)){identityAdapter.callback=response.callback;pendingCallbacks++;}
if(response.id){identityAdapter.idObj=identityAdapter.decode(response.id);}}}}
function processIdentityAdapterCallbacks(){if(pendingCallbacks>0){Object.keys(identityAdapters).forEach(function(name){var identityAdapter=identityAdapters[name];if(ProperMedia.utils.isFn(identityAdapter.callback)){identityAdapter.callback(function callbackCompleted(idObj){if(idObj){if(identityAdapter.storage){setStoredValue(identityAdapter.storage,idObj);}
identityAdapter.idObj=identityAdapter.decode(idObj);}else{properLog.mylog('UserID: '+identityAdapter.name+' - request id responded with an empty value');}
pendingCallbacks--;if(pendingCallbacks==0){matchingDone();}else{createUidObjAndEidsArray();}
identityAdapter.callback=undefined;});}});}else{matchingDone();}}
function getEmailHashes(){if(!userIdData.emailHashes){var storage={gvlid:13,type:'localstorage',name:'sovrn-hem',expiresInDays:7,};userIdData.emailHashes=getStoredValue(storage);}
saveEmailHashes();return userIdData.emailHashes||false;}
function saveEmailHashes(){if(userIdData.emailHashes){var storage={gvlid:13,type:'localstorage',name:'sovrn-hem',expiresInDays:7,};has_hem=true;setStoredValue(storage,userIdData.emailHashes);}}
function getStoredValue(storage,key){var storedKey=key?storage.name+'_'+key:storage.name;var storedValue;try{var storageObj={gvlid:storage.gvlid,moduleName:storage.name||'userid'};if(storage.type===COOKIE){storedValue=decodeURIComponent(properStorage.getCookie(storedKey,storageObj)||'');}else if(storage.type===LOCAL_STORAGE){var storedValueExp=properStorage.getDataFromLocalStorage(storage.name+'_exp',storageObj);if(storedValueExp===''){storedValue=properStorage.getDataFromLocalStorage(storedKey,storageObj);}else if(storedValueExp){if(new Date(storedValueExp).getTime()-Date.now()>0){storedValue=decodeURIComponent(properStorage.getDataFromLocalStorage(storedKey,storageObj));}}}
if(typeof storedValue==='string'){storedValue=storedValue.trim();if(storedValue.charAt(0)==='{'){storedValue=ProperMedia.utils.safeJsonParse(storedValue);}}}catch(e){properLog.mylog(e);}
return storedValue;}
function setStoredValue(storage,value){try{if(!value)return;var storageObj={gvlid:storage.gvlid,moduleName:storage.name||'userid'};var valueStr=ProperMedia.utils.isPlainObject(value)?JSON.stringify(value):value;var expiresStr=new Date(Date.now()+storage.expiresInDays*(60*60*24*1000)).toUTCString();if(storage.type===COOKIE){properStorage.setCookie(storage.name,valueStr,expiresStr,'Lax','',storageObj);if(typeof storage.refreshInSeconds==='number'){properStorage.setCookie(storage.name+'_last',new Date().toUTCString(),expiresStr,'Lax','',storageObj);}}else if(storage.type===LOCAL_STORAGE){properStorage.setDataInLocalStorage(storage.name+'_exp',expiresStr,storageObj);properStorage.setDataInLocalStorage(storage.name,encodeURIComponent(valueStr),storageObj);if(typeof storage.refreshInSeconds==='number'){properStorage.setDataInLocalStorage(storage.name+'_last',new Date().toUTCString(),storageObj);}}}catch(error){properLog.mylog(error);}}
function createUidObjAndEidsArray(){eidsArray=[];Object.keys(identityAdapters).forEach(function(name){var identityAdapter=identityAdapters[name];if(!ProperMedia.utils.deepAccess(identityAdapter.excludeEid)){var eid=createEidObject(identityAdapter);if(eid){eidsArray.push(eid);}
if(identityAdapter.idObj&&((ProperMedia.utils.isPlainObject(identityAdapter.idObj)&&Object.keys(identityAdapter.idObj).length)||ProperMedia.utils.isStr(identityAdapter.idObj))){uidsObj[identityAdapter.eid_name]=identityAdapter.idObj;}}});}
function createEidObject(identityAdapter){var eid={};eid.source=identityAdapter['source']||'';var value=ProperMedia.utils.isFn(identityAdapter.getValue)?identityAdapter.getValue():identityAdapter.idObj;if(!ProperMedia.utils.deepAccess(identityAdapter.excludeEid)&&ProperMedia.utils.isStr(value)){var uid={id:value,atype:identityAdapter['atype']||1,};if(ProperMedia.utils.isFn(identityAdapter.getUidExt)){var uidExt=identityAdapter.getUidExt();if(uidExt){uid.ext=uidExt;}}
eid.uids=[uid];if(ProperMedia.utils.isFn(identityAdapter.getEidExt)){var eidExt=identityAdapter.getEidExt();if(eidExt){eid.ext=eidExt;}}
return eid;}
return null;}
function addTimeout(){timeout_handle=properSetTimeout.setTimeout(matchingDone,timeout);}
function resetTimeout(){clearTimeout(timeout_handle);timeout_handle=null;}
function matchingDone(){createUidObjAndEidsArray();if(done_matching==1)return;done_matching=1;if(ProperMedia.utils.isFn(auctionCallback)){auctionCallback();auctionCallback=null;}
if(properOps.sovrn_signal||properSpecialOps.sovrn_signal){var script=document.createElement('script');script.src='https://get.s-onetag.com/70badba6-d3bf-4921-9807-0c0f5d9ffc19/tag.min.js';script.async=true;script.defer=true;window.top.document.getElementsByTagName('head')[0].appendChild(script);}
properLog.mylog('UserId Matching Done');resetTimeout();}
function isDoneMatching(){return!!done_matching;}
function setCallback(callbackFn){auctionCallback=callbackFn;}
function getEidsArray(){if(gppConsentModule.enrichEidsDenied()){properLog.mylog('userIds - GPP User SharingOptOut or TargetedAdvertisingOptOut');return{};}
return ProperMedia.utils.deepCopy(eidsArray||[]);}
function getUIdsObj(){if(gppConsentModule.enrichEidsDenied()){properLog.mylog('userIds - GPP User SharingOptOut or TargetedAdvertisingOptOut');return{};}
return ProperMedia.utils.deepCopy(uidsObj||{});}
function getUserIdData(){if(gppConsentModule.enrichEidsDenied()){properLog.mylog('userIds - GPP User SharingOptOut or TargetedAdvertisingOptOut');return{};}
return ProperMedia.utils.deepCopy(userIdData||{});}
function hasEmailHashes(){return!!has_hem;}
return{init:init,getUIdsObj:getUIdsObj,setCallback:setCallback,getEidsArray:getEidsArray,getUserIdData:getUserIdData,initUserIdData:initUserIdData,getEmailHashes:getEmailHashes,hasEmailHashes:hasEmailHashes,isDoneMatching:isDoneMatching,createEidObject:createEidObject,setUserIdDataValue:setUserIdDataValue,runIdentityAdapters:runIdentityAdapters,mergeUserIdDataValue:mergeUserIdDataValue,};})();var userObj=function(){this.lang='',this.tzone='',this.member='no',this.pubcid='',this.adblock={detected:false,acceptable_ads:false,deliver_to_adblock:false},this.sovrn_sync_done=true,this.userIdsCallback=null,this.init=function(){this.tzone=new Date().getTimezoneOffset();this.lang=navigator.language||navigator.browserLanguage||navigator.userLanguage||navigator.systemLanguage;this.pubcid=userIdAdapters.pubCommonId.getValue()||ProperMedia.utils.generateUUID();this.setAdBock();if(properOps.sovrn_signal_email_hash||properSpecialOps.sovrn_signal_email_hash){this.sovrn_sync_done=false;this.getSovrnSignalEmailHash();}
window.addEventListener("proper-ad-requests-blocked",(function(){this.setAdBock();}).bind(this));window.addEventListener("proper-adblock-pixels-blocked",(function(){this.setAdBock();}).bind(this));}
this.setAdBock=function(){this.adblock=ProperMedia.utils.deepAccess(properSpecialOps,'adblock')||this.adblock;this.adblock.deliver_to_adblock=properOps.deliver_to_adblock||false;if(this.checkAdBlockDetected()&&(!this.adblock.acceptable_ads||!this.adblock.deliver_to_adblock)){properSpecialOps.kill_all_ads=true;var event=new CustomEvent('proper-ad-bidders-blocked',{});window.dispatchEvent(event);}
if(this.checkAdBlock()&&properSpecialOps.iframe_auction){$.createAuctionIframe();}}
this.checkAdBlock=function(){return!!(this.checkAdBlockDetected()&&this.adblock.acceptable_ads&&this.adblock.deliver_to_adblock);}
this.checkAdBlockDetected=function(){return!!(this.adblock.detected&&!properSpecialOps.disable_adblock_solution&&!properSpecialOps.adtoniq);}
this.getSovrnSignalEmailHash=function(){if(!userIds.getEmailHashes()&&!gppConsentModule.isConsentDenied()){var timeout_handle=properSetTimeout.setTimeout(sovrnSyncDone,350);var sync_pubcid=ProperMedia.utils.deepAccess(properPage,'get_vars.signal_test_id')?'83919c0c-77b4-4e6a-92a9-de8cd16be2db':this.pubcid;$.ajax({url:'https://ehash.proper.io/get/'+sync_pubcid,method:"GET",timeout:300,requestType:"cors",withCredentials:true,success:function(resp){if(resp){resp=ProperMedia.utils.safeJsonParse(resp);if(ProperMedia.utils.isPlainObject(resp)){properLog.mylog('UserID - Sovrn Signal Hashed Email: '+resp);userIds.setUserIdDataValue('emailHashes',resp);}}
sovrnSyncDone()},error:function(e){sovrnSyncDone()}});function sovrnSyncDone(){clearTimeout(timeout_handle);properUser.sovrn_sync_done=true;userIds.runIdentityAdapters();}}else{properLog.mylog('UserID - Hashed Emails From Storage');properUser.sovrn_sync_done=true;}}
this.stickyFreqCapHandler={setStickyClosedCookie:function(){var date=new Date();date.setHours(23,59,59,0);properStorage.setCookie('properStickyClosed','true',date.toGMTString(),'Lax','',{"moduleType":"core","moduleName":"userid"});},getStickyClosedCookie:function(){return properStorage.getCookie('properStickyClosed',{"moduleType":"core","moduleName":"userid"})=="true"?true:false;},setStickyUnitImps:function(unitImpressions){var date=new Date();date.setHours(23,59,59,0);properStorage.setCookie('properStickyUnitImps',parseInt(unitImpressions),date.toGMTString(),'Lax','',{"moduleType":"core","moduleName":"userid"});},getStickyUnitImps:function(){var properStickyUnitImps=properStorage.getCookie('properStickyUnitImps',{"moduleType":"core","moduleName":"userid"});return!isNaN(parseInt(properStickyUnitImps))?parseInt(properStickyUnitImps):0;},incrementStickyUnitImps:function(){var unitImpressions=this.getStickyUnitImps()||0;unitImpressions+=1;this.setStickyUnitImps(unitImpressions);}}}
var logObj=function(){(this.log_lines={}),(this.autoplay_html={}),(this.rogue_data=[]),(this.saved_data={}),(this.bid_data={}),(this.interstitial_bid_data={}),(this.ad_info={}),(this.rogue_timeout=null),(this.tracker_timeout=null),(this.tracker_wait=250),(this.init_bid_data=function(){if(ProperMedia.utils.deepAccess(this,'bid_data.ad_slots')&&Object.keys(this.bid_data.ad_slots).length>0){this.proper_tracker();}
this.setBidData();this.send_pageview_pixel();});this.setBidData=function(){this.bid_data={payload_version:ProperMedia.utils.validateValue(properOps.payload_version,{type:'string'}),page_guid:ProperMedia.utils.validateValue(properPage.uuid,{type:'string'}),website:ProperMedia.utils.validateValue(properOps.site_name,{type:'string',default_val:'unknown',max_len:40}),url:ProperMedia.utils.validateValue(properPage.url,{type:'string',max_len:255}),url_path:ProperMedia.utils.validateValue(properPage.path,{type:'string',max_len:150}),os:ProperMedia.utils.validateValue(properDevice.os_group,{type:'string',max_len:30}),browser:ProperMedia.utils.validateValue(properDevice.browser_group,{type:'string',max_len:30}),device:ProperMedia.utils.validateValue(properDevice.device_type,{type:'string',max_len:10}),use_ssl:ProperMedia.utils.validateValue(properPage.use_ssl,{type:'boolean'}),is_mobile:ProperMedia.utils.validateValue(properDevice.device_type=='mobile',{type:'boolean'}),is_isolated:ProperMedia.utils.validateValue(properPage.isolated,{type:'boolean'}),session_depth:ProperMedia.utils.validateValue(properSession.sessionData.depth,{type:'number'}),session_guid:ProperMedia.utils.validateValue(properSession.sessionData.uuid,{type:'string'}),resolution_width:ProperMedia.utils.validateValue(properPage.width,{type:'number',max:99999}),resolution_height:ProperMedia.utils.validateValue(properPage.height,{type:'number',max:99999}),rtp_file_version:ProperMedia.utils.validateValue(properOps.rtp_file_version,{type:'number'}),referrer:ProperMedia.utils.validateValue(properSession.sessionData.referrer,{type:'string',max_len:255}),utm_source:ProperMedia.utils.validateValue(properSession.sessionData.utm_source,{type:'string',max_len:100}),utm_campaign:ProperMedia.utils.validateValue(properSession.sessionData.utm_campaign,{type:'string',max_len:255}),utm_medium:ProperMedia.utils.validateValue(properSession.sessionData.utm_medium,{type:'string',max_len:100}),utm_term:ProperMedia.utils.validateValue(properSession.sessionData.utm_term,{type:'string',max_len:100}),utm_content:ProperMedia.utils.validateValue(properSession.sessionData.utm_content,{type:'string',max_len:100}),utm_template:ProperMedia.utils.validateValue(properSession.sessionData.utm_template,{type:'string',max_len:100}),utm_referrer:ProperMedia.utils.validateValue(properSession.sessionData.utm_referrer,{type:'string',max_len:100}),utm_adset:ProperMedia.utils.validateValue(properSession.sessionData.utm_adset,{type:'string',max_len:100}),utm_subid:ProperMedia.utils.validateValue(properSession.sessionData.utm_subid,{type:'string',max_len:100}),gclid:ProperMedia.utils.validateValue(properSession.sessionData.gclid,{type:'string',max_len:100}),fbclid:ProperMedia.utils.validateValue(properSession.sessionData.fbclid,{type:'string',max_len:100}),category:ProperMedia.utils.validateValue(properPage.page_meta.category,{type:'string',max_len:50}),editor:ProperMedia.utils.validateValue(properPage.page_meta.editor,{type:'string',max_len:50}),writer:ProperMedia.utils.validateValue(properPage.page_meta.writer,{type:'string',max_len:50}),buyer:ProperMedia.utils.validateValue(properPage.page_meta.buyer,{type:'string',max_len:50}),page_type:ProperMedia.utils.validateValue(properPage.page_meta.page_type,{type:'string',max_len:50}),split:ProperMedia.utils.validateValue(properPage.page_meta.split,{type:'string',max_len:50}),tags:ProperMedia.utils.validateValue(properPage.page_meta.tags.join(','),{type:'string',max_len:500}),custom:this.validateCustom(properPage.page_meta.custom),adblock:ProperMedia.utils.validateValue(properUser.adblock.detected,{type:'boolean'}),ad_slots:{},};};this.validateCustom=function(custom){var new_custom={};for(var dimension in custom){if(dimension.match(/^dimension_([1-9]|10)$/))
new_custom[dimension]=ProperMedia.utils.validateValue(custom[dimension],{type:'string',max_len:100});}
return new_custom;};this.send_pageview_pixel=function(){ProperMedia.utils.deepSetValue(this,'bid_data.ad_slots.pageview_pixel',{slot_name:'pageview_pixel',bidder:'pageview_pixel',price:0,gross:0,size:'0x0',refresh_cnt:0,line_item_id:'',response_ms:0,auction_duration:0,precent_bids_ready:0,tag_id:'',adid:'',adomain:'',cid:'',crid:'',dealid:'',});this.proper_tracker();};this.send_takeover_pixel=function(slot,bid){if(!properPage.takeover.logged&&ProperMedia.utils.deepAccess(properPage,'takeover.bidder')!=''){var auction_ms=ProperMedia.utils.getTimePassed(slot.auction_started_ts);var slot_name=properOps.site_name+'_page_takeover_'+properPage.takeover.bidder;ProperMedia.utils.deepSetValue(this,'bid_data.ad_slots.'+slot_name,{slot_name:ProperMedia.utils.validateValue(slot_name,{type:'string',max_len:50}),bidder:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(properPage,'takeover.bidder'),{type:'string',max_len:30}),price:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(properPage,'takeover.price'),{type:'string',max_len:30}),gross:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(properPage,'takeover.price'),{type:'string',max_len:30}),size:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(bid,'size'),{type:'string',max_len:10}),refresh_cnt:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(bid,'refresh.count'),{type:'number',max:999}),line_item_id:'',response_ms:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(bid,'response_ms'),{type:'number',max:999999}),auction_duration:ProperMedia.utils.validateValue(auction_ms,{type:'number',max:999999}),precent_bids_ready:ProperMedia.utils.validateValue(100,{type:'number',max:100}),tag_id:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(bid,'tag_id'),{type:'string',max_len:50}),adid:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(bid,'adid'),{type:'string',max_len:50}),adomain:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(bid,'adomain.0'),{type:'string',max_len:50}),cid:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(bid,'cid'),{type:'string',max_len:50}),crid:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(bid,'crid'),{type:'string',max_len:50}),dealid:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(bid,'dealid'),{type:'string',max_len:50}),floor:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(bid,'floor'),{type:'number',max:999,max_len:15}),});this.proper_tracker();properPage.takeover.logged=true;}};this.log_bid=function(ad){this.mylog(ad.bidder+' ('+ad.tag_id+'@'+ad.size+') = '+ad.price);};this.mylog=function(content,id){id=id||'proper';this.log_lines[id]=ProperMedia.utils.checkData(this.log_lines[id]);this.log_lines[id].push(content);if(ProperMedia.utils.deepAccess(properPage,'get_vars.'+id)==1||(id=='proper'&&properStorage.getCookie('proper_log',{moduleType:'core'})==1))
console.log(content);};this.rogue_tracker=function(){clearTimeout(this.rogue_timeout);this.rogue_timeout=null;if(this.rogue_data.length>0){var post_data=this.rogue_data;this.rogue_data=[];var log=this;$.ajax({url:'https://proper.io/ajax/tracker.php?rogue=1',method:'POST',data:'data='+JSON.stringify(post_data),headers:{'Content-type':'application/x-www-form-urlencoded'},success:function(resp){log.mylog('autoplay ads tracked! x'+post_data.length);},});}};this.proper_tracker=function(){var log=this;var post_data={};clearTimeout(this.tracker_timeout);this.tracker_timeout=null;if(this.bid_data.ad_slots&&Object.keys(this.bid_data.ad_slots).length>0){var ad_slots=ProperMedia.utils.deepCopy(this.bid_data.ad_slots);this.setBidData();if(!this.bid_data.website)this.bid_data.website='unknown';this.bid_data.ad_slots=Object.keys(ad_slots).filter(function(slot_name){return!!(slot_name=='pageview_pixel'||slot_name.indexOf(properOps.site_name)===0);}).reduce(function(obj,key){obj[key]=ad_slots[key];return obj;}.bind(this),{});if(Object.keys(this.bid_data.ad_slots).length>0){post_data=JSON.stringify(this.bid_data);this.bid_data.ad_slots={};if(!properOps.testing_mode.ids){$.ajax({url:'https://bids.proper.io/api/bidding',method:'POST',withCredentials:false,data:post_data,success:function(resp){log.mylog('bids tracked!');},error:function(e){log.mylog('error tracking bid data');},});}else{log.mylog('Not logging winnig bids. Test IDs are being used.');}}}};this.track_rogue=function(slot,rogue_type){var ad={};if(typeof slot.displayed_ad.displayed!=='undefined'&&slot.displayed_ad.displayed==1){ad=slot.displayed_ad;}else{ad={bidder:'static_tag',price:0,size:'',adcode:'[DFP STATIC TAG]'};}
this.mylog('rogue '+rogue_type+' detected (slot='+slot.name+', bidder='+ad.bidder+')');this.rogue_data.push({rogue_type:rogue_type,bidder:ad.bidder,cpm:ad.price,size:ad.size,slot:slot.dfp_name,website:properOps.site_name,device:properDevice.device_type,os:properDevice.os_group,browser:properDevice.browser_group,is_mobile:properDevice.isMobile(),tag_id:ad.tag_id,ad_details:ad.ad_details,split_version:properOps.rtp_file_version,});clearTimeout(this.rogue_timeout);this.rogue_timeout=null;this.rogue_timeout=properSetTimeout.setTimeout.call(this,function(){this.rogue_tracker();},this.tracker_wait);if(slot.getWinningBid()){showWinningAd(slot);return;}};this.proper_log=function(id){id=id||'proper';if(id=='page'){console.log(properPage);return;}
function getResponses(){var output=[];var slots=properPage.slots;Object.keys(properPage.slots).forEach(function(slot_type){Object.keys(properPage.slots[slot_type]).forEach(function(slot_name){var slot=slots[slot_type][slot_name];if(slot instanceof slotObj){for(var ad_id=0;ad_id<slot.ads.length;ad_id++){var response=slot.ads[ad_id];const row=adObjToOutput(response);if(ProperMedia.utils.indexOfObjectInArray(output,row)===-1){output.push(row);}}}
if(slot.hasWinningBid()){const row=adObjToOutput(slot.winning_ad);if(ProperMedia.utils.indexOfObjectInArray(output,row)===-1){output.push(row);}}
if(slot.hasWinningAmazonBid()){const row=adObjToOutput(slot.winning_amazon_ad);if(ProperMedia.utils.indexOfObjectInArray(output,row)===-1){output.push(row);}}},this);},this);return output;function adObjToOutput(response){return{slot_name:response.slot.name,size:response.size,bidder:response.bidder,time:response.response_ms,floor:response.floor,cpm:response.price,dfp_price:response.dfp_price,gross:response.gross,price:response.price,tag_id:response.tag_id,refresh_cnt:response.slot.refresh.count,displayed:response.displayed,};}}
if(id=='bid_table'){const output=getResponses();if(output.length){if(console.table){console.table(output);}else{for(let j=0;j<output.length;j++){console.log(output[j]);}}}else{console.warn('No responses');}
return;}
if(id=='bid_table_csv'){const output=getResponses();if(output.length){csv_output='';header_keys=Object.keys(output[0]);for(let j=0;j<header_keys.length;j++){csv_output+='"'+header_keys[j]+'"'+(j<header_keys.length-1?',':'');}
for(let j=0;j<output.length;j++){csv_output+='\n'+'"'+ProperMedia.utils.objectValues(output[j]).join('","')+'"';}
var element=document.createElement('a');element.setAttribute('href','data:text/plain;charset=utf-8,'+encodeURIComponent(csv_output));element.setAttribute('download','proper_bid_table_'+document.location.hostname+'.csv');element.style.display='none';document.body.appendChild(element);element.click();document.body.removeChild(element);}else{console.warn('No responses');}
return;}
if(id=='on'){id='proper';var date=new Date();var hours=1;date.setTime(date.getTime()+hours*60*60*1000);document.cookie='proper_log=1; expires='+date.toGMTString()+'; path=/; SameSite=Lax;';console.log("NOTICE: Turning on persistent logging. Run proper_log('off'); to turn off.");}else if(id=='off'){id='proper';console.log('NOTICE: Turning off persistent logging.');document.cookie='proper_log=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; SameSite=Lax;';ProperMedia.utils.deepSetValue(properPage,'get_vars.'+id,0);return false;}
for(var x=0;x<properLog.log_lines[id].length;x++){if(properLog.log_lines[id][x])console.log(properLog.log_lines[id][x]);ProperMedia.utils.deepSetValue(properPage,'get_vars.'+id,1);}
return true;};};var properLog=new logObj();var optionsObj=function(){(this.rtp_file_version=0),(this.slot_level_auction=false),(this.dfp_per_slot=0),(this.payload_version='3.0.0'),(this.prebid_version='7.45.0'),(this.post_id=''),(this.additional_domains=[]),(this.site_name=''),(this.domain=''),(this.domain_protection=0),(this.confiant=0),(this.extra_css=''),(this.extra_js=''),(this.tmax=1000),(this.default_tags=[]),(this.mcm_type='mcm'),(this.proper_dfp_id=5376056),(this.dfp_advertiser_ids={google:42904576,proper:600883576,adsense:1349528536,}),(this.dfp_id=5376056),(this.google_advertiser=42904576),(this.proper_advertiser=600883576),(this.amazon_advertiser=455011336),(this.adsense_advertiser=1349528536),(this.dynamic_floors={mobile:{enabled:false,init_floor_max:1.25,init_size_floor_max:{'640x480':3.5,'400x300':3.5},init_mult_max:0.5,init_mult_min:0.5,avg_mult:3,avg_max:10,},desktop:{enabled:false,init_floor_max:1.25,init_size_floor_max:{'640x480':3.5,'400x300':3.5},init_mult_max:0.5,init_mult_min:0.5,avg_mult:3,avg_max:10,},}),(this.nobid_auction_limit={enabled:false,display:10,video:15,}),(this.testing_mode={enabled:false,bidder:false,ids:false,}),(this.video_players={}),(this.video_limit={enabled:false,outstream_inview_limit:5,}),(this.ad_slots={}),(this.isolated_urls=[]),(this.s2s_websockets=false),(this.s2s_sse=false),(this.s2s_wss_endpoint='wss://eb-staging.proper.io/s2s'),(this.s2s_sse_endpoint='https://eb-staging.proper.io/s2s'),(this.s2s_endpoint='https://eb.proper.io/s2s'),(this.crid_whitelist_api='https://creative-whitelist-dev.properio.workers.dev/cwl/'),(this.slot_wrapper_class='proper-ad-unit'),(this.usync_endpoint='https://usync.proper.io/v1/usersync'),(this.usync_hb_endpoint='https://eb.proper.io/v1/usersync'),(this.sandbox_iframe=1),(this.sandbox_options=['allow-popups','allow-pointer-lock','allow-scripts','allow-same-origin',]),(this.audience_pixels={enabled:false,thresholds:[],}),(this.audience_segments={}),(this.native_sizes={skin:'1x1',fluid:'1x1',native_vertical:'1x1',native_horizontal:'1x1',sticky_horizontal:'1x1',}),(this.advertisement_disclosure={enabled:false,location:'below',}),(this.schain={ver:'1.0',complete:0,nodes:[],}),(this.skip_schain=false),(this.refresh={desktop:{enabled:1,interval:60000,inview_interval:15000,max:5,exclude_dfp:0,},mobile:{enabled:1,interval:30000,inview_interval:15000,max:5,exclude_dfp:0,},}),(this.floors={desktop:{backup:0.15,sizes:{},},mobile:{backup:0.15,sizes:{},},}),(this.lazyload={desktop:{enabled:1,fetchMarginPercent:0,renderMarginPercent:0,},mobile:{enabled:1,fetchMarginPercent:0,renderMarginPercent:0,},}),(this.autoDelete={desktop:{enabled:false,autoDeleteMarginPercent:200,},mobile:{enabled:false,autoDeleteMarginPercent:200,},}),(this.userIds={identityAdapters:{id5id:{name:'id5Id',config:{enabled:false,},storage:{},},identitylink:{name:'identityLink',config:{enabled:false,},storage:{},},pubcommonid:{name:'pubCommonId',config:{enabled:true,},storage:{},},publink:{name:'pubLink',config:{enabled:false,},storage:{},},fabrickid:{name:'fabrickId',config:{enabled:false,apiKey:'',},storage:{},},verizonmediaid:{name:'verizonMediaId',config:{enabled:false,},storage:{},},},}),(this.adlightning={enabled:false,clientId:'properio',reportAd:false,}),(this.bidders={header:{},s2s:{},}),(this.bidder_info={adaptmx_s2s:{rev_share:1,demand_type:'display',bid_grouping:'page',adapter_name:'s2s',},adaptmx_instream_s2s:{rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'page',adapter_name:'s2s',default_bid_ttl:300000,},adaptmx_outstream_s2s:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',adapter_name:'s2s',default_bid_ttl:300000,},arbigo_s2s:{rev_share:1,demand_type:'display',bid_grouping:'page',adapter_name:'s2s',default_bid_ttl:300000,},pubmatic_s2s:{rev_share:1,demand_type:'display',bid_grouping:'slot',adapter_name:'s2s',default_bid_ttl:60000,gvlid:76,},sovrn_s2s:{rev_share:1,demand_type:'display',bid_grouping:'page',adapter_name:'s2s',gvlid:13,},sovrn_instream_s2s:{rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'slot',adapter_name:'s2s',default_bid_ttl:300000,gvlid:13,},sovrn_outstream_s2s:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',adapter_name:'s2s',default_bid_ttl:300000,gvlid:13,},sonobi_s2s:{rev_share:1,demand_type:'display',bid_grouping:'slot',adapter_name:'s2s',gvlid:104,},gumgum_s2s:{rev_share:1,demand_type:'display',bid_grouping:'page',adapter_name:'s2s',gvlid:13,native_sizes:{desktop:{'1x1':'sticky_horizontal',},mobile:{'1x1':'sticky_horizontal',},},},mediagrid_outstream:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',adapter_name:'mediagrid',gvlid:686,},mediagrid_s2s:{rev_share:1,demand_type:'display',bid_grouping:'page',adapter_name:'s2s',gvlid:13,},mediagrid_outstream_s2s:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',adapter_name:'s2s',gvlid:13,},verizon_media_s2s:{rev_share:1,demand_type:'display',bid_grouping:'slot',adapter_name:'s2s',gvlid:25,},aol_instream_s2s:{rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'page',adapter_name:'s2s',gvlid:25,},aol_outstream_s2s:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',adapter_name:'s2s',gvlid:25,},engagebdr_s2s:{rev_share:1,demand_type:'display',bid_grouping:'page',adapter_name:'s2s',},magnite_s2s:{rev_share:1,demand_type:'display',bid_grouping:'page',adapter_name:'s2s',gvlid:52,},yieldmo_s2s:{rev_share:1,demand_type:'display',bid_grouping:'page',adapter_name:'s2s',gvlid:173,},appnexus_native:{rev_share:1,demand_type:'native',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'appnexus',gvlid:32,native_sizes:{native_horizontal:'300x250',native_vertical:'300x250',},},brealtime:{rev_share:0.9,demand_type:'display',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'appnexus',gvlid:32,},districtm:{rev_share:0.9,demand_type:'display',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'appnexus',gvlid:32,},shemedia:{rev_share:0.5,demand_type:'display',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'rubicon',gvlid:337,},openx_pmp:{rev_share:1,bid_grouping:'slot',gvlid:69,},triplelift_instream:{rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'page',default_bid_ttl:3600000,adapter_name:'triplelift',gvlid:28,},triplelift_outstream:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:3600000,adapter_name:'triplelift',gvlid:28,},undertone_instream:{rev_share:0.9,demand_type:'video',video_type:'instream',bid_grouping:'page',default_bid_ttl:360000,adapter_name:'undertone',gvlid:677,},undertone_outstream:{rev_share:0.9,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:360000,adapter_name:'undertone',gvlid:677,},vidazoo_instream:{rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'slot',default_bid_ttl:300000,adapter_name:'vidazoo',gvlid:744,},vidazoo_outstream:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'slot',default_bid_ttl:300000,adapter_name:'vidazoo',gvlid:744,},thirtythreeacross_instream:{rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'slot',default_bid_ttl:360000,adapter_name:'thirtythreeacross',gvlid:58,},thirtythreeacross_outstream:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'slot',default_bid_ttl:360000,adapter_name:'thirtythreeacross',gvlid:58,},smart_adserver_instream:{rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'page',default_bid_ttl:360000,adapter_name:'smart_adserver',gvlid:45,},smart_adserver_outstream:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:360000,adapter_name:'smart_adserver',gvlid:45,},medianet_outstream:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:360000,adapter_name:'medianet',gvlid:142,},unruly_instream:{rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'page',default_bid_ttl:600000,adapter_name:'unruly',gvlid:32,},unruly_outstream:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:600000,adapter_name:'unruly',gvlid:32,},rhythmone:{rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:360000,adapter_name:'unruly',gvlid:36,},rhythmone_instream:{rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'page',default_bid_ttl:600000,adapter_name:'unruly',gvlid:36,},rhythmone_outstream:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:600000,adapter_name:'unruly',gvlid:36,},adyoulike_instream:{rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'slot',default_bid_ttl:3600000,adapter_name:'adyoulike',gvlid:259,},adyoulike_outstream:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'slot',default_bid_ttl:3600000,adapter_name:'adyoulike',gvlid:259,},districtmdmx_instream:{rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'page',default_bid_ttl:3600000,adapter_name:'districtmdmx',},districtmdmx_outstream:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:3600000,adapter_name:'districtmdmx',},amazon_tam_instream:{rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'a9',gvlid:793,},amazon_tam_outstream:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'a9',auto_gen_sizes:['400x300','640x480'],gvlid:793,},emx_instream:{rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'page',default_bid_ttl:360000,adapter_name:'emx',gvlid:183,},emx_outstream:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:360000,adapter_name:'emx',gvlid:183,},sonobi_instream:{rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'sonobi',gvlid:104,},sonobi_outstream:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'sonobi',gvlid:104,},appnexus_instream:{rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'page',default_bid_ttl:3600000,adapter_name:'appnexus',gvlid:32,},appnexus_outstream:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:3600000,adapter_name:'appnexus',gvlid:32,},index:{rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'ix',gvlid:10,},ix_instream:{rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'page',default_bid_ttl:3600000,adapter_name:'ix',gvlid:10,},ix_outstream:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:3600000,adapter_name:'ix',gvlid:10,},engagebdr_instream_s2s:{rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'page',default_bid_ttl:3600000,adapter_name:'s2s',},engagebdr_outstream_s2s:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:3600000,adapter_name:'s2s',},magnite_instream_s2s:{rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'page',default_bid_ttl:3600000,adapter_name:'s2s',gvlid:25,},magnite_outstream_s2s:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:3600000,adapter_name:'s2s',gvlid:102,},yahoo_s2s:{rev_share:1,demand_type:'display',bid_grouping:'slot',default_bid_ttl:300000,adapter_name:'s2s',gvlid:25,},yahoo_instream_s2s:{rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'slot',default_bid_ttl:300000,adapter_name:'s2s',gvlid:25,},yahoo_outstream_s2s:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'slot',default_bid_ttl:300000,adapter_name:'s2s',gvlid:25,},yahoo_instream:{rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'slot',default_bid_ttl:300000,adapter_name:'yahoo',gvlid:25,},yahoo_outstream:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'slot',default_bid_ttl:300000,adapter_name:'yahoo',gvlid:25,},aol_outstream:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'aol_instream',gvlid:25,},beachfront_outstream:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'beachfront_instream',gvlid:335,},openx_outstream:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'openxOrtb',gvlid:69,},pubmatic_outstream:{rev_share:0.81,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'pubmatic_instream',gvlid:76,},rubicon_outstream:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'rubicon_instream',gvlid:52,},spotx_outstream:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:360000,adapter_name:'spotx_instream',gvlid:165,},beeswax_s2s:{rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'s2s',gvlid:12,},beeswax_instream_s2s:{rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'page',default_bid_ttl:3600000,adapter_name:'s2s',gvlid:12,},beeswax_outstream_s2s:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:3600000,adapter_name:'s2s',gvlid:12,},xandr_s2s:{rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'s2s',gvlid:32,},xandr_native_s2s:{rev_share:1,demand_type:'native',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'s2s',gvlid:32,native_sizes:{desktop:{'728x90':'native_horizontal','300x250':'native_horizontal','160x600':'native_vertical',},mobile:{'300x250':'native_horizontal','320x50':'native_horizontal',},},},pubmatic_outstream_s2s:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'s2s',gvlid:76,},pubmatic_native_s2s:{rev_share:1,demand_type:'native',bid_grouping:'page',default_bid_ttl:60000,adapter_name:'s2s',gvlid:76,native_sizes:{desktop:{'728x90':'native_horizontal','300x250':'native_horizontal','160x600':'native_vertical',},mobile:{'300x250':'native_horizontal','320x50':'native_horizontal',},},},pubmatic_native:{rev_share:0.81,demand_type:'native',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'pubmatic',gvlid:76,native_sizes:{desktop:{'300x250':'native_horizontal','320x50':'native_horizontal',},mobile:{'300x250':'native_horizontal','320x50':'native_horizontal',},},},medianet_native:{rev_share:1,demand_type:'native',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'medianet',gvlid:142,},xandr_instream_s2s:{rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'page',default_bid_ttl:3600000,adapter_name:'s2s',gvlid:32,},xandr_outstream_s2s:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:3600000,adapter_name:'s2s',gvlid:32,},criteo_instream:{rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'page',default_bid_ttl:3600000,adapter_name:'criteo',gvlid:91,},criteo_outstream:{rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:3600000,adapter_name:'criteo',gvlid:91,},criteo_native:{rev_share:1,demand_type:'native',bid_grouping:'page',default_bid_ttl:3600000,adapter_name:'criteo',gvlid:91,},alias_appnexus:{alias:1,rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'appnexus',gvlid:32,},alias_appnexus_instream:{alias:1,rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'page',default_bid_ttl:3600000,adapter_name:'appnexus',gvlid:32,},alias_appnexus_outstream:{alias:1,rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:3600000,adapter_name:'appnexus',gvlid:32,},alias_appnexus_native:{alias:1,rev_share:1,demand_type:'native',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'appnexus',gvlid:32,native_sizes:{native_horizontal:'300x250',native_vertical:'300x250',},},alias_index:{alias:1,rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'ix',gvlid:10,},alias_adagio:{alias:1,rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'adagio',gvlid:617,},alias_teads:{alias:1,rev_share:1,demand_type:'display',bid_grouping:'page',div_insertion:1,adapter_name:'teads',gvlid:132,native_sizes:{native_horizontal:'300x250',native_vertical:'300x250',},},alias_triplelift:{alias:1,rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'triplelift',gvlid:28,native_sizes:{native_horizontal:'300x250',native_vertical:'300x250',},},alias_medianet:{alias:1,rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'medianet',gvlid:142,},alias_rubicon:{alias:1,rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'rubicon',gvlid:52,},alias_mediagrid_s2s:{alias:1,rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:120000,adapter_name:'s2s',gvlid:13,},alias_sovrn:{alias:1,rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:90000,adapter_name:'sovrn',gvlid:13,},alias_emx:{alias:1,rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'emx',gvlid:183,},alias_openx:{alias:1,rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'openxOrtb',gvlid:69,},alias_rhythmone:{alias:1,rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:350000,adapter_name:'unruly',gvlid:36,},alias_sharethrough:{alias:1,rev_share:0.9,demand_type:'display',bid_grouping:'slot',default_bid_ttl:360000,adapter_name:'sharethrough',gvlid:80,native_sizes:{native_horizontal:'1x1',native_vertical:'1x1',},},alias_thirtythreeacross:{alias:1,rev_share:0.8,demand_type:'display',bid_grouping:'slot',default_bid_ttl:60000,adapter_name:'thirtythreeacross',gvlid:58,},alias_pubmatic:{alias:1,rev_share:0.81,demand_type:'display',bid_grouping:'page',default_bid_ttl:300000,acceptable_ads:true,adapter_name:'pubmatic',gvlid:76,},alias_criteo:{alias:1,rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:60000,adapter_name:'criteo',gvlid:91,},alias_aol:{alias:1,rev_share:1,demand_type:'display',bid_grouping:'slot',default_bid_ttl:60000,adapter_name:'aol',gvlid:25,},alias_spotx_instream:{alias:1,rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'slot',default_bid_ttl:360000,adapter_name:'spotx_instream',},alias_spotx_outstream:{alias:1,rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:360000,adapter_name:'spotx_instream',gvlid:165,},alias_a9:{alias:1,rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:120000,adapter_name:'a9',gvlid:793,},alias_amazon_tam_instream:{alias:1,rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'a9',gvlid:793,},alias_amazon_tam_outstream:{alias:1,rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'a9',gvlid:793,},alias_adyoulike_outstream:{alias:1,rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'slot',default_bid_ttl:3600000,adapter_name:'adyoulike',gvlid:259,},alias_criteo_outstream:{alias:1,rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:3600000,adapter_name:'criteo',gvlid:91,},alias_criteo_instream:{alias:1,rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'page',default_bid_ttl:3600000,adapter_name:'criteo',gvlid:91,},alias_ix:{alias:1,rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'ix',gvlid:10,},alias_ix_instream:{alias:1,rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'page',default_bid_ttl:3600000,adapter_name:'ix',gvlid:10,},alias_ix_outstream:{alias:1,rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:3600000,adapter_name:'ix',gvlid:10,},alias_index_outstream:{alias:1,rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:3600000,adapter_name:'ix',gvlid:10,},alias_openx_instream:{alias:1,rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'slot',default_bid_ttl:300000,adapter_name:'openxOrtb',gvlid:69,},alias_openx_outstream:{alias:1,rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'openxOrtb',gvlid:69,},alias_pubmatic_instream:{alias:1,rev_share:0.81,demand_type:'video',video_type:'instream',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'pubmatic_instream',gvlid:76,},alias_pubmatic_native:{alias:1,rev_share:0.81,demand_type:'native',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'pubmatic',gvlid:76,native_sizes:{desktop:{'300x250':'native_horizontal','320x50':'native_horizontal',},mobile:{'300x250':'native_horizontal','320x50':'native_horizontal',},},},alias_pubmatic_native_s2s:{alias:1,rev_share:1,demand_type:'native',bid_grouping:'page',default_bid_ttl:60000,adapter_name:'s2s',gvlid:76,native_sizes:{desktop:{'728x90':'native_horizontal','300x250':'native_horizontal','160x600':'native_vertical',},mobile:{'300x250':'native_horizontal','320x50':'native_horizontal',},},},alias_pubmatic_outstream_s2s:{alias:1,rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:300000,adapter_name:'s2s',gvlid:76,},alias_pubmatic_s2s:{alias:1,rev_share:1,demand_type:'display',bid_grouping:'slot',default_bid_ttl:60000,adapter_name:'s2s',gvlid:76,},alias_unruly:{alias:1,rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:360000,adapter_name:'unruly',gvlid:32,},alias_unruly_instream:{alias:1,rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'page',default_bid_ttl:600000,adapter_name:'unruly',gvlid:32,},alias_unruly_outstream:{alias:1,rev_share:1,demand_type:'video',video_type:'outstream',bid_grouping:'page',default_bid_ttl:600000,adapter_name:'unruly',gvlid:32,},});};var adPoolObj=(function(){function adPoolObj(){(this.initialized=false),(this.ads=[]),(this.amazon_ads=[]),(this.displayed_ads=[]),(this.auctions={}),(this.finished_auctions={}),(this.auction_refresh=true),(this.total_auctions=0),(this.auction_count=0),(this.vid_auction_count=0),(this.max_auctions=10),(this.last_auction_ts=0),(this.timeout_handle=null),(this.timeout=58000),(this.default_timeout=58000),(this.min_timeout=3000),(this.auction_rounds=1),(this.sizes={}),(this.sizes_bid_limit={}),(this.floors={}),(this.size_override=[]);this.init();}
adPoolObj.prototype.init=function(){window.addEventListener('properActiveTab',function(_e){this.setNextAuctionTimeout();}.bind(this));window.addEventListener('properInactiveTab',function(_e){properLog.proper_tracker();this.clearNextAuctionTimeout();}.bind(this));};adPoolObj.prototype.setSizes=function(slots){try{this.sizes={};if(slots&&slots.length){for(var i=0;i<slots.length;i++){let slot=slots[i];for(var j=0;j<slot.sizes.length;j++){if(this.size_override.length>0&&this.size_override.indexOf(slot.name)===-1)continue;var size=slot.sizes[j];if(properSpecialOps.no_bid_limit){this.sizes[size]=99;this.sizes_bid_limit=99;}else{if(!slot.slot_level_auction){this.sizes_bid_limit[size]=this.sizes_bid_limit[size]?this.sizes_bid_limit[size]+1:1;}
this.sizes[size]=this.sizes[size]?this.sizes[size]+1:1;}}}}else{Object.keys(properPage.slots).forEach(function(slot_type){if(Object.keys(properPage.slots[slot_type]).length){Object.keys(properPage.slots[slot_type]).forEach(function(slot_name){if(properPage.slots[slot_type][slot_name].sizes.length>0){for(var i=0;i<properPage.slots[slot_type][slot_name].sizes.length;i++){if(this.size_override.length>0&&this.size_override.indexOf(slot_name)===-1)continue;var size=properPage.slots[slot_type][slot_name].sizes[i];if(properSpecialOps.no_bid_limit){this.sizes[size]=99;this.sizes_bid_limit=99;}else{if(!properPage.slots[slot_type][slot_name].slot_level_auction){this.sizes_bid_limit[size]=this.sizes_bid_limit[size]?this.sizes_bid_limit[size]+1:1;}
this.sizes[size]=this.sizes[size]?this.sizes[size]+1:1;}}}},this);}},this);}
if(!Object.keys(this.sizes).length){var auction_sizes=ProperMedia.utils.deepAccess(properOps,'auctions.resolution_size_map')||{};if(Object.keys(auction_sizes).length>0){Object.keys(auction_sizes).forEach(function(tier){if(properPage.width>=tier){auction_sizes[tier].forEach(function(size){this.sizes[size]=99;},this);}},this);}}}catch(e){properLog.mylog('AdPool: Error setting auction sizes');return false;}
return true;};adPoolObj.prototype.setAuctionRounds=function(){try{var device_type=properDevice.isMobile()?'mobile':'desktop';this.auction_rounds=parseInt(ProperMedia.utils.deepAccess(properOps,'auctions.'+device_type+'.rounds')||this.auction_rounds);}catch(e){properLog.mylog('AdPool: Error setting auction rounds');return false;}
return true;};adPoolObj.prototype.setMaxAuctions=function(){try{var device_type=properDevice.isMobile()?'mobile':'desktop';this.max_auctions=parseInt(ProperMedia.utils.deepAccess(properOps,'auctions.'+device_type+'.max')||this.max_auctions);}catch(e){properLog.mylog('AdPool: Error setting max auction');return false;}
return true;};adPoolObj.prototype.setDefaultTimeout=function(){try{var device_type=properDevice.isMobile()?'mobile':'desktop';this.default_timeout=parseInt(ProperMedia.utils.deepAccess(properOps,'auctions.'+device_type+'.timeout')||this.default_timeout);}catch(e){properLog.mylog('AdPool: Error setting auction default timeout');return false;}
return true;};adPoolObj.prototype.checkSlotRefresh=function(){var refresh=false;Object.keys(properPage.slots['display']).forEach(function(slot_name){var slot=properPage.slots['display'][slot_name];if(slot.refresh.enabled){refresh=true;}});return refresh;};adPoolObj.prototype.checkMaxAuctionsReached=function(){return!!(this.auction_count>=this.max_auctions||ProperMedia.utils.deepAccess(properPage,'takeover.bidder')!=='');};adPoolObj.prototype.setDefaultFloors=function(){try{var device_type=properDevice.isMobile()?'mobile':'desktop';this.floors=ProperMedia.utils.deepCopy(ProperMedia.utils.deepAccess(properOps,'floors.'+device_type)||{});}catch(e){properLog.mylog('AdPool: Error setting auction default floors');return false;}
return true;};adPoolObj.prototype.startNewAuction=function(force){if(!userIds.isDoneMatching()){properLog.mylog('AdPool: Wait for UserId Matching To Finish.');userIds.setCallback(this.startNewAuction.bind(this));return false;}
if(consentManager.checkIfMissing()){properLog.mylog('AdPool: Wait for CMP Consent To Finish.');consentManager.loadIfMissing(this.startNewAuction.bind(this));return false;}
if(!properPage.viewability_tracker.slotsInFetchZone){properLog.mylog('AdPool: No slots are in the fetch zone.');properPage.viewability_tracker.setCallback(this.startNewAuction.bind(this));return false;}
if(!properPage.init_slots_build){properLog.mylog("AdPool: Initial slots for page haven't been built yet.");return false;}
this.initialized=true;this.setDefaultFloors();this.setMaxAuctions();this.setAuctionRounds();this.setDefaultTimeout();this.clearNextAuctionTimeout();this.setNextAuctionTimeout(force);};adPoolObj.prototype.startNewVideoAuction=function(video_type,slots=[]){this.setSizes(slots);this.sendVideoAuction(video_type,slots);this.clearExpiredAds();};adPoolObj.prototype.sendVideoAuction=function(video_type,slots){properLog.mylog('AdPool: Starting New Video Auction');this.vid_auction_count++;let auctionParams={auction_num:parseFloat(this.total_auctions+'.'+this.vid_auction_count),demand_type:'video',video_type:video_type,slots:slots,};var auction=new auctionObj(auctionParams);this.auctions[auction.id]=auction;auction.sendBids();return true;};adPoolObj.prototype.sendAuction=function(force,slots=[]){if(this.checkMaxAuctionsReached()&&!force){properLog.mylog('AdPool: Max Auctions reached: '+this.max_auctions);return false;}else if(!this.checkSlotRefresh()&&this.auction_count>0&&!force){properLog.mylog('AdPool: Auction disabled. No slots have refresh enabled.');return false;}else if(!this.auction_refresh&&this.auction_count>0&&!force){properLog.mylog('AdPool: Auction Refresh is disabled.');return false;}else{properLog.mylog('AdPool: Starting New Auction');this.setSizes(slots);if(!slots||!slots.length){this.auction_count+=1;}
this.total_auctions+=1;properSession.updateSessionAuctionCount();if(properPage.video_enabled){this.vid_auction_count++;}
let auctionParams={auction_num:this.total_auctions,slots:slots,};var auction=new auctionObj(auctionParams);this.auctions[auction.id]=auction;auction.sendBids();this.size_override=[];return true;}};adPoolObj.prototype.auctionFinished=function(id){let auction=this.auctions[id]||false;if(auction){var properAuctionDoneEvent=new Event('properAuctionDone');window.dispatchEvent(properAuctionDoneEvent);this.finished_auctions[id]=this.auctions[id];delete this.auctions[id];if(!auction.slots||!auction.slots.length){this.last_auction_ts=Date.now();this.setNextAuctionTimeout();}
var auction_keys=Object.keys(this.finished_auctions)||[];if(auction_keys.length>10){var delete_keys=auction_keys.splice(0,auction_keys.length-10);delete_keys.forEach(function(id){delete this.finished_auctions[id];},this);}}};adPoolObj.prototype.addBidToPool=function(ad){if(ad.price>0){var newAd=new adObj(ProperMedia.utils.deepCopy(ad));newAd.dfp_price=roundPriceToDfpBucket(newAd.price);this.ads.push(newAd);this.ads.sort(function(a,b){return parseFloat(b.price)-parseFloat(a.price);});}};adPoolObj.prototype.getWinningBids=function(slot,ad_types,video_type){let winning_ad,flex_ads=[];const leading_bid=this.getWinningBid(slot,ad_types,video_type);if(slot.flex_enabled){const flex_map=slot.flex_map;const flex_bids=Object.entries(flex_map).filter(([,number_of_ads])=>number_of_ads>1).map(([size,number_of_ads])=>{const ads=this.ads.filter((ad)=>ad.size===size);return this.getWinningBid(slot,ad_types,video_type,ads,number_of_ads);});const winning_flex_bids=flex_bids.reduce((winner,current)=>((winner?.price||0)>(current?.price||0)?winner:current),leading_bid)?.ads;if(winning_flex_bids?.length){[winning_ad,...flex_ads]=winning_flex_bids.map((bid)=>new adObj(ProperMedia.utils.deepCopy(bid)));}}
if(!winning_ad&&leading_bid?.ads?.length){winning_ad=new adObj(ProperMedia.utils.deepCopy(leading_bid.ads[0]));}
this.removeAds(winning_ad,...flex_ads);return{winning_ad,flex_ads,};};adPoolObj.prototype.getWinningBid=function(slot,ad_types,video_type,ads_array,number_of_ads){const sizes=slot.sizes;const winning_ads=[];ad_types=ad_types||['display','native','video'];ads_array=ads_array||this.ads;number_of_ads=number_of_ads||1;if(ads_array.length>0){if(properPage.video_enabled===false||!(slot.video_player instanceof videoPlayer)){ad_types=['display','native'];}
for(const current_ad of ads_array){if(current_ad.checkIfExpired()){this.removeAds(current_ad);continue;}
if(current_ad.displayed===1)continue;if(ad_types.indexOf(current_ad.type)===-1)continue;if(current_ad.type==='video'&&(!video_type||video_type!==current_ad.video_type))continue;if(sizes.indexOf(current_ad.size)===-1)continue;if(slot.sticky===1&&slot.displayed===1&&slot.refresh.count>0&&slot.size!==current_ad.size&&!properSpecialOps.sliderHeader)
continue;if(slot.refresh.count>0&&ProperMedia.utils.deepAccess(properOps,'bidder_info.'+current_ad.bidder+'.dont_refresh')===1)
continue;if(current_ad.target_slot&&current_ad.target_slot!==slot.dfp_name){return;}
if(slot.slot_level_auction&&(!current_ad.target_slot||current_ad.target_slot!==slot.dfp_name)){return;}
if(properUser.checkAdBlock()&&(!ProperMedia.utils.deepAccess(properOps,'bidder_info.'+current_ad.bidder+'.acceptable_ads')||ProperMedia.utils.deepAccess(properOps,'bidder_info.'+current_ad.bidder+'.demand_type')!=='native')){continue;}
const floor_price=properOps.testing_mode.enabled?0:slot.getFloor(current_ad.size);if(ProperMedia.utils.deepAccess(properPage,'takeover.bidder')!==''&&current_ad.bidder!==ProperMedia.utils.deepAccess(properPage,'takeover.bidder'))
continue;if(current_ad.price>=floor_price){winning_ads.push(current_ad);if(winning_ads.length>=number_of_ads){break;}}}
return{ads:winning_ads,price:winning_ads.reduce((sum,{price})=>sum+price,0),};}
return null;};adPoolObj.prototype.removeAd=function(i){this.ads.splice(i,1);};adPoolObj.prototype.removeAds=function(...ads){this.ads?.reduce((acc,ad,i)=>(ads.find((a)=>a?.id===ad?.id)?[i,...acc]:acc),[]).forEach((i)=>this.removeAd(i));};adPoolObj.prototype.addAmazonBidToPool=function(ad){if(ad.price){var newAd=new adObj(ProperMedia.utils.deepCopy(ad));this.amazon_ads.push(newAd);this.amazon_ads=_0x2b21de(this.amazon_ads);}};adPoolObj.prototype.getWinningAmazonBid=function(slot,ad_types,video_type){var sizes=slot.sizes;ad_types=ad_types||['display','native','video'];if(this.amazon_ads.length>0){if((properPage.video_enabled===false||!(slot.video_player instanceof videoPlayer))&&ad_types.indexOf('video')!==-1){ad_types.splice(ad_types.indexOf('video'),1);}
if(ad_types.length==0)return;for(var i=0;i<this.amazon_ads.length;i++){var winning_ad=this.amazon_ads[i];if(winning_ad.checkIfExpired()){this.amazon_ads.splice(i,1);i--;continue;}
if(winning_ad.displayed==1)continue;if(ad_types.indexOf(winning_ad.type)==-1)continue;if(winning_ad.type=='video'&&(!video_type||video_type!==winning_ad.video_type))continue;if(sizes.indexOf(winning_ad.size)==-1)continue;if(slot.sticky==1&&slot.displayed==1&&slot.refresh.count>0&&slot.size!==winning_ad.size&&!properSpecialOps.sliderHeader)
continue;if(slot.refresh.count>0&&ProperMedia.utils.deepAccess(properOps,'bidder_info.'+winning_ad.bidder+'.dont_refresh')==1)
continue;if(winning_ad.target_slot&&winning_ad.target_slot!==slot.dfp_name){continue;}
if(properUser.checkAdBlock()&&(!ProperMedia.utils.deepAccess(properOps,'bidder_info.'+winning_ad.bidder+'.acceptable_ads')||ProperMedia.utils.deepAccess(properOps,'bidder_info.'+winning_ad.bidder+'.demand_type')!=='native')){continue;}
if(ProperMedia.utils.deepAccess(properPage,'takeover.bidder')!=''&&winning_ad.bidder!=ProperMedia.utils.deepAccess(properPage,'takeover.bidder'))
continue;slot.winning_amazon_ad=new adObj(ProperMedia.utils.deepCopy(winning_ad));this.amazon_ads.splice(i,1);break;}}};adPoolObj.prototype.calcTimeout=function(){if((this.total_auctions===0&&this.auction_count===0)||(this.total_auctions===1&&this.auction_count===1&&properPage.spa_settings.enabled&&properPage.spa_settings.prefetch)){this.timeout=0;}else if(this.auction_count===0&&this.total_auctions>0){this.timeout=this.timeSinceLastAuction()<this.min_timeout?this.min_timeout:0;}else{this.timeout=Math.max(this.min_timeout,this.default_timeout);}
this.timeout=this.timeout-this.timeSinceLastAuction();return Math.max(this.timeout,0);};adPoolObj.prototype.getTimeLeftOnRunningAuctions=function(){var times=[];try{if(Object.keys(this.auctions).length){Object.keys(this.auctions).forEach(function(id){var auction=this.auctions[id];var time=Math.max(0,auction.max_timeout-auction.auctionTimePassed());if(time>0){times.push(time);}},this);}}catch(e){console.log(e);}
return times;};adPoolObj.prototype.setNextAuctionTimeout=function(force){if(this.timeout_handle==null&&!this.checkMaxAuctionsReached()&&this.initialized&&!properOps.slot_level_auction){this.calcTimeout();this.timeout_handle=properSetTimeout.setTimeout.call(this,function(){this.clearNextAuctionTimeout();this.sendAuction(force);this.clearExpiredAds();},Math.max(0,this.timeout));}};adPoolObj.prototype.clearNextAuctionTimeout=function(){clearTimeout(this.timeout_handle);this.timeout_handle=null;};adPoolObj.prototype.timeSinceLastAuction=function(){if(this.last_auction_ts===0)return 0;return Date.now()-this.last_auction_ts;};adPoolObj.prototype.clearExpiredAds=function(){if(this.ads.length>0){for(var i=0;i<this.ads.length;i++){if(this.ads[i].checkIfExpired()){this.ads.splice(i--,1);}}}};adPoolObj.prototype.clearCachedAds=function(){properLog.mylog('AdPool: Clearing Cached Ads');this.ads=[];this.displayedAds=[];};return adPoolObj;})();var auctionObj=(function(auction_num){function auctionObj({auction_num,demand_type,video_type,slots}){(this.id=ProperMedia.utils.generateUUID()),(this.requests_sent=0),(this.ads=[]),(this.amazon_ads=[]),(this.bid_errors=[]),(this.bids={}),(this.bids_sent_finished=false),(this.bids_sent=0),(this.bids_returned=0),(this.bids_started_ts=0),(this.bids_done_ts=0),(this.auction_bidders=[]),(this.all_bidders=[]),(this.bidders_no_bids=[]),(this.max_timeout=1500),(this.max_timeout_handle=null),(this.auction_num=auction_num),(this.alias_accounts=false),(this.demand_type=demand_type||null),(this.video_type=video_type||null),(this.sizes={}),(this.finished=false),(this.uids={}),(this.slots=slots||[]);}
auctionObj.prototype.sendBids=function(){if(checkKillAllAds()){return false;}
this.uids=userIds.getUIdsObj();this.setAliasAccounts();this.setMaxAuctionTimeout();this.bids_started_ts=ProperMedia.utils.getTimestampMs();this.sendS2SBidders();this.sendHeaderBidders();this.bids_sent_finished=true;};auctionObj.prototype.sendS2SBidders=function(){if(!cookieMatching.done_matching){properLog.mylog('Wait for S2S Cookie Matching To Finish.');cookieMatching.callback=this.sendS2SBidders.bind(this);return;}
this.getAuctionBidders('s2s');if(this.auction_bidders.length>0){var tagIds={};var device=properDevice.isMobile()?'mobile':'desktop';var auction_round=Math.max(0,parseInt(properAdPool.auction_count-1)%parseInt(properAdPool.auction_rounds));this.auction_bidders.forEach(function(bidderS2S){var bidderDataS2S=ProperMedia.utils.deepAccess(properOps,'bidders.s2s.'+bidderS2S+'.tag_ids.'+device)||false;var bidderDataSlotS2S=ProperMedia.utils.deepAccess(properOps,'bidders.s2s.'+bidderS2S+'.slot_tag_ids.'+device)||false;var autoGenTagIds=ProperMedia.utils.deepAccess(properOps,'bidder_info.'+bidderS2S+'.auto_gen_tag_ids')||ProperMedia.utils.deepAccess(bidAdapters,'s2s.bidderInfo.auto_gen_tag_ids')||false;if(properOps.slot_level_auction===true){bidderDataS2S=false;}
if(autoGenTagIds){bidderDataS2S=false;bidderDataSlotS2S=[];let demand_type=ProperMedia.utils.deepAccess(properOps,'bidder_info.'+bidderS2S+'.demand_type')||'display';let data={};let autoGenSlots=this.slots.length?this.slots:objectValues(properPage.slots[demand_type]);if(autoGenSlots.length){autoGenSlots.forEach(function(slot){data[slot.dfp_name]={};for(let i=0;i<slot.sizes.length;i++){let size=slot.sizes[i];let auto_gen_sizes=ProperMedia.utils.deepAccess(properOps,'bidder_info.'+bidderS2S+'.auto_gen_sizes')||ProperMedia.utils.deepAccess(bidAdapters,'s2s.bidderInfo.auto_gen_sizes')||[];if(properOps.native_sizes[size]&&auto_gen_sizes.indexOf(size)==-1){continue;}
if(typeof data[slot.dfp_name][size]=='undefined'){data[slot.dfp_name][size]=[];}
data[slot.dfp_name][size].push(slot_name);}});}
if(Object.keys(data)){bidderDataSlotS2S.push(data);}}
if(!this.checkAlternateAccounts(bidderS2S)){return false;}
if(!bidderDataS2S||bidderDataS2S.length==0){return false;}
var bidderDataS2SCopy=ProperMedia.utils.deepCopy(bidderDataS2S);var site_id=ProperMedia.utils.deepAccess(properOps,'bidders.s2s.'+bidderS2S+'.site_id')||'';var tag_ids=Object.filter(bidderDataS2SCopy[auction_round]||{},function(size){return typeof properAdPool.sizes[size]!=='undefined'&&bidderDataS2SCopy[auction_round][size].length>0;});var bidderDataSlotTagIdsCopy=ProperMedia.utils.deepCopy(bidderDataSlotS2S);var auctionSlots=this.slots||[];var slot_tag_ids=Object.filter(bidderDataSlotTagIdsCopy[auction_round]||{},function(slot_name){let slot=properPage.getSlotFromPageObjectByDfpName(slot_name);if(auctionSlots.length){found=auctionSlots.find(function(auction_slot){return auction_slot.dfp_name==slot.dfp_name;})||false;}
return slot&&slot.slot_level_auction&&found;},this);for(var size in tag_ids){var bid_limit=properAdPool.sizes_bid_limit[size];slot_tag_ids=[];if(tag_ids[size].length-bid_limit>0){tag_ids[size].splice(bid_limit,tag_ids[size].length-bid_limit);}
if(!ProperMedia.utils.deepAccess(this,'sizes.'+size)){this.sizes[size]=properAdPool.sizes[size];}}
for(var slot_name in slot_tag_ids){for(var slot_tag_id_size in slot_tag_ids[slot_name]){if(typeof properAdPool.sizes[slot_tag_id_size]!=='undefined'&&slot_tag_ids[slot_name][slot_tag_id_size].length>0){if(!ProperMedia.utils.deepAccess(this,'sizes.'+slot_tag_id_size)){this.sizes[slot_tag_id_size]=properAdPool.sizes[slot_tag_id_size];}}else{delete slot_tag_ids[slot_name][slot_tag_id_size];}}}
var bidder_floors=ProperMedia.utils.deepCopy(ProperMedia.utils.deepAccess(properOps,'bidders.s2s'+'.'+bidderS2S+'.floors.'+device)||{});var skip_schain=schainCheck(bidderS2S)?false:true;var bidder_ids={};if(ProperMedia.utils.deepAccess(properOps,'bidders.s2s.'+bidderS2S+'.account_overrides.enabled')&&ProperMedia.utils.deepAccess(properOps,'bidders.s2s.'+bidderS2S+'.account_overrides.bidder_ids')){bidder_ids=ProperMedia.utils.deepAccess(properOps,'bidders.s2s.'+bidderS2S+'.account_overrides.bidder_ids');}
if(Object.keys(tag_ids).length>0){tagIds[bidderS2S]={site_id:site_id,tag_ids:tag_ids,slot_tag_ids:slot_tag_ids,bidder_ids:bidder_ids,skip_schain:skip_schain,bidder_floors:bidder_floors,};}},this);if(Object.keys(tagIds).length>0){this.bids['s2s']=new bidObj('s2s',tagIds,{},this);try{consentManager.ready(function(){bidAdapters['s2s'].send(this.bids['s2s']);}.bind(this));}catch(e){console.error(e);e.bidder='s2s';sendError(TraceKit.computeStackTrace(e));}}}};auctionObj.prototype.sendHeaderBidders=function(){this.getAuctionBidders('header');if(this.auction_bidders.length>0){var device=properDevice.isMobile()?'mobile':'desktop';this.shuffleBidders();var auction_round=!this.slots.length?Math.max(0,parseInt(properAdPool.auction_count-1)%parseInt(properAdPool.auction_rounds)):0;this.auction_bidders.forEach(function(bidder){var bidderAdapterName=bidderToAdapterName(bidder);var bidderDataTagIds=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.tag_ids.'+device)||false;var bidderDataSlotTagIds=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.slot_tag_ids.'+device)||false;var autoGenTagIds=ProperMedia.utils.deepAccess(properOps,'bidder_info.'+bidder+'.auto_gen_tag_ids')||ProperMedia.utils.deepAccess(bidAdapters,bidderAdapterName+'.bidderInfo.auto_gen_tag_ids')||false;if(properOps.slot_level_auction===true){bidderDataTagIds=false;}
if(autoGenTagIds){bidderDataTagIds=false;bidderDataSlotTagIds=[];let demand_type=ProperMedia.utils.deepAccess(properOps,'bidder_info.'+bidder+'.demand_type')||'display';let data={};let autoGenSlots=this.slots.length?this.slots:objectValues(properPage.slots[demand_type]);if(autoGenSlots.length){autoGenSlots.forEach(function(slot){data[slot.dfp_name]={};for(let i=0;i<slot.sizes.length;i++){let size=slot.sizes[i];let auto_gen_sizes=ProperMedia.utils.deepAccess(properOps,'bidder_info.'+bidder+'.auto_gen_sizes')||ProperMedia.utils.deepAccess(bidAdapters,bidderAdapterName+'.bidderInfo.auto_gen_sizes')||[];if(properOps.native_sizes[size]&&auto_gen_sizes.indexOf(size)==-1){continue;}
if(typeof data[slot.dfp_name][size]=='undefined'){data[slot.dfp_name][size]=[];}
data[slot.dfp_name][size].push(slot_name);}});}
if(Object.keys(data)){bidderDataSlotTagIds.push(data);}}
if(!this.checkAlternateAccounts(bidder)){return false;}
if((!bidderDataTagIds||bidderDataTagIds.length==0)&&(!bidderDataSlotTagIds||bidderDataSlotTagIds.length==0)){return false;}
var bidderDataTagIdsCopy=ProperMedia.utils.deepCopy(bidderDataTagIds);var tag_ids=Object.filter(bidderDataTagIdsCopy[auction_round]||{},function(size){return typeof properAdPool.sizes[size]!=='undefined'&&bidderDataTagIdsCopy[auction_round][size].length>0;});var bidderDataSlotTagIdsCopy=ProperMedia.utils.deepCopy(bidderDataSlotTagIds);var auctionSlots=this.slots||[];var slot_tag_ids=Object.filter(bidderDataSlotTagIdsCopy[auction_round]||{},function(slot_name){let slot=properPage.getSlotFromPageObjectByDfpName(slot_name);let found=true;if(auctionSlots.length){found=auctionSlots.find(function(auction_slot){return auction_slot.dfp_name==slot.dfp_name;})||false;}
return slot&&slot.slot_level_auction&&found;},this);for(var tag_id_size in tag_ids){var bid_limit=properAdPool.sizes_bid_limit[tag_id_size];if(tag_ids[tag_id_size].length-bid_limit>0){tag_ids[tag_id_size].splice(bid_limit,tag_ids[tag_id_size].length-bid_limit);}
if(!ProperMedia.utils.deepAccess(this,'sizes.'+tag_id_size)){this.sizes[tag_id_size]=properAdPool.sizes[tag_id_size];}}
for(var slot_name in slot_tag_ids){for(var slot_tag_id_size in slot_tag_ids[slot_name]){if(typeof properAdPool.sizes[slot_tag_id_size]!=='undefined'&&slot_tag_ids[slot_name][slot_tag_id_size].length>0){if(!ProperMedia.utils.deepAccess(this,'sizes.'+slot_tag_id_size)){this.sizes[slot_tag_id_size]=properAdPool.sizes[slot_tag_id_size];}}else{delete slot_tag_ids[slot_name][slot_tag_id_size];}}}
if(Object.keys(tag_ids).length>0||Object.keys(slot_tag_ids).length>0){this.bids[bidder]=new bidObj(bidder,tag_ids,slot_tag_ids,this);try{if(typeof bidAdapters[bidderAdapterName]!=='undefined'){consentManager.ready(function(){bidAdapters[bidderAdapterName].send(this.bids[bidder]);if(typeof bidAdapters[bidderAdapterName].getUserSyncs=='function'){bidAdapters[bidderAdapterName].getUserSyncs();}}.bind(this));}}catch(e){console.error(e);e.bidder=bidderAdapterName;sendError(TraceKit.computeStackTrace(e));}}},this);}};auctionObj.prototype.getAuctionBidders=function(bidder_type){this.auction_bidders=Object.keys(properOps.bidders[bidder_type]||{}).filter(function(bidder){var bidderObj=properOps.bidders[bidder_type][bidder],demand_type=ProperMedia.utils.deepAccess(properOps,'bidder_info.'+bidder+'.demand_type')||'display',acceptable_ads=ProperMedia.utils.deepAccess(properOps,'bidder_info.'+bidder+'.acceptable_ads')||false,video_type=ProperMedia.utils.deepAccess(properOps,'bidder_info.'+bidder+'.video_type')||null,no_bid_cnt=ProperMedia.utils.deepAccess(properSession,'sessionData.no_bid_cnt.'+bidder)||0;if(!gdprEnforcement.makeBidRequestEnforcement(bidder)){return false;}
if(properOps.nobid_auction_limit.enabled&&no_bid_cnt>=properOps.nobid_auction_limit[demand_type]+3){no_bid_cnt=properOps.nobid_auction_limit[demand_type]-1;ProperMedia.utils.deepSetValue(properSession,'sessionData.no_bid_cnt.'+bidder,no_bid_cnt);}else if(properOps.nobid_auction_limit.enabled&&no_bid_cnt>=properOps.nobid_auction_limit[demand_type]){no_bid_cnt++;ProperMedia.utils.deepSetValue(properSession,'sessionData.no_bid_cnt.'+bidder,no_bid_cnt);}
if((ProperMedia.utils.deepAccess(properSpecialOps,'disabled_bidders')||[]).includes(bidder)){return false;}
if(properUser.checkAdBlock()&&!acceptable_ads&&demand_type!=='native'){return false;}
if(ProperMedia.utils.deepAccess(properPage,'takeover.bidder')!=''&&ProperMedia.utils.deepAccess(properPage,'takeover.bidder')!=bidder){return false;}
return((!properOps.nobid_auction_limit.enabled||no_bid_cnt<properOps.nobid_auction_limit[demand_type])&&(!this.demand_type||this.demand_type==demand_type)&&(demand_type=='display'||demand_type=='native'||(demand_type=='video'&&properPage.video_enabled==true&&properPage.video_player_count[video_type]['possible'].length>0&&(!this.video_type||this.video_type==video_type)))&&((bidderObj.enabled&&!bidderObj.test&&!properOps.testing_mode.bidder)||properOps.testing_mode.bidder==bidder));},this);this.bidders_no_bids=this.bidders_no_bids.concat(ProperMedia.utils.deepCopy(this.auction_bidders));this.all_bidders=ProperMedia.utils.deepCopy(this.bidders_no_bids);};auctionObj.prototype.setAuctionTopAverages=function(){let device=properDevice.isMobile()?'mobile':'desktop';let multiplier=properSpecialOps.dynamicFloorsAvgMult||ProperMedia.utils.deepAccess(properOps,'dynamic_floors.'+device+'.avg_mult')||(properSession?.sessionData?.depth<5?3:4);let avgMax=properSpecialOps.dynamicFloorsAvgMax||ProperMedia.utils.deepAccess(properOps,'dynamic_floors.'+device+'.avg_max')||10;var bid_limits={};if(properSpecialOps.dynamicFloors||ProperMedia.utils.deepAccess(properOps,'dynamic_floors.'+device+'.enabled')){var top_size_bids={};properSession.sessionData.bid_avg=properSession.sessionData.bid_avg||{};Object.keys(this.sizes).forEach(function(size){bid_limits[size]=Math.min(Math.round((this.sizes[size]===99?4:this.sizes[size])*multiplier),avgMax);top_size_bids[size]=[];},this);this.ads.forEach(function(ad){if(typeof top_size_bids[ad.size]=='undefined'){bid_limits[ad.size]=Math.min(Math.round((this.sizes[ad.size]===99?4:this.sizes[ad.size])*multiplier),avgMax);top_size_bids[ad.size]=[];}
if(top_size_bids[ad.size].length<bid_limits[ad.size]){top_size_bids[ad.size].push(ad.price);}},this);top_size_bids=_0x359c5d(this,top_size_bids,bid_limits,multiplier,avgMax);Object.keys(top_size_bids).forEach(function(size){var avg_cnt=bid_limits[size]+1;var floor=ProperMedia.utils.deepAccess(properAdPool,'floors.sizes.'+size)||properAdPool.floors.backup;if(!properSession.sessionData.bid_avg[size]){avg_cnt=bid_limits[size];properSession.sessionData.bid_avg[size]=0;}
for(var i=0;i<bid_limits[size];i++){var price=top_size_bids[size][i]||floor;properSession.sessionData.bid_avg[size]+=price;}
properSession.sessionData.bid_avg[size]=Number((properSession.sessionData.bid_avg[size]/avg_cnt).toFixed(2));},this);properSession.setSessionData();}};auctionObj.prototype.shuffleBidders=function(){var currentIndex=this.auction_bidders.length,temporaryValue,randomIndex;while(0!==currentIndex){randomIndex=Math.floor(Math.random()*currentIndex);currentIndex-=1;temporaryValue=this.auction_bidders[currentIndex];this.auction_bidders[currentIndex]=this.auction_bidders[randomIndex];this.auction_bidders[randomIndex]=temporaryValue;}
return this.auction_bidders;};auctionObj.prototype.setMaxAuctionTimeout=function(){var obj=this;if(this.max_timeout_handle==null){this.max_timeout_handle=properSetTimeout.setTimeout.call(obj,function(){this.auctionFinished();},properOps.custom_auction_timeout||obj.max_timeout);}};auctionObj.prototype.clearMaxAuctionTimeout=function(){clearTimeout(this.max_timeout_handle);this.max_timeout_handle=null;};auctionObj.prototype.incrementRequestsSent=function(count){this.bids_sent+=!isNaN(parseInt(count))?parseInt(count):0;this.requests_sent++;};auctionObj.prototype.incrementBidResponseCount=function(count){this.bids_returned+=!isNaN(parseInt(count))?parseInt(count):0;if(this.bids_sent<=this.bids_returned&&this.bids_sent_finished==true&&this.finished==false){this.auctionFinished();}};auctionObj.prototype.getPerecentBidsReady=function(){return this.bids_sent>0?((this.bids_returned/this.bids_sent)*100).toFixed(2):0;};auctionObj.prototype.logBidResponse=function(ad,bid){var newAd=new adObj(ProperMedia.utils.deepCopy(ad));var bid_adapter_name=bidderToAdapterName(bid.bidder);if(bid.bidder=='a9'||bid_adapter_name=='a9'){this.amazon_ads.push(newAd);this.amazon_ads=_0x2b21de(this.amazon_ads);}else{this.ads.push(newAd);this.ads.sort(function(a,b){return parseFloat(b.price)-parseFloat(a.price);});}
var bidder=bid.bidder=='s2s'?ad.bidder:bid.bidder;if(this.bidders_no_bids.indexOf(bidder)!==-1){this.bidders_no_bids.splice(this.bidders_no_bids.indexOf(bidder),1);}
if(!properUser.checkAdBlockDetected()||properUser.checkAdBlock()){if(bid.bidder=='a9'||bid_adapter_name=='a9'){properAdPool.addAmazonBidToPool(ad);}else{properAdPool.addBidToPool(ad);}}};auctionObj.prototype.calcAuctionMs=function(){return this.bids_done_ts>0&&this.bids_started_ts>0&&this.bids_done_ts>this.bids_started_ts?this.bids_done_ts-this.bids_started_ts:-1;};auctionObj.prototype.auctionTimePassed=function(){var d=new Date();var ts=d.getTime();return ts-this.bids_started_ts;};auctionObj.prototype.auctionFinished=function(){if(!this.finished){this.finished=true;properLog.mylog('Auction Finished');this.clearMaxAuctionTimeout();this.bids_done_ts=ProperMedia.utils.getTimestampMs();properAdPool.auctionFinished(this.id);this.setAuctionTopAverages();this.setBiddersWithNoBids();userIds.initUserIdData();}};auctionObj.prototype.setBiddersWithNoBids=function(){if(properOps.nobid_auction_limit.enabled&&this.all_bidders.length){this.all_bidders.forEach(function(bidder){if(this.bidders_no_bids.indexOf(bidder)!==-1){var count=(ProperMedia.utils.deepAccess(properSession,'sessionData.no_bid_cnt.'+bidder)||0)+1;ProperMedia.utils.deepSetValue(properSession,'sessionData.no_bid_cnt.'+bidder,count);}else{if(ProperMedia.utils.deepAccess(properSession,'sessionData.no_bid_cnt.'+bidder)){delete properSession.sessionData.no_bid_cnt[bidder];}}},this);properSession.setSessionData();}};auctionObj.prototype.setAliasAccounts=function(){this.alias_accounts=!!(ProperMedia.utils.deepAccess(properSpecialOps,'alias_accounts')||(ProperMedia.utils.deepAccess(properSpecialOps,'alternate_bidders_pageviews')&&ProperMedia.utils.deepAccess(properSession,'sessionData.depth')%2==0)||(ProperMedia.utils.deepAccess(properSpecialOps,'alternate_bidders_auctions')&&ProperMedia.utils.deepAccess(properSession,'sessionData.auction_count')%2==0));};auctionObj.prototype.checkAlternateAccounts=function(bidder){var bidder_alias=ProperMedia.utils.deepAccess(properOps,'bidder_info.'+bidder+'.alias')||false;return(((properSpecialOps.alias_accounts||properSpecialOps.alternate_bidders_auctions||properSpecialOps.alternate_bidders_pageviews)&&this.alias_accounts&&(bidder_alias||(!bidder_alias&&this.auction_bidders.indexOf('alias_'+bidder)==-1)))||(!this.alias_accounts&&!bidder_alias));};return auctionObj;})();var cookieMatchingObj=function(){(this.proper_uid=''),(this.bidderUserSyncValues={}),(this.cookie_map={aol:['aol_outstream','aol_instream'],sovrn:['sovrn','sovrn_instream','sovrn_outstream'],yahoo:['yahoo','yahoo_instream','yahoo_outstream'],adaptmx:['adaptmx','adaptmx_outstream','adaptmx_instream'],magnite:['magnite','magnite_instream','magnite_outstream'],pubmatic:['pubmatic','pubmatic_outstream','pubmatic_native'],engagebdr:['engagebdr','engagebdr_instream','engagebdr_outstream'],xandr:['xandr','xandr_native','xandr_instream','xandr_outstream'],verizon_media:['verizon_media','yahoo','yahoo_instream','yahoo_outstream'],}),(this.done_matching=false),(this.sent=0),(this.received=0),(this.timeout=1000),(this.timeout_handle=null),(this.callback=null),(this.init=function(){this.proper_uid=properUser.pubcid||userIdAdapters.pubCommonId.getValue();Object.keys(ProperMedia.utils.deepAccess(properOps,'bidders.s2s')||{}).forEach(function(bidder){if(ProperMedia.utils.deepAccess(properOps,'bidders.s2s.'+bidder+'.enabled')||(properOps.testing_mode.enabled&&properOps.testing_mode.bidder==bidder)){this.getBidderUserSyncValue(bidder);}},this);});this.cookieMatch=function(){var s2s_bidders=[];Object.keys(ProperMedia.utils.deepAccess(properOps,'bidders.s2s')||{}).forEach(function(bidder){if(ProperMedia.utils.deepAccess(properOps,'bidders.s2s.'+bidder+'.enabled')||(properOps.testing_mode.enabled&&properOps.testing_mode.bidder==bidder)){s2s_bidders.push(bidder);}});for(var i=0;i<s2s_bidders.length;i++){var bidder=s2s_bidders[i].replace('_s2s','');if(!this.bidderUserSyncValues[bidder]){consentManager.ready(function(){this.requestCookieMatch(bidder);}.bind(this));}}
if(this.sent==0){this.matchingDone();}else{this.addTimeout();}};this.requestCookieMatch=function(bidder){if(gppConsentModule.userSyncsDenied()||!gdprEnforcement.userSyncEnforcement(bidder+'_s2s')){return false;}
properLog.mylog('Start '+bidder+' Cookie Matching');var consentData=[];if(typeof gdprConsent.gdprApplies==='boolean'){consentData.push('gdpr='+gdprConsent.gdprApplies.toString());if(gdprConsent.consentString){consentData.push('gdpr_consent='+gdprConsent.consentString);}}
if(uspConsent.usPrivacy){consentData.push('us_privacy='+uspConsent.usPrivacy);}
var consentString=consentData.join('&');var redir=properOps.usync_endpoint+'?bidder='+bidder+'&proper_uid='+this.proper_uid+'&uid=';var obj=this,uid='',uri='',iframe_url='',iframe_id='';var onload=false;if(bidder=='adaptmx'||bidder=='adaptmx_instream'||bidder=='adaptmx_outstream'){uri='https://prebid.a-mo.net/cchain/0?cb='+encodeURIComponent(redir)+'&'+consentString;}else if(bidder=='sovrn'||bidder=='sovrn_instream'||bidder=='sovrn_outstream'){uid='[SOVRNID]';let siteId=ProperMedia.utils.deepAccess(properOps,'bidders.s2s.'+bidder+'_s2s.site_id')||263069;uri='https://ce.lijit.com/merge?pid='+
siteId+
'&3pid='+
this.proper_uid+
'&location='+
encodeURIComponent(redir+uid)+
'&'+
consentString;}else if(bidder=='pubmatic'||bidder=='pubmatic_outstream'||bidder=='pubmatic_native'){uid='#PM_USER_ID';uri='https://image6.pubmatic.com/AdServer/UCookieSetPug?oid=1&rd='+encodeURIComponent(redir+uid)+'&'+consentString;}else if(bidder=='districtm'){uid='$UID';uri='https://ib.adnxs.com/getuid?'+encodeURIComponent(redir+uid)+'&'+consentString;}else if(bidder=='sonobi'){uid='[UID]';uri='https://sync.go.sonobi.com/us?loc='+encodeURIComponent(redir+uid)+'&'+consentString;}else if(bidder=='yieldmo'){uid='$UID';uri='https://ads.yieldmo.com/pbsync?&redirectUri='+encodeURIComponent(redir+uid)+'&'+consentString;}else if(bidder=='gumgum'){iframe_id='gg-usync-iframe';let siteId=ProperMedia.utils.deepAccess(properOps,'bidders.s2s.'+bidder+'_s2s.site_id')||'';if(siteId&&!document.getElementById(iframe_id)){iframe_url='https://rtb.gumgum.com/getuid/'+siteId+'?r='+encodeURIComponent(redir+uid)+'&'+consentString;}}else if(bidder=='mediagrid'){uid='${BSW_UUID}';uri='https://x.bidswitch.net/check_uuid/'+encodeURIComponent(redir+uid)+'?'+consentString;}else if(bidder=='verizon_media'||bidder=='yahoo'||bidder=='yahoo_instream'||bidder=='yahoo_outstream'){uri='https://ups.analytics.yahoo.com/ups/58355/sync?redir=true';let qs={};if(gppConsent.gppString){qs.gpp=gppConsent.gppString;}
if(gppConsent.applicableSections){qs.gpp_sid=gppConsent.applicableSections;}
if(Object.keys(qs).length){uri+='&'+ProperMedia.utils.formatQueryString(qs);}
onload=function(){this.received++;}.bind(this);}else if(bidder=='aol_instream'||bidder=='aol_outstream'){uri='https://pixel.advertising.com/ups/58316/sync?redir=true&'+consentString;}else if(bidder=='xandr'||bidder=='xandr_native'||bidder=='xandr_instream'||bidder=='xandr_outstream'){uid='$UID';uri='https://ib.adnxs.com/getuid?'+encodeURIComponent(redir+uid);}else if(bidder=='engagebdr'||bidder=='engagebdr_instream'||bidder=='engagebdr_outstream'){uid='[UUID]';var sspid=1000227;if(ProperMedia.utils.deepAccess(properOps,'bidders.s2s.'+bidder+'_s2s.account_overrides.enabled')){sspid=ProperMedia.utils.deepAccess(properOps,'bidders.s2s.'+bidder+'_s2s.account_overrides.bidder_ids.sspid')||sspid;}
uri='https://match.bnmla.com/usersync?sspid='+sspid+'&redir='+encodeURIComponent(redir+uid);}else if(bidder=='magnite'||bidder=='magnite_instream'||bidder=='magnite_outstream'){iframe_id='multisync-iframe';if(!document.getElementById(iframe_id)){var account_id=8777;if(ProperMedia.utils.deepAccess(properOps,'bidders.s2s.'+bidder+'_s2s.account_overrides.enabled')){account_id=ProperMedia.utils.deepAccess(properOps,'bidders.s2s.'+bidder+'_s2s.account_overrides.bidder_ids.account_id')||account_id;}
iframe_url='https://secure-assets.rubiconproject.com/utils/xapi/multi-sync.html?p='+account_id+'&endpoint=us-west';}}
if(uri!=''){obj.sent++;$.ajax({url:uri,bidder:bidder,requestType:'jsonp',onload:onload,});}else if(iframe_url&&iframe_id){obj.sent++;var iframe=document.createElement('iframe');iframe.id=iframe_id;iframe.width=0;iframe.height=0;iframe.marginWidth=0;iframe.marginHeight=0;iframe.scrolling='no';iframe.frameBorder=0;iframe.style.border='0px';iframe.style.display='none';iframe.src=iframe_url;document.body.appendChild(iframe);}};this.logMatchingResponse=function(bidder,proper_uid,bidder_uid){this.updateBidderUserSyncData(bidder,bidder_uid);this.received++;if(bidder=='sonobi'){$(function(){try{var script=document.createElement('script');script.src='//sync.go.sonobi.com/uc.js?pubid='+(proper_uid||this.proper_uid);script.async=true;script.type='text/javascript';var scpt=document.getElementsByTagName('script')[0];scpt.parentNode.insertBefore(script,scpt);}catch(e){console.log(e);sendError(TraceKit.computeStackTrace(e));}});}
if(this.received>=this.sent){this.matchingDone();}};this.getBidderUserSyncValue=function(bidder){var storageEnfObj={bidderCode:bidder};bidder=bidder.replace('_s2s','');if(properStorage.cookiesAreEnabled(storageEnfObj)){if(properStorage.getCookie(bidder+'_cookie',storageEnfObj)){this.bidderUserSyncValues[bidder]=properStorage.getCookie(bidder+'_cookie',storageEnfObj);}}
if(properStorage.hasLocalStorage(storageEnfObj)){if(this.bidderUserSyncValues[bidder]){properStorage.setDataInLocalStorage('ProperS2SUserSync.'+bidder,this.bidderUserSyncValues[bidder],storageEnfObj);properStorage.deleteCookie(bidder+'_cookie','Lax','',storageEnfObj);}else if(properStorage.getDataFromLocalStorage('ProperS2SUserSync.'+bidder,storageEnfObj)){this.bidderUserSyncValues[bidder]=properStorage.getDataFromLocalStorage('ProperS2SUserSync.'+bidder,storageEnfObj);}}};this.updateBidderUserSyncData=function(bidder,bidder_uid){if(bidder&&bidder_uid){var storageEnfObj={bidderCode:bidder.includes('_s2s')?bidder:bidder+'_s2s'};bidder=bidder.replace('_s2s','');var map_bidder=bidder.replace(/_instream|_outstream/,'');var bidders=this.cookie_map[map_bidder]?this.cookie_map[map_bidder]:[bidder];for(var i=0;i<bidders.length;i++){this.bidderUserSyncValues[bidders[i]]=bidder_uid;if(properStorage.hasLocalStorage(storageEnfObj)){properStorage.setDataInLocalStorage('ProperS2SUserSync.'+bidders[i],bidder_uid,storageEnfObj);}else if(properStorage.cookiesAreEnabled(storageEnfObj)){var date=new Date();date.setTime(date.getTime()+60*24*60*60*1000);var key=bidders[i]+'_cookie',value=bidder_uid,expires=date.toGMTString(),sameSite='Lax';properStorage.setCookie(key,value,expires,sameSite,'',{bidderCode:bidder});}}}};this.matchingDone=function(){if(this.done_matching==1)return;this.done_matching=1;if(ProperMedia.utils.isFn(this.callback)){this.callback();this.callback=null;}
properLog.mylog('S2S Cookie Matching Done');this.resetTimeout();};this.addTimeout=function(){var obj=this;this.timeout_handle=properSetTimeout.setTimeout.call(obj,function(){obj.resetTimeout();obj.matchingDone();},obj.timeout);};this.resetTimeout=function(){clearTimeout(this.timeout_handle);this.timeout_handle=null;};};var sessionObj=function(){this.sessionData={uuid:'',depth:0,referrer:'',gclid:'',fbclid:'',utm_campaign:'',utm_source:'',utm_medium:'',utm_term:'',utm_content:'',utm_template:'',utm_referrer:'',utm_adset:'',utm_subid:'',revenue:0,bid_avg:{},no_bid_cnt:{},auction_count:0,last_threshold:0,};this.sessionCookieNameOld='properSessionData';this.sessionCookieNameNew='properSessionStorage';this.coreStorageObj={moduleType:'core',moduleName:'sessionData'};this.init=function(){this.getSessionData();if(ProperMedia.utils.deepAccess(this,'sessionData.depth')&&ProperMedia.utils.isNumber(parseInt(this.sessionData['depth']))){this.sessionData['depth']=parseInt(this.sessionData['depth'])+1;}else this.sessionData['depth']=1;this.initBidAvg();var utm_variables=['utm_medium','utm_source','utm_campaign','utm_term','utm_content','utm_template','utm_referrer','utm_adset','utm_subid','gclid','fbclid',];var check_utm_vars=utm_variables.some(function(variable){return typeof properPage.get_vars[variable]!=='undefined';},this);if(properPage.referrer!==''&&!ProperMedia.utils.matchDomain(properPage.domain,properPage.referrer)){if(this.checkForChange('referrer',properPage.referrer)){check_utm_vars=true;}}
if(check_utm_vars){utm_variables.forEach(function(variable){this.checkForChange(variable,properPage.get_vars[variable]||'');},this);}
if(typeof this.sessionData.uuid=='undefined'||this.sessionData.uuid==''){this.sessionData.uuid=ProperMedia.utils.generateUUID();this.sessionData.referrer=properPage.referrer;this.sessionData.last_threshold=0;}
audiencePixels.controller.newPageview();var initial_session_rps=parseFloat(properPage.get_vars['proper_rps']??0);if(initial_session_rps>0){this.sessionData.last_threshold=initial_session_rps-0.01;this.sessionData.revenue=0.001;}
this.setSessionRevenue(initial_session_rps*1000);window.proper_ad_session_uuid=this.sessionData.uuid;this.setSessionData();};this.checkForChange=function(variable,value){if(this.sessionData[variable]!==value){this.sessionData[variable]=value;this.sessionData.uuid='';this.sessionData.depth=1;return true;}
return false;};this.getSessionData=function(){var cookie_string_value=properStorage.getCookie(this.sessionCookieNameNew,this.coreStorageObj)||properStorage.getCookie(this.sessionCookieNameOld,this.coreStorageObj);if(cookie_string_value&&ProperMedia.utils.isStr(cookie_string_value)){if(ProperMedia.utils.isBase64(cookie_string_value)){cookie_string_value=ProperMedia.utils.b64DecodeUnicode(cookie_string_value);}else{cookie_string_value=decodeURIComponent(cookie_string_value);}
var cookieSessionData=ProperMedia.utils.safeJsonParse(cookie_string_value)||{};ProperMedia.utils.mergeObject(this.sessionData,cookieSessionData);}
if(properPage.domain!==properPage.root_domain){this.deleteSessionData(this.sessionCookieNameOld,'.'+properPage.domain);}};this.setSessionData=function(){try{var date_30_min=new Date();date_30_min.setTime(date_30_min.getTime()+30*60*1000);var date_midnight=new Date();date_midnight.setHours(23,59,59,0);var date=Date.parse(date_30_min)<Date.parse(date_midnight)?date_30_min.toGMTString():date_midnight.toGMTString();properStorage.setCookie(this.sessionCookieNameNew,ProperMedia.utils.b64EncodeUnicode(JSON.stringify(this.sessionData)),date,'Lax','.'+properPage.root_domain,this.coreStorageObj);}catch(e){}};this.deleteSessionData=function(cookieName,domain){properStorage.deleteCookie(cookieName,'Lax',domain,this.coreStorageObj);};this.setSessionRevenue=function(price){this.sessionData.revenue+=parseFloat(_0x3aa07a(price))/1000||0;properLog.mylog('Session revenue: '+this.sessionData.revenue);this.setSessionData();audiencePixels.controller.checkThresholds();window.proper_rps=this.sessionData.revenue;};this.updateSessionAuctionCount=function(){this.sessionData.auction_count+=1;properLog.mylog('Session Auction Count: '+this.sessionData.auction_count);this.setSessionData();};this.initBidAvg=function(){let device=properDevice.isMobile()?'mobile':'desktop';if((properSpecialOps.dynamicFloors||ProperMedia.utils.deepAccess(properOps,'dynamic_floors.enabled'))&&this.sessionData.depth==1&&ProperMedia.utils.isPlainObject(properSpecialOps.initDynamicFloorPrices)&&Object.keys(properSpecialOps.initDynamicFloorPrices).length){this.sessionData.bid_avg=ProperMedia.utils.deepAccess(properSpecialOps,'initDynamicFloorPrices')||{};let dynamic_floor_modifier=1;let init_min=Math.round((ProperMedia.utils.deepAccess(properOps,'dynamic_floors.init_mult_min')||0.5)*100)/100;let init_max=Math.round((ProperMedia.utils.deepAccess(properOps,'dynamic_floors.init_mult_max')||0.5)*100)/100;if(properSpecialOps.dynamicFloorsInitModifier){dynamic_floor_modifier=properSpecialOps.dynamicFloorsInitModifier;}else if(ProperMedia.utils.isNumber(init_min)&&ProperMedia.utils.isNumber(init_max)&&init_min>0&&init_max>0){if(init_min==init_max){dynamic_floor_modifier=init_max;}else if(init_min<init_max){dynamic_floor_modifier=Math.random()*(init_max-init_min)+init_min;}}
let init_floor_max=ProperMedia.utils.deepAccess(properSpecialOps,'initDynamicFloorInitMax')||ProperMedia.utils.deepAccess(properOps,'dynamic_floors.'+device+'.init_floor_max')||1.25;Object.keys(this.sessionData.bid_avg).forEach(function(size){let init_size_floor_max=ProperMedia.utils.deepAccess(properSpecialOps,'initDynamicFloorSizeInitMax.'+size)||ProperMedia.utils.deepAccess(properOps,'dynamic_floors.'+device+'.init_size_floor_max.'+size)||init_floor_max;this.sessionData.bid_avg[size]=ProperMedia.utils.round(Math.min(this.sessionData.bid_avg[size]*dynamic_floor_modifier,init_size_floor_max),2);},this);}};};var userSyncs=(function(){var started=false;var demandTypeDisplay=true;var demandTypeVideo=true;var interval=null;var container=null;var pending=[];function id(prefix){return(prefix||'')+Math.random().toString(16).substr(2);}
var insert={'iframe':function(sync){var ifr=document.createElement('iframe');ifr.id=id('i-');ifr.frameborder='0';ifr.allowtransparency='true';ifr.marginheight='0';ifr.marginwidth='0';ifr.width='0';ifr.hspace='0';ifr.vspace='0';ifr.height='0';ifr.scrolling='no';ifr.style.display='none';ifr.style.width='0';ifr.style.height='0';ifr.sandbox='allow-scripts allow-same-origin';ifr.src=sync.url;ifr.onload=function(){if(sync.payload){properStorage.setDataInLocalStorage('ProperEbUserSync.'+sync.bidder,Date.now(),{'bidderCode':sync.bidder});}else{properStorage.setDataInLocalStorage('ProperUserSync.'+sync.bidder,Date.now(),{'bidderCode':sync.bidder});}}
container.appendChild(ifr);if(sync.payload){ifr.contentWindow.document.open();ifr.contentWindow.document.write(sync.payload);ifr.contentWindow.document.close();}},'image':function(sync){var img=new Image();img.src=sync.url;img.onload=function(){properStorage.setDataInLocalStorage('ProperUserSync.'+sync.bidder,Date.now(),{'bidderCode':sync.bidder});}}};function process(){ebData={'usersyncs':[],'cookies':{}}
pending.splice(0,5).forEach(function(sync){var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+sync.bidder+'.edge')||false;if(edge){ebData.usersyncs.push(sync);var cookie=cookieMatching.getBidderUserSyncValue(sync.bidder+'_eb');if(cookie){ebData.cookies[bidder]=cookie;}}else{insert[sync.type](sync);}});if(ebData.usersyncs.length){$.ajax({"url":properOps.usync_hb_endpoint,"method":"POST","requestType":"cors","data":JSON.stringify(ebData),success:function(resp){response=ProperMedia.utils.safeJsonParse(resp);if(response&&response.syncs&&response.syncs.length>0){for(var i=0;i<response.syncs.length;i++){var sync=response.syncs[i];if(sync.bidder&&sync.type&&sync.payload){if(sync.type=='iframe'){sync.url="javascript:\"<html><body style='background:transparent'></body></html>\"";insert[sync.type](sync);}else{properStorage.setDataInLocalStorage('ProperEbUserSync.'+sync.bidder,Date.now(),{'bidderCode':sync.bidder});}}}}
if(response.cookies){Object.keys(response.cookies).map(function(bidder){if(response.cookies[bidder]){cookieMatching.updateBidderUserSyncData(bidder,response.cookies[bidder]);}});}},error:function(e){}});}
if(pending.length===0){clearInterval(interval);interval=null;}}
function resume(){if(!started)return;if(pending.length===0)return;if(interval!==null)return;interval=setInterval(process,1500);process();}
function shouldSyncBidder(bidder){if(gppConsentModule.userSyncsDenied()||!gdprEnforcement.userSyncEnforcement(bidder)){return false;}
if(!ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.enabled')){return false;}
if(!properStorage.hasLocalStorage({'bidderCode':bidder})){return true;}
var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;var localStorageUserSync=edge?properStorage.getDataFromLocalStorage('ProperEbUserSync.'+bidder,{'bidderCode':bidder}):properStorage.getDataFromLocalStorage('ProperUserSync.'+bidder,{'bidderCode':bidder});if(!localStorageUserSync||((Date.now()-parseInt(localStorageUserSync))>2592000000)){return true;}
return false;}
return{add:function(syncs){consentManager.ready(function(){var sync_data=ProperMedia.utils.isArray(syncs)?syncs[0]:syncs;var syncDemandType=ProperMedia.utils.deepAccess(sync_data,'demand_type');var bidder=ProperMedia.utils.deepAccess(sync_data,'bidder');if(((syncDemandType=='video'&&demandTypeVideo)||((syncDemandType=='display'||!syncDemandType)&&demandTypeDisplay))&&shouldSyncBidder(bidder)){pending=pending.concat(syncs);resume();}});return true;},start:function(){if(!started){started=true;container=document.createElement('div');container.id=id('us-');container.style.display='none';container.style.width='0';container.style.height='0';document.body.appendChild(container);}
resume();}};})();var debugConsole=function(){this.enabled=false;this.resize_elem=null;this.breadcrumb_elem=null;this.debug_cont_elem=null;this.debug_console_elem=null;this.view_refresh_timer=null;this.slot_refresh_interval=null;this.debug_style_elem=null;this.createDebugConsole=function(type){this.enabled=true;if(!this.debug_console_elem){this.debug_console_elem=document.createElement('div');this.debug_console_elem.id='proper-debug-console';document.body.appendChild(this.debug_console_elem);}
if(!this.resize_elem){this.resize_elem=document.createElement('div');this.resize_elem.innerHTML='&#8942;';this.resize_elem.id='proper-debug-console-resizer';this.debug_console_elem.appendChild(this.resize_elem);}
if(!this.breadcrumb_elem){this.breadcrumb_elem=document.createElement('div');this.breadcrumb_elem.id='proper-debug-console-breadcrumb';this.debug_console_elem.appendChild(this.breadcrumb_elem);}
if(!this.debug_cont_elem){this.debug_cont_elem=document.createElement('div');this.debug_cont_elem.id='proper-debug-console-cont';this.debug_console_elem.appendChild(this.debug_cont_elem);}
this.addCssStyle();if(this.resize_elem&&this.breadcrumb_elem)this.setDragAndResizeActions();this.addSlotOverlays();this.createOverview();};this.addCssStyle=function(){if(!this.debug_style_elem){this.debug_style_elem=document.createElement('style');this.debug_style_elem.id='proper-debug-styling';this.debug_style_elem.innerHTML=this.debug_console_css;document.body.appendChild(this.debug_style_elem);}};this.createDebugOverlays=function(){this.addCssStyle();this.addSlotOverlays();this.refreshViewInterval();};this.addSlotOverlays=function(){Object.keys(properPage.slots).forEach(function(slot_type){Object.keys(properPage.slots[slot_type]).forEach(function(slot_name){var slot=properPage.slots[slot_type][slot_name];this.addSlotOverlay(slot);},this);},this);};this.addSlotOverlay=function(slot){if(slot instanceof slotObj){var elem=slot.getElement();if(elem){var overlay_id='proper_debug_overlay_'+slot.name;var overlay=document.getElementById(overlay_id);var parent=document.getElementById(slot.div_id);if(parent&&overlay)overlay.parentNode.removeChild(overlay);var overlay_elem=document.createElement('div');overlay_elem.id=overlay_id;overlay_elem.classList.add('proper-debug-overlay');var slot_overlay=document.createElement('div');slot_overlay.classList.add('proper-debug-overlay-background');var slot_overlay_html=document.createElement('div');slot_overlay_html.classList.add('proper-debug-overlay-text');slot_overlay_html.innerHTML=[slot.name,'Size: '+slot.displayed_ad.size,'Bidder: '+slot.displayed_ad.bidder,'CPM: '+slot.displayed_ad.price,].join('<br>');$(slot_overlay).on('click',function(){this.toggleMobileSticky(true);this.createSlotView(slot);}.bind(this));overlay_elem.append(slot_overlay_html);overlay_elem.append(slot_overlay);parent.appendChild(overlay_elem);}}else{return false;}
return true;};this.toggleMobileSticky=function(force_off){var method=force_off?'remove':'toggle';document.body.classList[method]('proper-debug-pinned');var element=document.getElementById('proper-debug-console');element.classList[method]('pinned');};this.destroyDebugConsole=function(){this.enabled=false;if(this.debug_console_elem){this.debug_console_elem.parentNode.removeChild(this.debug_console_elem);}
if(this.debug_style_elem){this.debug_style_elem.parentNode.removeChild(this.debug_style_elem);}
if(this.view_refresh_timer){clearTimeout(this.view_refresh_timer);}
this.view_refresh_timer=null;this.debug_console_elem=null;this.breadcrumb_elem=null;this.debug_cont_elem=null;this.debug_style_elem=null;this.resize_elem=null;Object.keys(properPage.slots).forEach(function(slot_type){Object.keys(properPage.slots[slot_type]).forEach(function(slot_name){var slot=properPage.slots[slot_type][slot_name];this.removeSlotOverlay(slot);},this);},this);};this.removeSlotOverlay=function(slot){if(slot instanceof slotObj){var elem=slot.getElement();if(elem){var overlay_elem=$(elem).parent().find('.proper-debug-overlay').remove();}}else{return false;}
return true;};this.refreshViewInterval=function(){clearTimeout(this.slot_refresh_interval);this.slot_refresh_interval=properSetInterval.setInterval.call(this,this.loadViewCallback,1500);};this.refreshViewTimer=function(view,obj){clearTimeout(this.view_refresh_timer);this.view_refresh_timer=properSetTimeout.setTimeout.call(this,this.loadViewCallback,1500,view,obj);};this.loadViewCallback=function(view,obj){this.addSlotOverlays();if(view=='overview'){this.createOverview();}else if(view=='page'){this.createPageView(obj);}else if(view=='slot'){this.createSlotView(obj);}else if(view=='ad_pool'){this.createAdPoolView(obj);}else if(view=='auction'){this.createAuctionView(obj);}};this.createBreadcrumb=function(crumbtrail){this.breadcrumb_elem.innerHTML='';var pin_btn=document.createElement('span');$(pin_btn).addClass('proper-debug-mobile-pin-btn');pin_btn.innerHTML='&#8595;';$(pin_btn).on('click',function(){this.toggleMobileSticky();}.bind(this));this.breadcrumb_elem.appendChild(pin_btn);Object.keys(crumbtrail).forEach(function(i){var crumb=crumbtrail[i];var span=document.createElement('div');$(span).addClass('proper-debug-breadcrumb');span.innerHTML=crumb['text'];$(span).on('click',function(){this.loadViewCallback(crumb['text'].replaceAll(' ','_'),crumb['obj']);}.bind(this));this.breadcrumb_elem.appendChild(span);if(i<crumbtrail.length-1){var spacer=document.createElement('div');$(spacer).addClass('proper-debug-breadcrumb-spacer');this.breadcrumb_elem.appendChild(spacer);}else if(i==crumbtrail.length-1){this.refreshViewTimer(crumb['text'],crumb['obj']);}},this);var close_btn=document.createElement('span');$(close_btn).addClass('proper-debug-close-console-btn');close_btn.innerHTML='&times;';$(close_btn).on('click',function(){this.destroyDebugConsole();}.bind(this));this.breadcrumb_elem.appendChild(close_btn);};this.createTitleElement=function(title_html){var title_elem=document.createElement('div');$(title_elem).addClass('proper-debug-cont-title');title_elem.style.cssText='padding: 4px; margin: 4px; font-size: 1em; font-weight: 700; display: inline-block;';$(title_elem).html(title_html);this.debug_cont_elem.appendChild(title_elem);};this.createStateElements=function(states){var states_cont_elem=document.createElement('div');$(states_cont_elem).addClass('proper-debug-state-cont');this.debug_cont_elem.appendChild(states_cont_elem);Object.keys(states).forEach(function(state){var state_elem=document.createElement('div');$(state_elem).addClass('proper-debug-state-cell');if(!states[state])$(state_elem).addClass('proper-debug-state-cell red');$(state_elem).html(state);states_cont_elem.appendChild(state_elem);},this);};this.createOverview=function(){var cumbtrail=[{text:'overview',obj:{},},];this.createBreadcrumb(cumbtrail);this.debug_cont_elem.innerHTML='';this.createTitleElement('Sections');var sections_cont_elem=document.createElement('div');$(sections_cont_elem).addClass('proper-debug-sections-cont');this.debug_cont_elem.appendChild(sections_cont_elem);var page_elem=document.createElement('button');$(page_elem).addClass('proper-debug-page-cell');if(properPage instanceof pageObj==false)$(page_elem).addClass('proper-debug-page-cell red');$(page_elem).html('Page &amp; Slots');$(page_elem).on('click',function(){this.createPageView(properPage);}.bind(this));sections_cont_elem.appendChild(page_elem);var ad_pool_elem=document.createElement('button');$(ad_pool_elem).addClass('proper-debug-ad-pool-cell');if(properAdPool.ads.length==0&&properAdPool.amazon_ads.length==0)$(ad_pool_elem).addClass('proper-debug-ad-pool-cell red');$(ad_pool_elem).html('Ad Pool &amp; Auctions');$(ad_pool_elem).on('click',function(){this.createAdPoolView(properAdPool);}.bind(this));sections_cont_elem.appendChild(ad_pool_elem);this.createTitleElement('Device');var device_data=[{property:'OS',value:properDevice.os},{property:'OS Group',value:properDevice.os_group},{property:'Browser',value:properDevice.browser},{property:'Browser Group',value:properDevice.browser_group},{property:'Device Type',value:properDevice.device_type},{property:'User Agent',value:navigator.userAgent},];this.createTable('#proper-debug-console-cont',device_data,false);this.createTitleElement('Session Data');var session_data=[{property:'UUID',value:properSession.sessionData.uuid},{property:'Depth',value:properSession.sessionData.depth},{property:'Referrer',value:properSession.sessionData.referrer},{property:'UTM campaign',value:properSession.sessionData.utm_campaign},{property:'UTM source',value:properSession.sessionData.utm_source},{property:'UTM medium',value:properSession.sessionData.utm_medium},{property:'UTM term',value:properSession.sessionData.utm_term},{property:'UTM content',value:properSession.sessionData.utm_content},{property:'RPS',value:properSession.sessionData.revenue},];this.createTable('#proper-debug-console-cont',session_data,false);this.createTitleElement('Special Ops');var pre=document.createElement('pre');pre.innerHTML=JSON.stringify(properSpecialOps,undefined,2);this.debug_cont_elem.appendChild(pre);this.debug_cont_elem.appendChild(document.createElement('hr'));};this.createPageView=function(page){var cumbtrail=[{text:'overview',obj:{},},{text:'page',obj:page,},];this.createBreadcrumb(cumbtrail);this.debug_cont_elem.innerHTML='';this.createTitleElement('Slots');var slots_cont_elem=document.createElement('div');$(slots_cont_elem).addClass('proper-debug-page-slots-cont');this.debug_cont_elem.appendChild(slots_cont_elem);Object.keys(properPage.slots).forEach(function(slot_type){Object.keys(properPage.slots[slot_type]).forEach(function(slot_name){var slot=properPage.slots[slot_type][slot_name];var background_color=slot.getElement()?'#00800087':'#ff000070';var slot_elem=document.createElement('button');$(slot_elem).addClass('proper-debug-page-slot-cell');$(slot_elem).html(slot.name);$(slot_elem).on('click',function(){this.createSlotView(slot);}.bind(this));slots_cont_elem.appendChild(slot_elem);},this);},this);this.createTitleElement('States');var states={};if(page.isolated!==1&&properOps.dfp_per_slot==0){states['DFP Init']=properPage.dfp_init;if(typeof properPage.dfp_enabled_services!=='undefined'&&properPage.dfp_enabled_services==true){if(typeof googletag.pubads().isSRA=='function'&&googletag.pubads().isSRA()){states['DFP Single Request Enabled']=1;}}}
if(Object.keys(states).length>0){this.createStateElements(states);}
this.createTitleElement('Page Data');var page_data=[{property:'UUID',value:page.uuid},{property:'DFP ID',value:properOps.dfp_id},{property:'MCM Type',value:properOps.mcm_type},{property:'Url',value:page.url},{property:'Referrer',value:page.referrer},{property:'Protocol',value:page.protocol},{property:'Canonical url',value:page.canonical_url},{property:'Isolated',value:page.isolated},{property:'Width',value:page.width},{property:'Height',value:page.height},{property:'Post id',value:page.post_id},{property:'SPA enabled',value:page.spa_settings['enabled']},];if(page.spa_settings['enabled']==true){page_data=page_data.concat([{property:'SPA gallery id',value:page.spa_settings['gallery_id']},{property:'SPA gallery url',value:page.spa_settings['gallery_base_url']},{property:'SPA page number',value:page.spa_settings['page_number']},{property:'SPA prefetch enabled',value:page.spa_settings['prefetch']},]);}
this.createTable('#proper-debug-console-cont',page_data,false);this.createTitleElement('Page Meta');var page_meta=[];Object.keys(page.page_meta).forEach(function(key){page_meta.push({property:key.split('_').map(function(a){return a.charAt(0).toUpperCase()+a.slice(1);}).join(' '),value:typeof page.page_meta[key]=='object'?JSON.stringify(page.page_meta[key]):page.page_meta[key],});});this.createTable('#proper-debug-console-cont',page_meta,false);};this.createSlotView=function(slot){var cumbtrail=[{text:'overview',obj:{},},{text:'page',obj:properPage,},{text:'slot',obj:slot,},];this.createBreadcrumb(cumbtrail);this.debug_cont_elem.innerHTML='';this.createTitleElement('Slots');var slots_cont_elem=document.createElement('div');$(slots_cont_elem).addClass('proper-debug-page-slots-cont');this.debug_cont_elem.appendChild(slots_cont_elem);var current_slot_name=slot.name.toString();Object.keys(properPage.slots).forEach(function(slot_type){Object.keys(properPage.slots[slot_type]).forEach(function(slot_name){var slot=properPage.slots[slot_type][slot_name];var background_color=slot.getElement()?'#00800087':'#ff000070';var slot_elem=document.createElement('button');$(slot_elem).addClass('proper-debug-page-slot-cell');if(current_slot_name==slot_name){$(slot_elem).addClass('proper-debug-page-slot-cell active');}
$(slot_elem).html(slot.name);$(slot_elem).on('click',function(){this.createSlotView(slot);}.bind(this));slots_cont_elem.appendChild(slot_elem);},this);},this);this.createTitleElement('States');var states={'In DOM':slot.getElement()?1:0,};if(properPage.isolated==0){if(properOps.dfp_per_slot==1){states['Slot DFP Init']=slot.dfp_init;if(slot.dfp_enabled_services==true){if(typeof slot.googletag().pubads().isSRA=='function'&&slot.googletag().pubads().isSRA()){states['DFP Single Request']=1;}}}else{states['DFP Init']=properPage.dfp_init;if(properPage.dfp_enabled_services==true){if(typeof googletag.pubads().isSRA=='function'&&googletag.pubads().isSRA()){states['DFP Single Request Enabled']=1;}}}
states['Mapped DFP Sizes']=slot.mapped_dfp_sizes;states['DFP Ready']=slot.dfp_ready;states['DFP Sent']=slot.dfp_sent;if(slot.refresh.enabled&&slot.refresh.count>0){states['DFP Refreshed']=slot.dfp_refreshed;}}
states['Displayed']=slot.displayed;this.createStateElements(states);this.createTitleElement(slot.name);var eye_elem=document.createElement('div');$(eye_elem).addClass('proper-debug-scroll-slot-inview');eye_elem.style.cssText='display: inline-block; cursor: pointer;';$(eye_elem).html('&#128065;');$(eye_elem).on('click',function(){var elem=slot.getElement();elem.scrollIntoView();}.bind(this));this.debug_cont_elem.appendChild(eye_elem);const refresh_button=document.createElement('button');$(refresh_button).addClass('proper-debug-page-slot-cell');$(refresh_button).html('Refresh');$(refresh_button).on('click',function(){console.log('refreshing slot: '+slot.name);refreshAuctionAndSlotsByName([slot.name]);}.bind(this));this.debug_cont_elem.appendChild(refresh_button);var sizes_arr=slot.sizes||[];const flex_map=slot.flex_map;var time_inview=slot.viewability.viewable==false?slot.viewability.total_time_inview:slot.viewability.total_time_inview+slot.getTimeInview();var slot_data=[{property:'Type',value:slot.type},{property:'Size',value:slot.size},{property:'Sizes',value:sizes_arr.join(', ')},{property:'Default size',value:slot.default_size.join('x')},{property:'MCM Type',value:slot.mcm_type},{property:'DFP ID',value:slot.dfp_id},{property:'DFP AD Unit Path',value:slot.dfpAdUnitPath},{property:'Div ID',value:slot.div_id},{property:'Number',value:slot.number},{property:'Refresh',value:slot.refresh.enabled},{property:'Refresh cnt',value:slot.refresh.count},{property:'Refresh max',value:slot.refresh.max},{property:'Refresh interval',value:slot.refresh.current_interval},{property:'Refresh inview interval',value:slot.refresh.inview_interval},{property:'Viewable',value:slot.viewability.viewable},{property:'Time inview',value:time_inview},{property:'Slider',value:slot.slider},{property:'Sticky',value:slot.sticky},{property:'Flex',value:slot.flex_enabled},];if(slot.flex_enabled){slot_data=slot_data.concat([{property:'Flex Map',value:Object.entries(flex_map).map(([key,value])=>`${key}: ${value}`).join(', '),},]);}
if(slot.sticky==1){slot_data=slot_data.concat([{property:'Position',value:slot.sticky_settings.position},{property:'Brand',value:slot.sticky_settings.brand},{property:'Close btn',value:slot.sticky_settings.close_btn},{property:'Disable on close',value:slot.sticky_settings.disable_on_close},{property:'Freq cap enabled',value:slot.sticky_settings.freq_cap_enabled},{property:'Freq cap',value:slot.sticky_settings.freq_cap},]);}
slot_data=slot_data.concat([{property:'Lazyload enabled',value:slot.lazyload.enabled}]);if(slot.lazyload.enabled){slot_data=slot_data.concat([{property:'In fetch zone',value:slot.lazyload.inFetchZone},{property:'In render zone',value:slot.lazyload.inRenderZone},{property:'Fetch zone %',value:slot.lazyload.fetchMarginPercent+'%'},{property:'Render zone %',value:slot.lazyload.renderMarginPercent+'%'},]);}
slot_data=slot_data.concat([{property:'Auto delete enabled',value:slot.autoDelete.enabled}]);if(slot.autoDelete.enabled){slot_data=slot_data.concat([{property:'In delete zone',value:slot.autoDelete.inDeleteZone},{property:'Delete zone %',value:slot.autoDelete.autoDeleteMarginPercent+'%'},]);}
slot_data=slot_data.concat([{property:'Dynamic enabled',value:slot.dynamic.enabled}]);if(slot.dynamic.enabled){slot_data=slot_data.concat([{property:'CSS Placement',value:slot.dynamic.cssplacement},{property:'CSS Selector',value:slot.dynamic.cssselector},{property:'Instance number',value:slot.dynamic.instance_number},]);}
if(properPage.spa_settings['enabled']==true&&properPage.spa_settings['prefetch']==true){slot_data=slot_data.concat([{property:'Prefetch enabled',value:1}]);}
this.createTable('#proper-debug-console-cont',slot_data,false);if(slot.type=='video'&&slot.video_player instanceof videoPlayer){this.createTitleElement('Video Player');var video_player=ProperMedia.utils.deepAccess(slot,'video_player.player_settings')||{};var video_player_data=[{property:'ID',value:video_player.id},{property:'Div ID',value:video_player.div_id},{property:'DFP Ad Unit',value:video_player.dfp_ad_unit},{property:'Video ID',value:video_player.video_id},{property:'Video Type',value:video_player.video_type},{property:'Number of Ads',value:video_player.number_of_ads},{property:'Autoplay',value:video_player.autoplay},{property:'Backfill',value:video_player.backfill},{property:'Backfill ID',value:video_player.backfill_id},{property:'Small Player',value:video_player.small_player},{property:'Small Player Bottom',value:video_player.small_player_bottom},{property:'Ad Failure Limit',value:video_player.ad_failure_limit},{property:'Vast Timeout',value:video_player.vast_timeout},{property:'No Ads No Player',value:video_player.no_ads_no_player},];slot_data=slot_data.concat([{property:'Lazyload enabled',value:slot.lazyload.enabled}]);this.createTable('#proper-debug-console-cont',video_player_data,false);}
if(slot.displayed==1&&Object.keys(slot.displayed_ad).length>0){this.createTitleElement('Displayed Ad');var dfp_response_time=Math.max(0,ProperMedia.utils.getTimePassed(slot.tracking_times.dfp_sent_ts,slot.tracking_times.dfp_returned_ts));var displayed_ad_data=[{property:'Bidder',value:slot.displayed_ad.bidder},{property:'Media Type',value:slot.displayed_ad.type},{property:'Size',value:slot.displayed_ad.size},{property:'Gross',value:slot.displayed_ad.gross},{property:'Price',value:slot.displayed_ad.price},{property:'Floor price',value:slot.displayed_ad.floor},{property:'DFP price',value:slot.displayed_ad.dfp_price},{property:'Tag ID',value:slot.displayed_ad.tag_id||''},{property:'Campaign ID',value:slot.displayed_ad.cid},{property:'Creative ID',value:slot.displayed_ad.crid},{property:'Deal ID',value:slot.displayed_ad.dealid},{property:'Ad ID',value:slot.displayed_ad.adid},{property:'Ad Domain',value:JSON.stringify(slot.displayed_ad.adomain)},{property:'Categories',value:JSON.stringify(slot.displayed_ad.cat)},{property:'Attributes',value:JSON.stringify(slot.displayed_ad.attr)},{property:'Extensions',value:JSON.stringify(slot.displayed_ad.ext)},];if(ProperMedia.utils.deepAccess(properOps,'bidders.header.'+slot.displayed_ad.bidder)||ProperMedia.utils.deepAccess(properOps,'bidders.s2s.'+slot.displayed_ad.bidder)){displayed_ad_data=displayed_ad_data.concat([{property:'Header Response Time',value:slot.displayed_ad.response_ms+' ms'}]);}
displayed_ad_data=displayed_ad_data.concat([{property:'DFP Response Time',value:dfp_response_time+' ms'}]);this.createTable('#proper-debug-console-cont',displayed_ad_data,false);}
this.createTitleElement('Floors');var pre=document.createElement('pre');pre.innerHTML=JSON.stringify({floors:slot.floors},undefined,2);this.debug_cont_elem.appendChild(pre);};this.createAdPoolView=function(adPool){var cumbtrail=[{text:'overview',obj:{},},{text:'ad_pool',obj:adPool,},];this.createBreadcrumb(cumbtrail);this.debug_cont_elem.innerHTML='';this.createTitleElement('Auctions');var auction_cont_elem=document.createElement('div');$(auction_cont_elem).addClass('proper-debug-auction-cont');this.debug_cont_elem.appendChild(auction_cont_elem);Object.keys(adPool.finished_auctions).forEach(function(auction_index){var auction=adPool.finished_auctions[auction_index];var background_color=auction.bids_sent?'#00800087':'#ff000070';var auction_elem=document.createElement('button');$(auction_elem).addClass('proper-debug-auction-cell');$(auction_elem).html('Auction '+auction.auction_num);$(auction_elem).on('click',function(){this.createAuctionView(auction,adPool);}.bind(this));auction_cont_elem.appendChild(auction_elem);},this);Object.keys(adPool.auctions).forEach(function(auction_index){var auction=adPool.auctions[auction_index];var background_color=auction.bids_sent?'#00800087':'#ff000070';var auction_elem=document.createElement('button');$(auction_elem).addClass('proper-debug-auction-cell');$(auction_elem).html('Auction '+auction.auction_num);$(auction_elem).on('click',function(){this.createAuctionView(auction,adPool);}.bind(this));auction_cont_elem.appendChild(auction_elem);},this);this.debug_cont_elem.appendChild(document.createElement('hr'));this.createTitleElement('Bidders');var bidders_cont_elem=document.createElement('div');$(bidders_cont_elem).addClass('proper-debug-bidders-cont');this.debug_cont_elem.appendChild(bidders_cont_elem);Object.keys(properOps.bidders).forEach(function(bidder_type){Object.keys(properOps.bidders[bidder_type]).forEach(function(bidder_name){var bidder=properOps.bidders[bidder_type][bidder_name];var bidder_elem=document.createElement('div');$(bidder_elem).addClass('proper-debug-bidder-cell');if(!bidder.enabled)$(bidder_elem).addClass('red');$(bidder_elem).html(bidder_name);bidders_cont_elem.appendChild(bidder_elem);},this);},this);this.debug_cont_elem.appendChild(document.createElement('hr'));this.createTitleElement('Bids ('+adPool.ads.length+')');var ad_pool_ad_data=[];for(let i=0;i<adPool.ads.length;i++){let ad=adPool.ads[i];ad_pool_ad_data.push({bidder:ad.bidder,type:ad.type,size:ad.size,gross:ad.gross,price:ad.price,floor:ad.floor,dfp_price:ad.dfp_price,tag_id:ad.tag_id,target_slot:ad.target_slot,response_ms:ad.response_ms,ttl:ad.ttl,dealid:ad.dealid,crid:ad.crid,});}
this.createTable('#proper-debug-console-cont',ad_pool_ad_data,true);this.createTitleElement('Amazon Bids ('+adPool.amazon_ads.length+')');ad_pool_ad_data=[];for(let i=0;i<adPool.amazon_ads.length;i++){let ad=adPool.amazon_ads[i];ad_pool_ad_data.push({bidder:ad.bidder,type:ad.type,size:ad.size,gross:ad.gross,price:ad.price,floor:ad.floor,dfp_price:ad.dfp_price,tag_id:ad.tag_id,target_slot:ad.target_slot,response_ms:ad.response_ms,ttl:ad.ttl,dealid:ad.dealid,crid:ad.crid,});}
this.createTable('#proper-debug-console-cont',ad_pool_ad_data,true);this.createTitleElement('Displayed Bids');ad_pool_ad_data=[];for(var i=0;i<adPool.displayed_ads.length;i++){var ad=adPool.displayed_ads[i];ad_pool_ad_data.push({bidder:ad.bidder,type:ad.type,size:ad.size,gross:ad.gross,price:ad.price,floor:ad.floor,dfp_price:ad.dfp_price,tag_id:ad.tag_id,response_ms:ad.response_ms,ttl:ad.ttl,dealid:ad.dealid,crid:ad.crid,target_slot:ad.target_slot,});}
this.createTable('#proper-debug-console-cont',ad_pool_ad_data,true);var auction_meta_elem=document.createElement('div');$(auction_meta_elem).addClass('proper-debug-auction-meta');var pre_floor=document.createElement('pre');pre_floor.innerHTML=JSON.stringify({'dynamic floors':properSession.sessionData.bid_avg},undefined,2);auction_meta_elem.appendChild(pre_floor);var pre_no_bids=document.createElement('pre');pre_no_bids.innerHTML=JSON.stringify({no_bid_cnt:properSession.sessionData.no_bid_cnt},undefined,2);auction_meta_elem.appendChild(pre_no_bids);this.debug_cont_elem.appendChild(auction_meta_elem);};this.createAuctionView=function(auction){var cumbtrail=[{text:'overview',obj:{},},{text:'ad_pool',obj:properAdPool,},{text:'auction',obj:auction,},];this.createBreadcrumb(cumbtrail);this.debug_cont_elem.innerHTML='';this.createTitleElement('Auction Data');var auction_data=[{property:'Network Requests',value:auction.requests_sent},{property:'Bids returned / sent',value:auction.bids_returned+' / '+auction.bids_sent},{property:'Bids sent',value:auction.bids_started_ts?1:0},{property:'Bids ready',value:auction.bids_done_ts?1:0},{property:'Auction ms',value:auction.calcAuctionMs()},{property:'Max timeout',value:auction.max_timeout},];this.createTable('#proper-debug-console-cont',auction_data,false);this.createTitleElement('Bids');var bid_data=[];if(Object.keys(auction.bids).length>0){Object.keys(auction.bids).forEach(function(bidder){var bidder_bids=auction.bids[bidder];if(bidder_bids.responses.length>0){for(var i=0;i<bidder_bids.responses.length;i++){var ad=bidder_bids.responses[i];bid_data.push({bidder:ad.bidder,displayed:ad.displayed,type:ad.type,size:ad.size,gross:ad.gross,price:ad.price,floor:ad.floor,dfp_price:ad.dfp_price,tag_id:ad.tag_id,target_slot:ad.target_slot,'response ms':ad.response_ms,ttl:ad.ttl,});}}});}
this.createTable('#proper-debug-console-cont',bid_data,true);this.createTitleElement('No Bid Responses');bid_data=[];if(Object.keys(auction.bids).length>0){Object.keys(auction.bids).forEach(function(bidder){var bidder_bids=auction.bids[bidder];if(bidder_bids.responses_no_bid.length>0){for(var i=0;i<bidder_bids.responses_no_bid.length;i++){var bid=bidder_bids.responses_no_bid[i];bid_data.push({bidder:bid.bidder,type:bid.type,tag_id:bid.tag_id,'response ms':bid.response_ms,});}}});}
this.createTable('#proper-debug-console-cont',bid_data,true);this.createTitleElement('Errored Bid Requests');bid_data=[];if(Object.keys(auction.bids).length>0){Object.keys(auction.bids).forEach(function(bidder){var bidder_bids=auction.bids[bidder];if(bidder_bids.response_errors.length>0){for(var i=0;i<bidder_bids.response_errors.length;i++){var bid=bidder_bids.response_errors[i];bid_data.push({bidder:bid.bidder,status:bid.status,statusText:bid.statusText,responseMs:bid.response_ms,timeoutMs:bid.timeout,});}}});}
this.createTable('#proper-debug-console-cont',bid_data,true);};this.createTable=function(selector,data,show_headers){buildHtmlTable();var table;function buildHtmlTable(){table=document.createElement('table');$(table).addClass('proper-debug-table');table.style.cssText='margin: 5px;';$(selector).append(table);var columns=addAllColumnHeaders();for(var i=0;i<data.length;i++){var row=document.createElement('tr');for(var colIndex=0;colIndex<columns.length;colIndex++){var cellValue=data[i][columns[colIndex]];if(cellValue==null){cellValue='';}
var td=document.createElement('td');td.style.cssText='padding: 5px;';td.innerHTML=cellValue;$(row).append(td);}
$(table).append(row);}}
function addAllColumnHeaders(){var columnSet=[];var headerTr=document.createElement('tr');for(var i=0;i<data.length;i++){var rowHash=data[i];for(var key in rowHash){if(columnSet.includes(key)==false){columnSet.push(key);var th=document.createElement('th');th.innerHTML=key;$(headerTr).append(th);}}}
if(show_headers==true){$(table).append(headerTr);}
return columnSet;}};this.setDragAndResizeActions=function(){var minimum_size=20;var original_height=0;var original_width=0;var original_y=0;var original_mouse_y=0;var original_x=0;var original_mouse_x=0;var element=this.debug_console_elem;var currentResizer=this.resize_elem;var currentDragBar=this.breadcrumb_elem;currentResizer.addEventListener('mousedown',function(e){e.preventDefault();original_height=parseFloat(getComputedStyle(element,null).getPropertyValue('height').replace('px',''));original_width=parseFloat(getComputedStyle(element,null).getPropertyValue('width').replace('px',''));original_y=element.getBoundingClientRect().top;original_mouse_y=e.pageY;original_x=element.getBoundingClientRect().left;original_mouse_x=e.pageX;window.addEventListener('mousemove',resize);window.addEventListener('mouseup',stopResize);});currentDragBar.addEventListener('mousedown',function(e){e.preventDefault();original_y=element.getBoundingClientRect().top;original_mouse_y=e.pageY;original_x=element.getBoundingClientRect().left;original_mouse_x=e.pageX;window.addEventListener('mousemove',dragTo);window.addEventListener('mouseup',stopDrag);});function resize(e){var height=original_height+(e.pageY-original_mouse_y);var width=original_width+(e.pageX-original_mouse_x);if(height>minimum_size){element.style.height=height+'px';}
if(width>minimum_size){element.style.width=width+'px';}}
function dragTo(e){element.style.top=original_y+(e.pageY-original_mouse_y)+'px';element.style.left=original_x+(e.pageX-original_mouse_x)+'px';}
function stopResize(){window.removeEventListener('mousemove',resize);}
function stopDrag(){window.removeEventListener('mousemove',dragTo);}};this.css_values={fontMedium:'12px',fontLarge:'16px',maxZ:2147483647,purple:'#2C3050',purpleLight:'#555F9E',purpleDark:'#1A1D3E',green:'#44B558',greenLight:'#57EB73',greenDark:'#008C2B',grayLight:'#f6f8fa',grayDark:'#3b565d',};this.debug_console_css='\
		@keyframes console-tween-in {\
			from {left: -500px}\
			to {left: 15px}\
		}\
		#proper-debug-console {\
			background: '+
this.css_values.grayLight+
';\
			z-index: '+
this.css_values.maxZ+
';\
			position: fixed;\
			top: 15px;\
			left: 15px;\
			width: calc(100% - 30px);\
			overflow: auto;\
			height: 500px;\
			width: 600px;\
			border-radius: 5px;\
			color:'+
this.css_values.grayDark+
';\
			font-size:12px !important;\
			max-width: calc(100vw - 30px);\
			box-shadow: 0 0 0 7px rgba(255,255,255,0.7), 0 10px 10px 0 rgba(0,0,0,0.65), inset 0 -4px 0 0 white;\
			animation: console-tween-in 500ms ease-out;\
		}#proper-debug-console, #proper-debug-console * {\
			 font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif !important;\
		}\
		#proper-debug-console.short {\
			height:250px;\
		}#proper-debug-console-cont {\
			padding: 8px 8px;\
		}\
		#proper-debug-console-resizer {\
			width: 12px;\
			height: 20px;\
			position: sticky;\
			z-index: 9999999;\
			background: white;\
			color: gray;\
			font-size:16px;\
			display:flex;\
			align-items:center;\
			justify-content:center;\
			cursor: nwse-resize;\
			top:calc(100% - 20px);\
			left:calc(100% - 12px);\
			margin-bottom: -20px;\
		}\
		#proper-debug-console-breadcrumb {\
			font-weight: bold;\
			border-radius: 6px 6px 0 0;\
			padding-left: 11px;\
			background: '+
this.css_values.purple+
';\
			position: sticky;\
			top:0;\
			z-index: 999;\
			cursor: move;\
			box-shadow:inset 0 0 0 4px '+
this.css_values.grayLight+
";\
			display:flex;\
			height:50px;\
		}.proper-debug-breadcrumb {\
			margin: 0px 3px;\
			cursor: pointer;\
			display:block;\
			color:white;\
		}.proper-debug-breadcrumb:not(:last-of-type){\
			opacity:0.7;\
		}\
		#proper-debug-console-breadcrumb > * {\
			display:flex;\
			align-items:center;\
			text-transform: capitalize;\
		}.proper-debug-breadcrumb-spacer {\
			margin-right:3px;\
		}.proper-debug-breadcrumb-spacer:after {\
			content:'';\
			width: 4px;\
			height:4px;\
			border-top: solid 1px white;\
			border-right: solid 1px white;\
			transform: rotate(45deg);\
			opacity:0.7;\
		}\
		.proper-debug-close-console-btn {\
			padding: 4px;\
			margin: 0 12px 0 auto;\
			cursor: pointer;\
			display: inline-block;\
			float: right;\
			font-size:21px;\
			font-family:'Futura', sans-serif !important;\
			font-weight:normal;\
			color: white;\
		}\
		#proper-debug-console-cont {\
			display:flex;\
			flex-direction:column;\
		}#proper-debug-console-cont > * {\
			flex: 1 1 100%;\
			margin:6px 0 0 0 !important;\
			padding:0;\
		}\
		.proper-debug-auction-meta pre {\
			width: 50%;\
			float: left;\
		}\
		.proper-debug-overlay-text {\
			text-align: left;\
			z-index: "+
(this.css_values.maxZ-1)+
';\
			padding: 4px 8px 8px 8px;\
			position: absolute;\
			top: 0px;\
			left: 0px;\
			opacity: .90;\
			background: '+
this.css_values.greenLight+
';\
			font-size: '+
this.css_values.fontMedium+
';\
			line-height: 1.3em;\
			color: black;\
		}\
		.'+
properOps.slot_wrapper_class+
'.ad-sticky.sticky-btm .proper-debug-overlay-text{\
			top:auto;\
			bottom:0;\
		}\
		.proper-debug-overlay-background {\
			cursor: pointer;\
			box-shadow: 0 0 0 4px '+
this.css_values.greenLight+
';\
			z-index: '+
(this.css_values.maxZ-2)+
';\
			position: absolute;\
			top: 0px;\
			bottom: 0px;\
			left: 0px;\
			right: 0px;\
			max-width: calc(100vw - 8px);\
			margin:0 auto;\
		}\
		.proper-debug-page-slot-cell {\
			border: 2px solid black;\
			padding: 4px;\
			margin: 4px;\
			width: fit-content;\
			display: inline-block;\
			cursor: pointer;\
		}.proper-debug-page-slot-cell.active {\
			background:'+
this.css_values.greenLight+
" !important\
		}\
		.proper-debug-state-cell,\
		.proper-debug-bidder-cell {\
			padding: 4px 6px 4px 18px;\
			margin: 4px;\
			width: fit-content;\
			display: inline-block;\
			position:relative;\
			background: white;\
			border-radius:30px;\
			box-shadow: 0 1px 5px 0 rgba(0,0,0,0.1);\
		}.proper-debug-state-cell:before,\
		.proper-debug-bidder-cell:before{\
			content:'';\
			width:8px;\
			height:8px;\
			position: absolute;\
			left: 5px;\
			top: 6px;\
			z-index:3;\
			margin-right:5px;\
			background-image: linear-gradient("+
this.css_values.greenLight+
','+
this.css_values.greenDark+
');\
			border-radius: 5px;\
			box-shadow: inset 0 0 2px 0 '+
this.css_values.greenLight+
';\
		}.proper-debug-state-cell.red,\
		.proper-debug-bidder-cell.red {\
			color:red;\
		}.proper-debug-state-cell.red:before,\
		.proper-debug-bidder-cell.red:before {\
			background:red;\
			box-shadow:none;\
		}\
		.proper-debug-state-cell{\
			border-radius:0;\
		}.proper-debug-state-cell:first-of-type {\
			border-radius: 30px 0 0 30px;\
		}\
		.proper-debug-state-cell:last-of-type {\
			border-radius: 0 30px 30px 0;\
		}.proper-debug-state-cell:first-of-type:last-of-type{\
			border-radius: 30px;\
		}\
		.proper-debug-state-cell:not(:last-of-type) {\
			margin-right:-2px;\
		}\
		.'+
properOps.slot_wrapper_class+
',\
		.proper-ad-insert {\
			background: '+
this.css_values.greenDark+
'AA;\
		}.'+
properOps.slot_wrapper_class+
':hover,\
		.proper-ad-insert:hover {\
			background: '+
this.css_values.greenLight+
';\
		}\
		#proper-debug-console table {\
			border-top: solid 2px '+
this.css_values.purple+
';\
			background:white;\
			border-bottom: solid 1px #ccc;\
			line-height:1.4em;\
		}#proper-debug-console table td:not(:first-of-type){\
			border-left: solid 1px #ccc;\
		}#proper-debug-console table td:first-of-type{\
			min-width:100px;\
			background:white;\
			width:1px;\
			font-weight:bold;\
		}#proper-debug-console table th {\
			font-weight:bold;\
			border-bottom:solid 1px #cccccc80;\
		}\
		#proper-debug-console hr {\
			border:none;\
			border-bottom: solid 1px '+
this.css_values.grayDark+
';\
			opacity:0.3;\
		}\
		#proper-debug-console button {\
			-webkit-appearance:none;\
			cursor:pointer;\
			border:none;\
			border-radius: 4px;\
			padding: 5px 9px;\
			font-weight:bold;\
			color:white;\
			background:'+
this.css_values.green+
';\
			display:inline-block;\
		}#proper-debug-console button:not(:hover) {\
			opacity:0.9;\
		}\
		#proper-debug-console button.red {\
			background:red;\
		}\
		.proper-debug-mobile-pin-btn {\
			display:none !important;\
			background:white;\
			width:24px;\
			height:24px;\
			font-weight:bold;\
			border-radius: 4px;\
			margin-top:13px;\
			margin-right:6px;\
			cursor:pointer;\
			justify-content:center;\
			align-items:center;\
		}\
		@media screen and (max-width: 727px){\
			#proper-debug-console {\
				max-width:100vw !important;\
				width:100vw !important;\
				position:fixed !important;\
				left:0 !important;\
				top: auto !important;\
				bottom:0 !important;\
				box-shadow: none !important;\
				animation:none !important;\
				max-height:500px !important;\
				transition: max-height 250ms !important;\
			}\
			#proper-debug-console.pinned {\
				max-height:50px !important;\
			}\
			#proper-debug-console.pinned .proper-debug-mobile-pin-btn{\
				transform: scaleY(-1);\
			}\
			#proper-debug-console-breadcrumb {\
				cursor: default !important;\
			}\
			#proper-debug-console-resizer {\
				display:none;\
			}\
			.proper-debug-mobile-pin-btn {\
				display:flex !important;\
			}\
			body.proper-debug-pinned .'+
properOps.slot_wrapper_class+
'.sticky-btm{\
				transform: translateY(-50px);\
			}\
		}\
		';};var consentManager=(function(){var status={gdpr:false,uspc:false,gpp:false,};var disableAuction=true;var waitingOnCMP={};var errorLogged=false;var pendingWaiters=[];var consentManager={ready:function(callback,type){if(type=='unshift'){pendingWaiters.unshift(callback);}else{pendingWaiters.push(callback);}},consentReady:function(type,consentData){if(status[type]===true)return;status[type]=true;if((type=='gpp'&&gppConsent.gppApplies&&gppConsent.gppString)||(type=='uspc'&&uspConsent.ccpaApplies&&uspConsent.usPrivacy)||(type=='gdpr'&&gdprConsent.gdprApplies&&gdprConsent.consentString)||ProperMedia.utils.objectValues(status).filter(function(value){return value==false;}).length==0){callPendingWaiters();}},checkIfMissing:function(){var missing=false;if(disableAuction){if(ProperMedia.utils.deepAccess(properSpecialOps,'gppDoesApply')||ProperMedia.utils.deepAccess(properSpecialOps,'gdprDoesApply')||ProperMedia.utils.deepAccess(properSpecialOps,'uspcDoesApply')){missing=true;if(ProperMedia.utils.deepAccess(properSpecialOps,'gppDoesApply')){if(gppConsent.gppApplies&&gppConsent.gppString){disableAuction=false;missing=false;}else{disableAuction=ProperMedia.utils.deepAccess(properSpecialOps,'gppSection')=='EU'?true:false;missing=true;}}
if(missing==true){if(ProperMedia.utils.deepAccess(properSpecialOps,'gdprDoesApply')){if(gdprConsent.gdprApplies&&gdprConsent.consentString){disableAuction=false;missing=false;}else{disableAuction=true;missing=true;}}else if(ProperMedia.utils.deepAccess(properSpecialOps,'uspcDoesApply')){if(uspConsent.ccpaApplies&&uspConsent.usPrivacy){disableAuction=false;missing=false;}else{disableAuction=false;missing=true;}}}}else{missing=false;disableAuction=false;}}
return missing||disableAuction;},loadIfMissing:function(callback){let consentCallback=function(shouldCancelAuction,type,errMsg,...extraArgs){delete waitingOnCMP[type];if(errMsg&&!errorLogged){let error=new Error(errMsg);error.event_type='CMP_ERROR';sendError(error);errorLogged=true;}
disableAuction=shouldCancelAuction;if(!shouldCancelAuction&&!Object.keys(waitingOnCMP).length&&typeof callback=='function'){callback();}
if(errMsg){disableAuction=true;}};if(ProperMedia.utils.deepAccess(properSpecialOps,'gppDoesApply')&&!waitingOnCMP['gpp']){waitingOnCMP['gpp']=true;}
if(ProperMedia.utils.deepAccess(properSpecialOps,'gdprDoesApply')&&!waitingOnCMP['gdpr']){waitingOnCMP['gdpr']=true;}else if(ProperMedia.utils.deepAccess(properSpecialOps,'uspcDoesApply')&&!waitingOnCMP['uspc']){waitingOnCMP['uspc']=true;}
if(waitingOnCMP['gpp']){gppConsentModule.loadIfMissing(consentCallback);}
if(waitingOnCMP['gdpr']){gdprConsentModule.loadIfMissing(consentCallback);}
if(waitingOnCMP['uspc']){uspConsentModule.loadIfMissing(function(errMsg,...extraArgs){delete waitingOnCMP['uspc'];if(errMsg&&!errorLogged){let error=new Error(errMsg);error.event_type='CMP_ERROR';sendError(error);errorLogged=true;}
callback();if(errMsg){disableAuction=true;}});}
return true;},};function callPendingWaiters(){consentManager.ready=function(callback){callback.call();};while(pendingWaiters.length){pendingWaiters.shift().call();}}
return consentManager;})();var gppConsent={};var gppConsentModule=(function(){var DEFAULT_CMP='iab',DEFAULT_CONSENT_TIMEOUT=10000,CMP_VERSION=1;var userCMP='iab',cmpApiName='__gpp',gppScope=ProperMedia.utils.deepAccess(properSpecialOps,'gppDoesApply')||false,maxFailCnt=ProperMedia.utils.deepAccess(properSpecialOps,'gppSection')=='EU'&&ProperMedia.utils.deepAccess(properSpecialOps,'gppDisableAuction')!==false?8:4,disableAuction=(ProperMedia.utils.deepAccess(properSpecialOps,'gppSection')=='EU'&&ProperMedia.utils.deepAccess(properSpecialOps,'gppDisableAuction'))??false,consentTimeout=DEFAULT_CONSENT_TIMEOUT,staticConsentData,provisionalConsent,cmpFrame;var cmpCallMap={'iab':lookupIabConsent,'static':lookupStaticConsentData};function checkApplicableSectionIsReady(gppData){return gppData&&Array.isArray(gppData.applicableSection)&&gppData.applicableSection.length>0&&gppData.applicableSection[0]!==0;}
function checkApplicableSectionsIsReady(gppData){return gppData&&Array.isArray(gppData.applicableSections)&&gppData.applicableSections.length>0&&gppData.applicableSections[0]!==0;}
function lookupStaticConsentData({onSuccess,onError}){processCmpData(staticConsentData,{onSuccess,onError})}
function lookupIabConsent({onSuccess,onError}){const cmpCallbacks={};let registeredPostMessageResponseListener=false;function findCMP(){let f=window;let cmpDirectAccess=false;while(true){try{if(typeof f[cmpApiName]==='function'){cmpFrame=f;cmpDirectAccess=true;break;}}catch(e){}
try{if(f.frames['__gppLocator']){cmpFrame=f;break;}}catch(e){}
if(f===window.top)break;f=f.parent;}
return{cmpFrame,cmpDirectAccess};}
const cmpData=findCMP();cmpFrame=cmpData.cmpFrame;const cmpDirectAccess=cmpData.cmpDirectAccess;if(!cmpFrame){return onError('GPP: CMP not found.');}
const invokeCMP=(cmpDirectAccess)?invokeCMPDirect:invokeCMPFrame;function invokeCMPDirect({command,callback,parameter,version=CMP_VERSION},resultCb){if(typeof resultCb==='function'){resultCb(cmpFrame[cmpApiName](command,callback,parameter,version));}else{cmpFrame[cmpApiName](command,callback,parameter,version);}}
function invokeCMPFrame({command,callback,parameter,version=CMP_VERSION},resultCb){const callName=`${cmpApiName}Call`;if(!registeredPostMessageResponseListener){window.addEventListener('message',readPostMessageResponse,false);registeredPostMessageResponseListener=true;}
const callId=Math.random().toString();const msg={[callName]:{command:command,parameter,version,callId:callId}};cmpCallbacks[callId]=(typeof callback==='function')?callback:resultCb;cmpFrame.postMessage(msg,'*');function readPostMessageResponse(event){const cmpDataPkgName=`${cmpApiName}Return`;const json=(typeof event.data==='string'&&event.data.includes(cmpDataPkgName))?JSON.parse(event.data):event.data;if(json[cmpDataPkgName]&&json[cmpDataPkgName].callId){const payload=json[cmpDataPkgName];if(cmpCallbacks.hasOwnProperty(payload.callId)){cmpCallbacks[payload.callId](payload.returnValue);}}}}
const startupMsg=(cmpDirectAccess)?'Detected GPP CMP API is directly accessible, calling it now...':'Detected GPP CMP is outside the current iframe where Prebid.js is located, calling it now...';properLog.mylog(startupMsg);let pingdata=__gpp("ping",null,null)||{};if(pingdata.cmpStatus=='loaded'){invokeCMP({command:'getGPPData'},function(gppData){properLog.mylog(`Received a ${cmpDirectAccess?'direct':'postmsg'} response from GPP CMP for getGPPData`);processCmpData(gppData,{onSuccess,onError});});}
invokeCMP({command:'addEventListener',callback:function(evt){if(evt){properLog.mylog(`Received a ${(cmpDirectAccess?'direct':'postmsg')} response from GPP CMP for event`);if(evt.eventName==='sectionChange'||evt.pingData.cmpStatus==='loaded'){invokeCMP({command:'getGPPData'},function(gppData){properLog.mylog(`Received a ${cmpDirectAccess?'direct':'postmsg'} response from GPP CMP for getGPPData`);processCmpData(gppData,{onSuccess,onError});});}else if(evt.pingData.cmpStatus==='error'){onError('CMP returned with a cmpStatus:error response.  Please check CMP setup.');}}}});}
function loadConsentData(cb){var isDone=false;var timer=null;var fail_count=0,timeoutHandler=null;function done(consentData,shouldCancelAuction,errMsg,...extraArgs){if(timer!=null){clearTimeout(timer);timer=null;}
if(timeoutHandler!=null){clearTimeout(timeoutHandler);timeoutHandler=null;}
if(errMsg){properLog.mylog(`${errMsg}`);}
isDone=true;if(typeof cb==='function'){cb(shouldCancelAuction,'gpp',errMsg,...extraArgs);}else if(!shouldCancelAuction){consentManager.consentReady('gpp',consentData);}}
properLog.mylog("GPP: CMP gppDoesApply: "+ProperMedia.utils.deepAccess(properSpecialOps,'gppDoesApply'));if(ProperMedia.utils.deepAccess(properSpecialOps,'gppDoesApply')===false){done(storeConsentData(undefined),false,'GPP: GPP does not apply.');return;}
if(!Object.keys(cmpCallMap).includes(userCMP)){done(storeConsentData(undefined),false,'GPP: CMP framework ('+userCMP+') is not a supported framework.  Aborting consentManagement module and resuming auction.');return;}
const callbacks={onSuccess:(data)=>done(data,false),onError:function(msg,...extraArgs){properLog.mylog(msg);if(typeof cb=='function'){done(storeConsentData(undefined),disableAuction,msg,...extraArgs)}else{if(timeoutHandler!=null){clearTimeout(timeoutHandler);timeoutHandler=null;}
maxFailCnt=ProperMedia.utils.deepAccess(properSpecialOps,'gdprMaxFailCnt')??maxFailCnt;fail_count++;if(fail_count<maxFailCnt){timeoutHandler=setTimeout(function(){cmpCallMap[userCMP](callbacks);},500);}else{done(storeConsentData(undefined),disableAuction,msg,...extraArgs);}}}}
cmpCallMap[userCMP](callbacks);}
function processCmpData(consentObject,{onSuccess,onError}){function checkData(){var gppApplies=consentObject&&typeof consentObject.gppApplies==='boolean'?consentObject.gppApplies:gppScope;const gppString=consentObject&&consentObject.gppString;const gppSection=(checkApplicableSectionsIsReady(consentObject))?consentObject.applicableSections:(checkApplicableSectionIsReady(consentObject))?consentObject.applicableSection:(provisionalConsent&&provisionalConsent.applicableSections)?provisionalConsent.applicableSections:getDetectedApplicableSections();return!!((!Array.isArray(gppSection))||(Array.isArray(gppSection)&&(!gppString||!ProperMedia.utils.isStr(gppString))));}
if(checkData()){onError(`CMP returned unexpected value during lookup process.`);}else{onSuccess(storeConsentData(consentObject));}}
function storeConsentData(cmpConsentObject){gppConsent={gppString:(cmpConsentObject)?cmpConsentObject.gppString:(provisionalConsent&&ProperMedia.utils.isStr(provisionalConsent.gppString)&&provisionalConsent.gppString!=='')?provisionalConsent.gppString:undefined,fullGppData:(cmpConsentObject)||undefined,gppApplies:cmpConsentObject&&typeof cmpConsentObject.gppApplies==='boolean'?cmpConsentObject.gppApplies:gppScope};gppConsent.applicableSections=(checkApplicableSectionsIsReady(cmpConsentObject))?cmpConsentObject.applicableSections:(checkApplicableSectionIsReady(cmpConsentObject))?cmpConsentObject.applicableSection:(provisionalConsent?.applicableSections)?provisionalConsent.applicableSections:getDetectedApplicableSections();gppConsent.apiVersion=CMP_VERSION;return gppConsent;}
function loadIfMissing(cb){if(Object.keys(gppConsent).length&&gppConsent.gppString){properLog.mylog('GPP: User consent information already known.  Pulling internally stored information...');cb(false);}else{loadConsentData(cb);}}
const section_name_map={'2':'tcfeuv2','5':'tcfcav1','6':'uspv1','7':'uspnatv1','8':'uspcav1','9':'uspvav1','10':'uspcov1','11':'usputv1','12':'uspctv1',}
const region_section_map={'EU':'2','CA':'8','VA':'9','CO':'10','UT':'11','CT':'12',}
function getDetectedApplicableSections(){return[];}
function checkPersonalDataConsents(){return getConsentByField('PersonalDataConsents')===1;}
function checkMspaServiceProviderMode(){return getConsentByField('MspaServiceProviderMode')===1;}
function checkGpc(){return getConsentByField('checkGpc')===1;}
function checkSaleOptOut(){let saleOptOutNotice=getConsentByField('SaleOptOutNotice');let saleOptOut=getConsentByField('SaleOptOut');return saleOptOutNotice===2||saleOptOut===1||(sharingOptOutNotice===0&&sharingOptOut===2);}
function checkSharingOptOut(){let sharingNotice=getConsentByField('SharingNotice');let sharingOptOut=getConsentByField('SharingOptOut');let sharingOptOutNotice=getConsentByField('SharingOptOutNotice');return sharingNotice===2||sharingOptOutNotice===2||sharingOptOut===1||(sharingOptOutNotice===0&&sharingOptOut===2);}
function checkTargetedAdvertisingOptOut(){let targetedAdvertisingOptOutNotice=getConsentByField('TargetedAdvertisingOptOutNotice');let targetedAdvertisingOptOut=getConsentByField('TargetedAdvertisingOptOut');return targetedAdvertisingOptOutNotice===2||targetedAdvertisingOptOut===1||(targetedAdvertisingOptOutNotice===0&&targetedAdvertisingOptOut===2);}
function checkKnownChildSensitiveDataConsents(){let knownChildSensitiveDataConsents=getConsentByField('KnownChildSensitiveDataConsents')||[0,0];return knownChildSensitiveDataConsents[0]===1||knownChildSensitiveDataConsents[1]!==0;}
function isBasicConsentDenied(){return checkGpc()||checkMspaServiceProviderMode()||checkKnownChildSensitiveDataConsents();}
function isConsentDenied(){return isBasicConsentDenied()||checkSharingOptOut()||checkTargetedAdvertisingOptOut();}
function getConsentByField(field){if(gppConsent.gppApplies){if(gppConsent.applicableSections&&gppConsent.applicableSections.length){for(var i=0;i<gppConsent.applicableSections.length;i++){let section_name=section_name_map[gppConsent.applicableSections[i]]||'uspnatv1';let value=getFieldValue(`${section_name}.${field}`);if(value!==false&&value!==null&&typeof value!=='undefined'){return value;}}}}
return false;}
function getFieldValue(field){if(gppConsent.gppApplies&&cmpFrame&&typeof cmpFrame[cmpApiName]==='function'){return cmpFrame[cmpApiName]("getField",null,field)}
return false;}
return{"loadIfMissing":loadIfMissing,"getFieldValue":getFieldValue,"loadConsentData":loadConsentData,"checkSharingOptOut":checkSharingOptOut,"isConsentDenied":isConsentDenied,"userSyncsDenied":isConsentDenied,"enrichEidsDenied":isConsentDenied,"transmitEidsDenied":isConsentDenied,}})()
gppConsentModule.loadConsentData();var uspConsent={};var uspConsentModule=(function(){var DEFAULT_CONSENT_API='iab';var DEFAULT_CONSENT_TIMEOUT=50;var USPAPI_VERSION=1;var consentAPI=DEFAULT_CONSENT_API;var consentTimeout=DEFAULT_CONSENT_TIMEOUT;var provisionalConsent={usPrivacy:'1NNY',};var staticConsentData;uspConsent={ccpaApplies:ProperMedia.utils.deepAccess(properSpecialOps,'uspcDoesApply')||false,};var uspCallMap={iab:lookupUspConsent,static:lookupStaticConsentData,};function lookupStaticConsentData(onSuccess,onError){processUspData(staticConsentData,onSuccess,onError);}
function lookupUspConsent(onSuccess,onError){function findUsp(){var f=window;var uspapiFrame;var uspapiFunction;while(!uspapiFrame){try{if(typeof f.__uspapi==='function'){uspapiFunction=f.__uspapi;uspapiFrame=f;break;}}catch(e){}
try{if(f.frames['__uspapiLocator']){uspapiFrame=f;break;}}catch(e){}
if(f===window.top)break;f=f.parent;}
return{uspapiFrame:uspapiFrame,uspapiFunction:uspapiFunction,};}
function handleUspApiResponseCallbacks(){var uspResponse={};function afterEach(){if(uspResponse.usPrivacy){processUspData(uspResponse,onSuccess,onError);}else{onError('USPC: Unable to get USP consent string.');}}
return{consentDataCallback:function(consentResponse,success){if(success&&consentResponse.uspString){uspResponse.usPrivacy=consentResponse.uspString;}
afterEach();},};}
var callbackHandler=handleUspApiResponseCallbacks();var uspapiCallbacks={};var uspData=findUsp(),uspapiFrame=uspData.uspapiFrame,uspapiFunction=uspData.uspapiFunction;if(!uspapiFrame){return onError('USPC: USP CMP not found.');}
if(ProperMedia.utils.isFn(uspapiFunction)){properLog.mylog('USPC: Detected USP CMP is directly accessible, calling it now...');uspapiFunction('getUSPData',USPAPI_VERSION,callbackHandler.consentDataCallback);}else{properLog.mylog('USPC: Detected USP CMP is outside the current iframe where Prebid.js is located, calling it now...');callUspApiWhileInIframe('getUSPData',uspapiFrame,callbackHandler.consentDataCallback);}
function callUspApiWhileInIframe(commandName,uspapiFrame,moduleCallback){window.__uspapi=function(cmd,ver,callback){var callId=Math.random()+'';var msg={__uspapiCall:{command:cmd,version:ver,callId:callId,},};uspapiCallbacks[callId]=callback;uspapiFrame.postMessage(msg,'*');};window.addEventListener('message',readPostMessageResponse,false);window.__uspapi(commandName,USPAPI_VERSION,moduleCallback);function readPostMessageResponse(event){var res=event&&event.data&&event.data.__uspapiReturn;if(res&&res.callId){if(typeof uspapiCallbacks[res.callId]!=='undefined'){uspapiCallbacks[res.callId](res.returnValue,res.success);delete uspapiCallbacks[res.callId];}}}}}
function loadConsentData(cb){var timer=null;var isDone=false;var fail_count=0,timeoutHandler=null;function done(consentData,errMsg,...extraArgs){if(timer!=null){clearTimeout(timer);timer=null;}
if(timeoutHandler!=null){clearTimeout(timeoutHandler);timeoutHandler=null;}
isDone=true;if(ProperMedia.utils.isFn(cb)){if(!uspConsent.usPrivacy){storeUspConsentData(provisionalConsent);}
cb(errMsg,...extraArgs);}else{consentManager.consentReady('uspc',consentData);}}
properLog.mylog('USPC: CMP uspcDoesApply: '+ProperMedia.utils.deepAccess(properSpecialOps,'uspcDoesApply'));if(ProperMedia.utils.deepAccess(properSpecialOps,'uspcDoesApply')===false){done(null,'USPC: USPC does not apply.');return;}
if(!uspCallMap[consentAPI]){done(null,'USPC: USP framework ('+consentAPI+') is not a supported framework. Aborting consentManagement module and resuming auction.');return;}
var callbacks={onSuccess:done,onError:function(errMsg,...extraArgs){if(typeof cb=='function'){done(null,errMsg+' Resuming auction without consent data as per consentManagement config.',...extraArgs);}else{if(timeoutHandler!=null){clearTimeout(timeoutHandler);timeoutHandler=null;}
fail_count++;if(fail_count<6){timeoutHandler=setTimeout(function(){uspCallMap[consentAPI](callbacks.onSuccess,callbacks.onError);},250);}else{done(null,errMsg+' Resuming auction without consent data as per consentManagement config.',...extraArgs);}}},};uspCallMap[consentAPI](callbacks.onSuccess,callbacks.onError);if(!isDone){if(consentTimeout===0){processUspData(undefined,callbacks.onSuccess,callbacks.onError);}else{timer=setTimeout(callbacks.onError.bind(null,'USPC: USPAPI workflow exceeded timeout threshold.'),consentTimeout);}}}
function processUspData(consentObject,onSuccess,onError){var valid=!!(consentObject&&consentObject.usPrivacy);if(!valid){onError('USPC: USPAPI returned unexpected value during lookup process.',consentObject);return;}
storeUspConsentData(consentObject);onSuccess(uspConsent);}
function storeUspConsentData(consentObject){if(consentObject&&consentObject.usPrivacy){uspConsent.usPrivacy=consentObject.usPrivacy;uspConsent.restrictDataProcessing=consentObject.usPrivacy.match(/^\d{1}[\w-]{1}Y[\w-]{1}$/)?true:false;}}
function loadIfMissing(cb){loadConsentData(function(errMsg,...extraArgs){if(errMsg!=null){properLog.mylog(errMsg);if(ProperMedia.utils.isFn(cb)){cb();}}});}
return{loadIfMissing:loadIfMissing,loadConsentData:loadConsentData,};})();uspConsentModule.loadConsentData();var gdprConsent={};var gdprConsentModule=(function(){var DEFAULT_CMP='iab',DEFAULT_CONSENT_TIMEOUT=10000,CMP_VERSION=2;var userCMP='iab',gdprScope=ProperMedia.utils.deepAccess(properSpecialOps,'gdprDoesApply')||false,maxFailCnt=ProperMedia.utils.deepAccess(properSpecialOps,'gdprDisableAuction')!==false?8:4,disableAuction=ProperMedia.utils.deepAccess(properSpecialOps,'gdprDisableAuction')??false,consentTimeout=DEFAULT_CONSENT_TIMEOUT,staticConsentData,provisionalConsent;var cmpCallMap={'iab':lookupIabConsent,'static':lookupStaticConsentData};function lookupStaticConsentData(onSuccess,onError){processCmpData(staticConsentData,onSuccess,onError)}
function lookupIabConsent(onSuccess,onError){function findCMP(){var f=window;var cmpFrame;var cmpFunction;while(true){try{if(typeof f.__tcfapi==='function'){cmpFunction=f.__tcfapi;cmpFrame=f;break;}}catch(e){}
try{if(f.frames['__tcfapiLocator']){cmpFrame=f;break;}}catch(e){}
if(f===window.top)break;f=f.parent;}
return{'cmpFrame':cmpFrame,'cmpFunction':cmpFunction};}
function cmpResponseCallback(tcfData,success){properLog.mylog('GDPR: Received a response from CMP. gdprApplies: '+tcfData.gdprApplies+', tcString: '+tcfData.tcString+', eventStatus:'+tcfData.eventStatus);if(success){if(tcfData.gdprApplies===false||tcfData.eventStatus==='tcloaded'||tcfData.eventStatus==='useractioncomplete'){processCmpData(tcfData,onSuccess,onError);}else{provisionalConsent=tcfData;}}else{onError('GDPR: CMP unable to register callback function. Please check CMP setup.');}}
var cmpCallbacks={};var cpmData=findCMP(),cmpFrame=cpmData.cmpFrame,cmpFunction=cpmData.cmpFunction;if(!cmpFrame){return onError('GDPR: CMP not found.');}
if(typeof cmpFunction==='function'){properLog.mylog('GDPR: Detected CMP API is directly accessible, calling it now...');cmpFunction('addEventListener',CMP_VERSION,cmpResponseCallback);}else{properLog.mylog('GDPR: Detected CMP is outside the current iframe where ad project is located, calling it now...');callCmpWhileInIframe('addEventListener',cmpFrame,cmpResponseCallback);}
function callCmpWhileInIframe(commandName,cmpFrame,moduleCallback){var apiName='__tcfapi';var callName=apiName+'Call';window[apiName]=function(cmd,cmpVersion,callback,arg){var callId=Math.random()+'';var msg={[callName]:{"command":cmd,"version":cmpVersion,"parameter":arg,"callId":callId}};cmpCallbacks[callId]=callback;cmpFrame.postMessage(msg,'*');}
window.addEventListener('message',readPostMessageResponse,false);window[apiName](commandName,CMP_VERSION,moduleCallback);function readPostMessageResponse(event){var cmpDataPkgName=apiName+'Return';var json=(typeof event.data==='string'&&event.data.includes(cmpDataPkgName))?ProperMedia.utils.safeJsonParse(event.data):event.data;if(json[cmpDataPkgName]&&json[cmpDataPkgName].callId){var payload=json[cmpDataPkgName];if(typeof cmpCallbacks[payload.callId]!=='undefined'){cmpCallbacks[payload.callId](payload.returnValue,payload.success);}}}}}
function loadConsentData(cb){var isDone=false;var timer=null;var fail_count=0,timeoutHandler=null;function done(consentData,shouldCancelAuction,errMsg,...extraArgs){if(timer!=null){clearTimeout(timer);timer=null;}
if(timeoutHandler!=null){clearTimeout(timeoutHandler);timeoutHandler=null;}
isDone=true;shouldCancelAuction=properSpecialOps.gdprCancelAuction??shouldCancelAuction;if(typeof cb==='function'){cb(shouldCancelAuction,'gdpr',errMsg,...extraArgs);}else if(!shouldCancelAuction){consentManager.consentReady('gdpr',consentData);}}
properLog.mylog("GDPR: CMP gdprDoesApply: "+ProperMedia.utils.deepAccess(properSpecialOps,'gdprDoesApply'));if(ProperMedia.utils.deepAccess(properSpecialOps,'gdprDoesApply')===false){done(null,false,'GDPR: GDPR does not apply.');return;}
if(!Object.keys(cmpCallMap).includes(userCMP)){done(null,false,'GDPR: CMP framework ('+userCMP+') is not a supported framework.  Aborting consentManagement module and resuming auction.');return;}
var callbacks={onSuccess:function(data){done(data,false);},onError:function(msg,...extraArgs){properLog.mylog(msg);if(typeof cb=='function'){done(null,disableAuction,msg,...extraArgs)}else{if(timeoutHandler!=null){clearTimeout(timeoutHandler);timeoutHandler=null;}
maxFailCnt=ProperMedia.utils.deepAccess(properSpecialOps,'gdprMaxFailCnt')??maxFailCnt;fail_count++;if(fail_count<maxFailCnt){timeoutHandler=setTimeout(function(){cmpCallMap[userCMP](callbacks.onSuccess,callbacks.onError);},500);}else{storeConsentData(undefined);done(null,disableAuction,msg,...extraArgs);}}}}
cmpCallMap[userCMP](callbacks.onSuccess,callbacks.onError);}
function processCmpData(consentObject,onSuccess,onError){function checkData(){var gdprApplies=consentObject&&typeof consentObject.gdprApplies==='boolean'?consentObject.gdprApplies:gdprScope;var tcString=consentObject&&consentObject.tcString;return!!((typeof gdprApplies!=='boolean')||(gdprApplies===true&&(!tcString||!ProperMedia.utils.isStr(tcString))));}
if(userCMP==='static'){consentObject=consentObject.getTCData;}
if(checkData()){onError('GDPR: CMP returned unexpected value during lookup process.');}else{onSuccess(storeConsentData(consentObject));}}
function storeConsentData(cmpConsentObject){gdprConsent.consentString=(cmpConsentObject)?cmpConsentObject.tcString:undefined,gdprConsent.vendorData=(cmpConsentObject)||undefined,gdprConsent.gdprApplies=cmpConsentObject&&typeof cmpConsentObject.gdprApplies==='boolean'?cmpConsentObject.gdprApplies:gdprScope
if(cmpConsentObject&&cmpConsentObject.addtlConsent&&ProperMedia.utils.isStr(cmpConsentObject.addtlConsent)){gdprConsent.addtlConsent=cmpConsentObject.addtlConsent;}
gdprConsent.apiVersion=CMP_VERSION;return gdprConsent;}
function loadIfMissing(cb){if(Object.keys(gdprConsent).length&&gdprConsent.consentString){properLog.mylog('GDPR: User consent information already known.  Pulling internally stored information...');cb(false);}else{loadConsentData(cb);}}
function hasPurpose1Consent(){if(gdprConsent.gdprApplies){return ProperMedia.utils.deepAccess(gdprConsent,'vendorData.purpose.consents.1')===true;}
return true;}
function hasPurpose4Consent(){if(gdprConsent.gdprApplies){return ProperMedia.utils.deepAccess(gdprConsent,'vendorData.purpose.consents.4')===true;}
return true;}
return{"loadIfMissing":loadIfMissing,'loadConsentData':loadConsentData,'hasPurpose1Consent':hasPurpose1Consent,'hasPurpose4Consent':hasPurpose4Consent,}})()
gdprConsentModule.loadConsentData();var gdprEnforcement=(function(){var gdprEnforcement={};var TCF2={purpose1:{id:1,name:'storage'},purpose2:{id:2,name:'basicAds'},purpose4:{id:4,name:'personalisedAds'},purpose7:{id:7,name:'measurement'},};var DEFAULT_RULES=[{purpose:'storage',enforcePurpose:true,enforceVendor:true,vendorExceptions:['pubcid'],},{purpose:'basicAds',enforcePurpose:true,enforceVendor:true,vendorExceptions:[],},{purpose:'personalisedAds',enforcePurpose:true,enforceVendor:true,vendorExceptions:[],},];var purpose1Rule;var purpose2Rule;var purpose7Rule;var enforcementRules;var storageBlocked=[];var biddersBlocked=[];var analyticsBlocked=[];var gvlidMap={gam:755,};function getGvlid(module){var gvlid=null;if(module){var moduleCode=typeof module==='string'?module:module.name;gvlid=getGvlidForBidAdapter(moduleCode)||getGvlidForUserIdModule(module)||getGvlidForAnalyticsAdapter(moduleCode);}
return gvlid;}
function getGvlidForBidAdapter(bidderCode){var gvlid=null;if(bidderCode){var bidderAdapterName=bidderToAdapterName(bidderCode);gvlid=ProperMedia.utils.deepAccess(properOps,'bidder_info.'+bidderCode+'.gvlid')||ProperMedia.utils.deepAccess(properOps,'bidder_info.'+bidderAdapterName+'.gvlid')||gvlidMap[bidderCode]||null;}
return gvlid;}
function getGvlidForUserIdModule(userIdModuleName){return ProperMedia.utils.deepAccess(userIdAdapters,userIdModuleName+'.storage.gvlid')||null;}
function getGvlidForAnalyticsAdapter(code){return null;}
function validateRules(rule,currentModule,gvlId){var purposeId=TCF2[Object.keys(TCF2).filter((purposeName)=>TCF2[purposeName].name===rule.purpose)[0]].id;if((rule.vendorExceptions||[]).indexOf(currentModule)!==-1){return true;}
var purposeConsent=false;var vendorConsent=false;var liTransparency=false;if(gppConsent.gppApplies&&gppConsent.gppString&&ProperMedia.utils.deepAccess(properSpecialOps,'gppSection')=='EU'){let purposeConsents=gppConsentModule.getFieldValue('PurposeConsents')||[];let vendorConsents=gppConsentModule.getFieldValue('VendorConsents')||[];let purposeLegitimateInterests=gppConsentModule.getFieldValue('PurposeLegitimateInterests')||[];purposeConsent=purposeConsents[purposeId];vendorConsent=vendorConsents[gvlId];liTransparency=purposeLegitimateInterests[purposeId];}else if(gdprConsent.gdprApplies&&gdprConsent.consentString){purposeConsent=ProperMedia.utils.deepAccess(gdprConsent,'vendorData.purpose.consents.'+purposeId);vendorConsent=ProperMedia.utils.deepAccess(gdprConsent,'vendorData.vendor.consents.'+gvlId);liTransparency=ProperMedia.utils.deepAccess(gdprConsent,'vendorData.purpose.legitimateInterests.'+purposeId);}
var purposeAllowed=rule.enforcePurpose===false||purposeConsent===true;var vendorAllowed=rule.enforceVendor===false||vendorConsent===true;if(purposeId===2){return(purposeAllowed&&vendorAllowed)||liTransparency===true;}
return purposeAllowed&&vendorAllowed;}
gdprEnforcement.deviceAccessEnforcement=function(gvlid,moduleName){var result;if((gdprConsent&&gdprConsent.gdprApplies)||(gppConsent&&gppConsent.gppApplies&&ProperMedia.utils.deepAccess(properSpecialOps,'gppSection')=='EU')){gvlid=getGvlid(moduleName)||gvlid;var isAllowed=validateRules(purpose1Rule,moduleName,gvlid);if(isAllowed){result=true;}else{moduleName&&properLog.mylog('TCF2 denied device access for '+moduleName);result=false;storageBlocked.push(moduleName);}}else{result=true;}
return result;};gdprEnforcement.userSyncEnforcement=function(curBidder){var result;if((gdprConsent&&gdprConsent.gdprApplies)||(gppConsent&&gppConsent.gppApplies&&ProperMedia.utils.deepAccess(properSpecialOps,'gppSection')=='EU')){var gvlid=getGvlid(curBidder);var isAllowed=validateRules(purpose1Rule,curBidder,gvlid);if(isAllowed){result=isAllowed;}else{result=false;properLog.mylog('User sync not allowed for '+curBidder);storageBlocked.push(curBidder);}}else{result=true;}
return result;};gdprEnforcement.userIdEnforcement=function(submodules){if((gdprConsent&&gdprConsent.gdprApplies)||(gppConsent&&gppConsent.gppApplies&&ProperMedia.utils.deepAccess(properSpecialOps,'gppSection')=='EU')){var userIdModules=submodules.map(function(submodule){if(submodule.name&&userIdAdapters[submodule.name]){var identityAdapter=userIdAdapters[submodule.name];var gvlid=ProperMedia.utils.deepAccess(identityAdapter,'storage.gvlid')||null;var moduleName=ProperMedia.utils.deepAccess(identityAdapter,'name')||'';var isAllowed=validateRules(purpose1Rule,moduleName,gvlid);if(isAllowed){return submodule;}else{properLog.mylog('User denied permission to fetch user id for '+moduleName+' User id module');storageBlocked.push(moduleName);}}
return undefined;}).filter(function(moduleObj){return moduleObj;});return{submodules:userIdModules,hasValidated:true};}else{return{submodules:submodules};}};gdprEnforcement.makeBidRequestEnforcement=function(currBidder){if(((gdprConsent&&gdprConsent.gdprApplies)||(gppConsent&&gppConsent.gppApplies&&ProperMedia.utils.deepAccess(properSpecialOps,'gppSection')=='EU'))&&ProperMedia.utils.deepAccess(properSpecialOps,'gdprDisableBidsOnBasicAds')!==false&&ProperMedia.utils.deepAccess(properSpecialOps,'gppDisableBidsOnBasicAds')!==false){var gvlId=getGvlid(currBidder);if(biddersBlocked.indexOf(currBidder)!==-1)return false;var isAllowed=!!validateRules(purpose2Rule,currBidder,gvlId);if(!isAllowed){properLog.mylog('TCF2 blocked auction for '+currBidder);biddersBlocked.push(currBidder);}
return isAllowed;}else{return true;}};var hasPurpose1=function(rule){return rule.purpose===TCF2.purpose1.name;};var hasPurpose2=function(rule){return rule.purpose===TCF2.purpose2.name;};var hasPurpose4=function(rule){return rule.purpose===TCF2.purpose4.name;};var hasPurpose7=function(rule){return rule.purpose===TCF2.purpose7.name;};gdprEnforcement.setEnforcementConfig=function(config){var rules=ProperMedia.utils.deepAccess(config,'gdpr.rules');if(!rules){properLog.mylog('TCF2: enforcing P1 and P2 by default');enforcementRules=DEFAULT_RULES;}else{enforcementRules=rules;}
if(ProperMedia.utils.isArray(enforcementRules)){purpose1Rule=enforcementRules.find(hasPurpose1);purpose2Rule=enforcementRules.find(hasPurpose2);purpose4Rule=enforcementRules.find(hasPurpose4);purpose7Rule=enforcementRules.find(hasPurpose7);if(!purpose1Rule){purpose1Rule=DEFAULT_RULES[0];}
if(!purpose2Rule){purpose2Rule=DEFAULT_RULES[1];}
if(!purpose4Rule){purpose4Rule=DEFAULT_RULES[2];}}};return gdprEnforcement;})();var confiantWrapper=(function(){var confiantWrapper={cdnHost:'cdn.clarium.io',confiantId:'TzdoClhg0h30W2CCYiFFb2rl5ww',mapBlockingType:{'1':{'type':'manual','desc':'Deprecated'},'2':{'type':'creative','desc':'Creative-based detection'},'3':{'type':'provider_security','desc':'Domain-based detection for unsafe domains'},'4':{'type':'banned_domain','desc':'Domain-based detection for banned domains'},'5':{'type':'provider_ibv','desc':'Domain-based detection for in-banner-video'},'6':{'type':'unsafejs','desc':'Javascript-based detection for unsafe ads'},'7':{'type':'hrap','desc':'Domain-based detection for high risk ad platform domains'}},loadDFPTag:function(win){properLog.mylog('Confiant loadDFPTag');win=win||window;this.confiantId=ProperMedia.utils.deepAccess(properSpecialOps,'confiant.accountId')||ProperMedia.utils.deepAccess(properOps,'confiant.accountId')||this.confiantId;if(ProperMedia.utils.deepAccess(properSpecialOps,'confiant.version')==2){var w=win;w._clrm=w._clrm||{};w._clrm.gpt={propertyId:this.confiantId,confiantCdn:this.cdnHost,sandbox:0,mapping:'W3siaSI6MiwidCI6Int7b319Ont7d319eHt7aH19IiwicCI6MCwiRCI6MSwiciI6W119LHsiaSI6NiwidCI6Int7Y299fTp7e3d9fXh7e2h9fSIsInAiOjUwLCJEIjowLCJyIjpbeyJ0IjoiZXgiLCJzIjpudWxsLCJ2IjoiY28ifV19XQ==',activation:'||neq|NDM5NjA3NDE2,||neq|NDk4NzQ4NDU2,||neq|NTExMjA0NTc2,||neq|ODA2NzU4NTc2,||neq|ODA2NzYxMjE2,||neq|ODEyODU5NjE2,||neq|ODEyODg1Mjk2,||neq|MTU2MTIwNzQ1Ng==',callback:TraceKit.wrap(this.callback.bind(this))};var e=document.createElement('script');e.async=true;e.src='//'+this.cdnHost+'/gpt/a/wrap.js?v2_1';win.document.getElementsByTagName('head')[0].appendChild(e);}else{win.confiant=win.confiant||{};win.confiant.callback=TraceKit.wrap(this.callback.bind(this));var e=win.document.createElement('script');e.async=true;e.src='https://cdn.confiant-integrations.net/'+this.confiantId+'/gpt_and_prebid/config.js';win.document.getElementsByTagName('head')[0].appendChild(e);}},callback:function(blockingType,blockingId,isBlocked,wrapperId,tagId,impressionData){properLog.mylog('Confiant Callback');var slot={},ad={cpm:0.00,size:'1x1',bidder:'dfp',blockData:arguments};if(impressionData&&typeof impressionData.dfp!=='undefined'){var advertiserId=impressionData.dfp.ad||null;var yieldGroup=impressionData.dfp.y||null;if(advertiserId==properOps.amazon_advertiser){ad.bidder="a9";}else if(advertiserId==properOps.adsense_advertiser){ad.bidder="adsense";}else if(advertiserId==properOps.google_advertiser||advertiserId==1||advertiserId==0||advertiserId==null||yieldGroup!=null){ad.bidder="adx";}
var dfpid_regex=/^\/[\d,]+\//;var slot=ProperMedia.utils.extractSlotName(impressionData.dfp.s)||properPage.getSlotFromPageObjectByAdUnitPath(impressionData.dfp.A)||'';if(slot&&slot instanceof slotObj){ad.size=slot.size;if(ad.bidder=="adx"||ad.bidder=="adsense"){var floor_size=(slot.interstitial?'interstitial':creative_size);var floor=slot.getFloor(floor_size);if(slot.dfp_bid_price&&parseFloat(slot.dfp_bid_price)>floor){ad.cpm=parseFloat(slot.dfp_bid_price)+0.01;}else{ad.cpm=parseFloat(floor)+0.01;}}
if(isBlocked){if(slot.getWinningBid()){showWinningAd(slot);return;}}}else{properLog.mylog("Confiant DFP Callback: Cannnot determin slot.");}}
this.trackBadAd(ad);},wrapTag:function(slot,doc,winning_ad){properLog.mylog('Confiant wrapTag: '+slot.name);this.confiantId=ProperMedia.utils.deepAccess(properSpecialOps,'confiant.accountId')||ProperMedia.utils.deepAccess(properOps,'confiant.accountId')||this.confiantId;var confiantWrap=TraceKit.wrap(function(a,b,c,d,e){function f(a){return(m(a)||"")[s]("/","_")[s]("+","-")}function g(b,c,d){var e=w+n(b)+"&d="+c,f="err__"+1*new Date;k[f]=d;var g="<"+q+" on"+t+'="void('+f+'())" '+r+'="'+e+'" type="text/java'+q+'" ></'+q+">";a[v](g)}function h(){var c=f(d+"/"+x.k.hb_bidder[0]+":"+x.k.hb_size[0]),h={wh:c,wd:l.parse(l[u](x)),wr:0};g(c,f(l[u](h)),function(){a[v](b.ad)});var i={prebid:{adId:b.adId,cpm:b.cpm}},j={d:h,t:b.ad,cb:e,id:i};k[d]={},k[d][c]=j}var i=b.bidder,j=b.size,k=a.parentWindow||a.defaultView,l=k.JSON,m=k.btoa,n=k.encodeURIComponent;if(!l||!m)return!1;var o="t",p="i",q="script",r="src",s="replace",t="error",u="stringify",v="wr"+p+o+"e",w="https://"+c+"/?wrapper="+n(d)+"&tpid=",x={k:{hb_bidder:[i],hb_size:[j]}};return h(),a.close(),!0});var callback=TraceKit.wrap(function(blockingType,blockingId,isBlocked,wrapperId,tagId,impressionData){var ad={cpm:winning_ad.price,size:winning_ad.size,bidder:winning_ad.bidder,blockData:arguments};if(isBlocked){properLog.mylog('Confiant blocked ad: '+slot.name+' - '+ad.bidder);slot.winning_ad={};if(slot.getWinningBid()){showWinningAd(slot);return;}}
this.trackBadAd(ad);});var bid={bidder:winning_ad.bidder,size:winning_ad.size,ad:winning_ad.adcode}
if(!confiantWrap(doc,bid,this.cdnHost,this.confiantId,callback.bind(this))){properLog.mylog('Confiant failed: '+slot.name);doc.write(ad.adcode);}},trackBadAd:function(ad){try{var blockData=ProperMedia.utils.deepAccess(ad,'blockData.0')||'';var postData={'client_timestamp':new Date().getTime(),'event_type':'rogue_ad','event_id':ProperMedia.utils.generateUUID(),'page_id':ProperMedia.utils.generateUUID(),'session_id':ProperMedia.utils.generateUUID(),'bidder':ad.bidder||'','user_id':ProperMedia.utils.validateValue(properUser.pubcid,{'type':'string'}),'publisher':ProperMedia.utils.validateValue(properOps.site_name,{'type':'string'}),'rtp_file_version':ProperMedia.utils.validateValue(properOps.rtp_file_version,{'type':'string'}),'ad_project_tag':ProperMedia.utils.validateValue(properOps.rtp_file_revision,{'type':'string'}),'page_url':getPageUrl()||'','in_iframe':(properOps.run_dfp_in_window!==1)?true:false,'is_https':('https:'==document.location.protocol)?true:false,'user_agent':navigator.userAgent||'','stack_trace':JSON.stringify(ad),'error_message':ProperMedia.utils.deepAccess(this,'mapBlockingType.'+blockData+'.desc')||'Confiant Flagged Ad','error_name':ProperMedia.utils.deepAccess(this,'mapBlockingType.'+blockData+'.type')||'rogue_ad'}
if(properPage.uuid&&properPage.uuid!==''){postData['page_id']=properPage.uuid;}
if(ProperMedia.utils.deepAccess(properSession,'sessionData.uuid')){postData['session_id']=properSession.sessionData.uuid;}
$.ajax({url:"https://events.proper.io/api/event",requestType:"fetch",method:"POST",data:JSON.stringify(postData),withCredentials:false,success:function(resp){console.log("Proper exception logged successfully.");},error:function(){console.error("Unable to log Proper exception.");}});}catch(e){console.error("Error sending exception data");console.error(e);}}}
return confiantWrapper;})();var adLightningWrapper=(function(){var adLightningWrapper={clientId:'properio',loadDFPTag:function(win){win=win||window;this.clientId=ProperMedia.utils.deepAccess(properOps,'adlightning.clientId')||ProperMedia.utils.deepAccess(properSpecialOps,'adlightning.clientId')||this.clientId;var e=win.document.createElement('script');e.async=true;e.src='https://tagan.adlightning.com/'+this.clientId+'/op.js';win.document.getElementsByTagName('head')[0].appendChild(e);window.addEventListener('message',function(event){var data=event.data
if(data.message==='ADL_BLOCKED'){if(data.adUnit){var adUnitParts=data.adUnit.split('/');var slot_name=adUnitParts.pop();var slot=properPage.getSlotFromPageObject(slot_name)||properPage.getSlotFromPageObject(slot_name.replace(/_\d+$/,''));if(slot){var error=new Error(slot.name+' data:'+JSON.stringify(data));error.event_type='ADL_BLOCKED';sendError(error);properLog.mylog('ADL Blocked Ad for '+slot.name);if(!slot.adl_blocked){slot.adl_blocked=true;slot.getWinningBid();showWinningAd(slot);}}}}});},wrapTag:function(slot,contentWindow,winning_ad){properLog.mylog('Running AdLightning Wrapper: '+slot.name);var urlEncodedUrl=encodeURIComponent(winning_ad.adcode);var size=winning_ad.size.split('x');var adl_wrapper_html='<script> var urlEncodedUrl = "%%ENCODED_AD_TAG%%";</script>\
                <script src="https://tagan.adlightning.com/%%CLIENT_ID%%/blacklist_script.js" type="text/javascript"></script>\
                <script src="https://tagan.adlightning.com/%%CLIENT_ID%%/blocking_script.js" type="text/javascript"></script>\
                <script type="text/javascript">\
                    function createTagDetails(){\
                        var tagDetails = {};\
                        tagDetails.w = "%%WIDTH%%";\
                        tagDetails.h = "%%HEIGHT%%";\
                        tagDetails.adServerDetails = {advertiserId: "%%ADVERTISER_ID%%", campaignId: "%%CAMPAIGN_ID%%", creativeId: "%%CREATIVE_ID%%", lineitemId: "%%LINEITEM_ID%%", adServer: "%%AD_SERVER%%"};\
                        tagDetails.au = "%%AD_UNIT_ID%%";\
                        tagDetails.markupInDom = true;\
                        tagDetails.refreshMessage = "true";\
                        var timeBase36 = Date.now().toString(36);\
                        var random = Math.random().toString(36).substr(2).split("")\
                                    .map(function (c) {\
                                    return (Math.random() < 0.5 ? c.toUpperCase() : c); }) .join("");\
                        tagDetails.currentTagId="adltag_" + timeBase36 + "_" + random;\
                    return tagDetails;\
                    }\
                    var random = "" + Math.round(Math.random() * 1e8);\
                    var clientId = "%%CLIENT_ID%%";\
                    var site_id = random + "_" + clientId;\
                    window[site_id]={};\
                    window[site_id].tagDetails=createTagDetails();\
                    !function(){"use strict";"blocker"in window||(window.blocker=function(e,n,t,o,r){function i(e){var n=window.Request,t=n&&n.prototype||{};if(navigator&&navigator.sendBeacon)navigator.sendBeacon(e);else if(window.fetch){var o={method:"GET"};"keepalive"in t&&(o.keepalive=!0),window.fetch(e,o)}else{var r=new Image(1,1);"loading"in r&&(r.loading="eager"),r.src=e}}if((r=r||{}).bw){if(Math.random()<.1)for(var a="undefined"!=typeof btoa?btoa:String,x="https://"+clientId+"-tagan.adlightning.com",c=window[e]?window[e].tagDetails:{},d={siteId:clientId,url:window.top.location.href,tagDetails:c,errorData:null,errorMethod:"missing_blocker"},f=function(){var t=(new Date).getTime();"undefined"!=typeof performance&&"function"==typeof performance.now&&(t+=performance.now());return"xxxxxxxxxxxxxxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?n:3&n|8).toString(16)})}(),l=encodeURIComponent(JSON.stringify(d)).replace(/%([0-9A-F]{2})/g,function(e,n){return String.fromCharCode("0x"+n)}),g=encodeURIComponent(a(l)),w=8e3-(x.length+100),u=Math.ceil(g.length/w),s=0,p=1;p<=u;p+=1){i(x+"/error?d="+g.substr(s,w)+"&i="+p+"-"+u+"&t="+c.currentTagId+"&r="+f+"&c="+clientId+"&z=1"),s+=w}document.write(n)}})}();\
                    blocker(site_id, decodeURIComponent(urlEncodedUrl) + "<!--ADL_WRAPPED-->", false, window, {bw:true});\
                </script>';var html=adl_wrapper_html.replace(/%%ENCODED_AD_TAG%%/g,urlEncodedUrl).replace(/%%CLIENT_ID%%/g,this.clientId).replace(/%%WIDTH%%/g,size[0]).replace(/%%HEIGHT%%/g,size[1]).replace(/%%ADVERTISER_ID%%/g,winning_ad.adid).replace(/%%CAMPAIGN_ID%%/g,winning_ad.cid).replace(/%%CREATIVE_ID%%/g,winning_ad.crid).replace(/%%LINEITEM_ID%%/g,'').replace(/%%AD_SERVER%%/g,'proper').replace(/%%AD_UNIT_ID%%/g,slot.name);contentWindow.document.open();contentWindow.document.write(html);contentWindow.document.close();},addReportAd:function(event){try{var adId=event.slot.getSlotElementId();var adReportDialogSelector=ProperMedia.utils.makeid(10)+'-'+adId;var addParentReporterDiv=document.createElement('div');addParentReporterDiv.id=adReportDialogSelector;addParentReporterDiv.className='adl-report-ad-container-parent';var buttonDiv=document.createElement('div');buttonDiv.className='adl-report-ad-container';var createReportBtnEvent={"adlAction":'createUserReportButton',"selector":'#'+adReportDialogSelector,"uniqueId":event.creativeId||event.sourceAgnosticCreativeId,"targetAd":adId};addParentReporterDiv.appendChild(buttonDiv);var adContainer=document.getElementById(adId);var adContainerParent=adContainer.parentElement.getElementsByClassName("adl-report-ad-container-parent");if(adContainerParent&&adContainerParent.length){adContainerParent[0].remove();}
if(adContainer){adContainer.insertAdjacentElement("afterend",addParentReporterDiv);window.postMessage(createReportBtnEvent,'*');}}catch(e){properLog.mylog('Error creating Ad Lightning report ad button. '+JSON.stringify(e));}}}
return adLightningWrapper;})();var geoEdgeWrapper=(function(){var geoEdgeWrapper={wrapTag:function(slot,doc,winning_ad){properLog.mylog('Running geoEdge Wrapper: '+slot.name);var ge_wrapper_header='<div id="grumi-container"><script type="text/javascript" nonce="!headerNonce!">!function(d,i){var p={wver:"1.1.5",wtype:"dfp",key:"caae3efc-52af-4938-bc92-44182723e3e2",meta:{adup:"%%ADUNIT%%",dest:"%%DEST_URL_ESC%%",w:"%%WIDTH%%",h:"%%HEIGHT%%",li:"%eaid!",adv:"%eadv!",ord:"%ebuy!",cr:"%ecid!",ygIds:"%_ygIds!",aduid:"%epid!",haduid:"%esid!",isAfc:"%_isAfc!",isAmp:"%_isAmp!",qid:"%qid!",cust_imp:"%cust_imp!",cust1:"%cust1!",cust2:"%cust2!",cust3:"%cust3!",caid:"%caid!",di:"%DEMAND_ID!",dn:"%DEMAND_NAME!",dcid:"%DEMAND_CREATIVE_ID!",pid:"%PUBLISHER_ID!",pn:"%PUBLISHER_NAME!",adElId:"%_adElId!"},sp:"dfp",cfg:{},pbAdId:"%%PATTERN:hb_adid%%",pbAdIdAst:"%%PATTERN:hb_adid_appnexusAst%%",pbBidder:"%%PATTERN:hb_bidder%%",hbPb:"%%PATTERN:hb_pb%%",hbCid:"%_hbcid!",site:"%%SITE%%",pimp:"%_pimp%"};window.grumi=p}();</script><template style="display: none;" id="template0"><xmp style="display: none;" id="xmp0">';var ge_wrapper_footer='</xmp></template><script type="text/javascript" nonce="!footerNonce!">!function(t){var o=window.grumi.key,r=window.grumi,e=r&&r.wtype&&"gpt"===r.wtype,n=window.onerror,i=1*new Date,a=navigator.userAgent&&navigator.userAgent.match(/\\b(MSIE |Trident.*?rv:|Edge\\/)(\\d+)/),w=e&&!a;function d(){var e=function(){for(var e,n=document.getElementsByTagName("template"),t=n.length-1;0<=t;t--)if("template0"===n[t].id){e=n[t];break}return e}();return e.content?e.content.getElementById?e.content.getElementById("xmp0"):e.content.childNodes[0]:e.getElementsByTagName("xmp")[0]}function u(){var e=d();return e&&e.innerHTML}function c(e,n){n=n||!1,top.postMessage&&top.postMessage({evType:e||"",key:r.key,adup:r.meta.adup,html:window.grumi?window.grumi.tag:"",el:r.meta.adElId,refresh:n},"*")}var m=!1;function g(e,n){if(!m){m=!0;var t="",o=a&&"complete"===document.readyState;window.grumi&&(window.grumi.fsRan=!0,t=window.grumi.tag),o||(t||(t=u()),w&&window.document.open(),window.document.write(t),window.document.close()),((n=n||!1)||o)&&c(e,o)}}function l(e,t){return function(){var n=setTimeout(function(){var e=document.getElementById(i);e&&null===function(e){if(void 0!==e.nextElementSibling)return e.nextElementSibling;for(var n=e.nextSibling;n&&1!==n.nodeType;)n=n.nextSibling;return n}(e)&&t&&t(),clearTimeout(n)},e)}}l(5e3,function(){g()})(),l(2e3,function(){c("slwCl")})(),window.grumi.tag=u(),window.grumi.scriptHost=t,window.grumi.pbGlobal=window.grumi.cfg&&window.grumi.cfg.pbGlobal||"pbjs",window.grumi.onerror=n,window.parent&&window.parent.postMessage&&window.parent.postMessage({iw:!0,key:r.key,adup:r.meta.adup,el:r.meta.adElId},"*"),function(){var e=document.createElement("script");e.type="text/javascript",e.src=t+o+"/grumi.js",e.className="rm",e.id=i,w&&(e.async=!0);var n="_"+1*new Date;window[n]=function(){g("netErr",!0)},window.grumi.start=1*new Date;try{window.document.write(e.outerHTML.replace(\'class="rm"\',\'onerror="\'+n+\'();"\'))}catch(e){g()}}(),window.onerror=function(e){"function"==typeof n&&n.apply(this,arguments),l(0,g)(),window.onerror=n}}(("http"===window.location.protocol.substr(0,4)?window.location.protocol:"https:")+"//rumcdn.geoedge.be/");</script></div>';ge_wrapper_header=ge_wrapper_header.replace(/%DEMAND_ID!/g,winning_ad.bidder).replace(/%DEMAND_NAME!/g,winning_ad.bidder).replace(/%DEMAND_CREATIVE_ID!/g,winning_ad.crid).replace(/%PUBLISHER_ID!/g,properOps.site_name).replace(/%PUBLISHER_NAME!/g,properOps.site_name);var html=ge_wrapper_header+winning_ad.adcode+ge_wrapper_footer;doc.open();doc.write(html);doc.close();}}
return geoEdgeWrapper;})();var bidAdapters={},userIdAdapters={},audiencePixels={networks:{}},properOps=new optionsObj(),properSession=new sessionObj(),properDevice=new deviceObj(),properUser=new userObj(),cookieMatching=new cookieMatchingObj(),properPage=new pageObj(),properAdPool=new adPoolObj(),debugObj=new debugConsole();var thirtyThreeAcrossIdAdapter=(function(){const MODULE_NAME='thirtyThreeAcrossId';const API_URL='https://lexicon.33across.com/v1/envelope';const AJAX_TIMEOUT=10000;const CALLER_NAME='pbjs';const VENDOR_ID=58;function thirtyThreeAcrossId(){this.name=MODULE_NAME;this.eid_name='33acrossId';this.source='33across.com';this.atype=1;this.config={enabled:false,pid:null,};this.storage={type:'localstorage',name:'33acrossId',expiresInDays:90,refreshInSeconds:8*3600,gvlid:VENDOR_ID,};this.idObj=null;this.callback=null;}
function getEnvelope(response){if(!response?.data?.envelope){properLog.mylog(`${MODULE_NAME}: No envelope was received`);return;}
return response.data.envelope;}
thirtyThreeAcrossId.prototype.calculateQueryStringParams=function(){const uspString=uspConsent&&uspConsent.usPrivacy?uspConsent.usPrivacy:'';const gdprApplies=Boolean(gdprConsent.gdprApplies);const params={pid:this.config.pid,gdpr:Number(gdprApplies),src:CALLER_NAME,ver:properOps.prebid_version,};if(uspString){params.us_privacy=uspString;}
if(gdprApplies){params.gdpr_consent=gdprConsent.consentString||'';}
return params;};thirtyThreeAcrossId.prototype.getValue=function(){return ProperMedia.utils.deepAccess(this,'idObj.'+this.eid_name+'.envelope')||undefined;};thirtyThreeAcrossId.prototype.decode=function(value){return{[this.eid_name]:{envelope:value,},};};thirtyThreeAcrossId.prototype.getId=function(cacheIdObj){if(typeof this.config.pid!=='string'){properLog.mylog(`${MODULE_NAME}: Submodule requires a partner ID to be defined`);return;}
const{pid,apiUrl=API_URL}=this.config;var resp=function(callback){let qs_params=this.calculateQueryStringParams();$.ajax({url:apiUrl+'?'+ProperMedia.utils.formatQueryString(qs_params),method:'GET',timeout:AJAX_TIMEOUT,success:function(response){let envelope;try{envelope=getEnvelope(ProperMedia.utils.safeJsonParse(response));}catch(err){properLog.mylog(`${MODULE_NAME}: ID reading error:`+err);}
callback(envelope);}.bind(this),error:function(err){properLog.mylog(`${MODULE_NAME}: ID error response`,err);callback();},});};return{callback:resp};};return thirtyThreeAcrossId;})();userIdAdapters.thirtyThreeAcrossId=new thirtyThreeAcrossIdAdapter();var verizonMediaIdAdapter=(function(){var MODULE_NAME='verizonMediaId';var VENDOR_ID=25;var PLACEHOLDER='__PIXEL_ID__';var VMCID_ENDPOINT='https://ups.analytics.yahoo.com/ups/'+PLACEHOLDER+'/fed';var OVERRIDE_OPT_OUT_KEY='connectIdOptOut';function verizonMediaId(){this.name=MODULE_NAME;this.eid_name='connectid';this.source='yahoo.com';this.emailHash='';this.atype=3;this.config={enabled:false,pixelId:58491,};this.storage={type:'localstorage',name:'connectid',expiresInDays:14,gvlid:VENDOR_ID,};this.idObj=null;this.callback=null;}
function isEUConsentRequired(gdprConsent){return!!(gdprConsent&&gdprConsent.gdprApplies);}
function userHasOptedOut(){try{return localStorage.getItem(OVERRIDE_OPT_OUT_KEY)==='1';}catch{return false;}}
verizonMediaId.prototype.initialize=function(userIdData){if(ProperMedia.utils.deepAccess(userIdData,'emailHashes.sha256')){this.emailHash=userIdData.emailHashes.sha256;}};verizonMediaId.prototype.getValue=function(){return this.idObj||undefined;};verizonMediaId.prototype.decode=function(value){if(userHasOptedOut()){return undefined;}
return typeof value==='object'&&(value.connectid||value.vmuid)?value.connectid||value.vmuid:undefined;};verizonMediaId.prototype.getId=function(cacheIdObj){if(userHasOptedOut()){return;}
if((!this.emailHash&&!properUser.pubcid)||!this.config.pixelId){properLog.mylog('The verizonMediaId submodule requires userIdData.emailHash.sha256 and pixelId parameters to be defined.');return;}
var data={v:'1','1p':'1',url:properPage.url.split('?')[0],puid:properUser.pubcid,pixelId:this.config.pixelId,gdpr:isEUConsentRequired(gdprConsent)?'1':'0',gdpr_consent:isEUConsentRequired(gdprConsent)?gdprConsent.consentString:'',us_privacy:uspConsent&&uspConsent.usPrivacy?uspConsent.usPrivacy:'',};if(this.emailHash){data.he=this.emailHash;}
var endpoint=VMCID_ENDPOINT.replace(PLACEHOLDER,this.config.pixelId);var url=endpoint+'?'+ProperMedia.utils.formatQueryString(data);var resp=function(callback){$.ajax({url:url,method:'GET',success:function(response){var responseObj;if(response){try{responseObj=ProperMedia.utils.safeJsonParse(response);}catch(error){properLog.mylog(error);}}
callback(responseObj);}.bind(this),error:function(error){properLog.mylog('VerizonMediaId - ID fetch encountered an error: '+JSON.stringify(error));callback();},});};return{callback:resp};};function isUnderGPPJurisdiction(){return!!(gppConsent&&gppConsent.gppString);}
return verizonMediaId;})();userIdAdapters.verizonMediaId=new verizonMediaIdAdapter();var identityLinkAdapter=(function(){function identityLink(){this.name='identityLink';this.eid_name='idl_env';this.envelope='';this.email='';this.emailHashes=[];this.source='liveramp.com';this.atype=3;this.config={enabled:false,placementID:72,atsEnabled:false,detectionType:'',urlParameter:'',detectionSubject:'',detectDynamicNodes:'',detectionEventType:'',cssSelectors:'',rootDomain:'',detectionInterval:0,urlRegex:'',logging:'',};this.storage={type:'cookie',name:'idl_env',expiresInDays:5,gvlid:97,};this.idObj=null;this.callback=null;this.atsLoaded=null;this.atsCallback=null;this.getIdCalled=false;this.atsCalled=false;this.excludeEid=true;}
identityLink.prototype.initialize=function(userIdData){if(userIdData.email){this.email=userIdData.email;}else if(ProperMedia.utils.deepAccess(properSpecialOps,'liveramp_email')){this.email=ProperMedia.utils.deepAccess(properSpecialOps,'liveramp_email');}else if(properStorage.getCookie('proper_lre',{moduleName:this.name,gvlid:this.storage.gvlid})){this.email=properStorage.getCookie('proper_lre',{moduleName:this.name,gvlid:this.storage.gvlid});}
if(this.email){this.config.atsEnabled=true;if(ProperMedia.utils.isBase64(this.email)){this.email=ProperMedia.utils.b64DecodeUnicode(this.email);}}
if(this.config.urlParameter&&ProperMedia.utils.deepAccess(properPage,'get_vars.'+this.config.urlParameter)){var url_email=properPage.get_vars[this.config.urlParameter];if(url_email.includes('@')){this.config.urlHashType='email';}else if(url_email.length==32){this.config.urlHashType='md5';}else if(url_email.length==40){this.config.urlHashType='sha1';}else if(url_email.length==64){this.config.urlHashType='sha256';}
if(url_email&&this.config.urlHashType&&this.config.urlHashType!='email'&&!ProperMedia.utils.deepAccess(userIdData,'emailHashes.'+this.config.urlHashType)){ProperMedia.utils.deepSetValue(userIdData,'emailHashes.'+this.config.urlHashType,url_email);}}
this.config.cssSelectors=ProperMedia.utils.isStr(this.config.cssSelectors)?this.config.cssSelectors.split(','):[];if(this.config.detectionType||this.config.urlParameter||this.config.detectionSubject||this.config.detectDynamicNodes||this.config.detectionEventType||this.config.rootDomain||this.config.detectionInterval||this.config.urlHashType||this.config.urlRegex||this.config.logging||(this.config.cssSelectors&&this.config.cssSelectors.length)){this.config.atsEnabled=true;}
if(ProperMedia.utils.deepAccess(userIdData,'emailHashes')){this.config.atsEnabled=true;this.emailHashes=ProperMedia.utils.objectValues(ProperMedia.utils.deepAccess(userIdData,'emailHashes'))||[];}else if(ProperMedia.utils.deepAccess(properSpecialOps,'liveramp_emailHashes')){this.config.atsEnabled=true;this.emailHashes=ProperMedia.utils.objectValues(ProperMedia.utils.deepAccess(properSpecialOps,'liveramp_emailHashes'))||[];}
if(this.config.atsEnabled){this.loadAtsScript();}};identityLink.prototype.runATS=function(email){this.config.atsEnabled=true;if(email){this.email=email;}
if(!this.atsLoaded){this.loadAtsScript();}else{this.atsOnLoad();}};identityLink.prototype.atsOnLoad=function(){this.atsLoaded=true;var detect_params=['detectionType','urlParameter','detectionSubject','detectDynamicNodes','detectionEventType','detectionInterval','urlHashType','urlRegex','logging',];var params={placementID:this.config.placementID,};if(this.email){params['email']=this.email.toLowerCase().trim();}else if(this.emailHashes&&this.emailHashes.length){params['emailHashes']=this.emailHashes;}else{detect_params.forEach(function(key){if(this.config[key]){params[key]=this.config[key];}},this);}
if(this.config.cssSelectors&&this.config.cssSelectors.length){params.cssSelectors=this.config.cssSelectors;}
if(this.config.rootDomain){params.rootDomain=this.config.rootDomain;}
properLog.mylog('identityLink: ATS params: '+JSON.stringify(params));window.top.ats.start(params);if(this.getIdCalled&&!this.atsCalled){this.callAts();}};identityLink.prototype.loadAtsScript=function(){var atsScript=window.top.document.createElement('script');atsScript.onload=this.atsOnLoad.bind(this);atsScript.src='https://ats.rlcdn.com/ats.js';window.top.document.body.appendChild(atsScript);};identityLink.prototype.decode=function(value){return value||undefined;};identityLink.prototype.getValue=function(){return this.idObj||undefined;};identityLink.prototype.getId=function(){this.getIdCalled=true;var resp=function(callback){this.atsCallback=callback;if(this.config.atsEnabled){this.callAts();}else{this.getEnvelope();}};return{callback:resp};};identityLink.prototype.callAts=function(){if(window.top.ats&&this.getIdCalled&&!this.atsCalled){this.atsCalled=true;properLog.mylog('identityLink: ATS exists!');window.top.ats.retrieveEnvelope(function(envelope){if(envelope){properLog.mylog('identityLink: An envelope can be retrieved from ATS!');this.setEnvelopeSource(true);this.atsCallback(ProperMedia.utils.safeJsonParse(envelope).envelope||'');}else{this.getEnvelope();}}.bind(this));}};identityLink.prototype.getEnvelope=function(){if(!properStorage.getCookie('_lr_retry_request',{moduleName:this.name,gvlid:this.storage.gvlid})){var hasGdpr=gdprConsent&&typeof gdprConsent.gdprApplies==='boolean'&&gdprConsent.gdprApplies?1:0;var gdprConsentString=hasGdpr?gdprConsent.consentString:'';var tcfPolicyV2=ProperMedia.utils.deepAccess(gdprConsent,'vendorData.tcfPolicyVersion')===2;if(hasGdpr&&(!gdprConsentString||gdprConsentString==='')){properLog.mylog('identityLink: Consent string is required to call envelope API.');return;}
var url='https://api.rlcdn.com/api/identity/envelope?pid='+
this.config.placementID+
(hasGdpr?(tcfPolicyV2?'&ct=4&cv=':'&ct=1&cv=')+gdprConsentString:'');this.setRetryCookie();properLog.mylog('identityLink: A 3P retrieval is attempted!');this.setEnvelopeSource(false);$.ajax({url:url,method:'GET',requestType:'cors',success:function(response){var responseObj;if(response){try{responseObj=ProperMedia.utils.safeJsonParse(response);}catch(error){properLog.mylog(error);}}
this.atsCallback(responseObj&&responseObj.envelope?responseObj.envelope:'');}.bind(this),error:function(error){properLog.mylog('identityLink: identityLink: ID fetch encountered an error '+JSON.stringify(error));this.atsCallback();}.bind(this),});}else{this.atsCallback();}};identityLink.prototype.setRetryCookie=function(){var now=new Date();now.setTime(now.getTime()+3600000);properStorage.setCookie('_lr_retry_request','true',now.toUTCString(),'','',{moduleName:this.name,gvlid:this.storage.gvlid});};identityLink.prototype.setEnvelopeSource=function(src){var now=new Date();now.setTime(now.getTime()+2592000000);properStorage.setCookie('_lr_env_src_ats',src,now.toUTCString(),'','',{moduleName:this.name,gvlid:this.storage.gvlid});};return identityLink;})();userIdAdapters.identityLink=new identityLinkAdapter();var pubCommonIdAdapter=(function(){var ID_NAME='_pubcid',OPTOUT_NAME='_pubcid_optout',DEFAULT_EXPIRES=365,PUB_COMMON='PublisherCommonId',EXP_SUFFIX='_exp',COOKIE='cookie',LOCAL_STORAGE='localstorage',MODULE_NAME='pubCommonId',GVLID=887;function pubCommonId(){this.name='pubcid';this.eid_name='pubcid';this.source='pubcid.org';this.atype=1;this.config={enabled:true,create:true,extend:true,};this.storage={type:LOCAL_STORAGE,name:ID_NAME,expiresInDays:DEFAULT_EXPIRES,gvlid:GVLID,};this.idObj=null;this.callback=null;}
pubCommonId.prototype.decode=function(value){return value||undefined;};pubCommonId.prototype.getValue=function(){return ProperMedia.utils.isStr(this.idObj)?this.idObj:ProperMedia.utils.deepAccess(this,'idObj.pubcid');};pubCommonId.prototype.init=function(){if(properStorage.localStorageIsEnabled({moduleName:MODULE_NAME,gvlid:GVLID})){this.storage.type=LOCAL_STORAGE;}else if(properStorage.cookiesAreEnabled({moduleName:MODULE_NAME,gvlid:GVLID})){this.storage.type=COOKIE;}else{this.storage.type=null;}
this.getId();};function setStorageItem(key,val,expires){try{if(expires!==undefined&&expires!=null){var expStr=new Date(Date.now()+expires*(60*60*24*1000)).toUTCString();properStorage.setDataInLocalStorage(key+EXP_SUFFIX,expStr,{moduleName:MODULE_NAME,gvlid:GVLID});}
properStorage.setDataInLocalStorage(key,val,{moduleName:MODULE_NAME,gvlid:GVLID});}catch(e){properLog.mylog(JSON.stringify(e));}}
function getStorageItem(key){var val=null;try{var expVal=properStorage.getDataFromLocalStorage(key+EXP_SUFFIX,{moduleName:MODULE_NAME,gvlid:GVLID});if(!expVal){val=properStorage.getDataFromLocalStorage(key,{moduleName:MODULE_NAME,gvlid:GVLID});}else{var expDate=new Date(expVal);var isValid=expDate.getTime()-Date.now()>0;if(isValid){val=properStorage.getDataFromLocalStorage(key,{moduleName:MODULE_NAME,gvlid:GVLID});}else{removeStorageItem(key);}}}catch(e){properLog.mylog(JSON.stringify(e));}
return val;}
pubCommonId.prototype.removeStorageItem=function(key){try{properStorage.removeDataFromLocalStorage(key+EXP_SUFFIX,{moduleName:MODULE_NAME,gvlid:GVLID});properStorage.removeDataFromLocalStorage(key,{moduleName:MODULE_NAME,gvlid:GVLID});}catch(e){properLog.mylog(JSON.stringify(e));}};pubCommonId.prototype.readValue=function(name,type){var value;if(!type){type=this.storage.type;}
if(type===COOKIE){value=properStorage.getCookie(name,{moduleName:MODULE_NAME,gvlid:GVLID});}else if(type===LOCAL_STORAGE){value=getStorageItem(name);}
if(value==='undefined'||value==='null'){return null;}
return value;};pubCommonId.prototype.writeValue=function(name,value,expInterval){if(name&&value){if(this.storage.type===COOKIE){var expTime=new Date();expTime.setTime(expTime.getTime()+expires*(60*60*24*1000));properStorage.setCookie(name,value,expTime.toGMTString(),'Lax','.'+properPage.root_domain,{moduleName:MODULE_NAME,gvlid:GVLID,});}else if(this.storage.type===LOCAL_STORAGE){setStorageItem(name,value,expInterval);}}};pubCommonId.prototype.getId=function(){var pubcid=null;var optout=(properStorage.cookiesAreEnabled({moduleName:MODULE_NAME,gvlid:GVLID})&&this.readValue(OPTOUT_NAME,COOKIE))||(properStorage.hasLocalStorage({moduleName:MODULE_NAME,gvlid:GVLID})&&this.readValue(OPTOUT_NAME,LOCAL_STORAGE));if(!this.storage.type||optout){return false;}
if(typeof window[PUB_COMMON]==='object'){pubcid=window[PUB_COMMON].getId();properLog.mylog(PUB_COMMON+': pubcid = '+pubcid);}else{pubcid=this.readValue(ID_NAME);if(!pubcid){if(this.storage.type==COOKIE){pubcid=this.readValue(ID_NAME,LOCAL_STORAGE);}else if(this.storage.type==LOCAL_STORAGE){pubcid=this.readValue(ID_NAME,COOKIE);}}
if(!pubcid){if(this.config.create){if(this.storage.type===LOCAL_STORAGE){pubcid=this.readValue(ID_NAME,COOKIE);}
if(!pubcid){pubcid=ProperMedia.utils.generateUUID();}
this.writeValue(ID_NAME,pubcid,this.storage.expiresInDays);pubcid=this.readValue(ID_NAME);}}else if(this.config.extend){this.writeValue(ID_NAME,pubcid,this.storage.expiresInDays);}
properLog.mylog('pubCommonId: pubcid = '+pubcid);}
this.idObj={pubcid:pubcid,};return true;};return pubCommonId;})();userIdAdapters.pubCommonId=new pubCommonIdAdapter();var fabrickIdAdapter=(function(){var ENDPOINT='https://fid.agkn.com/f?';function fabrickId(){this.name='fabrickId';this.eid_name='fabrickId';this.source='neustar.biz';this.atype=1;this.config={"enabled":false,'apiKey':null};this.storage={"type":'cookie',"name":'fabrickId',"expiresInDays":7};this.idObj=null;this.callback=null;}
fabrickId.prototype.initialize=function(userIdData){if(ProperMedia.utils.deepAccess(userIdData,'emailHashes.sha256')){this.config.e=ProperMedia.utils.deepAccess(userIdData,'emailHashes.sha256');}else if(ProperMedia.utils.deepAccess(userIdData,'emailHashes.sha1')){this.config.e=ProperMedia.utils.deepAccess(userIdData,'emailHashes.sha1');}else if(ProperMedia.utils.deepAccess(userIdData,'emailHashes.md5')){this.config.e=ProperMedia.utils.deepAccess(userIdData,'emailHashes.md5');}
if(userIdData.ipv4){this.config.i4=userIdData.ipv4;}
if(userIdData.ipv6){this.config.i6=userIdData.ipv6;}}
fabrickId.prototype.decode=function(value){return value.fabrickId||undefined;}
fabrickId.prototype.getValue=function(){return this.idObj||undefined;}
fabrickId.prototype.getId=function(cacheIdObj){try{if(!this.config.enabled){return;}
if(typeof this.config.apiKey!=='string'){properLog.mylog('fabrickId submodule requires an apiKey.');return;}
try{var url=ENDPOINT;var keysArr=Object.keys(this.config);for(var i in keysArr){var k=keysArr[i];if(k==='url'||k==='refererInfo'||k==='enabled'){continue;}
var v=this.config[k];if(Array.isArray(v)){for(var j in v){url+=k+'='+v[j]+'&';}}else{url+=k+'='+v+'&';}}
url=url.slice(0,-1)
var urls=[];url=truncateAndAppend(urls,url,'r',properPage.referer);url=truncateAndAppend(urls,url,'r',properPage.canonical_url);url=truncateAndAppend(urls,url,'r',properPage.url);var resp=function(callback){$.ajax({url:url,method:"GET",requestType:"cors",success:(function(response){var responseObj;if(response){try{responseObj=ProperMedia.utils.safeJsonParse(response);}catch(error){properLog.mylog(error);responseObj={};}}
callback(responseObj);}).bind(this),error:function(error){properLog.mylog('fabrickId fetch encountered an error',error);callback();}});};return{callback:resp};}catch(e){properLog.mylog('fabrickIdSystem encountered an error',e);}}catch(e){properLog.mylog('fabrickIdSystem encountered an error',e);}}
function truncateAndAppend(urls,url,paramName,s){if(s&&url.length<2000){if(s.length>200){s=s.substring(0,200);}
if(urls.indexOf(s)==-1){urls.push(s);return url+'&'+paramName+'='+s}}
return url;}
return fabrickId;})();userIdAdapters.fabrickId=new fabrickIdAdapter();var pubLinkAdapter=(function(){var ENDPOINT_URL='https://proc.ad.cpe.dotomi.com/cvx/client/sync/publink';function pubLink(){this.name='pubLink';this.eid_name='publinkId';this.email='';this.emailHashes={};this.source='epsilon.com';this.atype=3;this.config={"enabled":false,"siteId":null,"apiKey":null};this.storage={"type":"cookie","name":"_publink","expiresInDays":30,"gvlid":24};this.idObj=null;this.callback=null;}
pubLink.prototype.initialize=function(userIdData){this.enabled=ProperMedia.utils.deepAccess(properOps,'bidders.header.conversant.enabled')||false;if(this.enabled){this.config.siteId=ProperMedia.utils.deepAccess(properOps,'bidders.header.conversant.site_id')||0;if(userIdData.email){this.email=userIdData.email;}
if(this.email&&ProperMedia.utils.isBase64(this.email)){this.email=ProperMedia.utils.b64DecodeUnicode(this.email);}
this.emailHashes=ProperMedia.utils.deepAccess(userIdData,'emailHashes')||{};}}
pubLink.prototype.decode=function(value){return value||undefined;}
pubLink.prototype.getValue=function(){return this.idObj||undefined;}
pubLink.prototype.getId=function(){var localValue=this.getlocalValue();if(localValue){return{'id':localValue};}
if(!this.idObj){var email=this.emailHashes.md5||this.email||'';if(email&&isHex(email)&&this.config.siteId&&this.config.apiKey){var search={'deh':email,'mpn':'Prebid.js','mpv':properOps.prebid_version,};search.sid=this.config.siteId;search.apikey=this.config.apiKey;search.gdpr=(gdprConsent.gdprApplies)?1:0;search.gdpr_consent=gdprConsent.consentString;if(uspConsent.usPrivacy&&typeof uspConsent.usPrivacy==='string'){search.us_privacy=uspConsent.usPrivacy;}
var url=ENDPOINT_URL+'?'+ProperMedia.utils.formatQueryString(search);var resp=function(callback){$.ajax({url:url,method:"GET",requestType:"cors",withCredentials:true,success:(function(response){var response;if(response){try{responseObj=ProperMedia.utils.safeJsonParse(response);response=responseObj.publink;}catch(error){properLog.mylog(error);}}
callback(response);}).bind(this),error:function(error){properLog.mylog('pubLink fetch encountered an error',error);callback();}});};return{callback:resp};}else{properLog.mylog('params.e must be a hex string and requires a Site ID and API Key');}}
return;}
pubLink.prototype.getlocalValue=function(){var result;function getData(key){var value;if(properStorage.hasLocalStorage({'moduleName':this.name,'gvlid':this.storage.gvlid})){value=properStorage.getDataFromLocalStorage(key,{'moduleName':this.name,'gvlid':this.storage.gvlid});}
if(!value){value=properStorage.getCookie(key,{'moduleName':this.name,'gvlid':this.storage.gvlid});}
if(typeof value==='string'){value=decodeURIComponent(value);if(value.charAt(0)==='{'){try{var obj=ProperMedia.utils.safeJsonParse(value);if(obj){return obj.publink;}}catch(e){properLog.mylog(e);}}else{return value;}}}
result=getData.call(this,this.storage.name+'_srv');if(!result){result=getData.call(this,this.storage.name);}
return result;}
function isHex(s){return /^[A-F0-9]+$/i.test(s);}
return pubLink;})();userIdAdapters.pubLink=new pubLinkAdapter();var id5IdAdapter=(function(){var GVLID=131;var MODULE_NAME='id5Id';var NB_EXP_DAYS=30;var ID5_STORAGE_NAME='id5id';var NO_EMAIL_STORAGE_NAME=ID5_STORAGE_NAME+'_no_email';var ID5_PRIVACY_STORAGE_NAME=ID5_STORAGE_NAME+'_privacy';function id5Id(){this.name=MODULE_NAME;this.eid_name='id5id';this.source='id5-sync.com';this.email='';this.atype=1;this.config={enabled:false,partnerId:445,};this.storage={type:'localstorage',name:ID5_STORAGE_NAME,expiresInDays:90,refreshInSeconds:8*3600,gvlid:GVLID,};this.idObj=null;this.callback=null;}
id5Id.prototype.initialize=function(userIdData){if(ProperMedia.utils.deepAccess(userIdData,'emailHashes.sha256')){this.email=userIdData.emailHashes.sha256;}else if(ProperMedia.utils.deepAccess(userIdData,'emailHashes.md5')){this.email=userIdData.emailHashes.md5;}};id5Id.prototype.generatePD=function(){return this.email?ProperMedia.utils.b64EncodeUnicode('1='+this.email+(properUser.pubcid?'&5='+properUser.pubcid:'')):'';};id5Id.prototype.getValue=function(){return ProperMedia.utils.deepAccess(this,'idObj.uid');};id5Id.prototype.getUidExt=function(){if(ProperMedia.utils.deepAccess(this,'idObj.ext')){return ProperMedia.utils.deepAccess(this,'idObj.ext');}};id5Id.prototype.decode=function(value){var universalUid;var linkType=0;if(value&&typeof value.universal_uid==='string'){universalUid=value.universal_uid;linkType=value.link_type||linkType;}else{linkType=undefined;}
var responseObj={uid:universalUid,ext:{linkType:linkType,},};return responseObj;};id5Id.prototype.getId=function(cacheIdObj){var url='https://id5-sync.com/g/v2/'+this.config.partnerId+'.json';var hasGdpr=gdprConsent&&typeof gdprConsent.gdprApplies==='boolean'&&gdprConsent.gdprApplies?1:0;var us_privacy=uspConsent.usPrivacy?uspConsent.usPrivacy:'';var signature=cacheIdObj&&cacheIdObj.signature?cacheIdObj.signature:'';var data={gdpr:hasGdpr,gdpr_consent:hasGdpr?gdprConsent.consentString:'',partner:this.config.partnerId,nbPage:incrementNb(this.config.partnerId),o:'api',pd:this.generatePD(),provider:'',tml:properPage.url,ref:properPage.referrer,cu:properPage.canonical_url,s:signature,top:1,u:properPage.url,us_privacy:us_privacy,v:properOps.prebid_version,storage:{type:this.storage.type=='localstorage'?'html5':this.storage,name:this.storage.name,expires:this.storage.expiresInDays,refreshInSeconds:this.storage.refreshInSeconds,},localstorage:properStorage.localStorageIsEnabled({moduleName:MODULE_NAME,gvlid:GVLID}),};var resp=function(callback){$.ajax({url:url,method:'POST',requestType:'cors',data:JSON.stringify(data),success:function(response){var responseObj;if(response){try{responseObj=ProperMedia.utils.safeJsonParse(response);resetNb(this.config.partnerId);if(!this.email){storeInLocalStorage(NO_EMAIL_STORAGE_NAME,1,NB_EXP_DAYS);}else if(getFromLocalStorage(NO_EMAIL_STORAGE_NAME)){properStorage.removeDataFromLocalStorage(NO_EMAIL_STORAGE_NAME,{moduleName:MODULE_NAME,gvlid:GVLID});properStorage.removeDataFromLocalStorage(NO_EMAIL_STORAGE_NAME+'_exp',{moduleName:MODULE_NAME,gvlid:GVLID});}
if(responseObj.privacy){storeInLocalStorage(ID5_PRIVACY_STORAGE_NAME,JSON.stringify(responseObj.privacy),NB_EXP_DAYS);}}catch(error){properLog.mylog(error);}}
callback(responseObj);}.bind(this),error:function(error){properLog.mylog('UserID - ID5 submodule getId fetch encountered an error: '+JSON.stringify(error));callback();},});};return{callback:resp};};id5Id.prototype.extendId=function(cacheIdObj){if(this.email&&getFromLocalStorage(NO_EMAIL_STORAGE_NAME)){return this.getId(cacheIdObj);}
var partnerId=this.config.partnerId||0;incrementNb(partnerId);return cacheIdObj;};function expDaysStr(expDays){return new Date(Date.now()+1000*60*60*24*expDays).toUTCString();}
function nbCacheName(partnerId){return ID5_STORAGE_NAME+'_'+partnerId+'_nb';}
function storeNbInCache(partnerId,nb){storeInLocalStorage(nbCacheName(partnerId),nb,NB_EXP_DAYS);}
function getNbFromCache(partnerId){var cacheNb=getFromLocalStorage(nbCacheName(partnerId));return cacheNb?parseInt(cacheNb):0;}
function incrementNb(partnerId){var nb=getNbFromCache(partnerId)+1;storeNbInCache(partnerId,nb);return nb;}
function resetNb(partnerId){storeNbInCache(partnerId,0);}
function getFromLocalStorage(key){var storedValueExp=properStorage.getDataFromLocalStorage(key+'_exp',{moduleName:MODULE_NAME,gvlid:GVLID});if(storedValueExp===''){return properStorage.getDataFromLocalStorage(key,{moduleName:MODULE_NAME,gvlid:GVLID});}else if(storedValueExp){if(new Date(storedValueExp).getTime()-Date.now()>0){return properStorage.getDataFromLocalStorage(key,{moduleName:MODULE_NAME,gvlid:GVLID});}}
properStorage.removeDataFromLocalStorage(key,{moduleName:MODULE_NAME,gvlid:GVLID});return null;}
function storeInLocalStorage(key,value,expDays){properStorage.setDataInLocalStorage(key+'_exp',expDaysStr(expDays),{moduleName:MODULE_NAME,gvlid:GVLID});properStorage.setDataInLocalStorage(key,value,{moduleName:MODULE_NAME,gvlid:GVLID});}
return id5Id;})();userIdAdapters.id5Id=new id5IdAdapter();audiencePixels.controller=(function(){var networks={};function init(configObj,configObj2){var config=ProperMedia.utils.mergeObject({},configObj);if(config.networks&&Object.keys(config.networks).length){Object.keys(config.networks).forEach(function(network){if(ProperMedia.utils.deepAccess(config,'networks.'+network+'.enabled')&&ProperMedia.utils.deepAccess(audiencePixels,'networks.'+network)){networks[network]=audiencePixels.networks[network];networks[network].setConfig(config.networks[network]);networks[network].init();}});}
audiencePixels.audience_pixels.init(configObj2)}
function newPageview(){if(Object.keys(networks).length){Object.keys(networks).forEach(function(network){if(ProperMedia.utils.deepAccess(networks,network+'.newPageview')){networks[network].newPageview();}});}}
function checkThresholds(){if(Object.keys(networks).length){Object.keys(networks).forEach(function(network){networks[network].checkThresholds();});}
audiencePixels.audience_pixels.checkThresholds();}
return{"init":init,"newPageview":newPageview,"checkThresholds":checkThresholds};})();audiencePixels.audience_pixels=(function(){var config={enabled:false,thresholds:[]};function init(configObj){config=ProperMedia.utils.mergeObject(config,configObj);}
function checkThresholds(){var last_threshold_price=ProperMedia.utils.deepAccess(properSession,'sessionData.last_threshold')||0;var threshold={'price':0,'pixel':''}
config.thresholds.map(function(obj){if(obj.price>threshold.price&&obj.price>last_threshold_price&&obj.price<properSession.sessionData.revenue){threshold=obj;}});if(threshold.price){placePixel(threshold)}}
function placePixel(threshold){if(config.enabled&&threshold.pixel){var id="audience-pixel-"+threshold.price.toString();if(!document.getElementById(id)){properLog.mylog("Place audience pixel: "+threshold.price);var iframe=document.createElement('iframe');iframe.id=id;iframe.width='0px';iframe.height='0px';iframe.style.display='none';document.getElementsByTagName('body')[0].appendChild(iframe);iframe.contentWindow.document.open();iframe.contentWindow.document.write(threshold.pixel.toString());iframe.contentWindow.document.close();ProperMedia.utils.deepSetValue(properSession,'sessionData.last_threshold',threshold.price);properSession.setSessionData();}}}
return{"init":init,"checkThresholds":checkThresholds};})();audiencePixels.networks.taboola=(function(){var ID=0;var lastThreshold=0;var config={enabled:false,disable_init_code:false,configId:'',range:{},};function setConfig(configObj){config=ProperMedia.utils.mergeObject(config,configObj);}
function init(){if(config.disable_init_code)return;try{ID=config.configId||'';properLog.mylog('audiencePixels: Taboola Init: '+ID);if(ID){window.top._tfa=window.top._tfa||[];!(function(t,f,a,x){if(!document.getElementById(x)){t.async=1;t.src=a;t.id=x;f.parentNode.insertBefore(t,f);}})(document.createElement('script'),document.getElementsByTagName('script')[0],'//cdn.taboola.com/libtrc/unip/'+ID+'/tfa.js','tb_tfa_script');window.top.fireTaboolaPixel=function(name){window.top._tfa.push({notify:'event',name:name,id:ID});};}}catch(e){console.error(e);}}
function checkThresholds(){var price=parseFloat(Math.floor(properSession.sessionData.revenue*100)/100);if(lastThreshold<price&&config.range[price]){placePixel(price);}}
function placePixel(price){try{lastThreshold=price;var key='rps_'+parseInt(price*100);properLog.mylog('audiencePixels: Taboola pixel: '+price+' '+key);window.top.fireTaboolaPixel(config.range[price]);}catch(e){console.error(e);}}
return{checkThresholds:checkThresholds,setConfig:setConfig,init:init,};})();audiencePixels.networks.outbrain=(function(){var lastThreshold=0;var config={enabled:false,disable_init_code:false,configId:'',range:{},};function setConfig(configObj){config=ProperMedia.utils.mergeObject(config,configObj);}
function init(){if(config.disable_init_code)return;try{!(function(_window,_document){var OB_ADV_IDS=(config.configId||'').replace(/\s+/,'').split(',');properLog.mylog('audiencePixels: Outbrain Init: '+JSON.stringify(config.ids));if(_window.obApi){var toArray=function(object){return Object.prototype.toString.call(object)==='[object Array]'?object:[object];};_window.obApi.marketerId=toArray(_window.obApi.marketerId).concat(toArray(OB_ADV_IDS));return;}
var api=(_window.obApi=function(){api.dispatch?api.dispatch.apply(api,arguments):api.queue.push(arguments);});api.version='1.1';api.loaded=true;api.marketerId=OB_ADV_IDS;api.queue=[];var tag=document.createElement('script');tag.async=true;tag.src='//amplify.outbrain.com/cp/obtp.js';tag.type='text/javascript';var script=document.getElementsByTagName('script')[0];script.parentNode.insertBefore(tag,script);})(window.top,document);}catch(e){console.error(e);}}
function checkThresholds(){var price=parseFloat(Math.floor(properSession.sessionData.revenue*100)/100);if(lastThreshold<price&&config.range[price]){placePixel(price);}}
function placePixel(price){try{lastThreshold=price;properLog.mylog('audiencePixels: Outbrain pixel: '+price+' '+config.range[price]);window.top.obApi('track',config.range[price]);}catch(e){console.error(e);}}
return{checkThresholds:checkThresholds,setConfig:setConfig,init:init,};})();audiencePixels.networks.facebook=(function(){var lastThreshold=0;var config={"enabled":false,"disable_init_code":false,"ids":[],"range":{"min":0.01,"max":0.22,"exceptions":[]},"pageview":{"enabled":false,"everyPage":false}}
function setConfig(configObj){config=ProperMedia.utils.mergeObject(config,configObj);}
function init(){if(config.disable_init_code)return;try{!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js');fbq('dataProcessingOptions',['LDU'],0,0);if(config.ids.length){for(var i=0;i<config.ids.length;i++){properLog.mylog("audiencePixels: Facebook Init: "+config.ids[i]);window.top.fbq('init',config.ids[i]);}}}catch(e){console.error(e);}}
function newPageview(){try{if(config.pageview.enabled&&(config.pageview.everyPage||properSession.sessionData.depth<=1)){properLog.mylog("audiencePixels: Facebook newPageview");window.top.fbq('track','PageView');}}catch(e){console.error(e);}}
function checkThresholds(){var price=parseFloat(Math.floor(properSession.sessionData.revenue*100)/100);if(lastThreshold<price&&config.range.min<=price&&config.range.max>=price&&config.range.exceptions.indexOf(price)==-1){placePixel(price);}}
function placePixel(price){try{lastThreshold=price;properLog.mylog("audiencePixels: Facebook pixel: "+price);window.top.fbq('trackCustom',price.toString(),{"value":parseFloat(price),"currency":'USD'});}catch(e){console.error(e);}}
return{"checkThresholds":checkThresholds,"newPageview":newPageview,"setConfig":setConfig,"init":init};})();audiencePixels.networks.google=(function(){var lastThreshold=0;var config={"enabled":false,"disable_init_code":false,"configId":'',"range":{}}
function setConfig(configObj){config=ProperMedia.utils.mergeObject(config,configObj);}
function init(){if(config.disable_init_code)return;try{var configIds=config.configId.split(",");properLog.mylog("audiencePixels: Google Init");const sourceDiv=document.createElement('script');sourceDiv.src="https://www.googletagmanager.com/gtag/js";sourceDiv.setAttribute('async','');window.top.document.getElementsByTagName('body')[0].prepend(sourceDiv);window.top.dataLayer=window.top.dataLayer||[];window.top.gtag=function(){window.top.dataLayer.push(arguments);}
window.top.gtag('js',new Date());for(var x=0;x<configIds.length;x++){properLog.mylog("audiencePixels: Google config: "+configIds[x]);window.top.gtag('config',configIds[x]);}}catch(e){console.error(e);}}
function checkThresholds(){var price=parseFloat(Math.floor(properSession.sessionData.revenue*100)/100);if(lastThreshold<price&&config.range[price]){placePixel(price);}}
function placePixel(price){try{lastThreshold=price;properLog.mylog("audiencePixels: Google pixel: "+price+" "+config.configId+" "+config.range[price]);window.top.gtag('event','conversion',{'send_to':config.range[price]});}catch(e){console.error(e);}}
return{"checkThresholds":checkThresholds,"setConfig":setConfig,"init":init};})();audiencePixels.networks.twitter=(function(){var lastThreshold=0;var config={"enabled":false,"disable_init_code":false,"range":{}}
function setConfig(configObj){config=ProperMedia.utils.mergeObject(config,configObj);}
function init(){if(config.disable_init_code)return;try{properLog.mylog("audiencePixels: Twitter Init");!function(){var twitterTag=document.createElement('script');twitterTag.async=true;twitterTag.src='//platform.twitter.com/oct.js';twitterTag.type='text/javascript';var script=document.getElementsByTagName('script')[0];script.parentNode.insertBefore(twitterTag,script);}()}catch(e){console.error(e);}}
function checkThresholds(){var price=parseFloat(Math.floor(properSession.sessionData.revenue*100)/100);if(lastThreshold<price&&config.range.min<=price&&config.range.max>=price&&config.range.exceptions.indexOf(price)==-1){placePixel(price);}}
function placePixel(price){try{lastThreshold=price;properLog.mylog("audiencePixels: Twitter pixel: "+price+" "+config.range[price]);twttr.conversion.trackPid(config.range[price],{"tw_sale_amount":price});}catch(e){console.error(e);}}
return{"checkThresholds":checkThresholds,"setConfig":setConfig,"init":init};})();bidAdapters.a9=(function(){var bidderInfo={rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:120000,auto_gen_sizes:['160x600','300x250','300x600','320x50','728x90','970x250'],gvlid:793,};var bidder='a9';var amazon_queue=[],amazon_ready=0,amazon_iframe=0,amazon_loading=0,amazon_crid_map={};var amazon_window=window.top;var ENDPOINT_URL='https://aax.amazon-adsystem.com/e/dtb/bid';var OUT_OUT_COOKIE='pub_audiences_opt_out';var amzn_bidder_map={display:{fiuark:'a9','1777sow':'adgeneration_tam',c4h9ts:'beachfront_tam',tvrabk:'conversant_tam','6kpe68':'districtm_tam',pfxs74:'districtmdmx_tam','1bn1atc':'gumgum_tam',rnuj9c:'index_tam',pzwyyo:'mediagrid_tam','1rqdr0g':'medianet_tam','7onrpc':'oath_tam',fgcef4:'openx_tam',s7tq0w:'onetag_tam','1lmmolc':'pubmatic_tam',obzeo0:'pulsepoint_tam',bki328:'risecodes_tam',x7meww:'rubicon_tam',l04a2o:'rhythmone_tam','1ye4074':'sharethrough_tam',jw5wjk:'smaato_tam',b0iwao:'sovrn_tam','11nfx1c':'triplelift_tam','1eywfeo':'xandr_tam',n8114w:'yahoo_tam','1oyht6o':'yieldmo_tam',},video:{instream:{'5gr0n4':'adobe_tam_instream',fiuark:'amazon_tam_instream','1r6ek8w':'amobee_tam_instream','1777sow':'adgeneration_tam_instream',c4h9ts:'beachfront_tam_instream','19f4jr4':'conversant_uam_instream',tvrabk:'conversant_tam_instream',pfxs74:'dmx_tam_instream','6kpe68':'districtm_tam_instream','1bn1atc':'gumgum_tam_instream','1mql24g':'gumgum_uam_instream',rnuj9c:'index_tam_instream',x7meww:'magnite_tam_instream',pzwyyo:'mediagrid_tam_instream','1rqdr0g':'medianet_tam_instream',fgcef4:'openx_tam_instream',s7tq0w:'onetag_tam_instream','1lmmolc':'pubmatic_tam_instream',obzeo0:'pulsepoint_tam_instream',bki328:'risecodes_tam_instream','1ye4074':'sharethrough_tam_instream',l04a2o:'unruly_tam_instream',jw5wjk:'smaato_tam_instream',b0iwao:'sovrn_tam_instream','11nfx1c':'triplelift_tam_instream','7onrpc':'verizon_media_tam_instream',n8114w:'verizon_media_tam_instream','1eywfeo':'xandr_tam_instream','1tebbb4':'yahoo_tam_instream','1oyht6o':'yieldmo_tam_instream',},outstream:{'5gr0n4':'adobe_tam_outstream',fiuark:'amazon_tam_outstream','1r6ek8w':'amobee_tam_outstream','1777sow':'adgeneration_tam_outstream',c4h9ts:'beachfront_tam_outstream','19f4jr4':'conversant_uam_outstream',tvrabk:'conversant_tam_outstream',pfxs74:'dmx_tam_outstream','6kpe68':'districtm_tam_outstream','1bn1atc':'gumgum_tam_outstream','1mql24g':'gumgum_uam_outstream',rnuj9c:'index_tam_outstream',x7meww:'magnite_tam_outstream',pzwyyo:'mediagrid_tam_outstream','1rqdr0g':'medianet_tam_outstream',fgcef4:'openx_tam_outstream',s7tq0w:'onetag_tam_outstream','1lmmolc':'pubmatic_tam_outstream',obzeo0:'pulsepoint_tam_outstream','1ye4074':'sharethrough_tam_outstream',l04a2o:'unruly_tam_outstream',bki328:'risecodes_tam_outstream',jw5wjk:'smaato_tam_outstream',b0iwao:'sovrn_tam_outstream','11nfx1c':'triplelift_tam_outstream','7onrpc':'verizon_media_tam_outstream',n8114w:'verizon_media_tam_outstream','1eywfeo':'xandr_tam_outstream','1tebbb4':'yahoo_tam_outstream','1oyht6o':'yieldmo_tam_outstream',},},};var amzn_ttl_map={sovrn_tam:90000,};var pub_id='cb3b5777-430d-4622-b7fc-358cfa27d518';var alias_pub_id='748e627c-0eaa-42c2-9e73-69aef798751c';function formatRequest(bidData,bidder,bidderInfo){var requestData={slots:{},data_map:{},request_cnt:0,bidderInfo:bidderInfo,};if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){for(var i=0;i<data[size].length;i++){var tag_id=data[size][i];var slot_id=bidderInfo.demand_type=='video'?tag_id.split('-')[0]:tag_id;if(typeof requestData['slots'][tag_id]=='undefined'){requestData['slots'][tag_id]={slotID:slot_id,};if(bidderInfo.demand_type=='video'){requestData['slots'][tag_id].mediaType='video';}else{requestData['slots'][tag_id].sizes=[];}
requestData['slots'][tag_id]['floor']={value:0,currency:'USD',};requestData['data_map'][slot_id]={slot_name:slot_name||'',tag_sizes:[],floor:0,};}
if(bidderInfo.demand_type=='display'){requestData['slots'][tag_id].sizes.push(size.split('x').map(function(s){return parseInt(s);}));}
var floor=parseInt(getBidderFloor(bidder,size)*100);if(!requestData['slots'][tag_id]['floor']['value']||floor<requestData['slots'][tag_id]['floor']['value']){requestData['slots'][tag_id]['floor']['value']=floor;ProperMedia.utils.deepSetValue(requestData,'data_map.'+slot_id+'.floor',floor/100);}
requestData['data_map'][slot_id]['tag_sizes'].push(size);requestData['request_cnt']++;}});}}
return requestData;}
function send(bidData){if(properPage.isolated){properLog.mylog('Turn off Amazon bidder for isolated pages');return true;}
var bidder=bidData.bidder;var bidderInfo=properOps.bidder_info[bidder]||bidderInfo;bidderInfo.bidder=bidder;pub_id=bidderInfo.alias?alias_pub_id:pub_id;if(ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.account_overrides.enabled')){pub_id=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.account_overrides.bidder_ids.pub_id')||pub_id;}
var requestData=formatRequest(bidData,bidder,bidderInfo);requestData.bidData=bidData;if(amazon_ready==1){a9Payload(requestData);}else{amazon_queue.push(requestData);if(amazon_iframe==0&&properOps.dfp_per_slot==1){createA9Iframe();}else if(amazon_loading==0){loadA9();}}}
function loadA9(){if(properPage.isolated||amazon_loading==1||amazon_ready==1)return;if(amazon_iframe==0&&properOps.dfp_per_slot==1){createA9Iframe();return;}
amazon_loading=1;!(function(a9,a,p,s,t,A,g){if(a[a9])return;function q(c,r){a[a9]._Q.push([c,r]);}
a[a9]={init:function(){q('i',arguments);},fetchBids:function(){q('f',arguments);},setDisplayBids:function(){},targetingKeys:function(){return[];},deleteId:function(){q('di',arguments);},renewId:function(){q('ri',arguments);},updateId:function(){q('ui',arguments);},_Q:[],};link1=p.createElement('link');link1.rel='dns-prefetch';link1.href='https://c.amazon-adsystem.com';link2=p.createElement('link');link2.rel='preconnect';link2.href='https://c.amazon-adsystem.com';var att=p.createAttribute('crossorigin');link2.setAttributeNode(att);var r=false;A=p.createElement(s);A.async=1;A.src=t;A.addEventListener('load',TraceKit.wrap(function(){try{var initParams={pubID:pub_id,params:{},bidTimeout:350,};if(!ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.account_overrides.enabled')||ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.account_overrides.deals')){initParams.deals=true;}
var schain=schainCheck(bidder);if(schain!='')initParams.schain=schain;if(gdprConsent.gdprApplies){initParams['gdpr']={enabled:!!gdprConsent.gdprApplies,consent:gdprConsent.consentString||'',};}
if(uspConsent.usPrivacy){initParams.us_privacy=uspConsent.usPrivacy;}
if(properPage.video_enabled){initParams.videoAdServer='DFP';}
a.apstag.init(initParams);var apstagBidsFunc=a.apstag.bids;a.apstag.bids=function(obj){apstagBidsFunc(obj);if(obj.slots&&obj.slots.length){for(var i=0;i<obj.slots.length;i++){var slot=obj.slots[i];if(slot.amzniid&&slot.crid){amazon_crid_map[slot.amzniid]=slot.crid;}
if(slot.amzniid_sp&&slot.crid){amazon_crid_map[slot.amzniid_sp]=slot.crid;}}}}.bind(a.apstag);var params=getPubAudiencesParams();if(params['hashedRecords']&&params['hashedRecords'].length){a.apstag.renewId(params,function(){properLog.mylog('Amazon: Publisher Audience ID Renewed. params: '+JSON.stringify(params));});}
amazon_ready=1;if(amazon_queue.length){for(var i=0;i<amazon_queue.length;i++){a9Payload(amazon_queue[i]);}}
amazon_queue=[];}catch(e){e.bidder=bidder;throw e;}}));g=p.getElementsByTagName('head')[0];g.appendChild(link1);g.appendChild(link2);g.appendChild(A);})('apstag',amazon_window,amazon_window.document,'script','https://c.amazon-adsystem.com/aax2/apstag.js');}
function a9Payload(data){if(typeof ProperMedia.utils.deepAccess(amazon_window,'apstag.debug')=='function'){if(properOps.testing_mode.ids==true){amazon_window.apstag.debug('enable');}else{amazon_window.apstag.debug('disable');}}
var bidData=data['bidData']||{};var request_cnt=data['request_cnt']||0;var slots=ProperMedia.utils.objectValues(data['slots'])||[];var data_map=data['data_map']||{};if(slots.length==0&&request_cnt>0){properLog.mylog('Amazon: No slots defined');return false;}
properLog.mylog('Amazon bids sent',data.bidderInfo.bidder);bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var astcallback=function(bids){try{properLog.mylog('Amazon bids returned: '+bids.length);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);let ad_types=['','sp'];for(var key=0;key<bids.length;key++){var bid=bids[key];for(let i in ad_types){let ad_type=ad_types[i];let{amzniid,amznbid,amznp,dealid,size}=getTargeting(bid,ad_type);var mapped_bidder=data.bidderInfo.bidder,encodedQsParams=ProperMedia.utils.deepAccess(bid,'helpers.encodedQsParams')||bid.encodedQsParams||'',qsParams=ProperMedia.utils.deepAccess(bid,'helpers.qsParams')||bid.qsParams||'',crid=amazon_crid_map[amzniid]||'';if(!amznbid)continue;var price=0;if(properOps.testing_mode.ids==1){price='testBid';}else if(amznbid){price=amznbid;}
if(properSpecialOps.AMZN_BIDDER_KEYS||(properOps.aaba30b&&properOps.amazon_advertiser)){var bidder_map=properOps.aaba30b?ProperMedia.utils.safeJsonParse(ProperMedia.utils.b64DecodeUnicode(properOps.aaba30b)):ProperMedia.utils.safeJsonParse(ProperMedia.utils.b64DecodeUnicode(properSpecialOps.AMZN_BIDDER_KEYS));if(bidder_map[amznp]){mapped_bidder=bidder_map[amznp];if(ProperMedia.utils.deepAccess(data,'bidderInfo.demand_type')=='video'){mapped_bidder+='_'+ProperMedia.utils.deepAccess(data,'bidderInfo.video_type');}}}else{mapped_bidder=(ProperMedia.utils.deepAccess(data,'bidderInfo.demand_type')=='video'?ProperMedia.utils.deepAccess(amzn_bidder_map,data.bidderInfo.demand_type+'.'+data.bidderInfo.video_type+'.'+amznp):ProperMedia.utils.deepAccess(amzn_bidder_map,data.bidderInfo.demand_type+'.'+amznp))||data.bidderInfo.bidder;}
if(amazon_crid_map[amzniid]){delete amazon_crid_map[amzniid];}
var ttl=bid.ttl||amzn_ttl_map[mapped_bidder]||ProperMedia.utils.deepAccess(data,'bidderInfo.default_bid_ttl');var ad_details={encodedQsParams:encodedQsParams,qsParams:qsParams,amznp:amznp,amznbid:amznbid,amzniid:amzniid,};let ad=new adObj({bidder:mapped_bidder,price:price,gross:price,size:size,tag_id:bid.slotID,dealid:dealid,crid:crid,request_url:ENDPOINT_URL,response:bid,response_ms:bid_response_ms,received_ts:bids_received_ts,ad_details:ad_details,ttl:ttl,floor:ProperMedia.utils.deepAccess(data_map,bid.slotID+'.floor')||0,target_slot:ProperMedia.utils.deepAccess(data_map,bid.slotID+'.slot_name')||'',});let creative_prefix=ad_type?ad_type+'|':'';if(ProperMedia.utils.deepAccess(data,'bidderInfo.demand_type')=='video'){if(!size||['400x300','640x480'].indexOf(size)==-1){if(ProperMedia.utils.deepAccess(data_map,bid.slotID+'.tag_sizes.0')&&['400x300','640x480'].indexOf(ProperMedia.utils.deepAccess(data_map,bid.slotID+'.tag_sizes.0'))!==-1){size=ProperMedia.utils.deepAccess(data_map,bid.slotID+'.tag_sizes.0');}else if(bid.slotID&&bid.slotID.match(/_\d+x\d+$/)){var matches=bid.slotID.match(/_(\d+x\d+)$/);if(matches.length>1&&['400x300','640x480'].indexOf(match[1])!==-1){size=matches[1];}}
if(!size){size=properDevice.isMobile()?['400x300']:['640x480'];}}
ad.type='video';ad.vast_type='url';ad.vast_tag='https://aax.amazon-adsystem.com/e/dtb/vast?b='+
creative_prefix+
amzniid+
'&pp='+
amznbid+
'&rnd='+
Math.round(new Date().getTime())+
'&cust_params='+
qsParams;ad.vpaid=false;ad.video_type=ProperMedia.utils.deepAccess(data,'bidderInfo.video_type');ad.size=size;}else{ad.type='display';if(amazon_iframe==1&&properOps.dfp_per_slot==1){ad.adcode='<script>try {var amazon_ifr = window.top.document.getElementById("proper-a9-auction-iframe");if(amazon_ifr) {var amzn_win = amazon_ifr.contentWindow;if(amzn_win && amzn_win.apstag) {window.apstag = amzn_win.apstag;window.apstag.renderImp(document,"'+
creative_prefix+
amzniid+
'");}}} catch(e) {console.error(e);}</script>';}else{ad.adcode='<script>var amzn_win=window,amzn_c=5,amzn_x=0;while(amzn_x<amzn_c){amzn_win=amzn_win.parent;if(amzn_win.apstag)try{amzn_win.apstag.renderImp(document,"'+
creative_prefix+
amzniid+
'");amzn_x=amzn_c}catch(e){}amzn_x++};</script>';}}
bidData.logBidResponse(ad);}}
bidData.incrementBidResponseCount(request_cnt);}catch(e){e.bidder=data.bidderInfo.bidder;throw e;}};if(typeof TraceKit!=='undefined'){TraceKit.wrap(astcallback);}
if(typeof ProperMedia.utils.deepAccess(amazon_window,'apstag.fetchBids')=='function'){amazon_window.apstag.fetchBids({slots:slots,timeout:properOps.tmax,},astcallback);}}
function createA9Iframe(){try{var ifr=document.createElement('iframe');ifr.id='proper-a9-auction-iframe';ifr.frameborder='0';ifr.allowtransparency='true';ifr.marginheight='0';ifr.marginwidth='0';ifr.width='0';ifr.hspace='0';ifr.vspace='0';ifr.height='0';ifr.scrolling='no';ifr.style.display='none';ifr.style.width='0';ifr.style.height='0';ifr.sandbox='allow-scripts allow-same-origin';ifr.onload=function(){amazon_window=ifr.contentWindow;amazon_iframe=1;amazon_window.__tcfapi=window.top.__tcfapi;if(amazon_loading==0)loadA9();};document.getElementsByTagName('body')[0].appendChild(ifr);}catch(e){amazon_window=window;console.error(e);}}
function getTargeting(bid,ad_type){let key_suffix=ad_type?'_'+ad_type:'';let amzniid=ProperMedia.utils.deepAccess(bid,`targeting.amzniid${key_suffix}`)||ProperMedia.utils.deepAccess(bid,`amzniid${key_suffix}`)||'';let amznbid=ProperMedia.utils.deepAccess(bid,`targeting.amznbid${key_suffix}`)||ProperMedia.utils.deepAccess(bid,`amznbid${key_suffix}`)||'';let amznp=ProperMedia.utils.deepAccess(bid,`targeting.amznp${key_suffix}`)||ProperMedia.utils.deepAccess(bid,`amznp${key_suffix}`)||'fiuark';let dealid=ProperMedia.utils.deepAccess(bid,`targeting.amzndeal${key_suffix}`)||ProperMedia.utils.deepAccess(bid,`amzndeal${key_suffix}`)||'';let size=ProperMedia.utils.deepAccess(bid,`targeting.amznsz${key_suffix}`)||ProperMedia.utils.deepAccess(bid,`amznsz${key_suffix}`)||'';return{amzniid,amznbid,amznp,dealid,size,};}
function getPubAudiencesParams(){var params={};var userIdData=userIds.getUserIdData();if(ProperMedia.utils.deepAccess(userIdData,'emailHashes.sha256')){params={hashedRecords:[{type:'email',record:ProperMedia.utils.deepAccess(userIdData,'emailHashes.sha256'),},],};}
if(gdprConsent.gdprApplies){params['gdpr']={enabled:!!gdprConsent.gdprApplies,consent:gdprConsent.consentString,};}
if(properStorage.getCookie(OUT_OUT_COOKIE,{moduleType:'core'})!==undefined){params['optOut']=!!properStorage.getCookie(OUT_OUT_COOKIE,{moduleType:'core'});}
return params;}
function updateOptOut(optOut){if(optOut){properStorage.setCookie(OUT_OUT_COOKIE,true,1209600,'Lax','',{moduleType:'core'});}else{ProperMedia.utils.deleteCookie(OUT_OUT_COOKIE,'Lax','',{moduleType:'core'});}
if(typeof ProperMedia.utils.deepAccess(amazon_window,'apstag.updateId')=='function'){var params=getPubAudiencesParams();params['optOut']=optOut;amazon_window.apstag.updateId(params,function(){properLog.mylog('Amazon: Publisher Audience ID Updated. params: '+JSON.stringify(params));});}}
return{send:send,bidderInfo:bidderInfo,updateOptOut:updateOptOut,formatRequest:formatRequest,loadInitScripts:loadA9,};})();bidAdapters.adagio=(function(){var bidderInfo={rev_share:1,demand_type:'display',bid_grouping:'page',div_insertion:1,default_bid_ttl:30000,gvlid:617,};var ENDPOINT_URL='https://mp.4dex.io/prebid',bidder='adagio';var ADAGIO_TAG_URL='https://script.4dex.io/localstore.js',ADAGIO_LOCALSTORAGE_KEY='adagioScript',MAX_SESS_DURATION=30*60*1000,ADAGIO_PUBKEY='AL16XT44Sfp+8SHVF1UdC7hydPSMVLMhsYknKDdwqq+0ToDSJrP0+Qh0ki9JJI2uYm/6VEYo8TJED9WfMkiJ4vf02CW3RvSWwc35bif2SK1L8Nn/GfFYr/2/GG/Rm0vUsv+vBHky6nuuYls20Og0HDhMgaOlXoQ/cxMuiy5QSktp',ADAGIO_PUBKEY_E=65537,GVLID=bidderInfo.gvlid;var FEATURES_VERSION='1',organizationId=1003,siteId=null;var adagio_script_loaded=false;var storageEnfObj={};function parseSize(size){var s=size.split('x');return{w:parseInt(s[0]),h:parseInt(s[1]),};}
function formatRequest(bidData,bidder,bidderInfo){var requestData={imps:{},data_map:{},request_cnt:0,};if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
var auctionId=bidderInfo.auctionId;function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){for(var i=0;i<data[size].length;i++){var tag_id=data[size][i];if(typeof requestData['imps'][tag_id]=='undefined'){var tagid=tag_id.split('-')[0]||tag_id;var div_id='adagio-'+ProperMedia.utils.generateUUID();var features={page_dimensions:getPageDimensions().toString(),viewport_dimensions:getViewPortDimensions().toString(),user_timestamp:getTimestampUTC().toString(),dom_loading:getDomLoadingDuration().toString(),print_number:(i+1).toString(),adunit_position:'',};Object.keys(features).forEach(function(prop){if(features[prop]===''){delete features[prop];}});requestData['imps'][tag_id]={bidId:tag_id,auctionId:auctionId,bidderRequestId:ProperMedia.utils.generateUUID(),adUnitCode:div_id,mediaTypes:{},bidder:'adagio',params:{site:siteId,placement:tagid,adUnitElementId:div_id,organizationId:organizationId.toString(),},features:features,floors:[],};internal.enqueue({action:'features',ts:Date.now(),data:{features:features,params:requestData['imps'][tag_id]['params'],adUnitCode:requestData['imps'][tag_id]['adUnitCode'],},});if(bidderInfo.demand_type=='display'){requestData['imps'][tag_id]['mediaTypes']['banner']={sizes:[],};}else if(bidderInfo.demand_type=='video'){var playerSize=parseSize(size);requestData['imps'][tag_id]['mediaTypes']['video']={context:bidderInfo.video_type,mimes:['video/mp4','application/javascript'],w:playerSize.w,h:playerSize.h,maxduration:30,minduration:10,api:[2],delivery:6,pos:0,playbackmethod:6,placement:bidderInfo.video_type=='outstream'?3:1,linearity:bidderInfo.video_type=='outstream'?2:1,protocols:[2,3,5,6],startdelay:0,skip:0,};_buildVideoBidRequest(bidRequest);}else if(bidderInfo.demand_type=='native'){requestData['imps'][tag_id]['mediaTypes']['ntaive']={main_image:{required:true,sizes:[],},icon:{required:true,sizes:[{width:50,height:50,},],},clickUrl:{required:true,},title:{required:true,len:80,},sponsored_by:{required:true,},ctatext:{required:false,},};}
if(properOps.testing_mode.ids==1){requestData['imps'][tag_id]['params']['debug']={enabled:true,cpm:3.0,};}
requestData['data_map'][tag_id]={floors:{},div_id:div_id,slot_name:slot_name||'',};}
if(bidderInfo.demand_type=='display'){var s=parseSize(size);requestData['imps'][tag_id]['mediaTypes']['banner']['sizes'].push([s['w'],s['h']]);}
var floor=getBidderFloor(bidder,size);requestData['imps'][tag_id]['floors'].push({mt:bidderInfo.demand_type,s:size,f:floor,});requestData['data_map'][tag_id]['floors'][size]=floor;requestData['request_cnt']++;}});Object.keys(requestData['imps']).forEach(function(tag_id){storeRequestInAdagioNS(requestData['imps'][tag_id]);});}}
return requestData;}
function send(bidData){var bidder=bidData.bidder;var bidderInfo=properOps.bidder_info[bidder]||bidderInfo;storageEnfObj={gvlid:bidderInfo.gvlid||GVLID,bidderCode:bidder,};if(ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.account_overrides.enabled')){organizationId=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.account_overrides.bidder_ids.organizationId')||organizationId;}
siteId=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.site_id')||0;if(!siteId){properLog.mylog('Adagio: Error Site ID is Required.');return false;}
bidderInfo.auctionId=ProperMedia.utils.deepAccess(bidData,'auction.id');var requestData=formatRequest(bidData,bidder,bidderInfo);var imps=ProperMedia.utils.objectValues(requestData['imps'])||[];var data_map=requestData['data_map']||{};var request_cnt=requestData['request_cnt'];var language=navigator.language?'language':'userLanguage';var gdprConsent=_getGdprConsent()||{};var uspConsent=_getUspConsent()||{};var schain=_getSchain();var eids=userIds.getEidsArray()||[];var uids=Object.keys(ProperMedia.utils.deepAccess(bidData,'auction.uids'));var usIfr=!!gdprEnforcement.userSyncEnforcement(bidder);var post_data={id:ProperMedia.utils.generateUUID(),pageviewId:internal.getPageviewId(),organizationId:organizationId.toString(),secure:properPage.use_ssl?1:0,site:{page:properPage.bidder_page_url,domain:properPage.domain,referrer:properPage.referrer,},device:{userAgent:navigator.userAgent,language:navigator[language],dnt:ProperMedia.utils.getDNT()?1:0,geo:{},js:1,},adUnits:imps,data:GlobalExchange.getExchangeData(),regs:{gdpr:gdprConsent,ccpa:uspConsent,coppa:{required:ProperMedia.utils.deepAccess(properSpecialOps,'coppa')?1:0,},},user:{eids:eids,},prebidVersion:properOps.prebid_version,featuresVersion:FEATURES_VERSION,usIfr:usIfr,};if(schain!='')post_data['schain']=schain;properLog.mylog(ENDPOINT_URL,bidder);bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({url:ENDPOINT_URL,method:'POST',requestType:'cors',bidder:bidder,edge:edge,headers:{'Content-Type':'text/plain'},data:JSON.stringify(post_data),success:function(resp){try{var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);resp=ProperMedia.utils.safeJsonParse(resp);if(resp){if(resp.data){internal.enqueue({action:'ssp-data',ts:Date.now(),data:resp.data,});}
if(resp.bids&&resp.bids.length){properLog.mylog(resp,bidder);resp.bids.forEach(function(obj){var impid=obj.requestId||'',price=obj.cpm||0,width=obj.width||1,height=obj.height||1,adcode=obj.ad||'',nurl=obj.nurl||'',crid=obj.creativeId||0,dealid=obj.dealId||'',adomain=obj.aDomain||[],ttl=obj.ttl||bidderInfo.default_bid_ttl/1000;var size=width+'x'+height;var ad_details={div_id:ProperMedia.utils.deepAccess(data_map,impid+'.div_id'),};var ad=new adObj({bidder:bidder,size:size,price:parseFloat(price),gross:parseFloat(price),nurl:nurl,tag_id:impid,crid:crid,dealid:dealid,ad_details:ad_details,request_url:ENDPOINT_URL,response:obj,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:ttl*1000,floor:ProperMedia.utils.deepAccess(data_map,impid+'.floors.'+size)||0,target_slot:ProperMedia.utils.deepAccess(data_map,impid+'.slot_name')||'',uids:uids,});if(bidderInfo.demand_type=='display'){var ad_code_prepend='<script> var elem = window.top.document.getElementById("{PROPER_SLOT_DIV_ID}"); if(elem) { if(elem.parentNode.className.indexOf("'+
properOps.slot_wrapper_class+
'") !== -1) { elem = elem.parentNode; elem.setAttribute(\'id\', "'+
ProperMedia.utils.deepAccess(data_map,impid+'.div_id')+
'");}} </script>';ad.adcode=ad_code_prepend+
'<div id="'+
ProperMedia.utils.deepAccess(data_map,impid+'.div_id')+
'">'+
adcode+
'</div>';}else if(bidderInfo.demand_type=='video'){ad.type='video';ad.vast_tag=obj.vastXml;var tagTypes=ProperMedia.utils.parseVastVpaid(ad.vast_tag);ad.vast_type=tagTypes['vast_type'];ad.vpaid=tagTypes['vpaid'];ad.video_type=bidderInfo.video_type;}else if(bidderInfo.demand_type=='native'){var native=obj.admNative||{};native.clickTrackers=ProperMedia.utils.deepAccess(native,'link.clicktrackers')||[];ad.type='native';ad.native=native;}
bidData.logBidResponse(ad);});addUserSyncs(resp);}}else{properLog.mylog('Adagio: No bids returned');var ad=new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:ENDPOINT_URL,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,});bidData.logNoBidResponse(ad);}
bidData.incrementBidResponseCount(request_cnt);}catch(e){e.bidder=bidder;throw e;}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}
function addUserSyncs(resp){try{if(ProperMedia.utils.deepAccess(resp,'ext.pixels')){var pixels=resp.ext.pixels||[];var itemsRegExp=/(img|iframe)[\s\S]*?src\s*=\s*("|')(.*?)\2/gi;var tagNameRegExp=/\w*(?=\s)/;var srcRegExp=/src=("|')(.*?)\1/;var userSyncObjects=[];if(pixels){var matchedItems=pixels.match(itemsRegExp);if(matchedItems){matchedItems.forEach(function(item){var tagName=item.match(tagNameRegExp)[0];var url=item.match(srcRegExp)[2];if(tagName&&url){var tagType=tagName.toLowerCase()==='img'?'image':'iframe';userSyncs.add({type:tagType,url:url,});}});}}}}catch(e){e.bidder=bidder;throw e;}}
function _getGdprConsent(){if(gdprConsent){return{apiVersion:gdprConsent.apiVersion,consentString:gdprConsent.consentString,consentRequired:gdprConsent.gdprApplies?1:0,allowAuctionWithoutConsent:gdprConsent.allowAuctionWithoutConsent?1:0,};}else{return false;}}
function _getUspConsent(){return uspConsent.usPrivacy?{uspConsent:uspConsent.usPrivacy}:false;}
function _getSchain(){return schainCheck(bidder);}
function getPageDimensions(){var body=window.document.querySelector('body');var html=window.document.documentElement;var pageWidth=Math.max(body.scrollWidth,body.offsetWidth,html.clientWidth,html.scrollWidth,html.offsetWidth);var pageHeight=Math.max(body.scrollHeight,body.offsetHeight,html.clientHeight,html.scrollHeight,html.offsetHeight);return pageWidth+'x'+pageHeight;}
function getViewPortDimensions(){var viewportDims={w:window.innerWidth||0,h:window.innerHeight||0,};return viewportDims.w+'x'+viewportDims.h;}
function getTimestampUTC(){return Math.floor(new Date().getTime()/1000)-new Date().getTimezoneOffset()*60;}
function getDomLoadingDuration(){var domLoadingDuration=-1;var performance;performance=window.performance;if(performance&&performance.timing&&performance.timing.navigationStart>0){var val=performance.timing.domLoading-performance.timing.navigationStart;if(val>0){domLoadingDuration=val;}}
return domLoadingDuration;}
var GlobalExchange=(function(){var features;var exchangeData={};return{clearFeatures:function(){features=undefined;},clearExchangeData:function(){exchangeData={};},getOrSetGlobalFeatures:function(){if(!features){features={page_dimensions:getPageDimensions().toString(),viewport_dimensions:getViewPortDimensions().toString(),user_timestamp:getTimestampUTC().toString(),dom_loading:getDomLoadingDuration().toString(),};}
return features;},prepareExchangeData(storageValue){var adagioStorage=JSON.parse(storageValue,function(name,value){if(name.charAt(0)!=='_'||name===''){return value;}});var random=ProperMedia.utils.deepAccess(adagioStorage,'session.rnd');var newSession=false;if(internal.isNewSession(adagioStorage)){newSession=true;random=Math.random();}
var data={session:{new:newSession,rnd:random,},};ProperMedia.utils.mergeDeep(exchangeData,adagioStorage,data);internal.enqueue({action:'session',ts:Date.now(),data:exchangeData,});},getExchangeData(){return exchangeData;},};})();function adagioScriptFromLocalStorageCb(ls){try{if(!ls){properLog.mylog('Adagio script not found.');return;}
var hashRgx=/^(\/\/ hash: (.+)\n)(.+\n)$/;if(!hashRgx.test(ls)){properStorage.removeDataFromLocalStorage(ADAGIO_LOCALSTORAGE_KEY,storageEnfObj);}}catch(err){properLog.mylog('Adagio: '+JSON.stringify(err));}}
function getAdagioScript(){var ls=properStorage.getDataFromLocalStorage(ADAGIO_LOCALSTORAGE_KEY,storageEnfObj);internal.adagioScriptFromLocalStorageCb(ls);if(properStorage.localStorageIsEnabled(storageEnfObj)){var elem=document.createElement('script');elem.src=ADAGIO_TAG_URL;elem.async=true;elem.type='text/javascript';var scpt=document.getElementsByTagName('script')[0];scpt.parentNode.insertBefore(elem,scpt);}}
function storeRequestInAdagioNS(bidRequest){const w=window.top;w.ADAGIO=w.ADAGIO||{};w.ADAGIO.pbjsAdUnits=w.ADAGIO.pbjsAdUnits.filter(function(adUnit){return adUnit.code!==bidRequest.adUnitCode;});var printNumber;if(bidRequest.features&&bidRequest.features.print_number){printNumber=bidRequest.features.print_number;}else if(bidRequest.params.features&&bidRequest.params.features.print_number){printNumber=bidRequest.params.features.print_number;}
w.ADAGIO.pbjsAdUnits.push({code:bidRequest.adUnitCode,mediaTypes:bidRequest.mediaTypes||{},sizes:bidRequest.mediaTypes&&bidRequest.mediaTypes.banner&&Array.isArray(bidRequest.mediaTypes.banner.sizes)?bidRequest.mediaTypes.banner.sizes:bidRequest.sizes,bids:[{bidder:bidRequest.bidder,params:bidRequest.params,},],auctionId:bidRequest.auctionId,pageviewId:internal.getPageviewId(),printNumber:printNumber,});w.ADAGIO.adUnits[bidRequest.adUnitCode]={auctionId:bidRequest.auctionId,pageviewId:internal.getPageviewId(),printNumber:printNumber,};}
function initAdagio(){if(!adagio_script_loaded){adagio_script_loaded=true;var w=window.top;w.ADAGIO=w.ADAGIO||{};w.ADAGIO.adUnits=w.ADAGIO.adUnits||{};w.ADAGIO.pbjsAdUnits=w.ADAGIO.pbjsAdUnits||[];w.ADAGIO.queue=w.ADAGIO.queue||[];w.ADAGIO.versions=w.ADAGIO.versions||{};w.ADAGIO.versions.pbjs=properOps.prebid_version;w.ADAGIO.isSafeFrameWindow=0;var storageData=properStorage.getDataFromLocalStorage('adagio',storageEnfObj)||'{}';try{GlobalExchange.prepareExchangeData(storageData);}catch(e){properLog.mylog('Adagio: '+JSON.stringify(e));}
getAdagioScript();}}
function enqueue(ob){var w=window.top;w.ADAGIO=w.ADAGIO||{};w.ADAGIO.queue=w.ADAGIO.queue||[];w.ADAGIO.queue.push(ob);}
function getPageviewId(){var w=window.top;w.ADAGIO=w.ADAGIO||{};w.ADAGIO.pageviewId=w.ADAGIO.pageviewId||ProperMedia.utils.generateUUID();return w.ADAGIO.pageviewId;}
function isNewSession(adagioStorage){var now=Date.now();var session=ProperMedia.utils.deepAccess(adagioStorage,'session')||{};var lastActivityTime=session['lastActivityTime']||undefined;var vwSmplg=session['vwSmplg']||undefined;return!ProperMedia.utils.isNumber(lastActivityTime)||!ProperMedia.utils.isNumber(vwSmplg)||now-lastActivityTime>MAX_SESS_DURATION;}
var internal={enqueue:enqueue,getPageviewId:getPageviewId,adagioScriptFromLocalStorageCb:adagioScriptFromLocalStorageCb,isNewSession:isNewSession,};function onBidWon(bid,slot){try{window.top.ADAGIO.queue.push({action:'adagio-creative-rendered',data:{eventName:'renderEvent',args:{isEmpty:false,elementId:ProperMedia.utils.deepAccess(bid,'ad_details.div_id'),creativeId:bid.crid,creativeSize:bid.size.split('x').map(function(s){return parseInt(s);}),},},ts:Date.now(),});}catch(e){console.error(e);}}
return{send:send,onBidWon:onBidWon,bidderInfo:bidderInfo,formatRequest:formatRequest,loadInitScripts:initAdagio,};})();bidAdapters.appnexus=(function(){var bidderInfo={rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:300000,gvlid:32,};var ENDPOINT_URL='https://ib.adnxs.com/ut/v3/prebid',SYNC_ENDPOINT='https://acdn.adnxs.com/dmp/async_usersync.html',bidder='appnexus';var NATIVE_DEF_REQ={main_image:{required:true,sizes:[],},icon:{required:true,sizes:[{width:50,height:50,},],},clickUrl:{required:true,},title:{required:true,len:80,},sponsored_by:{required:true,},ctatext:{required:false,},};function parseSize(size,bidderInfo){size=ProperMedia.utils.deepAccess(bidderInfo,'native_sizes.'+size)||size;var s=size.split('x');return{width:parseInt(s[0]),height:parseInt(s[1]),};}
function formatRequest(bidData,bidder,bidderInfo){var requestData={astTags:{},data_map:{},request_cnt:0,};if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){for(i=0;i<data[size].length;i++){var tag_id=data[size][i];if(typeof requestData['astTags'][tag_id]=='undefined'){var primary_size=parseSize(size,bidderInfo);var uuid=astUID();var id=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.site_id')||tag_id;requestData['astTags'][tag_id]={sizes:[],primary_size:primary_size,uuid:uuid,id:parseInt(id),prebid:true,ad_types:[],reserve:0,hb_source:1,disable_psa:true,allow_smaller_sizes:false,use_pmt_rule:false,};requestData['data_map'][uuid]={slot_name:slot_name||'',tag_id:tag_id,floor:0,};}
if(bidderInfo.demand_type=='display'){requestData['astTags'][tag_id]['ad_types'].push('banner');}else if(bidderInfo.demand_type=='native'){if(requestData['astTags'][tag_id]['ad_types'].indexOf('native')==-1){requestData['astTags'][tag_id]['ad_types'].push('native');}
var nativeRequest=ProperMedia.utils.deepAccess(requestData,'astTags.'+tag_id+'.native.layouts.0')||NATIVE_DEF_REQ;nativeRequest['main_image']['sizes'].push(parseSize(size));requestData['astTags'][tag_id]['native']={layouts:[nativeRequest]};}else if(bidderInfo.demand_type=='video'){requestData['astTags'][tag_id]['ad_types'].push('video');if(bidderInfo.video_type=='instream'){requestData['astTags'][tag_id]['require_asset_url']=true;}else if(bidderInfo.video_type=='outstream'){requestData['astTags'][tag_id]['require_asset_url']=false;}
requestData['astTags'][tag_id]['allow_smaller_sizes']=true;requestData['astTags'][tag_id]['video_frameworks']=[2];requestData['astTags'][tag_id]['video']={minduration:1,playback_method:2,mimes:['video/mp4','application/javascript'],custom_renderer_present:true,};}
var floor=getBidderFloor(bidder,size);if(!requestData['astTags'][tag_id]['reserve']||floor<requestData['astTags'][tag_id]['reserve']){requestData['astTags'][tag_id]['reserve']=floor;ProperMedia.utils.deepSetValue(requestData,'data_map.'+ProperMedia.utils.deepAccess(requestData,'astTags.'+tag_id+'.uuid')+'.floor',floor);}
requestData['astTags'][tag_id]['sizes'].push(parseSize(size));requestData['request_cnt']++;}});}}
return requestData;}
function send(bidData){var bidder=bidData.bidder;var bidderInfo=properOps.bidder_info[bidder]||bidderInfo;var requestData=formatRequest(bidData,bidder,bidderInfo);var astTags=ProperMedia.utils.objectValues(requestData['astTags'])||[];var data_map=requestData['data_map']||{};var request_cnt=requestData['request_cnt'];if(astTags.length==0){return false;}
var data={tags:astTags,sdk:{source:'pbjs',version:properOps.prebid_version,},referrer_detection:{rd_ref:encodeURIComponent(properPage.url),rd_top:true,rd_ifs:0,rd_stk:encodeURIComponent(properPage.url),},user:{},};if(ProperMedia.utils.deepAccess(properSpecialOps,'coppa')){data.user.coppa=true;}
var eidsArray=userIds.getEidsArray();if(eidsArray.length){let eids=[];eidsArray.forEach((eid)=>{if(!eid||!eid.uids||eid.uids.length<1){return;}
eid.uids.forEach((uid)=>{let tmp={source:eid.source,id:uid.id,};if(eid.source=='adserver.org'){tmp.rti_partner='TDID';}else if(eid.source=='uidapi.com'){tmp.rti_partner='UID2';}
eids.push(tmp);});});if(eids.length){data.eids=eids;}}
var uids=Object.keys(ProperMedia.utils.deepAccess(bidData,'auction.uids'));var schain=schainCheck(bidder);if(schain!='')data.schain=schain;if(gdprConsent){data.gdpr_consent={consent_string:gdprConsent.consentString,consent_required:gdprConsent.gdprApplies,};if(gdprConsent.addtlConsent&&gdprConsent.addtlConsent.indexOf('~')!==-1){let ac=gdprConsent.addtlConsent;let acStr=ac.substring(ac.indexOf('~')+1);data.gdpr_consent.addtl_consent=acStr.split('.').map((id)=>parseInt(id,10));}}
if(uspConsent.usPrivacy){data.us_privacy=uspConsent.usPrivacy;}
if(gppConsent){data.privacy={gpp:gppConsent.gppString,gpp_sid:gppConsent.applicableSections,};}
properLog.mylog(ENDPOINT_URL,bidder);bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({url:ENDPOINT_URL,requestType:'cors',method:'POST',bidder:bidder,edge:edge,data:JSON.stringify(data),success:function(resp){try{properLog.mylog(resp,bidder);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var json=ProperMedia.utils.safeJsonParse(resp);if(json&&json.error){properLog.mylog('Error: '+bidder+' adapter - '+json.error);var bidError={bidder:bidder,status:418,statusText:json.error+'(x'+request_cnt+')',response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}else if(json&&json.tags&&json.tags.length){for(var i=0;i<json.tags.length;i++){var obj=json.tags[i];if(obj.ads&&obj.ads[0]){var tag_id=obj.tag_id,uuid=obj.uuid,adData=obj.ads[0];var price=adData.cpm||0,crid=adData.creative_id||'',adid=adData.adId||adData.advertiser_id||'';var ad=new adObj({bidder:bidder,price:parseFloat(price),gross:parseFloat(price),tag_id:ProperMedia.utils.deepAccess(data_map,uuid+'.tag_id')||tag_id,adid:adid,crid:crid,request_url:ENDPOINT_URL,response:obj,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:bidderInfo.default_bid_ttl,floor:ProperMedia.utils.deepAccess(data_map,uuid+'.floor')||0,target_slot:ProperMedia.utils.deepAccess(data_map,uuid+'.slot_name')||'',uids:uids,});if(bidderInfo.demand_type=='video'){let notify_url=ProperMedia.utils.deepAccess(adData,'rtb.notify_url')||'',asset_url=ProperMedia.utils.deepAccess(adData,'rtb.video.asset_url')||'',vastImpUrl=ProperMedia.utils.deepAccess(adData,'rtb.video.notify_url')||'',adWidth=ProperMedia.utils.deepAccess(adData,'rtb.video.player_width')||'',adHeight=ProperMedia.utils.deepAccess(adData,'rtb.video.player_height')||'';var vast_tag='';if(bidderInfo.video_type=='instream'){vast_tag=notify_url+'&redir='+encodeURIComponent(asset_url);}else if(bidderInfo.video_type=='outstream'){vast_tag=ProperMedia.utils.deepAccess(adData,'rtb.video.content')||'';}
ad.size=adWidth+'x'+adHeight;ad.type='video';ad.vast_tag=vast_tag;var tagTypes=ProperMedia.utils.parseVastVpaid(ad.vast_tag);ad.vast_type=tagTypes['vast_type'];ad.vpaid=tagTypes['vpaid'];ad.video_type=bidderInfo.video_type;}else if(bidderInfo.demand_type=='native'){ad.type='native';var nativeAd=ProperMedia.utils.deepAccess(adData,'rtb.native');ad['native']=buildNative(nativeAd);}else{let adcode=ProperMedia.utils.deepAccess(adData,'rtb.banner.content')||'',adWidth=ProperMedia.utils.deepAccess(adData,'rtb.banner.width')||'',adHeight=ProperMedia.utils.deepAccess(adData,'rtb.banner.height')||'';var tracking_url='';try{tracking_url=ProperMedia.utils.deepAccess(adData,'rtb.trackers.0.impression_urls.0');}catch(e){}
adcode+='<div style="position:absolute;left:0px;top:0px;visibility:hidden;"><img src="'+
encodeURI(tracking_url)+
'"></div>';ad.size=adWidth+'x'+adHeight;ad.adcode=adcode;}
bidData.logBidResponse(ad);}else if(obj.nobid){let ad=new adObj({bidder:bidder,price:0,gross:0,tag_id:obj.tag_id||'',request_url:ENDPOINT_URL,response:obj,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,});bidData.logNoBidResponse(ad);}}}else{let ad=new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:ENDPOINT_URL,response:json,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,});bidData.logNoBidResponse(ad);}
bidData.incrementBidResponseCount(request_cnt);}catch(e){e.bidder=bidder;throw e;}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}
function buildNative(nativeAd){return{link:{url:ProperMedia.utils.deepAccess(nativeAd,'link.url')||'',},assets:[{title:{text:ProperMedia.utils.deepAccess(nativeAd,'title')||'',},},{img:{type:1,url:ProperMedia.utils.deepAccess(nativeAd,'main_img.url')||'',height:ProperMedia.utils.deepAccess(nativeAd,'main_img.height')||'',width:ProperMedia.utils.deepAccess(nativeAd,'main_img.width')||'',},},{img:{type:2,url:ProperMedia.utils.deepAccess(nativeAd,'icon.url')||'',height:ProperMedia.utils.deepAccess(nativeAd,'icon.height')||'',width:ProperMedia.utils.deepAccess(nativeAd,'icon.width')||'',},},{type:1,value:ProperMedia.utils.deepAccess(nativeAd,'advertiser.description')||'',},{type:2,value:ProperMedia.utils.deepAccess(nativeAd,'sponsored')||'',},{type:12,value:ProperMedia.utils.deepAccess(nativeAd,'ctatext')||'',},],clickTrackers:ProperMedia.utils.deepAccess(nativeAd,'link.click_trackers')||[],imptrackers:ProperMedia.utils.deepAccess(nativeAd,'impression_trackers')||[],jstracker:ProperMedia.utils.deepAccess(nativeAd,'javascript_trackers')||[],javascriptViewability:ProperMedia.utils.deepAccess(nativeAd,'viewability.config')||'',};}
function astUID(){var e=new Date().getTime(),t='xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return(e=Math.floor(e/16)),('x'===t?n:(3&n)|8).toString(16);});t=t.split('-')[4];return t;}
function onBidWon(bid,slot){if(ProperMedia.utils.deepAccess(bid,'native.javascriptViewability')&&bid.adId){var prebidParams='pbjs_adid='+bid.adId+';pbjs_auc='+slot.div_id;var javascriptViewability=bid.native.javascriptViewability.replace('dom_id=%native_dom_id%',prebidParams);var jsTrackers=ProperMedia.utils.deepAccess(bid,'native.javascript_trackers');if(jsTrackers==undefined){jsTrackers=javascriptViewability;}else if(ProperMedia.utils.isStr(jsTrackers)){jsTrackers=[jsTrackers,javascriptViewability];}else if(ProperMedia.utils.isArray(jsTrackers)){jsTrackers.push(javascriptViewability);}
bid.native.jstracker=jsTrackers;}
return true;}
function getUserSyncs(){function checkGppStatus(){if(gppConsent&&Array.isArray(gppConsent.applicableSections)){return gppConsent.applicableSections.every((sec)=>typeof sec==='number'&&sec<=5);}
return true;}
if(gdprConsentModule.hasPurpose1Consent()&&checkGppStatus()){userSyncs.add({type:'iframe',url:SYNC_ENDPOINT,bidder:bidder,});}}
return{send:send,onBidWon:onBidWon,bidderInfo:bidderInfo,getUserSyncs:getUserSyncs,formatRequest:formatRequest,};})();bidAdapters.concert=(function(){var bidderInfo={rev_share:0.75,bid_grouping:'page',default_bid_ttl:60000,native_sizes:{'1030x590':'native_horizontal',},};var ENDPOINT_URL='https://bids.concert.io/bids/prebid',bidder='concert';var sizes={mobile:[[325,204],[325,508],],desktop:[[1030,590],[620,366],],};function formatRequest(bidData){var requestData={bids:{},data_map:{},request_cnt:0,};var site_id=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.site_id')||0;if(!site_id){properLog.mylog('Error: Concert Site ID is Required.');return requestData;}
var device_type=properDevice.isMobile()?'mobile':'desktop';var device_sizes=sizes[device_type]||[];if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){for(var i=0;i<data[size].length;i++){if(size=='native_horizontal'){var tag_id=data[size][i];if(typeof requestData['bids'][tag_id]=='undefined'){requestData['bids'][tag_id]={name:tag_id,bidId:tag_id,transactionId:ProperMedia.utils.generateUUID(),sizes:device_sizes,partnerId:site_id,adSlot:tag_id,site:properPage.url,ref:properPage.referrer,placementId:'',};requestData['data_map'][tag_id]={slot_name:slot_name||'',tag_id:tag_id,};requestData['request_cnt']+=1;}}}});}}
return requestData;}
function send(bidData){var requestData=formatRequest(bidData);var bids=ProperMedia.utils.objectValues(requestData['bids'])||[];var data_map=requestData['data_map']||{};var request_cnt=requestData['request_cnt'];if(request_cnt==0)return;var post_data={meta:{prebidVersion:properOps.prebid_version,pageUrl:properPage.bidder_page_url,screen:[window.screen.width,window.screen.height].join('x'),debug:properOps.testing_mode.ids==true?true:false,uid:getUid(),optedOut:hasOptedOutOfPersonalization(),adapterVersion:'1.2.0',uspConsent:getUspConsent(),gdprConsent:getGdprConsent(),gppConsent:getGppConsent(),},slots:bids,};properLog.mylog(ENDPOINT_URL,bidder);bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({url:ENDPOINT_URL,method:'POST',requestType:'cors',bidder:bidder,edge:edge,data:JSON.stringify(post_data),success:function(resp){try{resp=ProperMedia.utils.safeJsonParse(resp);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);if(!resp||!resp.bids||Object.keys(resp.bids).length==0){properLog.mylog('no '+bidder+' bids returned');var ad=new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:ENDPOINT_URL,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,});bidData.logNoBidResponse(ad);}else{properLog.mylog(resp,bidder);Object.keys(resp.bids).forEach(function(i){var obj=resp.bids[i];var bidId=obj.bidId||'',price=obj.cpm||0,netRevenue=obj.netRevenue||0,currency=obj.currency||'USD',width=obj.width||1,height=obj.height||1,adcode=obj.ad||'',crid=obj.creativeId||'',ttl=obj.ttl*1000||bidderInfo.default_bid_ttl;var ad_size=width+'x'+height;if(bidderInfo.native_sizes[ad_size]){ad_size=bidderInfo.native_sizes[ad_size];}
var ad=new adObj({bidder:bidder,size:ad_size,price:parseFloat(price),gross:parseFloat(price),adcode:adcode,tag_id:bidId,crid:crid,request_url:ENDPOINT_URL,response:obj,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:ttl,target_slot:ProperMedia.utils.deepAccess(data_map,bidId+'.slot_name')||'',});if(ad.price&&ad.adcode){bidData.logBidResponse(ad);}else{bidData.logNoBidResponse(ad);}});}
bidData.incrementBidResponseCount(request_cnt);}catch(e){e.bidder=bidder;throw e;}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}
function getGdprConsent(){if(gdprConsent){return{apiVersion:gdprConsent.apiVersion,consentString:gdprConsent.consentString,consentRequired:gdprConsent.gdprApplies?1:0,allowAuctionWithoutConsent:gdprConsent.allowAuctionWithoutConsent?1:0,};}else{return false;}}
function getUspConsent(){return uspConsent.usPrivacy?{uspConsent:uspConsent.usPrivacy}:false;}
function getGppConsent(){if(gppConsent){return{gppString:gppConsent.gppString,applicableSections:gppConsent.applicableSections,};}
return false;}
function getUid(){if(hasOptedOutOfPersonalization()||!consentAllowsPpid()){return false;}
if(properUser.pubcid)return properUser.pubcid;var CONCERT_UID_KEY='c_uid';var uid=properStorage.getDataFromLocalStorage(CONCERT_UID_KEY,{bidderCode:bidder});if(!uid){uid=ProperMedia.utils.generateUUID();properStorage.setDataInLocalStorage(CONCERT_UID_KEY,uid,{bidderCode:bidder});}
return uid;}
function hasOptedOutOfPersonalization(){var CONCERT_NO_PERSONALIZATION_KEY='c_nap';return properStorage.getDataFromLocalStorage(CONCERT_NO_PERSONALIZATION_KEY,{bidderCode:bidder})==='true';}
function consentAllowsPpid(bidderRequest){let uspConsentAllows=true;if(uspConsent.ccpaApplies&&typeof uspConsent.usPrivacy==='string'&&uspConsent.usPrivacy[0]==='1'&&uspConsent.usPrivacy[2].toUpperCase()==='Y'){uspConsentAllows=false;}
const gdprConsentAllows=!gdprConsent.gdprApplies||(gdprConsentModule.hasPurpose1Consent()&&gdprConsentModule.hasPurpose4Consent());const gppConsentAllows=!gppConsentModule.isConsentDenied();return uspConsentAllows&&gdprConsentAllows&&gppConsentAllows;}
return{send:send,bidderInfo:bidderInfo,formatRequest:formatRequest,};})();bidAdapters.consumable=(function(){var bidderInfo={rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:30000,};var networkId='9969',siteId='1030626',bidder='consumable',bidId=1;var ENDPOINT_URL='https://e.serverbid.com/api/v2';var sizeMap=[null,'120x90','120x90','468x60','728x90','300x250','160x600','120x600','300x100','180x150','336x280','240x400','234x60','88x31','120x60','120x240','125x125','220x250','250x250','250x90','0x0','200x90','300x50','320x50','320x480','185x185','620x45','300x125','800x250',];sizeMap[77]='970x90';sizeMap[123]='970x250';sizeMap[43]='300x600';sizeMap[286]='970x66';sizeMap[3230]='970x280';sizeMap[429]='486x60';sizeMap[374]='700x500';sizeMap[934]='300x1050';sizeMap[1578]='320x100';sizeMap[331]='320x250';sizeMap[3301]='320x267';sizeMap[2730]='728x250';function getSize(size){var index=sizeMap.indexOf(size[0]+'x'+size[1]);if(index>=0){return index;}
return false;}
function formatRequest(bidData){var requestData={imps:{},data_map:{},request_cnt:0,};if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){for(var i=0;i<data[size].length;i++){var tagId=data[size][i];var params=tagId.split('|'),unitName=params[0]||'',unitId=params[1]||'',zoneIds=(params[2]||'').split(',');if(typeof requestData['imps'][tagId]=='undefined'){requestData['imps'][tagId]={networkId:networkId,siteId:siteId,divName:tagId,unitName:unitName,unitId:unitId,zoneIds:[],adTypes:[],bidfloor:0,};requestData['data_map'][tagId]={slot_name:slot_name||'',tag_id:tagId,floor:0,};}
if(zoneIds instanceof Array){requestData['imps'][tagId]['zoneIds'].concat(zoneIds.map(function(x){return parseInt(x);}));}else{requestData['imps'][tagId]['zoneIds'].push(parseInt(zoneIds));}
var mappedSize=getSize(size.split('x'));if(mappedSize){requestData['imps'][tagId]['adTypes'].push(mappedSize);requestData['request_cnt']++;}
var floor=getBidderFloor(bidder,size);if(!requestData['imps'][tagId]['bidfloor']||floor<requestData['imps'][tagId]['bidfloor']){requestData['imps'][tagId]['bidfloor']=floor;requestData['data_map'][tagId]['floor']=floor;}}});}}
return requestData;}
function send(bidData){siteId=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.site_id')||siteId;if(ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.account_overrides.enabled')){networkId=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.account_overrides.bidder_ids.networkId')||networkId;}
var requestData=formatRequest(bidData);var imps=requestData['imps']||{};var data_map=requestData['data_map']||{};var request_cnt=requestData['request_cnt'];if(request_cnt==0)return false;var post_data={networkId:networkId,siteId:siteId,placements:ProperMedia.utils.objectValues(imps)||[],time:Date.now(),url:properPage.bidder_page_url,referrer:properPage.referrer,source:[{name:'prebidjs',version:properOps.prebid_version,},],};post_data.gdpr={consent:gdprConsent.consentString,applies:typeof gdprConsent.gdprApplies==='boolean'?gdprConsent.gdprApplies:true,};if(uspConsent.usPrivacy){post_data.ccpa=uspConsent.usPrivacy;}
var schain=schainCheck(bidder);if(schain!='')post_data.schain=schain;if(ProperMedia.utils.deepAccess(properSpecialOps,'coppa')){post_data.coppa=true;}
addUserSyncs();properLog.mylog(ENDPOINT_URL,bidder);bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({url:ENDPOINT_URL,method:'POST',requestType:'cors',bidder:bidder,edge:edge,data:JSON.stringify(post_data),success:function(resp){try{var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);if(resp){resp=ProperMedia.utils.safeJsonParse(resp);var serverResponse=resp||{};if(serverResponse&&serverResponse.decisions&&Object.keys(serverResponse.decisions).length>0){for(bidId in serverResponse.decisions){var decision=serverResponse.decisions[bidId];var price=ProperMedia.utils.deepAccess(decision,'pricing.clearPrice')||0,width=decision.width||0,height=decision.height||0,crid=decision.adId||'',adid=decision.adId||'',adcode=retrieveAd(decision)||'';bidData.logBidResponse(new adObj({bidder:bidder,size:width+'x'+height,price:parseFloat(price),gross:parseFloat(price),adcode:adcode,tag_id:bidId,crid:crid,adid:adid,request_url:ENDPOINT_URL,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:bidderInfo.default_bid_ttl,floor:ProperMedia.utils.deepAccess(data_map,bidId+'.floor')||0,target_slot:ProperMedia.utils.deepAccess(data_map,bidId+'.slot_name')||'',}));bidData.incrementBidResponseCount(request_cnt);}}else{bidData.logNoBidResponse(new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:ENDPOINT_URL,response:serverResponse,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,}));}}else{bidData.logNoBidResponse(new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:ENDPOINT_URL,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,}));}
bidData.incrementBidResponseCount(request_cnt);}catch(e){e.bidder=bidder;throw e;}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}
function retrieveAd(decision){var ad=ProperMedia.utils.deepAccess(decision,'contents[0].body');return ad;}
function appendUrlParam(url,queryString){return `${url}${url.indexOf('?')>-1?'&':'?'}${queryString}`;}
function addUserSyncs(){let syncUrl='https://sync.serverbid.com/ss/'+siteId+'.html';if(gdprConsent&&gdprConsent.consentString){if(typeof gdprConsent.gdprApplies==='boolean'){syncUrl=appendUrlParam(syncUrl,`gdpr=${Number(gdprConsent.gdprApplies)}&gdpr_consent=${gdprConsent.consentString}`);}else{syncUrl=appendUrlParam(syncUrl,`gdpr=0&gdpr_consent=${gdprConsent.consentString}`);}}
if(uspConsent&&uspConsent.usPrivacy){syncUrl=appendUrlParam(syncUrl,`us_privacy=${uspConsent.usPrivacy}`);}
userSyncs.add({type:'iframe',url:syncUrl,bidder:bidder,});}
return{formatRequest:formatRequest,send:send,bidderInfo:bidderInfo,};})();bidAdapters.conversant=(function(){var bidderInfo={rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:300000,gvlid:24,};var ENDPOINT_URL='https://web.hb.ad.cpe.dotomi.com/s2s/header/24';var bidder='conversant';var displaymanager='propermedia';function parseSize(size){var s=size.split('x');return{w:parseInt(s[0]),h:parseInt(s[1]),};}
function formatRequest(bidData){var requestData={imps:{},data_map:{},request_cnt:0,};if(ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.account_overrides.enabled')){displaymanager=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.account_overrides.bidder_ids.displaymanager')||displaymanager;}
if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){for(var i=0;i<data[size].length;i++){var tag_id=data[size][i];if(typeof requestData['imps'][tag_id]=='undefined'){requestData['imps'][tag_id]={id:tag_id.toString(),bidfloor:0,secure:properPage.use_ssl?1:0,displaymanager:displaymanager,displaymanagerver:'2.2.4',banner:{format:[],pos:0,},};requestData['data_map'][tag_id]={slot_name:slot_name||'',tag_id:tag_id,floor:0,};}
var floor=getBidderFloor(bidder,size);if(!requestData['imps'][tag_id]['bidfloor']||floor<requestData['imps'][tag_id]['bidfloor']){requestData['imps'][tag_id]['bidfloor']=floor;requestData['data_map'][tag_id]['floor']=floor;}
requestData['imps'][tag_id]['banner']['format'].push(parseSize(size));requestData['request_cnt']++;}});}}
return requestData;}
function send(bidData){var site_id=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.site_id')||0;if(!site_id){properLog.mylog('Error: Conversant Site ID is Required.');return false;}
var requestData=formatRequest(bidData);var imps=ProperMedia.utils.objectValues(requestData['imps'])||[];var data_map=requestData['data_map']||{};var request_cnt=requestData['request_cnt'];var post_data={id:Date.now().toString(),at:1,imp:imps,site:{id:site_id.toString(),mobile:properDevice.isMobile()?1:0,page:properPage.bidder_page_url,},device:getDevice(),user:{},tmax:properOps.tmax,};if(!gppConsentModule.isConsentDenied()&&gdprConsentModule.hasPurpose4Consent()){ProperMedia.utils.deepSetValue(post_data,'user.ext.fpc',properUser.pubcid);}
var{eids,uids}=collectEids();if(eids.length>0){ProperMedia.utils.deepSetValue(post_data,'user.ext.eids',eids);}
var schain=schainCheck(bidder);if(schain!='')ProperMedia.utils.deepSetValue(post_data,'source.ext.schain',schain);if(gdprConsent){ProperMedia.utils.deepSetValue(post_data,'user.ext.consent',gdprConsent.consentString);if(typeof gdprConsent.gdprApplies==='boolean'){post_data.regs={ext:{gdpr:Number(gdprConsent.gdprApplies),},};}}
if(uspConsent.usPrivacy){ProperMedia.utils.deepSetValue(post_data,'regs.ext.us_privacy',uspConsent.usPrivacy);}
properLog.mylog(ENDPOINT_URL,bidder);bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({url:ENDPOINT_URL,method:'POST',requestType:'cors',bidder:bidder,edge:edge,data:JSON.stringify(post_data),success:function(resp){try{var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);resp=ProperMedia.utils.safeJsonParse(resp);if(!resp||!resp.seatbid||resp.seatbid.length==0||!resp.seatbid[0].bid||!resp.seatbid[0].bid.length){properLog.mylog('no conversant bids returned');var ad=new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:ENDPOINT_URL,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,});bidData.logNoBidResponse(ad);}else{properLog.mylog(resp,bidder);Object.keys(resp.seatbid).forEach(function(x){Object.keys(resp.seatbid[x].bid).forEach(function(i){var obj=resp.seatbid[x].bid[i];var id=obj.id||'',impid=obj.impid||'',price=obj.price||0,width=obj.w||1,height=obj.h||1,adcode=obj.adm||'',crid=obj.crid||'',nurl=obj.nurl||'';if(nurl){adcode+=ProperMedia.utils.createTrackPixel(nurl);nurl='';}
var ad=new adObj({bidder:bidder,size:width+'x'+height,price:parseFloat(price),gross:parseFloat(price),adcode:adcode,nurl:nurl,tag_id:impid,crid:crid,request_url:ENDPOINT_URL,response:obj,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:bidderInfo.default_bid_ttl,floor:ProperMedia.utils.deepAccess(data_map,impid+'.floor')||0,target_slot:ProperMedia.utils.deepAccess(data_map,impid+'.slot_name')||'',uids:uids,});bidData.logBidResponse(ad);});});}
bidData.incrementBidResponseCount(request_cnt);}catch(e){e.bidder=bidder;throw e;}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}
function collectEids(){var tempEids=userIds.getEidsArray();var eids=[],uids=[];if(ProperMedia.utils.isArray(eids)&&eids.length>0){const requiredSourceValues={'id5-sync.com':'id5id','liveramp.com':'idl_env',};eids.forEach(function(eid){if(requiredSourceValues[eid.source]){eids.push(eid);uids.push(requiredSourceValues[eid.source]);}});}
return{eids,uids};}
function getDevice(){var language=navigator.language?'language':'userLanguage';return{h:screen.height,w:screen.width,dnt:ProperMedia.utils.getDNT()?1:0,language:navigator[language].split('-')[0],make:navigator.vendor?navigator.vendor:'',ua:navigator.userAgent,};}
function onBidWon(bid,slot){if(bid.nurl){var img=new Image();img.src=bid.nurl;}
return true;}
return{send:send,onBidWon:onBidWon,bidderInfo:bidderInfo,formatRequest:formatRequest,};})();bidAdapters.criteo=(function(){var bidderInfo={rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:60000,acceptable_ads:true,gvlid:91,};var bidder='criteo';var networkId=8388;var ENDPOINT_URL='https://bidder.criteo.com/cdb',FAST_BID_VERSION_CURRENT=135,PUBLISHER_TAG_URL='https://static.criteo.net/js/ld/publishertag.prebid.'+FAST_BID_VERSION_CURRENT+'.js',FAST_BID_PUBKEY_E=65537,FAST_BID_PUBKEY_N='ztQYwCE5BU7T9CDM5he6rKoabstXRmkzx54zFPZkWbK530dwtLBDeaWBMxHBUT55CYyboR/EZ4efghPi3CoNGfGWezpjko9P6p2EwGArtHEeS4slhu/SpSIFMjG6fdrpRoNuIAMhq1Z+Pr/+HOd1pThFKeGFr2/NhtAg+TXAzaU=',ADAPTER_VERSION=35,PROFILE_ID_INLINE=207,PROFILE_ID_PUBLISHERTAG=185;var OPTOUT_COOKIE_NAME='cto_optout',BUNDLE_COOKIE_NAME='cto_bundle',GUID_RETENTION_TIME_HOUR=24*30*13,OPTOUT_RETENTION_TIME_HOUR=5*12*30*24;var adblock_zones={'160x600':1697406,'728x90':1697405,'300x250':1697404,'320x50':1697453,};var NATIVE_DEF_REQ={main_image:{required:true,sizes:[],},icon:{required:true,sizes:[{width:50,height:50,},],},clickUrl:{required:true,},title:{required:true,len:80,},sponsored_by:{required:true,},ctatext:{required:false,},};function parseSize(size){var s=size.split('x');return[parseInt(s[0]),parseInt(s[1])];}
function formatRequest(bidData,bidder,bidderInfo,auctionId){var requestData={slots:{},data_map:{},request_cnt:0,};if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){for(var i=0;i<data[size].length;i++){var tag_id=data[size][i];var sizeArr=parseSize(size);var ids=tag_id.split('-');var zoneId=properUser.checkAdBlock()?adblock_zones[size]:ids[0];var media_type=bidderInfo.demand_type=='display'?'banner':bidderInfo.demand_type;if(!zoneId)return;if(typeof requestData['slots'][tag_id]=='undefined'){requestData['slots'][tag_id]={impid:tag_id,auctionId:auctionId,slotid:ProperMedia.utils.generateUUID(),transactionid:ProperMedia.utils.generateUUID(),};ProperMedia.utils.deepSetValue(requestData,'slots.'+tag_id+'.ext.floors.'+media_type,{});if(bidderInfo.demand_type=='display'||bidderInfo.demand_type=='native'){requestData['slots'][tag_id]['sizes']=[];}
if(bidderInfo.demand_type=='native'){requestData['slots'][tag_id]['zoneid']=zoneId;requestData['slots'][tag_id]['native']=true;}else if(bidderInfo.demand_type=='video'){requestData['slots'][tag_id]['video']={playersizes:[sizeArr],mimes:['video/mp4','application/javascript'],protocols:[2,3,5,6],maxduration:30,api:[1,2],skip:0,placement:bidderInfo.video_type=='outstream'?3:1,playbackmethod:bidderInfo.video_type=='outstream'?[6]:[3],minduration:5,startdelay:0,};requestData['slots'][tag_id]['zoneid']=zoneId;}
requestData['data_map'][tag_id]={slot_name:slot_name||'',tag_id:tag_id,floor:0,};}
if(bidderInfo.demand_type=='display'||bidderInfo.demand_type=='native'){requestData['slots'][tag_id]['sizes'].push(size);}
let floor=getBidderFloor(bidder,size);ProperMedia.utils.deepSetValue(requestData,'slots.'+tag_id+'.ext.floors.'+media_type+'.'+size,floor);requestData['data_map'][tag_id]['floor']=floor;requestData['request_cnt']++;}});}}
return requestData;}
function formatCriteoRequest(bidData,bidder,bidderInfo,auctionId,bidderRequestId){var requestData={bids:{},slots:{},data_map:{},request_cnt:0,};if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){for(var i=0;i<data[size].length;i++){var tag_id=data[size][i];var sizeArr=parseSize(size);var ids=tag_id.split('-');var zoneId=ids[0];if(typeof requestData['slots'][tag_id]=='undefined'){requestData['bids'][tag_id]={bidder:bidder,params:{},};requestData['slots'][tag_id]={adUnitCode:tag_id.toString(),auctionId:auctionId,bidId:ProperMedia.utils.makeid(14),bidder:'criteo',bidderRequestId:bidderRequestId,userId:userIds.getUIdsObj(),userIdAsEids:userIds.getEidsArray(),schain:{},mediaTypes:{},params:{},src:'client',transactionId:ProperMedia.utils.generateUUID(),};requestData['slots'][tag_id].getFloor=function(requestParams={currency:'USD',mediaType:'*',size:'*'}){return getBidderFloor(bidder,requestParams.size.join('x'));};var schain=schainCheck(bidder);if(schain!='')ProperMedia.utils.deepSetValue(requestData,'slots.'+tag_id+'.schain',schain);if(bidderInfo.demand_type=='display'){requestData['slots'][tag_id]['mediaTypes']={banner:{sizes:[],},};requestData['slots'][tag_id]['params']['networkId']=networkId;requestData['bids'][tag_id]['params']['networkId']=networkId;}
if(bidderInfo.demand_type=='native'){requestData['slots'][tag_id]['mediaTypes']={native:NATIVE_DEF_REQ,};requestData['slots'][tag_id]['params']['zoneId']=zoneId;requestData['bids'][tag_id]['params']['zoneId']=zoneId;}else if(bidderInfo.demand_type=='video'){requestData['slots'][tag_id]['mediaTypes']={video:{playerSize:sizeArr,mimes:['video/mp4','application/javascript'],protocols:[2,3,5,6],maxduration:30,api:[1,2],skip:0,placement:bidderInfo.video_type=='outstream'?3:1,minduration:5,playbackmethod:[6],startdelay:0,},};requestData['slots'][tag_id]['params']['zoneId']=zoneId;requestData['bids'][tag_id]['params']['zoneId']=zoneId;}
requestData['data_map'][tag_id]={slot_name:slot_name||'',tag_id:tag_id,floor:0,};}
var floor=getBidderFloor(bidder,size);if(!requestData['data_map'][tag_id]['floor']||floor<requestData['data_map'][tag_id]['floor']){requestData['data_map'][tag_id]['floor']=floor;}
if(bidderInfo.demand_type=='display'){requestData['slots'][tag_id]['mediaTypes']['banner']['sizes'].push(sizeArr);}
if(bidderInfo.demand_type=='native'){requestData['slots'][tag_id]['mediaTypes']['native']['main_image']['sizes'].push(sizeArr);}
requestData['request_cnt']++;}});}}
return requestData;}
function send(bidData){var bidder=bidData.bidder;var bidderInfo=properOps.bidder_info[bidder]||bidderInfo;var request_url=ENDPOINT_URL;var request_cnt=0;var data={};var data_map={};var bidRequests=[];var auctionId=ProperMedia.utils.deepAccess(bidData,'auction.id');if(ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.account_overrides.enabled')){networkId=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.account_overrides.bidder_ids.networkId')||networkId;}
if(!publisherTagAvailable()){window.Criteo=window.Criteo||{};window.Criteo.usePrebidEvents=false;tryGetCriteoFastBid();setTimeout(function(){var script=document.createElement('script');script.src=PUBLISHER_TAG_URL;script.async=true;script.type='text/javascript';document.getElementsByTagName('head')[0].appendChild(script);},1200);}
var userExt;var uids=[];var userIdData=userIds.getUserIdData();if(ProperMedia.utils.deepAccess(userIdData,'emailHashes.md5')){uids.push({id:ProperMedia.utils.deepAccess(userIdData,'emailHashes.md5'),atype:3,ext:{stype:'hemmd5',},});}
if(ProperMedia.utils.deepAccess(userIdData,'emailHashes.sha256')){uids.push({id:ProperMedia.utils.deepAccess(userIdData,'emailHashes.sha256'),atype:3,ext:{stype:'hemsha256',},});}
if(uids.length){userExt={data:{eids:[{source:properPage.domain,uids:uids,},],},};}
if(publisherTagAvailable()){properLog.mylog('Criteo: Using FastBid');var fastBidRequestData=formatCriteoRequest(bidData,bidder,bidderInfo,auctionId,bidderRequestId);bidRequests=ProperMedia.utils.objectValues(fastBidRequestData['slots'])||[];var bids=ProperMedia.utils.objectValues(fastBidRequestData['bids'])||[];data_map=fastBidRequestData['data_map']||{};var bidderRequestId=ProperMedia.utils.makeid(14);var bidderRequest={auctionId:auctionId,auctionStart:Date.now(),bidderCode:bidder,bidderRequestId:bidderRequestId,bids:bids,gdprConsent:{consentString:gdprConsent.consentString||'',vendorData:gdprConsent.vendorData||{},gdprApplies:gdprConsent.gdprApplies?1:0,},uspConsent:uspConsent.usPrivacy||'',refererInfo:{canonicalUrl:properPage.canonical_url,numIframes:0,reachedTop:true,referer:properPage.referrer,},userExt:userExt,coppa:ProperMedia.utils.deepAccess(properSpecialOps,'coppa')!=='undefined'?!!ProperMedia.utils.deepAccess(properSpecialOps,'coppa'):undefined,};var adapter=new Criteo.PubTag.Adapters.Prebid(PROFILE_ID_PUBLISHERTAG,ADAPTER_VERSION,bidRequests,bidderRequest,properOps.prebid_version);request_url=adapter.buildCdbUrl();data=adapter.buildCdbRequest();request_cnt=fastBidRequestData['request_cnt'];}else{properLog.mylog('Criteo: Sovrn Building Request');var context=buildContext();request_url=buildCdbUrl(context);var requestData=formatRequest(bidData,bidder,bidderInfo,auctionId);var slots=ProperMedia.utils.objectValues(requestData['slots'])||[];data_map=requestData['data_map']||{};request_cnt=requestData['request_cnt'];if(slots.length==0)return false;data={id:ProperMedia.utils.generateUUID(),publisher:{url:properPage.bidder_page_url,},slots:slots,regs:{coppa:ProperMedia.utils.deepAccess(properSpecialOps,'coppa')!=='undefined'?!!ProperMedia.utils.deepAccess(properSpecialOps,'coppa'):undefined,},};if(bidderInfo.demand_type=='display'){data.publisher.networkid=parseInt(networkId);}
var schain=schainCheck(bidder);if(schain!='')ProperMedia.utils.deepSetValue(data,'source.ext.schain',schain);var eids=userIds.getEidsArray();if(eids)ProperMedia.utils.deepSetValue(data,'eids',eids);if(gdprConsent){data.gdprConsent={};if(typeof gdprConsent.gdprApplies!=='undefined'){data.gdprConsent.gdprApplies=!!gdprConsent.gdprApplies;}
if(typeof gdprConsent.consentString!=='undefined'){data.gdprConsent.consentData=gdprConsent.consentString;}}
if(uspConsent.usPrivacy){ProperMedia.utils.deepSetValue(data,'user.uspIab',uspConsent.usPrivacy);}}
var request={method:'POST',url:'request_url',data:data,bidRequests:bidRequests};properLog.mylog(request_url,bidder);bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();$.ajax({url:request_url,requestType:'cors',method:'POST',data:JSON.stringify(data),success:function(json){try{properLog.mylog(json,bidder);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var resp=ProperMedia.utils.safeJsonParse(json);if(publisherTagAvailable()){var adapter=Criteo.PubTag.Adapters.Prebid.GetAdapter(request);if(adapter){var pbjs_ads=adapter.interpretResponse(resp,request);if(pbjs_ads&&pbjs_ads.length>0){pbjs_ads.forEach(function(obj){var impid=obj.impid||'',price=obj.cpm||0,width=obj.width||0,height=obj.height||0,adcode=obj.ad||'',dealid=obj.dealId||'',crid=obj.creativeId||'',ttl=obj.ttl*1000||bidderInfo.default_bid_ttl;var ad=new adObj({bidder:bidder,size:width+'x'+height,price:parseFloat(price),gross:parseFloat(price),tag_id:impid,dealid:dealid,crid:crid,request_url:request_url,response:obj,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:ttl,floor:ProperMedia.utils.deepAccess(data_map,impid+'.floor')||0,target_slot:ProperMedia.utils.deepAccess(data_map,impid+'.slot_name')||'',uids:Object.keys(ProperMedia.utils.deepAccess(bidData,'auction.uids')),});if(bidderInfo.demand_type=='native'){ad.type='native';var nativeAd=obj.native||{};ad['native']=buildNative(nativeAd);if(ad.size=='2x2')ad.size='1x1';}else if(bidderInfo.demand_type=='video'){var vast_tag=obj.vastUrl;ad.type='video';ad.vast_tag=vast_tag;var tagTypes=ProperMedia.utils.parseVastVpaid(ad.vast_tag);ad.vast_type=tagTypes['vast_type'];ad.vpaid=tagTypes['vpaid'];ad.video_type=bidderInfo.video_type;}else{ad.adcode=adcode;}
bidData.logBidResponse(ad);});}}}else{if(resp&&resp['slots']&&Object.keys(resp['slots']).length>0){Object.keys(resp['slots']).forEach(function(key){var obj=resp['slots'][key];var impid=obj.impid||'',zoneid=obj.zoneid||'',price=obj.cpm||0,width=obj.width||0,height=obj.height||0,adcode=obj.creative||'',dealid=obj.deal||'',crid=obj.creativecode||'',ttl=obj.ttl*1000||bidderInfo.default_bid_ttl;var ad=new adObj({bidder:bidder,size:width+'x'+height,price:parseFloat(price),gross:parseFloat(price),tag_id:impid,dealid:dealid,crid:crid,request_url:request_url,response:obj,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:ttl,});if(bidderInfo.demand_type=='native'){ad.type='native';var nativeAd=obj.native||{};ad['native']=buildNative(nativeAd);if(ad.size=='2x2')ad.size='1x1';}else if(bidderInfo.demand_type=='video'){var vast_tag=obj.displayurl;ad.type='video';ad.vast_tag=vast_tag;var tagTypes=ProperMedia.utils.parseVastVpaid(ad.vast_tag);ad.vast_type=tagTypes['vast_type'];ad.vpaid=tagTypes['vpaid'];ad.video_type=bidderInfo.video_type;}else{ad.adcode=adcode;}
bidData.logBidResponse(ad);});}else{var ad=new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:request_url,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,});bidData.logNoBidResponse(ad);}}
bidData.incrementBidResponseCount(request_cnt);}catch(e){e.bidder=bidder;throw e;}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}
function buildNative(nativeAd){return{link:{url:ProperMedia.utils.deepAccess(nativeAd,'products.0.click_url')||'',},assets:[{title:{text:ProperMedia.utils.deepAccess(nativeAd,'products.0.title')||'',},},{img:{type:1,url:ProperMedia.utils.deepAccess(nativeAd,'products.0.image.url')||'',},},{img:{type:2,url:ProperMedia.utils.deepAccess(nativeAd,'advertiser.logo.url')||'',},},{type:1,value:ProperMedia.utils.deepAccess(nativeAd,'advertiser.description')||'',},{type:2,value:ProperMedia.utils.deepAccess(nativeAd,'products.0.description')||'',},{type:12,value:ProperMedia.utils.deepAccess(nativeAd,'products.0.call_to_action')||'',},],imptrackers:(ProperMedia.utils.deepAccess(nativeAd,'impression_pixels')||[]).map(function(pix){return pix.url;}),};}
function buildNativeFromPrebidNativeAd(nativeAd){return{link:{url:ProperMedia.utils.deepAccess(nativeAd,'clickUrl')||'',},assets:[{title:{text:ProperMedia.utils.deepAccess(nativeAd,'title')||'',},},{img:{type:1,url:ProperMedia.utils.deepAccess(nativeAd,'image')||'',},},{img:{type:2,url:ProperMedia.utils.deepAccess(nativeAd,'icon.url')||'',},},{type:1,value:ProperMedia.utils.deepAccess(nativeAd,'sponsoredBy')||'',},{type:2,value:ProperMedia.utils.deepAccess(nativeAd,'body')||'',},{type:12,value:ProperMedia.utils.deepAccess(nativeAd,'cta')||'',},],imptrackers:ProperMedia.utils.deepAccess(nativeAd,'impressionTrackers')||[],};}
function publisherTagAvailable(){return typeof Criteo!=='undefined'&&Criteo.PubTag&&Criteo.PubTag.Adapters&&Criteo.PubTag.Adapters.Prebid;}
function tryGetCriteoFastBid(){try{var fastBidStorageKey='criteo_fast_bid';var hashPrefix='// Hash: ';var fastBidFromStorage=properStorage.getDataFromLocalStorage(fastBidStorageKey,{bidderCode:bidder,gvlid:bidderInfo.gvlid,});if(fastBidFromStorage!==null){var firstLineEndPosition=fastBidFromStorage.indexOf('\n');var firstLine=fastBidFromStorage.substr(0,firstLineEndPosition).trim();if(firstLine.substr(0,hashPrefix.length)!==hashPrefix){properLog.mylog('No hash found in FastBid');properStorage.removeDataFromLocalStorage(fastBidStorageKey,{bidderCode:bidder,gvlid:bidderInfo.gvlid,});}else{var publisherTagHash=firstLine.substr(hashPrefix.length);var publisherTag=fastBidFromStorage.substr(firstLineEndPosition+1);try{properLog.mylog('Using Criteo FastBid');eval(publisherTag);}catch(e){console.error(e);}}}}catch(e){properLog.mylog('Criteo: Unable to get fast bid');}}
function buildContext(){var context={url:properPage.url,debug:ProperMedia.utils.deepAccess(properPage,'get_vars.pbt_debug')==='1',noLog:ProperMedia.utils.deepAccess(properPage,'get_vars.pbt_nolog')==='1',amp:true,};return context;}
function buildCdbUrl(context){var url=ENDPOINT_URL;url+='?profileId='+PROFILE_ID_INLINE;url+='&av='+String(ADAPTER_VERSION);url+='&wv='+encodeURIComponent(properOps.prebid_version);url+='&cb='+String(Math.floor(Math.random()*99999999999));if(context.amp){url+='&im=1';}
if(context.debug){url+='&debug=1';}
if(context.noLog){url+='&nolog=1';}
var bundle=readFromAllStorages(BUNDLE_COOKIE_NAME);if(bundle){url+=`&bundle=${bundle}`;}
var optout=readFromAllStorages(OPTOUT_COOKIE_NAME);if(optout){url+=`&optout=1`;}
return url;}
function getUserSyncs(){var origin='criteoPrebidAdapter';if(gdprConsent.gdprApplies&&gdprConsentModule.hasPurpose1Consent()){var queryParams=[];queryParams.push(`origin=${origin}`);queryParams.push(`topUrl=${properPage.domain}`);if(gdprConsent){if(gdprConsent.gdprApplies){queryParams.push(`gdpr=${gdprConsent.gdprApplies==true?1:0}`);}
if(gdprConsent.consentString){queryParams.push(`gdpr_consent=${gdprConsent.consentString}`);}}
if(uspConsent.ccpaApplies&&uspConsent.usPrivacy){queryParams.push(`us_privacy=${uspConsent.usPrivacy}`);}
var requestId=Math.random().toString();var jsonHash={bundle:readFromAllStorages(BUNDLE_COOKIE_NAME),cw:properStorage.cookiesAreEnabled({bidderCode:bidder,gvlid:bidderInfo.gvlid}),lsw:properStorage.localStorageIsEnabled({bidderCode:bidder,gvlid:bidderInfo.gvlid}),optoutCookie:readFromAllStorages(OPTOUT_COOKIE_NAME),origin:origin,requestId:requestId,tld:properPage.domain,topUrl:properPage.domain,version:'$prebid.version$'.replace(/\./g,'_'),};window.addEventListener('message',function handler(event){if(!event.data||event.origin!='https://gum.criteo.com'){return;}
if(event.data.requestId!==requestId){return;}
this.removeEventListener('message',handler);event.stopImmediatePropagation();const response=event.data;if(response.optout){deleteFromAllStorages(BUNDLE_COOKIE_NAME);saveOnAllStorages(OPTOUT_COOKIE_NAME,true,OPTOUT_RETENTION_TIME_HOUR);}else{if(response.bundle){saveOnAllStorages(BUNDLE_COOKIE_NAME,response.bundle,GUID_RETENTION_TIME_HOUR);}}},true);var jsonHashSerialized=JSON.stringify(jsonHash).replace(/"/g,'%22');userSyncs.add({type:'iframe',url:`https://gum.criteo.com/syncframe?${queryParams.join('&')}#${jsonHashSerialized}`,bidder:bidder,});}
return[];}
function readFromAllStorages(name){var fromCookie=properStorage.getCookie(name,{bidderCode:bidder,gvlid:bidderInfo.gvlid});var fromLocalStorage=properStorage.getDataFromLocalStorage(name,{bidderCode:bidder,gvlid:bidderInfo.gvlid,});return fromCookie||fromLocalStorage||undefined;}
function saveOnAllStorages(name,value,expirationTimeHours){var date=new Date();date.setTime(date.getTime()+expirationTimeHours*60*60*1000);var expires=`expires=${date.toUTCString()}`;properStorage.setCookie(name,value,expires,null,null,{bidderCode:bidder,gvlid:bidderInfo.gvlid});properStorage.setDataInLocalStorage(name,value,{bidderCode:bidder,gvlid:bidderInfo.gvlid});}
function deleteFromAllStorages(name){properStorage.setCookie(name,'',0,null,null,{bidderCode:bidder,gvlid:bidderInfo.gvlid});properStorage.removeDataFromLocalStorage(name,{bidderCode:bidder,gvlid:bidderInfo.gvlid});}
return{send:send,bidderInfo:bidderInfo,getUserSyncs:getUserSyncs,formatRequest:formatRequest,};})();bidAdapters.gumgum=(function(){var bidderInfo={rev_share:1,bid_grouping:'slot',default_bid_ttl:60000,native_sizes:{sticky_horizontal:'1x1',native_horizontal:'1x1',},gvlid:61,};var ENDPOINT_URL='https://g2.gumgum.com/hbid/imp',JCSI={t:0,rq:8,pbv:properOps.prebid_version},DELAY_REQUEST_TIME=1800000,pageViewId=null,siteId=null;var bidder='gumgum';function parseSize(size,bidderInfo){try{size=ProperMedia.utils.deepAccess(bidderInfo,'native_sizes.'+size)||size;var s=size.split('x');return[parseInt(s[0]),parseInt(s[1])];}catch(e){return false;}}
function formatRequest(bidData,bidder,bidderInfo){var requestData={imps:{},data_map:{},};if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){for(var i=0;i<data[size].length;i++){var tag_id=data[size][i];if(typeof requestData['imps'][tag_id]=='undefined'){var ids=tag_id.split('-');requestData['imps'][tag_id]={bidfloor:0,sizes:[],tag_id:tag_id,native_size:'',};if(ProperMedia.utils.deepAccess(bidderInfo,'native_sizes.'+size)){requestData['imps'][tag_id]['type']=2;if(!siteId){requestData['imps'][tag_id]['zoneId']=ids[0]||'';requestData['imps'][tag_id]['native_size']=size;}}else{requestData['imps'][tag_id]['type']=3;if(!siteId){requestData['imps'][tag_id]['zoneId']=ids[0]||'';requestData['imps'][tag_id]['slotId']=ids[1]||'';}else{requestData['imps'][tag_id]['slotId']=ids[0]||'';}}
requestData['data_map'][tag_id]={slot_name:slot_name||'',tag_id:tag_id,};}
var floor=getBidderFloor(bidder,size);if(!requestData['imps'][tag_id]['bidfloor']||floor<requestData['imps'][tag_id]['bidfloor']){requestData['imps'][tag_id]['bidfloor']=floor;}
if(requestData['imps'][tag_id]['type']==3){requestData['imps'][tag_id]['sizes'].push(parseSize(size));}}});}}
return requestData;}
function send(bidData){var bidder=bidData.bidder;var bidderInfo=properOps.bidder_info[bidder]||bidderInfo;if(ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.site_id')){var siteIds=(ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.site_id')||'').split('-');siteId=properDevice.isMobile()&&siteIds.length==2?siteIds[1]:siteIds[0];}
var browserParams=_getBrowserParams(properPage.url);var eids=getEids()||{};var schain=schainCheck(bidder);var requestData=formatRequest(bidData,bidder,bidderInfo);var imps=ProperMedia.utils.objectValues(requestData['imps'])||[];var data_map=requestData['data_map']||{};if(Object.keys(imps).length>0){Object.keys(imps).forEach(function(tag_id){send_slot(imps[tag_id]);});}
function send_slot(imp){var date=new Date();var data={pi:imp.type,lt:date.getTime(),to:date.getTimezoneOffset(),};if(siteId){data.pubId=siteId;}else{data.t=imp.zoneId;}
if(imp.type==3){var maxDims=getGreatestDimensions(imp.sizes);data.maxw=maxDims[0];data.maxh=maxDims[1];data.si=imp.slotId||'';data.bf=imp.sizes.reduce(function(acc,curSlotDim){return(acc+=(acc.length?',':'')+curSlotDim.join('x'));},'');}
if(pageViewId){data.pv=pageViewId;}
if(imp.bidfloor){data.fp=imp.bidfloor||0;data.fpc='USD';}
for(var eid in eids)data[eid]=eids[eid];if(gdprConsent){data.gdprApplies=gdprConsent.gdprApplies?1:0;}
if(data.gdprApplies){data.gdprConsent=gdprConsent.consentString;}
if(uspConsent.usPrivacy){data.uspConsent=uspConsent.usPrivacy;}
if(gppConsent){data.gppConsent={gppString:gppConsent.gppString,gpp_sid:gppConsent.applicableSections,};}
if(ProperMedia.utils.deepAccess(properSpecialOps,'coppa')){data.coppa=1;}
if(schain&&schain.nodes){data.schain=_serializeSupplyChainObj(schain);}
data=ProperMedia.utils.mergeObject(data,browserParams);var request_url=ENDPOINT_URL+'?'+ProperMedia.utils.formatQueryString(data);var request_cnt=imp.sizes.length;var bidRequest={id:ProperMedia.utils.makeid(14),tmax:3000,tId:ProperMedia.utils.generateUUID(),pi:data.pi,sizes:imp.sizes,url:request_url,method:'GET',data:data,};properLog.mylog(request_url,bidder);bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({url:request_url,method:'GET',bidder:bidder,edge:edge,success:function(resp){try{var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);if(resp){resp=ProperMedia.utils.safeJsonParse(resp);if(!resp||!Object.keys(resp).length||resp.err){var err_msg='No '+bidder+' bids returned. '+(ProperMedia.utils.deepAccess(resp,'err')?resp.err:'');properLog.mylog(err_msg);bidData.logNoBidResponse(new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:request_url,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,}));}else{properLog.mylog(resp,bidder);var obj=resp.ad||{},price=obj.price||0,crid=obj.id||'',adcode=obj.markup||'',width=obj.width||0,height=obj.height||0,wrapper=resp.cw||'',adomain=ProperMedia.utils.deepAccess(resp,'meta.adomain')||[];if(wrapper){adcode=wrapper?getWrapperCode(wrapper,Object.assign({},resp,{bidRequest})):adcode;}
pageViewId=ProperMedia.utils.deepAccess(resp,'pag.pvid')||null;var size=ProperMedia.utils.deepAccess(imp,'native_size')||width+'x'+height;let ad=new adObj({bidder:bidder,price:parseFloat(price),gross:parseFloat(price),adcode:adcode,tag_id:imp.tag_id,size:size,crid:crid,adomain:adomain,request_url:request_url,response:obj,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:bidderInfo.default_bid_ttl,floor:imp.bidfloor||0,uids:Object.keys(eids)||[],target_slot:ProperMedia.utils.deepAccess(data_map,imp.tag_id+'.slot_name')||'',});bidData.logBidResponse(ad);}}else{bidData.logNoBidResponse(new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:request_url,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,}));}
bidData.incrementBidResponseCount(request_cnt);}catch(e){e.bidder=bidder;throw e;}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}}
function getEids(){userId=userIds.getUIdsObj();var idProperties=['uid','eid','lipbid','envelope'];return Object.keys(userId).reduce(function(eids,provider){var eid=userId[provider];switch(typeof eid){case 'string':eids[provider]=eid;break;case 'object':var idProp=idProperties.filter(function(prop){return typeof eid[prop]!=='undefined';});idProp.length&&(eids[provider]=eid[idProp[0]]);break;}
return eids;},{});}
function getGreatestDimensions(sizes){var maxw=0;var maxh=0;var greatestVal=0;sizes.forEach(function(bannerSize){var[width,height]=bannerSize;var greaterSide=width>height?width:height;if(greaterSide>greatestVal||(greaterSide===greatestVal&&width>=maxw&&height>=maxh)){greatestVal=greaterSide;maxw=width;maxh=height;}});return[maxw,maxh];}
function getWrapperCode(wrapper,data){return wrapper.replace('AD_JSON',ProperMedia.utils.b64EncodeUnicode(JSON.stringify(data)));}
function _serializeSupplyChainObj(schainObj){var serializedSchain=schainObj.ver+','+schainObj.complete;schainObj.nodes.map(function(node){serializedSchain+=`!${encodeURIComponent(node['asi']||'')},`;serializedSchain+=`${encodeURIComponent(node['sid']||'')},`;serializedSchain+=`${encodeURIComponent(node['hp']||'')},`;serializedSchain+=`${encodeURIComponent(node['rid']||'')},`;serializedSchain+=`${encodeURIComponent(node['name']||'')},`;serializedSchain+=`${encodeURIComponent(node['domain']||'')}`;});return serializedSchain;}
function _getBrowserParams(topWindowUrl){var paramRegex=function(paramName){return new RegExp(`[?#&](${paramName}=(.*?))($|&)`,'i');};var browserParams={};var topWindow;var topScreen;var topUrl;var ggad;var ggdeal;var ns;function getNetworkSpeed(){var connection=window.navigator&&(window.navigator.mozConnection||window.navigator.webkitConnection);var Mbps=connection&&(connection.downlink||connection.bandwidth);return Mbps?Math.round(Mbps*1024):null;}
function getOgURL(){var ogURL='';var ogURLSelector="meta[property='og:url']";var head=document&&document.getElementsByTagName('head')[0];var ogURLElement=head.querySelector(ogURLSelector);ogURL=ogURLElement?ogURLElement.content:null;return ogURL;}
function stripGGParams(url){var params=['ggad','ggdeal'];return params.reduce((result,param)=>{var matches=url.match(paramRegex(param));if(!matches)return result;matches[1]&&(result=result.replace(matches[1],''));matches[3]&&(result=result.replace(matches[3],''));return result;},url);}
try{topWindow=window.top;topScreen=topWindow.screen;topUrl=topWindowUrl||'';}catch(error){return browserParams;}
browserParams={vw:topWindow.innerWidth,vh:topWindow.innerHeight,sw:topScreen.width,sh:topScreen.height,pu:stripGGParams(topUrl),ce:properStorage.cookiesAreEnabled({bidderCode:bidder}),dpr:topWindow.devicePixelRatio||1,jcsi:JSON.stringify(JCSI),ogu:getOgURL(),};ns=getNetworkSpeed();if(ns){browserParams.ns=ns;}
ggad=(topUrl.match(paramRegex('ggad'))||[0,0,0])[2];if(ggad)browserParams[isNaN(ggad)?'eAdBuyId':'adBuyId']=ggad;ggdeal=(topUrl.match(paramRegex('ggdeal'))||[0,0,0])[2];if(ggdeal)browserParams.ggdeal=ggdeal;return browserParams;}
function removeCreative(slot){try{var element=window.top.document.getElementById('GG_PXS');if(element){var gumgum_top_elem=element.parentNode;if(gumgum_top_elem){gumgum_top_elem.parentNode.removeChild(gumgum_top_elem);}}}catch(e){console.error(e);}}
return{send:send,bidderInfo:bidderInfo,formatRequest:formatRequest,removeCreative:removeCreative,};})();bidAdapters.ix=(function(){var bidderInfo={rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:300000,gvlid:10,};var ENDPOINT_URL='https://htlb.casalemedia.com/cygnus',USER_SYNC_URL='https://js-sec.indexww.com/um/ixmatch.html',LOCAL_STORAGE_FEATURE_TOGGLES_KEY='ix_features',bidder='ix',site_id=null;var BANNER_ENDPOINT_VERSION=7.2,VIDEO_ENDPOINT_VERSION=8.1,CENT_TO_DOLLAR_FACTOR=100;var EID_SOURCE_MAPPING={'liveramp.com':{rti:'idl',adapter:'idl_env',},'id5-sync.com':{rti:'',adapter:'id5id',},'pubcid.org':{rti:'',adapter:'pubcid',},};let storageEnfObj={gvlid:bidderInfo.gvlid,bidderCode:bidder,};const FEATURE_TOGGLES={featureToggles:{},isFeatureEnabled:function(ft){return ProperMedia.utils.deepAccess(this.featureToggles,`features.${ft}.activated`);},getFeatureToggles:function(){if(properStorage.localStorageIsEnabled(storageEnfObj)){const parsedToggles=ProperMedia.utils.safeJsonParse(properStorage.getDataFromLocalStorage(LOCAL_STORAGE_FEATURE_TOGGLES_KEY,storageEnfObj));if(ProperMedia.utils.deepAccess(parsedToggles,'expiry')&&parsedToggles.expiry>=new Date().getTime()){this.featureToggles=parsedToggles;}else{this.clearFeatureToggles();}}},setFeatureToggles:function(serverResponse){const responseBody=serverResponse;const expiryTime=new Date();const toggles=ProperMedia.utils.deepAccess(responseBody,'ext.features');if(toggles){this.featureToggles={expiry:expiryTime.setHours(expiryTime.getHours()+1),features:toggles,};if(properStorage.localStorageIsEnabled(storageEnfObj)){properStorage.setDataInLocalStorage(LOCAL_STORAGE_FEATURE_TOGGLES_KEY,JSON.stringify(this.featureToggles),storageEnfObj);}}},clearFeatureToggles:function(){this.featureToggles={};if(properStorage.localStorageIsEnabled(storageEnfObj)){properStorage.removeDataFromLocalStorage(LOCAL_STORAGE_FEATURE_TOGGLES_KEY,storageEnfObj);}},};function formatRequest(bidData,bidder,bidderInfo){var requestData={imps:[],index_bids:{},request_cnt:0,};if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){for(var i=0;i<data[size].length;i++){var tag_id=data[size][i];if(typeof requestData['imps'][tag_id]=='undefined'){var id=tag_id+'-'+ProperMedia.utils.makeid(5);var s=size.split('x');var floor=getBidderFloor(bidder,size);var imp={id:String(id),bidfloor:floor,bidfloorcur:'USD',ext:{sid:id,siteID:String(site_id),},};if(bidderInfo.demand_type=='display'){imp['banner']={topframe:1,format:[{w:parseInt(s[0])||0,h:parseInt(s[1])||0,ext:{bidfloor:floor,},},],};}else if(bidderInfo.demand_type=='video'){imp['video']={topframe:1,skip:1,linearity:1,minduration:10,maxduration:30,placement:bidderInfo.video_type=='outstream'?3:1,playbackmethod:bidderInfo.video_type=='outstream'?[6]:[3],api:[1,2],mimes:['video/mp4','application/javascript'],protocols:[2,3,5,6],w:parseInt(s[0])||0,h:parseInt(s[1])||0,};}
requestData['imps'].push(imp);requestData['index_bids'][id]={slot_name:slot_name||'',width:parseInt(s[0]),height:parseInt(s[1]),tag_id:tag_id,floor:floor,};}
requestData['request_cnt']++;}});}}
return requestData;}
function send(bidData){var bidder=bidData.bidder;var bidderInfo=properOps.bidder_info[bidder]||bidderInfo;FEATURE_TOGGLES.getFeatureToggles();var siteIds=(ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.site_id')||'').toString().split('-')||['',''];site_id=properDevice.isMobile()&&siteIds.length==2?siteIds[1]:siteIds[0];if(!site_id){properLog.mylog('Error: '+bidder+' Site ID is Required.');return false;}
var requestData=formatRequest(bidData,bidder,bidderInfo);var imps=requestData['imps']||[];var request_cnt=requestData['request_cnt'];var r={id:ProperMedia.utils.generateUUID(),site:{ref:properPage.referrer,page:properPage.bidder_page_url,},ext:{source:'prebid',ixdiag:{sn:0,ls:properStorage.localStorageIsEnabled(storageEnfObj),imps:imps.length||0,},},imp:imps,};var allEids=userIds.getEidsArray();var eidInfo=getEidInfo(allEids);var userEids=eidInfo.toSend;var uids=eidInfo.uids;if(window.headertag&&typeof window.headertag.getIdentityInfo==='function'){var identityInfo=window.headertag.getIdentityInfo();if(identityInfo&&typeof identityInfo==='object'){for(var partnerName in identityInfo){if(typeof identityInfo[partnerName]!=='undefined'){var response=identityInfo[partnerName];if(!response.responsePending&&response.data&&typeof response.data==='object'&&Object.keys(response.data).length&&!eidInfo.seenSources[response.data.source]){userEids.push(response.data);}}}}}
if(userEids.length>0){ProperMedia.utils.deepSetValue(r,'user.eids',userEids);}
ProperMedia.utils.deepSetValue(r,'source.tid',ProperMedia.utils.deepAccess(bidData,'auction.id'));var schain=schainCheck(bidder);if(schain!='')ProperMedia.utils.deepSetValue(r,'source.ext.schain',schain);if(ProperMedia.utils.deepAccess(properSpecialOps,'coppa')){ProperMedia.utils.deepSetValue(r,'regs.coppa',1);}
if(typeof gdprConsent['gdprApplies']!=='undefined'){ProperMedia.utils.deepSetValue(r,'regs.ext.gdpr',Number(gdprConsent.gdprApplies));}
if(typeof gdprConsent['consentString']!=='undefined'){ProperMedia.utils.deepSetValue(r,'user.ext.consent',gdprConsent.consentString||'');}
if(typeof gdprConsent['addtlConsent']!=='undefined'&&gdprConsent.addtlConsent){ProperMedia.utils.deepSetValue(r,'user.ext.consented_providers_settings.addtl_consent',gdprConsent.addtlConsent);}
if(uspConsent.usPrivacy){ProperMedia.utils.deepSetValue(r,'regs.ext.us_privacy',uspConsent.usPrivacy);}
if(gppConsent){ProperMedia.utils.deepSetValue(r,'regs.gpp',gppConsent.gppString);ProperMedia.utils.deepSetValue(r,'regs.gpp_sid',gppConsent.applicableSections);}
var payload={s:site_id,sn:0,r:JSON.stringify(r),};let request_url=ENDPOINT_URL+'?s='+payload.s;properLog.mylog(request_url,bidder);bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({url:request_url,contentType:'text/plain',method:'POST',bidder:bidder,edge:edge,data:JSON.stringify(r),success:function(resp){try{var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);if(resp){resp=ProperMedia.utils.safeJsonParse(resp);if(!resp||!resp.seatbid||resp.seatbid.length==0||!resp.seatbid[0].bid||!resp.seatbid[0].bid.length){properLog.mylog('No '+bidder+' bids returned');bidData.logNoBidResponse(new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:request_url,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,}));}else{properLog.mylog(resp,bidder);for(var x=0;x<resp.seatbid.length;x++){for(var i=0;i<resp.seatbid[x].bid.length;i++){var obj=resp.seatbid[x].bid[i],impid=obj.impid||'',cid=obj.cid||'',crid=obj.crid||'',adid=obj.adid||'',adomain=obj.adomain||[],adcode=obj.adm||'';var ttl=ProperMedia.utils.isNumber(obj.ttl)?obj.ttl*1000:bidderInfo.default_bid_ttl;var price=parseFloat(obj.price/CENT_TO_DOLLAR_FACTOR)||0;var bid_data=requestData.index_bids[impid];var ad=new adObj({bidder:bidder,price:price,gross:price,tag_id:bid_data.tag_id,cid:cid,crid:crid,adid:adid,adomain:adomain,request_url:request_url,response:obj,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:ttl,floor:ProperMedia.utils.deepAccess(bid_data,'floor')||0,target_slot:ProperMedia.utils.deepAccess(bid_data,'slot_name')||'',uids,});if(bidderInfo.demand_type=='video'){ad.type='video';ad.size=bid_data.width+'x'+bid_data.height;ad.vast_tag=ProperMedia.utils.deepAccess(obj,'ext.vasturl');var tagTypes=ProperMedia.utils.parseVastVpaid(ad.vast_tag);ad.vast_type=tagTypes['vast_type'];ad.vpaid=tagTypes['vpaid'];ad.video_type=bidderInfo.video_type;}else{ad.size=obj.w+'x'+obj.h;ad.adcode=adcode;}
bidData.logBidResponse(ad);}}
FEATURE_TOGGLES.setFeatureToggles(resp);}}else{bidData.logNoBidResponse(new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:request_url,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,}));}
bidData.incrementBidResponseCount(request_cnt);}catch(e){e.bidder=bidder;throw e;}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}
function getEidInfo(allEids){var toSend=[];var uids=[];var seenSources={};if(Array.isArray(allEids)){for(var i=0;i<allEids.length;i++){var eid=allEids[i];if(typeof EID_SOURCE_MAPPING[eid.source]!=='undefined'&&ProperMedia.utils.deepAccess(eid,'uids.0')){seenSources[eid.source]=true;if(EID_SOURCE_MAPPING[eid.source]['rti']!=''){eid.uids[0].ext={rtiPartner:EID_SOURCE_MAPPING[eid.source]['rti'],};}
delete eid.uids[0].atype;toSend.push(eid);if(EID_SOURCE_MAPPING[eid.source]['adapter']!=''){uids.push(EID_SOURCE_MAPPING[eid.source]['adapter']);}}}}
return{toSend:toSend,seenSources:seenSources,uids:uids};}
function getUserSyncs(){userSyncs.add({type:'iframe',url:USER_SYNC_URL,bidder:bidder,});}
return{send:send,bidderInfo:bidderInfo,getUserSyncs:getUserSyncs,formatRequest:formatRequest,};})();bidAdapters.justpremium=(function(){var bidderInfo={rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:60000,dont_refresh:1,gvlid:62,native_sizes:{desktop:{skin:'1x1',sticky_horizontal:'728x90',native_horizontal:'728x90',},mobile:{sticky_horizontal:'320x50',native_horizontal:'320x50',},},};var ENDPOINT_URL='https://pre.ads.justpremium.com/v/2.0/t/xhr',SYNC_ENDPOINT='https://pre.ads.justpremium.com/v/1.0/t/sync',JP_ADAPTER_VERSION='1.8.3';var bidder='justpremium';function formatRequest(bidData){var requestData={imps:{},JPbids:{},data_map:{},request_cnt:0,};var device=properDevice.isMobile()?'mobile':'desktop';if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){for(var i=0;i<data[size].length;i++){var tag_id=data[size][i];if(typeof requestData['imps'][tag_id]=='undefined'){requestData['imps'][tag_id]={tag_id:parseInt(tag_id),sizes:[],slot_types:[[],{}],};requestData['data_map'][tag_id]={slot_name:slot_name||'',tag_id:tag_id,};}
requestData['JPbids'][tag_id]=size;var ad_size=ProperMedia.utils.deepAccess(bidderInfo,'native_sizes.'+device+'.'+size)||size;var s=ad_size.split('x').map(function(x){return parseInt(x);});if(s[0]=='728'&&s[1]=='90'){requestData['imps'][tag_id]['slot_types'][0]=requestData['imps'][tag_id]['slot_types'][0].concat(['cf','pu','as']);requestData['imps'][tag_id]['sizes'].push([s[0],s[1]]);requestData['request_cnt']++;}else if(s[0]=='160'&&s[1]=='600'){requestData['imps'][tag_id]['slot_types'][0]=requestData['imps'][tag_id]['slot_types'][0].concat(['sa']);requestData['imps'][tag_id]['sizes'].push([s[0],s[1]]);requestData['request_cnt']++;}else if(s[0]=='320'&&s[1]=='50'){var allow_params=['ms'];if(size=='native_horizontal'&&properDevice.isMobile()){allow_params.push('is');}
requestData['imps'][tag_id]['slot_types'][0]=requestData['imps'][tag_id]['slot_types'][0].concat(allow_params);requestData['imps'][tag_id]['sizes'].push([s[0],s[1]]);requestData['request_cnt']++;}else if(s[0]=='1'&&s[1]=='1'){requestData['imps'][tag_id]['slot_types'][0]=requestData['imps'][tag_id]['slot_types'][0].concat(['wp']);requestData['imps'][tag_id]['sizes'].push([s[0],s[1]]);requestData['request_cnt']++;}else{return requestData;}}});}}
return requestData;}
function send(bidData){var requestData=formatRequest(bidData);var data_map=requestData['data_map']||{};var request_cnt=requestData['request_cnt'];if(request_cnt==0){return false;}
var send_struct={zone:Object.keys(requestData['imps']).map(function(x){return parseInt(x);}),referer:properPage.url,hostname:window.top.location.hostname,protocol:window.top.location.protocol.replace(':',''),sw:window.top.screen.width,sh:window.top.screen.height,ww:window.top.innerWidth,wh:window.top.innerHeight,c:(function(reqs){var ret={};Object.keys(reqs).forEach(function(x){ret[reqs[x].tag_id]=reqs[x].slot_types;});return ret;})(requestData['imps']),id:parseInt(Object.keys(requestData['imps']).shift()),sizes:(function(reqs){var ret={};Object.keys(reqs).forEach(function(x){ret[reqs[x].tag_id]=reqs[x].sizes;});return ret;})(requestData['imps']),version:{prebid:properOps.prebid_version,jp_adapter:JP_ADAPTER_VERSION,},};if(!gppConsentModule.isConsentDenied()&&gdprConsentModule.hasPurpose4Consent()){send_struct.pubcid=properUser.pubcid;}
send_struct.uids=userIds.getUIdsObj();if(properOps.schain){ProperMedia.utils.deepSetValue(send_struct,'schain',properOps.schain);}
if(gdprConsent){send_struct.gdpr_consent={consent_string:gdprConsent.consentString,consent_required:typeof gdprConsent.gdprApplies==='boolean'?gdprConsent.gdprApplies:true,};}
if(uspConsent.usPrivacy){send_struct.us_privacy=uspConsent.usPrivacy;}
var request_string=JSON.stringify(send_struct);var ajax_url_final=ENDPOINT_URL+'?i='+ +new Date();properLog.mylog(ajax_url_final,bidder);bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({method:'POST',url:ajax_url_final,requestType:'cors',bidder:bidder,edge:edge,data:request_string,success:function(resp){try{var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);resp=ProperMedia.utils.safeJsonParse(resp);properLog.mylog(resp,bidder);if(resp&&resp.bid){for(var key in resp.bid){if(resp.bid[key]&&resp.bid[key].length>0){var bidResp=resp.bid[key].pop();var tagid=key,price=bidResp.price||0,width=bidResp.width||1,height=bidResp.height||1,adcode=bidResp.adm||'',crid=bidResp.id||'',ttl=bidResp.ttl*1000||bidderInfo.default_bid_ttl;var ad_size=ProperMedia.utils.deepAccess(requestData,'JPbids.'+tagid)||width+'x'+height;let ad=new adObj({bidder:bidder,size:ad_size,price:parseFloat(price),gross:parseFloat(price),adcode:adcode,tag_id:tagid,crid:crid,request_url:ajax_url_final,response:bidResp,ttl:ttl,response_ms:bid_response_ms,received_ts:bids_received_ts,uids:Object.keys(ProperMedia.utils.deepAccess(bidData,'auction.uids')),target_slot:ProperMedia.utils.deepAccess(data_map,tagid+'.slot_name')||'',});bidData.logBidResponse(ad);}else{let ad=new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:ajax_url_final,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,});bidData.logNoBidResponse(ad);}}}else{var ad=new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:ajax_url_final,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,});bidData.logNoBidResponse(ad);}
bidData.incrementBidResponseCount(request_cnt);}catch(e){e.bidder=bidder;throw e;}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}
function getUserSyncs(){var params='?_c='+'a'+Math.random().toString(36).substring(7)+Date.now();if(typeof gdprConsent.gdprApplies==='boolean'&&gdprConsent.gdprApplies&&gdprConsent.consentString){params+='&consentString='+encodeURIComponent(gdprConsent.consentString);}
if(uspConsent.usPrivacy){params+='&usPrivacy='+encodeURIComponent(uspConsent.usPrivacy);}
userSyncs.add({type:'iframe',url:SYNC_ENDPOINT+params,bidder:bidder,});}
return{send:send,bidderInfo:bidderInfo,getUserSyncs:getUserSyncs,formatRequest:formatRequest,};})();bidAdapters.kargo=(function(){var bidderInfo={rev_share:1,bid_grouping:'page',default_bid_ttl:300000,gvlid:972,native_sizes:{native_vertical:'300x250',native_horizontal:'300x250',sticky_horizontal:'300x50',},};var takeover_price={301:24,};var bidder='kargo',ENDPOINT_URL='https://krk.kargo.com/api/v2/bid',SYNCURL='https://crb.kargo.com/api/v1/initsyncrnd/{UUID}?seed={SEED}&idx={INDEX}&gdpr={GDPR}&gdpr_consent={GDPR_CONSENT}&us_privacy={US_PRIVACY}&gpp={GPP_STRING}&gpp_sid={GPP_SID}',SYNC_COUNT=5,lastPageUrl='',dummyCpmUpperBound=999999;function parseSize(size){size=ProperMedia.utils.deepAccess(bidderInfo,'native_sizes.'+size)||size;var s=size.split('x');return[parseInt(s[0]),parseInt(s[1])];}
function formatRequest(bidData){var requestData={bidIDs:{},bidSizes:{},request_cnt:0,tag_size_map:{},data_map:{},floor:0,};if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){Object.keys(data).forEach(function(size){for(var i=0;i<data[size].length;i++){var tag_id=data[size][i];var ids=tag_id.split('-');var bidId=ids[0];if(typeof requestData['bidIDs'][tag_id]=='undefined'){requestData['bidIDs'][tag_id]=bidId;requestData['bidSizes'][tag_id]=[];requestData['data_map'][tag_id]={slot_name:slot_name||'',tag_id:tag_id,};}
requestData['bidSizes'][tag_id].push(parseSize(size));var floor=getBidderFloor(bidder,size);if(!requestData['floor']||floor<requestData['floor']){requestData['floor']=floor;}
requestData['request_cnt']++;if(ProperMedia.utils.deepAccess(bidderInfo,'native_sizes.'+size)){requestData['tag_size_map'][tag_id]=size;}}});}
return requestData;}
function send(bidData){if(properPage.isolated){properLog.mylog('Turn off Kargo bidder for isolated pages');return true;}
var requestData=formatRequest(bidData.requests);var data_map=requestData['data_map']||{};var request_cnt=requestData['request_cnt'];var payload={sessionId:properSession.sessionData.uuid,requestCount:getRequestCount(),timeout:properOps.tmax,currency:'USD',cpmGranularity:1,timestamp:new Date().getTime(),bidIDs:requestData['bidIDs'],bidSizes:requestData['bidSizes'],cpmRange:{floor:requestData['floor'],ceil:dummyCpmUpperBound,},userIDs:{},pageURL:window.location.href,prebidVersion:properOps.prebid_version,};var tdid=false;var usp=uspConsent.usPrivacy?uspConsent.usPrivacy:'1---';var meta=_getAllMetadata(tdid,usp);var schain=schainCheck(bidder);if(schain!='')payload.schain=schain;ProperMedia.utils.mergeObject(payload,meta);properLog.mylog(ENDPOINT_URL,bidder);bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({url:ENDPOINT_URL+'?json='+encodeURIComponent(JSON.stringify(payload)),method:'GET',bidder:bidder,edge:edge,requestType:'cors',success:function(resp){try{resp=ProperMedia.utils.safeJsonParse(resp);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);if(resp&&Object.keys(resp).length>0){properLog.mylog(resp,bidder);Object.keys(resp).forEach(function(bidId){var adUnit=resp[bidId];var meta=null,size=adUnit.width+'x'+adUnit.height,price=Number(adUnit.cpm)||0,adcode=adUnit.adm||'',crid=adUnit.id||'';if(adUnit.metadata&&adUnit.metadata.landingPageDomain){meta={clickUrl:adUnit.metadata.landingPageDomain,};}
if(ProperMedia.utils.deepAccess(requestData,'tag_size_map.'+bidId)){size=ProperMedia.utils.deepAccess(requestData,'tag_size_map.'+bidId);}
if(adUnit.targetingCustom==301&&properAdPool.displayed_ads.length==0){properPage.takeover.bidder=bidder;properPage.takeover.price=takeover_price[adUnit.targetingCustom]||price;properPage.isolated=1;}
var ad=new adObj({bidder:bidder,size:size,price:parseFloat(price),gross:parseFloat(price),adcode:adcode,tag_id:bidId,crid:crid,request_url:ENDPOINT_URL,response:adUnit,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:bidderInfo.default_bid_ttl,floor:ProperMedia.utils.deepAccess(requestData,'floor')||0,target_slot:ProperMedia.utils.deepAccess(data_map,bidId+'.slot_name')||'',});bidData.logBidResponse(ad);});}else{properLog.mylog('no kargo bids returned');var ad=new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:ENDPOINT_URL,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,});bidData.logNoBidResponse(ad);}
addUserSyncs();bidData.incrementBidResponseCount(request_cnt);}catch(e){e.bidder=bidder;throw e;}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}
function getRequestCount(){if(!window.location){return 0;}
if(lastPageUrl===window.location.pathname){return++requestCounter;}
lastPageUrl=window.location.pathname;return(requestCounter=0);}
function _getCrbFromCookie(){try{var crb=JSON.parse(decodeURIComponent(properStorage.getCookie('krg_crb',{bidderCode:bidder,gvlid:bidderInfo.gvlid})));if(crb&&crb.v){var vParsed=JSON.parse(atob(crb.v));if(vParsed){return vParsed;}}
return{};}catch(e){return{};}}
function addUserSyncs(){var seed=ProperMedia.utils.generateUUID();var clientId=_getClientId();var gdpr=gdprConsent&&gdprConsent.gdprApplies?1:0;var gdprConsentString=gdprConsent&&gdprConsent.consentString?gdprConsent.consentString:'';var gppString=gppConsent&&gppConsent.gppString?gppConsent.gppString:'';var gppApplicableSections=gppConsent&&gppConsent.applicableSections&&Array.isArray(gppConsent.applicableSections)?gppConsent.applicableSections.join(','):'';if(typeof uspConsent.usPrivacy=='string'&&uspConsent.usPrivacy.length==4&&uspConsent.usPrivacy[0]==1&&uspConsent.usPrivacy[2]=='Y'){return;}
if(seed&&clientId){for(var i=0;i<SYNC_COUNT;i++){userSyncs.add({type:'image',url:SYNCURL.replace('{UUID}',clientId).replace('{SEED}',seed).replace('{INDEX}',i).replace('{GDPR}',gdpr).replace('{GDPR_CONSENT}',gdprConsentString).replace('{US_PRIVACY}',uspConsent.usPrivacy||'').replace('{GPP_STRING}',gppString).replace('{GPP_SID}',gppApplicableSections),bidder:bidder,});}}}
function _getCrbFromLocalStorage(){try{return JSON.parse(atob(_getLocalStorageSafely('krg_crb')));}catch(e){return{};}}
function _getCrb(){var localStorageCrb=_getCrbFromLocalStorage();if(Object.keys(localStorageCrb).length){return localStorageCrb;}
return _getCrbFromCookie();}
function _getLocalStorageSafely(key){try{return properStorage.getDataFromLocalStorage(key,{bidderCode:bidder,gvlid:bidderInfo.gvlid});}catch(e){return null;}}
function _getUserIds(tdid,usp){var crb=_getCrb();var userIds={kargoID:crb.userId,clientID:crb.clientId,crbIDs:crb.syncIds||{},optOut:crb.optOut,usp:usp,};if(gdprConsent){userIds['gdpr']={consent:gdprConsent.consentString||'',applies:!!gdprConsent.gdprApplies,};}
if(gppConsent){const parsedGPP={};if(gppConsent.gppString){parsedGPP.gppString=gppConsent.gppString;}
if(gppConsent.applicableSections){parsedGPP.applicableSections=gppConsent.applicableSections;}
if(Object.keys(parsedGPP).length){userIds['gpp']=parsedGPP;}}
if(tdid){userIds.tdID=tdid;}
return userIds;}
function _getClientId(){var crb=_getCrb();if(crb){return crb.clientId;}
return null;}
function _getAllMetadata(tdid,usp){return{userIDs:_getUserIds(tdid,usp),pageURL:window.location.href,rawCRB:properStorage.getCookie('krg_crb',{bidderCode:bidder,gvlid:bidderInfo.gvlid}),rawCRBLocalStorage:_getLocalStorageSafely('krg_crb'),};}
function onBidWon(bid,slot){if(ProperMedia.utils.deepAccess(properPage,'takeover.logged')==false&&ProperMedia.utils.deepAccess(properPage,'takeover.bidder')!=''&&ProperMedia.utils.deepAccess(properPage,'takeover.bidder')==bid.bidder){properLog.send_takeover_pixel(slot,bid);}
return true;}
return{send:send,onBidWon:onBidWon,bidderInfo:bidderInfo,formatRequest:formatRequest,};})();bidAdapters.mediagrid=(function(){var bidderInfo={rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:360000,gvlid:686,};var ENDPOINT_URL='https://grid.bidswitch.net/hbjson',SYNC_ENDPOINT='https://x.bidswitch.net/sync?ssp=themediagrid',USER_ID_KEY='tmguid',bidder='mediagrid';var storageEnfObj={};function parseSize(size){var s=size.split('x');return{w:parseInt(s[0]),h:parseInt(s[1]),};}
function formatRequest(bidData,bidder,bidderInfo){var requestData={imps:{},data_map:{},request_cnt:0,};if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){for(var i=0;i<data[size].length;i++){var tag_id=data[size][i];var div_id='grid-'+ProperMedia.utils.generateUUID();let{w,h}=parseSize(size);if(typeof requestData['imps'][tag_id]=='undefined'){requestData['imps'][tag_id]={id:String(tag_id),tagid:String(tag_id),bidfloor:0,ext:{divid:div_id,},};if(bidderInfo.demand_type=='display'){requestData['imps'][tag_id]['banner']={format:[],w,h,};}else if(bidderInfo.demand_type=='video'){requestData['imps'][tag_id]['video']={topframe:1,skip:1,linearity:bidderInfo.video_type=='outstream'?2:1,minduration:10,maxduration:30,placement:bidderInfo.video_type=='outstream'?3:1,playbackmethod:bidderInfo.video_type=='outstream'?[6]:[3],api:[1,2],mimes:['video/mp4','application/javascript'],protocols:[2,3,5,6],w,h,};}
requestData['data_map'][tag_id]={slot_name:slot_name||'',divid:div_id,floor:0,};}
var floor=getBidderFloor(bidder,size);if(!requestData['imps'][tag_id]['bidfloor']||floor<requestData['imps'][tag_id]['bidfloor']){requestData['imps'][tag_id]['bidfloor']=floor;requestData['data_map'][tag_id]=floor;}
if(bidderInfo.demand_type=='display'){requestData['imps'][tag_id]['banner']['format'].push({w,h});}
requestData['request_cnt']++;}});}}
return requestData;}
function send(bidData){var bidder=bidData.bidder;var bidderInfo=properOps.bidder_info[bidder]||bidderInfo;storageEnfObj={gvlid:bidderInfo.gvlid||GVLID,bidderCode:bidder,};var request_url=ENDPOINT_URL;var requestData=formatRequest(bidData,bidder,bidderInfo);var imps=ProperMedia.utils.objectValues(requestData['imps'])||[];var data_map=requestData['data_map']||{};var request_cnt=requestData['request_cnt'];var openRTBObj={id:ProperMedia.utils.generateUUID(),tmax:properOps.tmax,imp:imps,site:{page:properPage.url,},source:{tid:bidderInfo.auctionId||ProperMedia.utils.generateUUID(),ext:{wrapper:'Prebid_js',wrapper_version:properOps.prebid_version,},},};const fpdUserId=getUserIdFromFPDStorage();if(fpdUserId){ProperMedia.utils.deepSetValue(openRTBObj,'user.id',fpdUserId.toString());}
var eids=userIds.getEidsArray();if(eids&&eids.length){ProperMedia.utils.deepSetValue(openRTBObj,'user.ext.eids',eids);}
var uids=Object.keys(ProperMedia.utils.deepAccess(bidData,'auction.uids'));var schain=schainCheck(bidder);if(schain!='')ProperMedia.utils.deepSetValue(openRTBObj,'source.ext.schain',schain);ProperMedia.utils.deepSetValue(openRTBObj,'regs.coppa',ProperMedia.utils.deepAccess(properSpecialOps,'coppa')?1:0);ProperMedia.utils.deepSetValue(openRTBObj,'user.ext.consent',gdprConsent.consentString);if(typeof gdprConsent.gdprApplies==='boolean'){ProperMedia.utils.deepSetValue(openRTBObj,'regs.ext.gdpr',Number(gdprConsent.gdprApplies));}
if(uspConsent.usPrivacy){ProperMedia.utils.deepSetValue(openRTBObj,'regs.ext.us_privacy',uspConsent.usPrivacy);}
if(gppConsent){ProperMedia.utils.deepSetValue(openRTBObj,'regs.gpp',gppConsent.gppString);ProperMedia.utils.deepSetValue(openRTBObj,'regs.gpp_sid',gppConsent.applicableSections);}
properLog.mylog(request_url,bidder);bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({url:request_url,requestType:'cors',method:'POST',bidder:bidder,edge:edge,data:JSON.stringify(openRTBObj),success:function(resp){try{var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);resp=ProperMedia.utils.safeJsonParse(resp);if(!resp||!resp.seatbid||resp.seatbid.length==0||!resp.seatbid[0].bid||!resp.seatbid[0].bid.length){properLog.mylog('No '+bidder+' bids returned');var ad=new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:request_url,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,});bidData.logNoBidResponse(ad);}else{properLog.mylog(resp,bidder);Object.keys(resp.seatbid).forEach(function(x){Object.keys(resp.seatbid[x].bid).forEach(function(i){var obj=resp.seatbid[x].bid[i];var id=obj.id||'',impid=obj.impid||'',price=obj.price||0,width=obj.w||0,height=obj.h||0,adcode=obj.adm||'',dealid=obj.dealid||'',crid=obj.crid||'',nurl=obj.nurl||'';var ad=new adObj({bidder:bidder,size:width+'x'+height,price:parseFloat(price),gross:parseFloat(price),nurl:nurl,tag_id:impid,dealid:dealid,crid:crid,request_url:request_url,response:obj,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:bidderInfo.default_bid_ttl,floor:ProperMedia.utils.deepAccess(data_map,impid+'.floor')||0,target_slot:ProperMedia.utils.deepAccess(data_map,impid+'.slot_name')||'',uids:uids,});if(bidderInfo.demand_type=='video'){var vast_tag=adm||nurl;ad.type='video';ad.vast_tag=vast_tag;var tagTypes=ProperMedia.utils.parseVastVpaid(ad.vast_tag);ad.vast_type=tagTypes['vast_type'];ad.vpaid=tagTypes['vpaid'];ad.video_type=bidderInfo.video_type;}else{var ad_code_prepend='<div id="'+(ProperMedia.utils.deepAccess(data_map,impid+'.divid')||'')+'"></div>';adcode=ad_code_prepend+adcode;}
bidData.logBidResponse(ad);});});}
bidData.incrementBidResponseCount(request_cnt);}catch(e){e.bidder=bidder;throw e;}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}
function makeNewUserIdInFPDStorage(){const value=ProperMedia.utils.generateUUID().replace(/-/g,'');properStorage.setDataInLocalStorage(USER_ID_KEY,value,storageEnfObj);return value;}
function getUserIdFromFPDStorage(){return properStorage.getDataFromLocalStorage(USER_ID_KEY,storageEnfObj)||makeNewUserIdInFPDStorage();}
function getUserSyncs(){var query=[];var url=SYNC_ENDPOINT;if(gdprConsent){query.push(['gdpr',gdprConsent.gdprApplies?1:0]);query.push(['gdpr_consent='+encodeURIComponent(gdprConsent.consentString||'')]);}
if(uspConsent.usPrivacy){query.push(['us_privacy',encodeURIComponent(uspConsent.usPrivacy)]);}
if(query.length>0){url+='?'+
query.map(function(q){q.join('=');}).join('&');}
userSyncs.add({type:'image',url:url,bidder:bidder,});}
function onBidWon(bid,slot){if(bid.nurl){var img=new Image();img.src=bid.nurl;}
return true;}
return{send:send,onBidWon:onBidWon,bidderInfo:bidderInfo,getUserSyncs:getUserSyncs,formatRequest:formatRequest,};})();bidAdapters.medianet=(function(){var bidderInfo={rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:300000,gvlid:142,};var ENDPOINT_URL='https://prebid.media.net/rtb/prebid';var bidder='medianet';var site_id='8CUW4K2MG';function parseSize(size){var s=size.split('x');return{w:parseInt(s[0]),h:parseInt(s[1]),};}
function formatRequest(bidData,bidder,bidderInfo){var requestData={imps:{},data_map:{},request_cnt:0,};if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){for(var i=0;i<data[size].length;i++){var tag_id=data[size][i];var s=size.split('x');if(typeof requestData['imps'][tag_id]=='undefined'){var tagid=bidderInfo.demand_type=='display'?(properDevice.isMobile()?'506882127':'515514711'):'677195738';requestData['imps'][tag_id]={id:tag_id.toString(),tagid:tagid,bidfloor:0,ext:{visibility:0,},};requestData['data_map'][tag_id]={slot_name:slot_name||'',tag_id:tag_id,floor:0,};if(bidderInfo.demand_type=='display'){requestData['imps'][tag_id]['banner']=[];}else if(bidderInfo.demand_type=='video'){requestData['imps'][tag_id]['video']={protocols:[1,2,3,4,5,6],pos:0,topframe:1,minduration:10,maxduration:30,mimes:['video/mp4','application/javascript'],api:[1,2],placement:bidderInfo.video_type=='outstream'?3:1,playbackmethod:bidderInfo.video_type=='outstream'?[6]:[3],context:bidderInfo.video_type,playerSize:[size.split('x').map(function(wh){return parseInt(wh);}),],};}else if(bidderInfo.demand_type=='native'){requestData['imps'][tag_id]['native']=JSON.stringify({request:{ver:'1.2',context:1,plcmttype:1,privacy:1,assets:[{id:1,required:1,title:{len:80,},},{id:2,required:1,img:{type:3,w:parseInt(s[0]),h:parseInt(s[1]),},},{id:3,required:0,img:{type:1,w:50,h:50,},},{id:4,required:1,data:{type:1,},},{id:5,required:0,data:{type:2,},},{id:6,required:1,data:{type:0,},},{id:10,required:0,img:{type:0,w:50,h:50,},},{id:11,required:0,data:{type:1,},},{id:12,required:0,data:{type:2,},},{id:21,required:0,data:{type:11,},},{id:22,required:0,data:{type:12,},},],},});}}
if(bidderInfo.demand_type=='display'){requestData['imps'][tag_id]['banner'].push(parseSize(size));}
var floor=getBidderFloor(bidder,size);if(!requestData['imps'][tag_id]['bidfloor']||floor<requestData['imps'][tag_id]['bidfloor']){requestData['imps'][tag_id]['bidfloor']=floor;requestData['data_map'][tag_id]['floor']=floor;}
requestData['request_cnt']++;}});}}
return requestData;}
function send(bidData){var bidder=bidData.bidder;var bidderInfo=properOps.bidder_info[bidder]||bidderInfo;var requestData=formatRequest(bidData,bidder,bidderInfo);site_id=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.site_id')||site_id;var request_url=ENDPOINT_URL+'?cid='+site_id;var imps=ProperMedia.utils.objectValues(requestData['imps'])||[];var data_map=requestData['data_map']||{};var request_cnt=requestData['request_cnt'];var page_meta=getPageMeta();var site=ProperMedia.utils.mergeObject({domain:properPage.domain,page:properPage.bidder_page_url,ref:properPage.referrer,canonical_url:properPage.canonical_url,isTop:true,},page_meta);var post_data={id:Date.now().toString(),site:site,imp:imps,ext:{customer_id:site_id.toString(),prebid_version:properOps.prebid_version,screen:{w:window.innerWidth,h:window.innerHeight,},},tmax:properOps.tmax,};var schain=schainCheck(bidder);if(schain!='')ProperMedia.utils.deepSetValue(post_data,'ext.schain',schain);var uids=userIds.getUIdsObj();if(uids&&Object.keys(uids).length){ProperMedia.utils.deepSetValue(post_data,'ext.user_id',uids);}
ProperMedia.utils.deepSetValue(post_data,'ext.coppa_applies',!!ProperMedia.utils.deepAccess(properSpecialOps,'coppa'));if(gdprConsent){if(typeof gdprConsent.gdprApplies==='boolean'){ProperMedia.utils.deepSetValue(post_data,'ext.gdpr_applies',!!gdprConsent.gdprApplies);if(gdprConsent.gdprApplies){ProperMedia.utils.deepSetValue(post_data,'ext.gdpr_consent_string',gdprConsent.consentString||'');}}}
ProperMedia.utils.deepSetValue(post_data,'ext.usp_applies',!!uspConsent);if(uspConsent.usPrivacy){ProperMedia.utils.deepSetValue(post_data,'ext.usp_consent_string',uspConsent.usPrivacy);}
properLog.mylog(request_url,bidder);bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({url:request_url,method:'POST',requestType:'cors',bidder:bidder,edge:edge,data:JSON.stringify(post_data),success:function(resp){try{var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);resp=ProperMedia.utils.safeJsonParse(resp);if(!resp||!resp.bidList||resp.bidList.length==0){properLog.mylog('no medianet bids returned');var ad=new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:request_url,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,});bidData.logNoBidResponse(ad);}else{properLog.mylog(resp,bidder);resp.bidList.map(function(obj){var reqId=obj.requestId||'',price=obj.cpm||0,width=obj.width||1,height=obj.height||1,adcode=obj.ad||'',crid=obj.creativeId||'',nurl=obj.nurl||false,ttl=obj.ttl*1000||bidderInfo.default_bid_ttl;if(nurl&&bidderInfo.demand_type!=='video'){adcode+=ProperMedia.utils.createTrackPixel(nurl);nurl='';}
var ad=new adObj({bidder:bidder,size:width+'x'+height,price:parseFloat(price),gross:parseFloat(price),adcode:adcode,nurl:nurl,tag_id:reqId,crid:crid,request_url:request_url,response:obj,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:ttl,floor:ProperMedia.utils.deepAccess(data_map,reqId+'.floor')||0,target_slot:ProperMedia.utils.deepAccess(data_map,reqId+'.slot_name')||'',uids:Object.keys(ProperMedia.utils.deepAccess(bidData,'auction.uids')),});if(bidderInfo.demand_type=='video'){var vast_tag=obj.vastUrl||obj.vastXml||adcode;ad.type='video';ad.vast_tag=vast_tag;var tagTypes=ProperMedia.utils.parseVastVpaid(ad.vast_tag);ad.vast_type=tagTypes['vast_type'];ad.vpaid=tagTypes['vpaid'];ad.video_type=bidderInfo.video_type;}else if(bidderInfo.demand_type=='native'){ad.type='native';var native=obj.native;native.clickTrackers=ProperMedia.utils.deepAccess(native,'link.clicktrackers')||[];ad.native=native;}else{ad.adcode=adcode;}
if(obj.no_bid){bidData.logNoBidResponse(ad);}else{bidData.logBidResponse(ad);}});}
bidData.incrementBidResponseCount(request_cnt);}catch(e){e.bidder=bidder;throw e;}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}
function getPageMeta(){var pageMeta={canonicalUrl:getUrlFromSelector('link[rel="canonical"]','href'),twitterUrl:getUrlFromSelector('meta[property="og:url"]','content'),ogUrl:getUrlFromSelector('meta[name="twitter:url"]','content'),};return pageMeta;}
function getUrlFromSelector(selector,attribute){var attr=getAttributeFromSelector(selector,attribute);return attr&&getAbsoluteUrl(attr);}
function getAttributeFromSelector(selector,attribute){try{var element=window.top.document.querySelector(selector);if(element!==null&&element[attribute]){return element[attribute];}}catch(e){}}
function getAbsoluteUrl(url){var aTag=window.top.document.createElement('a');aTag.href=url;return aTag.href;}
function onBidWon(bid,slot){if(bid.nurl){var img=new Image();img.src=bid.nurl;}
return true;}
return{send:send,onBidWon:onBidWon,bidderInfo:bidderInfo,formatRequest:formatRequest,};})();bidAdapters.nobid=(function(){const bidderInfo={rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:300000,gvlid:816,};const ENDPOINT_URL='https://ads.servenobid.com/adreq';const QA_ENDPOINT='https://qa-ads.nobid.com/adreq';var bidder='nobid';var siteId;var storageEnfObj;window.nobidVersion='1.3.3';window.nobid=window.nobid||{};window.nobid.bidResponses=window.nobid.bidResponses||{};window.nobid.timeoutTotal=0;window.nobid.bidWonTotal=0;window.nobid.refreshCount=0;function formatRequest(bidData,bidder,bidderInfo){const request_data={imps:[],data_map:{},request_count:0,};if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){const parsedSize=size.split('x').map(Number);for(let i=0;i<data[size].length;i++){const tag_id=data[size][i];if(!request_data.imps[tag_id]){request_data.imps[tag_id]={d:ProperMedia.utils.generateUUID(),sid:siteId,pid:tag_id,at:bidderInfo.demand_type=='display'?'banner':'video',params:{siteId:siteId,placementId:tag_id,},z:[],g:{},};requestData['data_map'][tag_id]={slot_name:slot_name||'',tag_id:tag_id,floor:0,};}
request_data.request_count++;request_data.imps[tag_id].z.push(parsedSize);var floor=getBidderFloor(bidder,size);if(!request_data.imps[tag_id]['floor']||floor<request_data.imps[tag_id]['floor']){request_data.imps[tag_id]['floor']=floor;requestData['data_map'][tag_id]['floor']=floor;}}});}}
return request_data;}
function send(bidData){bidder=bidData.bidder;var bidderInfo=properOps.bidder_info[bidder]||bidderInfo;storageEnfObj={gvlid:bidderInfo.gvlid,bidderCode:bidder,};siteId=Number(ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.site_id'));if(!siteId){properLog.mylog('No_Bid: Error Site ID is Required.');return false;}
if(typeof window.nobid.refreshLimit!=='undefined'){if(window.nobid.refreshLimit<window.nobid.refreshCount){properLog.mylog('No_Bid: refreshLimit met: '+window.nobid.refreshCount);return false;}}
let ublock=nobidGetCookie('_ublock');if(ublock){properLog.mylog('No_Bid: Request blocked for user. hours: '+ublock);return false;}
var requestData=formatRequest(bidData,bidder,bidderInfo);var data_map=requestData.data_map||{};const request_count=requestData.request_count;const post_data={sid:siteId,l:properPage.url,tt:encodeURIComponent(document.title).replace(/'|;|quot;|39;|&amp;|&|#|\r\n|\r|\n|\t|\f|%0A|"|%22|%5C|%23|%26|%26|%09/gm,''),a:Object.keys(requestData.imps).map((key)=>requestData.imps[key]),t:timestamp(),tz:Math.round(new Date().getTimezoneOffset()),r:clientDim(),lang:(navigator.languages&&navigator.languages[0])||navigator.language||navigator.userLanguage,ref:properPage.referrer,gdpr:{},usp:uspConsent.usPrivacy||'',pjbdr:'nobid',schain:schainCheck(bidder)||null,eids:userIds.getEidsArray(),coppa:ProperMedia.utils.deepAccess(properSpecialOps,'coppa')?{coppa:true}:null,ortb2:{site:{domain:properPage.domain,page:properPage.url,referrer:properPage.referrer,},},};var uids=Object.keys(ProperMedia.utils.deepAccess(bidData,'auction.uids'));if(typeof gdprConsent.gdprApplies==='boolean'){ProperMedia.utils.deepSetValue(post_data,'gdpr.consentRequired',gdprConsent.gdprApplies);if(gdprConsent.consentString){ProperMedia.utils.deepSetValue(post_data,'gdpr.consentString',gdprConsent.consentString);}}
let request_url=properOps.testing_mode.ids==true?QA_ENDPOINT:ENDPOINT_URL;properLog.mylog(request_url,bidder);bidData.incrementRequestsSent(request_count);window.nobid.refreshCount++;let withCredentials=gdprConsent.gdprApplies&&gdprConsentModule.hasPurpose1Consent()?true:false;const bid_sent_ts=ProperMedia.utils.getTimestampMs();const edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({url:request_url+'?cb='+Math.floor(Math.random()*11000),method:'POST',requestType:'cors',bidder:bidder,edge:edge,withCredentials:withCredentials,data:JSON.stringify(post_data).replace(/'|&|#/g,''),success:function(response){try{const bids_received_ts=ProperMedia.utils.getTimestampMs();const bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);setRefreshLimit(response);setUserBlock(response);if(!response||typeof response!='object'||!response.bids||response.bids.length===0){properLog.mylog('no no-bid bids returned');bidData.logNoBidResponse(new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:request_url,response:response,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,}));}else{properLog.mylog(response,bidder);for(const bid of response.bids){if(bid.bdrid<100)continue;window.nobid.bidResponses[bid.id?.toString()]=bid;const{h,w}=bid.size;const newAd=new adObj({bidder,size:(w??1)+'x'+(h??1),price:parseFloat(bid.price??bid.bucket??0),gross:parseFloat(bid.price??bid.bucket??0),adcode:bid.adm,tag_id:bid.divid,crid:bid.creativeid,dealid:bid.dealid,request_url:request_url,response:bid,ttl:300000,floor:ProperMedia.utils.deepAccess(data_map,bid.divid+'.floor')||0,target_slot:ProperMedia.utils.deepAccess(data_map,bid.divid+'.slot_name')||'',uids:uids,});if(bidderInfo.demand_type=='video'||bid.atype=='video'){const vast_type=ProperMedia.utils.parseVastVpaid(bid.vastXml)?.vast_type;if(bid.vastUrl){newAd.vast_tag=bid.vastUrl;newAd.vast_type=vast_type;}
if(bid.vastXml){newAd.vast_tag=bid.vastXml;newAd.vast_type=vast_type;}}
bidData.logBidResponse(newAd);}}}catch(e){e.bidder=bidder;throw e;}},error:function(e){try{bidData.incrementBidResponseCount(request_count);const bids_received_ts=ProperMedia.utils.getTimestampMs();const bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);const bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}
function getUserSyncs(){let params='';if(gdprConsent&&typeof gdprConsent.consentString==='string'){if(typeof gdprConsent.gdprApplies==='boolean'){params+=`?gdpr=${Number(gdprConsent.gdprApplies)}&gdpr_consent=${gdprConsent.consentString}`;}else{params+=`?gdpr_consent=${gdprConsent.consentString}`;}}
if(uspConsent.usPrivacy){if(params.length>0)params+='&';else params+='?';params+='usp_consent='+uspConsent.usPrivacy;}
return[{type:'iframe',url:'https://public.servenobid.com/sync.html'+params,},];}
window.nobid.renderTag=function(doc,id){var bid=window.nobid.bidResponses[id.toString()];if(bid&&bid.adm2){var markup=bid.adm2;doc.write(markup);doc.close();}};window.addEventListener('message',function(event){let key=event.message?'message':'data';var msg=event[key].toString();if(msg.substring(0,'nbTagRenderer.requestAdMarkup|'.length)!=='nbTagRenderer.requestAdMarkup|')return;var adId=msg.substring(msg.indexOf('|')+1);if(!window.nobid||!window.nobid.bidResponses)return;var bid=window.nobid.bidResponses[adId.toString()];if(!(bid&&bid.adm2))return;var markup=bid.adm2;if(markup)event.source.postMessage('nbTagRenderer.renderAdInSafeFrame|'+markup,'*');},false);function setRefreshLimit(response){if(response&&typeof response.rlimit!=='undefined')window.nobid.refreshLimit=response.rlimit;}
function setUserBlock(response){if(response&&typeof response.ublock!=='undefined'){nobidSetCookie('_ublock','1',response.ublock);}}
function nobidSetCookie(cname,cvalue,hours){var d=new Date();d.setTime(d.getTime()+hours*60*60*1000);var expires='expires='+d.toUTCString();properStorage.setCookie(cname,cvalue,expires,storageEnfObj);}
function nobidGetCookie(cname){return properStorage.getCookie(cname,storageEnfObj);}
function timestamp(){const zp=function(val){return val.toString().padStart(2,'0');};const date=new Date();const day=date.getDate();const year=date.getFullYear();const month=date.getMonth()+1;const hour=date.getHours();const minute=date.getMinutes();const second=date.getSeconds();return ''+year+'-'+zp(month)+'-'+zp(day)+' '+zp(hour)+':'+zp(minute)+':'+zp(second);}
function clientDim(){try{const width=Math.max(document.documentElement.clientWidth,window.innerWidth||0);const height=Math.max(document.documentElement.clientHeight,window.innerHeight||0);return `${width}x${height}`;}catch(_e){}}
function onBidWon(bid,slot){window.nobid.bidWonTotal++;return true;}
return{send,onBidWon,bidderInfo,getUserSyncs,formatRequest,};})();bidAdapters.ogury=(function(){var bidderInfo={rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:60000,gvlid:31,native_sizes:{sticky_horizontal:'1x1',},};var bidder='ogury',SYNC_ENDPOINT='https://ms-cookie-sync.presage.io',ENDPOINT_URL='https://mweb-hb.presage.io/api/header-bidding-request',ADAPTER_VERSION='1.4.1';var siteId;function parseSize(size){size=ProperMedia.utils.deepAccess(bidderInfo,'native_sizes.'+size)||size;var s=size.split('x');return{w:parseInt(s[0]),h:parseInt(s[1]),};}
function formatRequest(bidData){var requestData={imps:{},data_map:{},request_cnt:0,};if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){for(var i=0;i<data[size].length;i++){var tag_id=data[size][i];if(typeof requestData['imps'][tag_id]=='undefined'){requestData['imps'][tag_id]={id:tag_id,tagid:tag_id,bidfloor:0,banner:{format:[],},ext:{assetKey:siteId,adUnitId:tag_id,},};requestData['data_map'][tag_id]={floor:0,tag_sizes:[],slot_name:slot_name||'',};}
var floor=getBidderFloor(bidder,size);if(!requestData['imps'][tag_id]['bidfloor']||floor<requestData['imps'][tag_id]['bidfloor']){requestData['imps'][tag_id]['bidfloor']=floor;requestData['data_map'][tag_id]['floor']=floor;}
requestData['data_map'][tag_id]['tag_sizes'].push(size);requestData['imps'][tag_id]['banner']['format'].push(parseSize(size));if(!requestData.imps[tag_id].banner.format.some((size)=>size.w===1&&size.h===1)){requestData.imps[tag_id].ext.skipSizeCheck=true;}
requestData['request_cnt']++;}});}}
return requestData;}
function checkRestrictions(bidData){try{if(properDevice.device_type!='mobile'){properLog.mylog('Ogury: Not a correct device, Ogury is mobile only');return false;}
var browser_version=(properDevice.browser_version||'0').toString().split('.')[0];if(properDevice.os_group.includes('iOS')){if(properDevice.browser.includes('Safari')){if(Number(browser_version)<10){properLog.mylog('Ogury: Not a correct Safari version');return false;}
return true;}
if(properDevice.browser.includes('Chrome')){if(Number(browser_version)<83){properLog.mylog('Ogury: Not a correct Chrome version');return false;}
return true;}
if(properDevice.browser.includes('Facebook')){return true;}}
if(properDevice.os_group.includes('Android')){if(properDevice.browser.includes('Samsung')){return true;}
if(properDevice.browser.includes('Chrome')){if(Number(browser_version)<83){properLog.mylog('Ogury: Not a correct Chrome version');return false;}
return true;}
if(properDevice.browser.includes('Facebook')){return true;}}
properLog.mylog('Ogury: Not a correct OS/Browser/Version');return false;}catch(e){return false;}}
function send(bidData){siteId=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.site_id')||0;if(!siteId){properLog.mylog('Ogury: Error Site ID is Required.');return false;}
if(!checkRestrictions()){properLog.mylog('Ogury: Not a correct device');return false;}
var requestData=formatRequest(bidData);var imps=ProperMedia.utils.objectValues(requestData['imps'])||[];var data_map=requestData['data_map']||{};var request_cnt=requestData['request_cnt'];if(imps.length==0)return false;var postData={id:ProperMedia.utils.generateUUID(),tmax:properOps.tmax,at:1,regs:{ext:{gdpr:Number(gdprConsent.gdprApplies),},},site:{id:siteId,domain:ProperMedia.utils.getPageDomain(),page:properPage.bidder_page_url,},user:{ext:{consent:'',},},imp:imps,ext:{adapterversion:ADAPTER_VERSION,prebidversion:properOps.prebid_version,},device:{w:getClientWidth(),h:getClientHeight(),pxratio:window.devicePixelRatio,},};if(typeof gdprConsent.gdprApplies==='boolean'){ProperMedia.utils.deepSetValue(postData,'regs.ext.gdpr',Number(gdprConsent.gdprApplies));}
if(gdprConsent.consentString){ProperMedia.utils.deepSetValue(postData,'user.ext.consent',gdprConsent.consentString);}
bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();properLog.mylog(ENDPOINT_URL,bidder);var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({method:'POST',url:ENDPOINT_URL,requestType:'cors',bidder:bidder,edge:edge,headers:{'Content-Type':'application/json'},data:JSON.stringify(postData),success:function(resp){try{properLog.mylog(resp,bidder);resp=ProperMedia.utils.safeJsonParse(resp);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);if(resp&&resp.seatbid&&resp.seatbid.length>0){resp.seatbid.forEach(function(seatbid){seatbid.bid.forEach(function(bid){var impid=bid.impid||'',price=bid.price||0,width=bid.w||1,height=bid.h||1,adcode=bid.adm||'',crid=bid.id||'',adomain=bid.adomain||[],nurl=bid.nurl||'',ext=bid.ext||{},size=width+'x'+height;var cid=ProperMedia.utils.deepAccess(bid,'ext.campaignid');var ad_details={ext:ext,size:size,width:width,height:height,};if((ProperMedia.utils.deepAccess(data_map,impid+'.tag_sizes')||[]).length){size=ProperMedia.utils.deepAccess(data_map,impid+'.tag_sizes.0')||size;}
var ad=new adObj({bidder:bidder,size:size,price:parseFloat(price),gross:parseFloat(price),adcode:adcode,ad_details:ad_details,nurl:nurl,tag_id:impid,crid:crid,cid:cid,adomain:adomain,request_url:ENDPOINT_URL,response:bid,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:bidderInfo.default_bid_ttl,floor:ProperMedia.utils.deepAccess(data_map,impid+'.floor')||0,target_slot:ProperMedia.utils.deepAccess(data_map,impid+'.slot_name')||'',});bidData.logBidResponse(ad);});});}else{var ad=new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:ENDPOINT_URL,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,});bidData.logNoBidResponse(ad);}
bidData.incrementBidResponseCount(request_cnt);}catch(e){e.bidder=bidder;throw e;}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}
function onBidWon(bid,slot){var mediaType=bid.type=='display'?'banner':bid.type;var bidObj={assetKey:siteId||'',adUnitId:bid.tag_id||'',adUnitCode:slot.div_id||'',creativeId:bid.crid||'',campaignId:bid.cid||'',requestId:bid.tag_id||'',bidder:bid.bidder||'',width:ProperMedia.utils.deepAccess(bid,'ad_details.width')||1,height:ProperMedia.utils.deepAccess(bid,'ad_details.height')||1,size:ProperMedia.utils.deepAccess(bid,'ad_details.size')||'1x1',mediaType:mediaType||'',cpm:bid.price||0,ad:bid.adcode||'',nurl:bid.nurl||'',meta:{advertiserDomains:bid.adomain,},currency:'USD',netRevenue:true,ttl:60,adapterVersion:ADAPTER_VERSION,prebidVersion:properOps.prebid_version,params:[{assetKey:siteId||'',adUnitId:bid.tag_id||'',adUnitCode:slot.div_id||'',creativeId:bid.crid||'',campaignId:bid.cid||'',},],ext:ProperMedia.utils.deepAccess(bid,'ad_details.ext')||{},};window.OG_PREBID_BID_OBJECT=bidObj;if(bid.nurl){var img=new Image();img.src=bid.nurl;}
return true;}
function getClientWidth(){const documentElementClientWidth=window.top.document.documentElement.clientWidth?window.top.document.documentElement.clientWidth:0;const innerWidth=window.top.innerWidth?window.top.innerWidth:0;const outerWidth=window.top.outerWidth?window.top.outerWidth:0;const screenWidth=window.top.screen.width?window.top.screen.width:0;return documentElementClientWidth||innerWidth||outerWidth||screenWidth;}
function getClientHeight(){const documentElementClientHeight=window.top.document.documentElement.clientHeight?window.top.document.documentElement.clientHeight:0;const innerHeight=window.top.innerHeight?window.top.innerHeight:0;const outerHeight=window.top.outerHeight?window.top.outerHeight:0;const screenHeight=window.top.screen.height?window.top.screen.height:0;return documentElementClientHeight||innerHeight||outerHeight||screenHeight;}
function getUserSyncs(){var iab_string=gdprConsent.consentString||'';userSyncs.add({type:'image',url:SYNC_ENDPOINT+'/v1/init-sync/bid-switch?iab_string='+iab_string+'&source=prebid',bidder:bidder,});userSyncs.add({type:'image',url:SYNC_ENDPOINT+'/ttd/init-sync?iab_string='+iab_string+'&source=prebid',bidder:bidder,});userSyncs.add({type:'image',url:SYNC_ENDPOINT+'/xandr/init-sync?iab_string='+iab_string+'&source=prebid',bidder:bidder,});}
function removeCreative(slot){try{let impid=ProperMedia.utils.deepAccess(slot,'displayed_ad.tag_id')||'';var ogy_root_elem=window.top.document.getElementById('ogy-root-container-'+impid);if(ogy_root_elem){ogy_root_elem.parentNode.removeChild(ogy_root_elem);}}catch(e){console.error(e);}}
return{send:send,onBidWon:onBidWon,bidderInfo:bidderInfo,getUserSyncs:getUserSyncs,formatRequest:formatRequest,removeCreative:removeCreative,};})();bidAdapters.openx=(function(){var bidderInfo={rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:300000,gvlid:69,};var ENDPOINT_URL='https://rtb.openx.net/openrtbb/prebidjs',DEL_DOMAIN='propermedia-d.openx.net',ALIAS_DEL_DOMAIN='onscroll-d.openx.net',SYNC_ENDPOINT='https://DEL_DOMAIN/w/1.0/pd',bidderConfig='hb_pb_ortb',bidderVersion='1.0',bidder='openx';var siteId=null;function parseSize(size){var s=size.split('x');return{w:parseInt(s[0]),h:parseInt(s[1]),};}
function formatRequest(bidData,bidder,bidderInfo){var requestData={imps:{},data_map:{},request_cnt:0,};if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){for(var i=0;i<data[size].length;i++){var tag_id=data[size][i];if(typeof requestData['imps'][tag_id]=='undefined'){var tagid=siteId||tag_id.split('-')[0]||tag_id;var div_id='openx-'+ProperMedia.utils.generateUUID();requestData['imps'][tag_id]={id:String(tag_id),tagid:String(tagid),bidfloorcur:'USD',bidfloor:0,ext:{divid:div_id,},};if(bidderInfo.demand_type=='display'){requestData['imps'][tag_id]['banner']={topframe:1,format:[],};}else if(bidderInfo.demand_type=='video'){var s=size.split('x');requestData['imps'][tag_id]['video']={topframe:1,skip:1,placement:bidderInfo.video_type=='outstream'?3:1,playbackmethod:bidderInfo.video_type=='outstream'?[6]:[3],linearity:bidderInfo.video_type=='outstream'?2:1,minduration:10,maxduration:30,api:[1,2],mimes:['video/mp4','application/javascript'],protocols:[2,3,5,6],w:parseInt(s[0])||0,h:parseInt(s[1])||0,};}
requestData['data_map'][tag_id]={slot_name:slot_name||'',divid:div_id,floor:0,};}
var floor=getBidderFloor(bidder,size);if(!requestData['imps'][tag_id]['bidfloor']||floor<requestData['imps'][tag_id]['bidfloor']){requestData['imps'][tag_id]['bidfloor']=floor;requestData['data_map'][tag_id]=floor;}
if(bidderInfo.demand_type=='display'){requestData['imps'][tag_id]['banner']['format'].push(parseSize(size));}
requestData['request_cnt']++;}});}}
return requestData;}
function send(bidData){var bidder=bidData.bidder;var bidderInfo=properOps.bidder_info[bidder]||bidderInfo;var request_url=ENDPOINT_URL;var delDomain=bidderInfo.alias?ALIAS_DEL_DOMAIN:DEL_DOMAIN;SYNC_ENDPOINT=SYNC_ENDPOINT.replace('DEL_DOMAIN',delDomain);var siteIds=(ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.site_id')||'').split('-');siteId=(properDevice.isMobile()&&siteIds.length==2?siteIds[1]:siteIds[0])||'';var requestData=formatRequest(bidData,bidder,bidderInfo);var imps=ProperMedia.utils.objectValues(requestData['imps'])||[];var data_map=requestData['data_map']||{};var request_cnt=requestData['request_cnt'];var tid=bidderInfo.auctionId||ProperMedia.utils.generateUUID();var openRTBObj={id:tid,tmax:properOps.tmax,imp:imps,at:1,site:{domain:properPage.domain,publisher:{domain:properPage.domain,},page:properPage.url,ref:properPage.referrer,},device:{h:screen.height,w:screen.width,dnt:ProperMedia.utils.getDNT()?1:0,language:navigator.language.split('-')[0],ua:navigator.userAgent,},source:{tid:tid,},ext:{delDomain:delDomain,bc:bidderConfig+'_'+bidderVersion,},};var eids=userIds.getEidsArray();if(eids&&eids.length){ProperMedia.utils.deepSetValue(openRTBObj,'user.ext.eids',eids);}
var uids=Object.keys(ProperMedia.utils.deepAccess(bidData,'auction.uids'));var schain=schainCheck(bidder);if(schain!='')ProperMedia.utils.deepSetValue(openRTBObj,'source.ext.schain',schain);if(ProperMedia.utils.deepAccess(properSpecialOps,'coppa')){ProperMedia.utils.deepSetValue(openRTBObj,'regs.coppa',ProperMedia.utils.deepAccess(properSpecialOps,'coppa')?1:0);}
ProperMedia.utils.deepSetValue(openRTBObj,'user.ext.consent',gdprConsent.consentString);if(typeof gdprConsent.gdprApplies==='boolean'){ProperMedia.utils.deepSetValue(openRTBObj,'regs.ext.gdpr',Number(gdprConsent.gdprApplies));}
if(uspConsent.usPrivacy){ProperMedia.utils.deepSetValue(openRTBObj,'regs.ext.us_privacy',uspConsent.usPrivacy);}
if(gppConsent){ProperMedia.utils.deepSetValue(openRTBObj,'regs.ext.gpp',gppConsent.gppString);ProperMedia.utils.deepSetValue(openRTBObj,'regs.ext.gpp_sid',gppConsent.applicableSections);}
if(ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.account_overrides.enabled')){request_url=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.account_overrides.bidder_ids.endpoint_url')||ENDPOINT_URL;ProperMedia.utils.deepSetValue(openRTBObj,'ext.delDomain',request_url);}
if(properOps.testing_mode.ids==true){openRTBObj.test=1;}
properLog.mylog(request_url,bidder);bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({url:request_url,requestType:'cors',method:'POST',bidder:bidder,edge:edge,data:JSON.stringify(openRTBObj),success:function(resp){try{var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);resp=ProperMedia.utils.safeJsonParse(resp);if(!resp||!resp.seatbid||resp.seatbid.length==0||!resp.seatbid[0].bid||!resp.seatbid[0].bid.length){properLog.mylog('No '+bidder+' bids returned');var ad=new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:request_url,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,});bidData.logNoBidResponse(ad);}else{properLog.mylog(resp,bidder);Object.keys(resp.seatbid).forEach(function(x){Object.keys(resp.seatbid[x].bid).forEach(function(i){var obj=resp.seatbid[x].bid[i];var id=obj.id||'',impid=obj.impid||'',price=obj.price||0,width=obj.w||0,height=obj.h||0,adcode=obj.adm||'',dealid=obj.dealid||'',crid=obj.crid||'',nurl=obj.nurl||'';var ad=new adObj({bidder:bidder,size:width+'x'+height,price:parseFloat(price),gross:parseFloat(price),adcode:adcode,nurl:nurl,tag_id:impid,dealid:dealid,crid:crid,request_url:request_url,response:obj,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:bidderInfo.default_bid_ttl,floor:ProperMedia.utils.deepAccess(data_map,impid+'.floor')||0,target_slot:ProperMedia.utils.deepAccess(data_map,impid+'.slot_name')||'',uids:uids,});if(bidderInfo.demand_type=='video'){var vast_tag=adm;ad.type='video';ad.vast_tag=vast_tag;var tagTypes=ProperMedia.utils.parseVastVpaid(ad.vast_tag);ad.vast_type=tagTypes['vast_type'];ad.vpaid=tagTypes['vpaid'];ad.video_type=bidderInfo.video_type;}else{ad.adcode='<div id="'+(ProperMedia.utils.deepAccess(data_map,impid+'.divid')||'')+'">'+adcode+'</div>';}
bidData.logBidResponse(ad);});});}
bidData.incrementBidResponseCount(request_cnt);}catch(e){e.bidder=bidder;throw e;}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}
function getUserSyncs(){var query=[];var url=SYNC_ENDPOINT;if(gdprConsent){query.push(['gdpr',gdprConsent.gdprApplies?1:0]);query.push(['gdpr_consent='+encodeURIComponent(gdprConsent.consentString||'')]);}
if(uspConsent.usPrivacy){query.push(['ccpa',encodeURIComponent(uspConsent.usPrivacy)]);}
if(query.length>0){url+='?'+
query.map(function(q){q.join('=');}).join('&');}
userSyncs.add({type:'iframe',url:url,bidder:bidder,});}
function onBidWon(bid,slot){if(bid.nurl){var img=new Image();img.src=bid.nurl;}
return true;}
return{send:send,onBidWon:onBidWon,bidderInfo:bidderInfo,getUserSyncs:getUserSyncs,formatRequest:formatRequest,};})();bidAdapters.pubmatic=(function(){var bidderInfo={rev_share:0.81,demand_type:'display',bid_grouping:'page',default_bid_ttl:300000,acceptable_ads:true,gvlid:76,};var bidder='pubmatic';var ENDPOINT='https://hbopenbid.pubmatic.com/translator?source=prebid-client';var USYNCURL='https://ads.pubmatic.com/AdServer/js/showad.js#PIX&kdntuid=1&p=';var pubId=109126;var alias_pubId=159475;var pubId_adBlock=161355;function parseSize(size){var s=size.split('x');return{w:parseInt(s[0]),h:parseInt(s[1]),};}
function formatRequest(bidData,bidder,bidderInfo){var requestData={imps:{},data_map:{},request_cnt:0,};if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){for(var i=0;i<data[size].length;i++){var tag_id=data[size][i];if(tag_id==1){tag_id=ProperMedia.utils.makeid(10);}
if(typeof requestData['imps'][tag_id]=='undefined'){var ids=tag_id.split('-');var tagid=ids[0];var s=size.split('x');requestData['imps'][tag_id]={id:tag_id.toString(),tagid:tagid.toString(),bidfloor:0,bidfloorcur:'USD',secure:1,ext:{},};if(bidderInfo.demand_type=='display'){requestData['imps'][tag_id]['banner']={w:parseInt(s[0]),h:parseInt(s[1]),pos:0,format:[],topframe:1,};}else if(bidderInfo.demand_type=='native'){requestData['imps'][tag_id]['native']=JSON.stringify({request:{ver:'1.2',context:1,plcmttype:1,privacy:1,assets:[{id:1,required:1,title:{len:80,},},{id:2,required:1,img:{type:3,w:parseInt(s[0]),h:parseInt(s[1]),},},{id:3,required:0,img:{type:1,w:50,h:50,},},{id:4,required:1,data:{type:1,},},{id:5,required:0,data:{type:2,},},{id:6,required:1,data:{type:0,},},{id:10,required:0,img:{type:0,w:50,h:50,},},{id:11,required:0,data:{type:1,},},{id:12,required:0,data:{type:2,},},{id:21,required:0,data:{type:11,},},{id:22,required:0,data:{type:12,},},],},});}
requestData['data_map'][tag_id]={slot_name:slot_name||'',tag_id:tag_id,floor:0,};}
if(bidderInfo.demand_type=='display'){requestData['imps'][tag_id]['banner']['format'].push(parseSize(size));}
var floor=getBidderFloor(bidder,size);if(!requestData['imps'][tag_id]['bidfloor']||floor<requestData['imps'][tag_id]['bidfloor']){requestData['imps'][tag_id]['bidfloor']=floor;requestData['data_map'][tag_id]['floor']=floor;}
requestData['request_cnt']++;}});}}
return requestData;}
function send(bidData){var bidder=bidData.bidder;var bidderInfo=properOps.bidder_info[bidder]||bidderInfo;var requestData=formatRequest(bidData,bidder,bidderInfo);var imps=ProperMedia.utils.objectValues(requestData['imps'])||[];var data_map=requestData['data_map']||{};var request_cnt=requestData['request_cnt'];pubId=bidderInfo.alias?alias_pubId:pubId;if(properUser.checkAdBlockDetected()&&properUser.adblock.acceptable_ads&&properUser.adblock.deliver_to_adblock){pubId=pubId_adBlock;}else if(ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.account_overrides.enabled')){pubId=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.account_overrides.bidder_ids.pubId')||pubId;}
if(imps.length==0){return false;}
var payload={id:''+new Date().getTime(),at:1,cur:['USD'],imp:imps,site:{page:properPage.bidder_page_url,domain:properPage.domain,ref:properPage.referrer,publisher:{id:pubId.toString(),},},device:{ua:navigator.userAgent,js:1,h:parseInt(properPage.height),w:parseInt(properPage.width),dnt:0,language:navigator.language,geo:{},},user:{geo:{},},ext:{wrapper:{wp:'pbjs',wv:'prebid_prebid_'+properOps.prebid_version,transactionId:ProperMedia.utils.generateUUID(),},},tmax:properOps.tmax,};if(properOps.testing_mode.ids==true){payload.test=1;}
payload.device.language=payload.device.language&&payload.device.language.split('-')[0];var eids=userIds.getEidsArray();if(eids&&eids.length){ProperMedia.utils.deepSetValue(payload,'user.eids',eids);}
var uids=Object.keys(ProperMedia.utils.deepAccess(bidData,'auction.uids'));var schain=schainCheck(bidder);if(schain!='')ProperMedia.utils.deepSetValue(payload,'source.ext.schain',schain);if(ProperMedia.utils.deepAccess(properSpecialOps,'coppa')){ProperMedia.utils.deepSetValue(payload,'regs.coppa',1);}
ProperMedia.utils.deepSetValue(payload,'user.ext.consent',gdprConsent.consentString||'');ProperMedia.utils.deepSetValue(payload,'regs.ext.gdpr',gdprConsent.gdprApplies?1:0);if(uspConsent.usPrivacy){ProperMedia.utils.deepSetValue(payload,'regs.ext.us_privacy',uspConsent.usPrivacy);}
properLog.mylog(ENDPOINT,bidder);bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({method:'POST',url:ENDPOINT,requestType:'cors',bidder:bidder,edge:edge,data:JSON.stringify(payload),success:function(resp){try{resp=ProperMedia.utils.safeJsonParse(resp);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);if(resp&&resp.seatbid&&resp.seatbid.length>0&&resp.seatbid[0].bid&&resp.seatbid[0].bid.length>0){for(var key=0;key<resp.seatbid.length;key++){if(resp.seatbid[key].bid){for(var key2=0;key2<resp.seatbid[key].bid.length;key2++){var bid=resp.seatbid[key].bid[key2];var requestId=bid.impid,price=bid.price||0,width=bid.w||0,height=bid.h||0,cid=bid.cid||'',crid=bid.crid||'',adcode=bid.adm||'',adomain=bid.adomain||[];var ad=new adObj({bidder:bidder,size:width+'x'+height,price:parseFloat(price),gross:parseFloat(price),tag_id:requestId,cid:cid,crid:crid,adomain:adomain,request_url:ENDPOINT,response:bid,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:bidderInfo.default_bid_ttl,floor:ProperMedia.utils.deepAccess(data_map,requestId+'.floor')||0,target_slot:ProperMedia.utils.deepAccess(data_map,requestId+'.slot_name')||'',uids:uids,});if(bidderInfo.demand_type=='native'){ad.type='native';adcode=JSON.parse(adcode.replace(/\\/g,''));var native=adcode.native;native.clickTrackers=ProperMedia.utils.deepAccess(native,'link.clicktrackers')||[];ad.native=native;}else{ad.adcode=adcode;}
bidData.logBidResponse(ad);}}else{bidData.logNoBidResponse(new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:ENDPOINT,response:resp.seatbid[key],response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,}));}}}else{bidData.logNoBidResponse(new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:ENDPOINT,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,}));}
bidData.incrementBidResponseCount(request_cnt);}catch(e){e.bidder=bidder;throw e;}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}
function getUserSyncs(){var syncurl=USYNCURL+pubId;if(gdprConsent){syncurl+='&gdpr='+(gdprConsent.gdprApplies?1:0);syncurl+='&gdpr_consent='+encodeURIComponent(gdprConsent.consentString||'');}
if(uspConsent.usPrivacy){syncurl+='&us_privacy='+encodeURIComponent(uspConsent.usPrivacy);}
userSyncs.add({type:'iframe',url:syncurl,bidder:bidder,});}
return{send:send,bidderInfo:bidderInfo,getUserSyncs:getUserSyncs,formatRequest:formatRequest,};})();bidAdapters.risecodes=(function(){const bidderInfo={rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:360000,gvlid:1043,};const ENDPOINT_URL='https://hb.yellowblue.io/';const ADAPTER_VERSION='6.0.0';const MODES={PRODUCTION:'hb-multi',TEST:'hb-multi-test',};function parseSize(size){return size.split('x').map(function(s){return parseInt(s);});}
function formatRequest(bidData,bidder,bidderInfo){const requestData={imps:{},data_map:{},request_cnt:0,};const auctionId=bidderInfo.auctionId;const schain=schainCheck(bidder);if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){for(let i=0;i<data[size].length;i++){const tag_id=data[size][i];if(typeof requestData['imps'][tag_id]=='undefined'){let mediaType=bidderInfo.demand_type=='display'?'banner':'video';requestData['imps'][tag_id]={adUnitCode:ProperMedia.utils.generateUUID(),transactionId:ProperMedia.utils.generateUUID(),bidderRequestId:ProperMedia.utils.generateUUID(),mediaType,sizes:[],floorPrice:0,bidId:tag_id,placementId:tag_id,loop:1,coppa:parseInt(ProperMedia.utils.deepAccess(properSpecialOps,'coppa')||0),};requestData['data_map'][tag_id]={slot_name:slot_name||'',tag_id:tag_id,floor:0,};}
if(bidderInfo.demand_type=='video'){requestData['imps'][tag_id]['playbackmethod']=bidderInfo.video_type=='outstream'?6:3;requestData['imps'][tag_id]['placement']=bidderInfo.video_type=='outstream'?3:1;requestData['imps'][tag_id]['minduration']=10;requestData['imps'][tag_id]['maxduration']=30;requestData['imps'][tag_id]['linearity']=1;requestData['imps'][tag_id]['skip']=1;requestData['imps'][tag_id]['protocols']=[2,3,5,6];}
requestData['imps'][tag_id]['sizes'].push(parseSize(size));var floor=getBidderFloor(bidder,size);if(!requestData['imps'][tag_id]['floorPrice']||floor<requestData['imps'][tag_id]['floorPrice']){requestData['imps'][tag_id]['floorPrice']=floor;requestData['data_map'][tag_id]['floor']=floor;}
requestData['request_cnt']++;}});}}
return requestData;}
function send(bidData){const bidder=bidData.bidder;const bidderInfo=properOps.bidder_info[bidder]||bidderInfo;const site_id=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.site_id')||'';if(!site_id){properLog.mylog('Error: '+bidder+' Site ID is Required.');return false;}
bidderInfo.auctionId=ProperMedia.utils.deepAccess(bidData,'auction.id');const requestData=formatRequest(bidData,bidder,bidderInfo);const imps=ProperMedia.utils.objectValues(requestData['imps'])||[];const data_map=requestData['data_map']||{};const request_cnt=requestData['request_cnt'];const domain=window.location.hostname;const post_data={params:{wrapper_type:'prebidjs',wrapper_vendor:'pbjs',wrapper_version:properOps.prebid_version,adapter_version:ADAPTER_VERSION,auction_start:new Date().getTime(),publisher_id:site_id.toString(),publisher_name:domain,site_domain:domain,dnt:navigator.doNotTrack=='yes'||navigator.doNotTrack=='1'||navigator.msDoNotTrack=='1'?1:0,device_type:getDeviceType(navigator.userAgent),ua:navigator.userAgent,is_wrapper:false,session_id:bidderInfo.auctionId,tmax:properOps.tmax,referrer:properPage.referrer,page_url:properPage.url,},bids:imps,};var uids=userIds.getUIdsObj();if(uids){post_data.params.userIds=JSON.stringify(uids);}
if(gdprConsent&&gdprConsent.gdprApplies){post_data.params.gdpr=gdprConsent.gdprApplies;post_data.params.gdpr_consent=gdprConsent.consentString||'';}
if(uspConsent.usPrivacy){post_data.params.us_privacy=uspConsent.usPrivacy||'';}
const schain=schainCheck(bidder);if(schain!=''){post_data.params.schain=ProperMedia.utils.formatSupplyChainString(schain);}
const syncsAllowed=gdprEnforcement.userSyncEnforcement(bidder);if(syncsAllowed){post_data.params.cs_method='iframe';}
var request_url=ENDPOINT_URL+(properOps.testing_mode.ids?MODES['TEST']:MODES['PRODUCTION']);properLog.mylog(request_url,bidder);bidData.incrementRequestsSent(request_cnt);const bid_sent_ts=ProperMedia.utils.getTimestampMs();$.ajax({url:request_url,method:'POST',requestType:'cors',data:JSON.stringify(post_data),success:function(resp){try{const bids_received_ts=ProperMedia.utils.getTimestampMs();const bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);resp=ProperMedia.utils.safeJsonParse(resp);if(!resp||!resp.bids||resp.bids.length==0){properLog.mylog(bidder+': No bids returned');const ad=new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:request_url,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,});bidData.logNoBidResponse(ad);}else{properLog.mylog(resp,bidder);for(let i=0;i<resp.bids.length;i++){const bid=resp.bids[i];const price=bid.cpm||0,width=bid.width||0,height=bid.height||0,tag_id=bid.bidId||'',crid=bid.requestId||'',nurl=bid.nurl||'',ttl=bid.ttl||bidderInfo.default_bid_ttl;const ad=new adObj({bidder:bidder,size:width+'x'+height,price:parseFloat(price),gross:parseFloat(price),tag_id:tag_id,crid:crid,nurl:nurl,request_url:request_url,response:bid,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:ttl,floor:ProperMedia.utils.deepAccess(data_map,bid.bidId+'.floor')||0,target_slot:ProperMedia.utils.deepAccess(data_map,bid.bidId+'.slot_name')||'',uids:Object.keys(ProperMedia.utils.deepAccess(bidData,'auction.uids')),});const bidMediaType=ProperMedia.utils.deepAccess(bid,'meta.mediaType');if(bidMediaType&&bidMediaType.toLowerCase()==='video'){ad.type='video';ad.vast_tag=bid.vastUrl||'';const tagTypes=ProperMedia.utils.parseVastVpaid(ad.vast_tag);ad.vast_type=tagTypes['vast_type'];ad.vpaid=tagTypes['vpaid'];ad.video_type=ProperMedia.utils.deepAccess(bid,'meta.videoContext');}else if(bidMediaType&&bidMediaType.toLowerCase()==='banner'){ad.adcode=bid.ad;}
bidData.logBidResponse(ad);}}
bidData.incrementBidResponseCount(request_cnt);}catch(e){e.bidder=bidder;throw e;}},error:function(resp){try{bidData.incrementBidResponseCount(request_cnt);const bids_received_ts=ProperMedia.utils.getTimestampMs();const bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);const bidError={bidder:bidder,status:resp.status,statusText:resp.statusText,timeout:resp.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}
function onBidWon(bid,slot){if(bid.nurl){var img=new Image();img.src=bid.nurl;}
return true;}
function getDeviceType(ua){if(/ipad|android 3.0|xoom|sch-i800|playbook|tablet|kindle/i.test(ua.toLowerCase())){return '5';}
if(/iphone|ipod|android|blackberry|opera|mini|windows\sce|palm|smartphone|iemobile/i.test(ua.toLowerCase())){return '4';}
if(/smart[-_\s]?tv|hbbtv|appletv|googletv|hdmi|netcast|viera|nettv|roku|\bdtv\b|sonydtv|inettvbrowser|\btv\b/i.test(ua.toLowerCase())){return '3';}
return '1';}
return{send:send,onBidWon:onBidWon,bidderInfo:bidderInfo,formatRequest:formatRequest,};})();bidAdapters.rubicon=(function(){var bidderInfo={rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:300000,gvlid:52,};var bidder='rubicon',accountId=8777,alias_accountId=15380;var ENDPOINT_URL='https://fastlane.rubiconproject.com/a/api/fastlane.json',SYNC_ENDPOINT='https://eus.rubiconproject.com/usync.html';var sizeMap={'468x60':1,'728x90':2,'120x90':5,'120x600':8,'160x600':9,'300x600':10,'200x200':13,'250x250':14,'300x250':15,'336x280':16,'300x100':19,'980x120':31,'250x360':32,'180x500':33,'980x150':35,'468x400':37,'930x180':38,'750x100':39,'750x200':40,'750x300':41,'320x50':43,'300x50':44,'300x300':48,'1024x768':53,'300x1050':54,'970x90':55,'970x250':57,'1000x90':58,'320x80':59,'320x150':60,'1000x1000':61,'580x500':64,'640x480':65,'930x600':66,'320x480':67,'1800x1000':68,'320x320':72,'320x160':73,'980x240':78,'980x300':79,'980x400':80,'480x300':83,'970x310':94,'970x210':96,'480x320':101,'768x1024':102,'480x280':103,'250x800':105,'320x240':108,'1000x300':113,'320x100':117,'800x250':125,'200x600':126,'980x600':144,'320x250':159,'250x600':179,'600x300':195,'640x360':198,'640x200':199,'1030x590':213,'980x360':214,'320x180':229,'580x400':232,'400x600':257,};Object.keys(sizeMap).forEach(function(x){sizeMap[sizeMap[x]]=x;});function formatRequest(bidData,bidder,bidderInfo){var requestData={imps:{},data_map:{},request_cnt:0,};var rubicon_sizes={};var siteId=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.site_id')||0;accountId=bidderInfo.alias?alias_accountId:accountId;if(ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.account_overrides.enabled')){accountId=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.account_overrides.bidder_ids.accountId')||accountId;}
if(!siteId){properLog.mylog('Error: Rubicon Site ID is Required.');return requestData;}
var transactionID=ProperMedia.utils.generateUUID();if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){for(var i=0;i<data[size].length;i++){var tag_id=data[size][i];if(typeof requestData['imps'][tag_id]=='undefined'){var ids=tag_id.split('-');var zoneId=ids[0];rubicon_sizes[tag_id]=[];requestData['imps'][tag_id]={account_id:parseInt(accountId),site_id:parseInt(siteId),zone_id:parseInt(zoneId),size_id:undefined,alt_size_ids:'',rp_floor:getBidderFloor(bidder,size),rp_secure:properPage.use_ssl==true?'1':'0',tk_flint:'pbjs_lite_v3.2.0','x_source.tid':transactionID,'x_imp.ext.tid':transactionID,p_screen_res:properPage.width+'x'+properPage.height,kw:'',tk_user_key:'','p_geo.latitude':undefined,'p_geo.longitude':undefined,'tg_fl.eid':tag_id,rf:properPage.bidder_page_url,};requestData['data_map'][tag_id]={slot_name:slot_name||'',tag_id:tag_id,floor:0,};}
if(typeof sizeMap[size]!=='undefined'){var floor=getBidderFloor(bidder,size);if(!requestData['imps'][tag_id]['rp_floor']||floor<requestData['imps'][tag_id]['rp_floor']){requestData['imps'][tag_id]['rp_floor']=floor;requestData['data_map'][tag_id]['floor']=floor;}
rubicon_sizes[tag_id].push(sizeMap[size]);rubicon_sizes[tag_id]=masSizeOrdering(rubicon_sizes[tag_id]);requestData['imps'][tag_id]['size_id']=rubicon_sizes[tag_id][0];requestData['imps'][tag_id]['alt_size_ids']=rubicon_sizes[tag_id].slice(1).join(',');requestData['request_cnt']++;}}});}}
return requestData;}
function send(bidData){var bidder=bidData.bidder;var bidderInfo=properOps.bidder_info[bidder]||bidderInfo;var requestData=formatRequest(bidData,bidder,bidderInfo);var data=ProperMedia.utils.objectValues(requestData['imps'])||[];var data_map=requestData['data_map']||{};var request_cnt=requestData['request_cnt'];if(request_cnt==0){return false;}
var combined_data=combineSlotUrlParams(data);if(!gppConsentModule.isConsentDenied()&&gdprConsentModule.hasPurpose4Consent()){combined_data['ppuid']=properUser.pubcid;}
var eids=userIds.getEidsArray();if(eids&&eids.length){eids.forEach(function(eid){try{if(eid.source==='adserver.org'){combined_data['tpid_tdid']=eid.uids[0].id;combined_data['eid_adserver.org']=eid.uids[0].id;}else if(eid.source==='liveintent.com'){combined_data['tpid_liveintent.com']=eid.uids[0].id;combined_data['eid_liveintent.com']=eid.uids[0].id;if(eid.ext&&Array.isArray(eid.ext.segments)&&eid.ext.segments.length){combined_data['tg_v.LIseg']=eid.ext.segments.join(',');}}else if(eid.source==='liveramp.com'){combined_data['x_liverampidl']=eid.uids[0].id;}else if(eid.source==='id5-sync.com'){combined_data['eid_id5-sync.com']=eid.uids[0].id+'^'+eid.uids[0].atype+'^'+((eid.uids[0].ext&&eid.uids[0].ext.linkType)||'');}else{combined_data['eid_'+eid.source]=eid.uids[0].id+'^'+(eid.uids[0].atype||'');}}catch(e){properLog.mylog('Rubicon: error reading eid:'+eid+'. '+JSON.stringify(e));}});}
var uids=Object.keys(ProperMedia.utils.deepAccess(bidData,'auction.uids'));if(ProperMedia.utils.deepAccess(properSpecialOps,'coppa')){combined_data['coppa']=1;}
if(typeof gdprConsent.gdprApplies==='boolean'){combined_data['gdpr']=Number(gdprConsent.gdprApplies);}
combined_data['gdpr_consent']=gdprConsent.consentString;if(uspConsent.usPrivacy){combined_data['us_privacy']=encodeURIComponent(uspConsent.usPrivacy);}
if(gppConsent.gppString){data['gpp']=gppConsent.gppString;data['gpp_sid']=gppConsent?.applicableSections?.toString();}
var schain=schainCheck(bidder);if(schain!='')combined_data['rp_schain']=ProperMedia.utils.formatSupplyChainString(schain);combined_data['slots']=data.length;combined_data['rand']=Math.random();var orderedParams=getOrderedParams(combined_data);var qs=ProperMedia.utils.formatQueryString(combined_data,true);var request_url=ENDPOINT_URL+'?'+qs;properLog.mylog(request_url,bidder);bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({url:request_url,requestType:'cors',bidder:bidder,edge:edge,success:function(resp){try{properLog.mylog(resp,bidder);var responseObj=ProperMedia.utils.safeJsonParse(resp)||{};if(responseObj&&typeof responseObj=='object'){var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var ads=responseObj.ads||[];if(Array.isArray(ads)&&ads.length>0){for(var i=0;i<ads.length;i++){var bid=ads[i];var impid=data&&data[i]&&data[i]['tg_fl.eid']?data[i]['tg_fl.eid']:'';if(bid.status!=='ok'){if(typeof bid.reason!=='undefined'){properLog.mylog('rubicon resposne status: '+bid.reason);}
continue;}
var price=bid.cpm||0,status=bid.status||'',adcode=bid.script||'',adtype=bid.type||'',size_id=bid.size_id||'',dealid=bid.dealid||'',adomain=bid.adomain||[],tag_id=responseObj.zoneId||'',crid=bid.creative_id||bid.crid||(bid.network||'')+'-'+(bid.advertiser||'');var adid=ProperMedia.utils.deepAccess(bid,'ext.bidder.rp.advid')||'';var size=sizeMap[size_id]||'unknown';if(adtype=='script'&&adcode)adcode='<script>'+adcode+'</script>';var ad_details={};if(typeof bid.advertiser!=='undefined')ad_details.advertiser=bid.advertiser;if(typeof bid.seat!=='undefined')ad_details.seat=bid.seat;if(typeof bid.creative_id!=='undefined')ad_details.creative_id=bid.creative_id;if(typeof bid.campaign_id!=='undefined')ad_details.campaign_id=bid.campaign_id;if(typeof bid.ad_id!=='undefined')ad_details.ad_id=bid.ad_id;var ad=new adObj({bidder:bidder,size:size,price:parseFloat(price),gross:parseFloat(price),adcode:adcode,tag_id:impid,adid:adid,dealid:dealid,crid:crid,adomain:adomain,request_url:request_url,response:bid,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:bidderInfo.default_bid_ttl,uids:uids,floor:ProperMedia.utils.deepAccess(data_map,impid+'.floor')||0,target_slot:ProperMedia.utils.deepAccess(data_map,impid+'.slot_name')||'',});if(status!=='no-ads'){bidData.logBidResponse(ad);}else{bidData.logNoBidResponse(ad);}}}else{bidData.logNoBidResponse(new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:request_url,response:responseObj,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,}));}}else{bidData.logNoBidResponse(new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:request_url,response:responseObj,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,}));}
bidData.incrementBidResponseCount(request_cnt);}catch(e){e.bidder=bidder;throw e;}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}
function combineSlotUrlParams(aSlotUrlParams){if(aSlotUrlParams.length===1){return aSlotUrlParams[0];}
var oCombinedSlotUrlParams=aSlotUrlParams.reduce(function(oCombinedParams,oSlotUrlParams,iIndex){Object.keys(oSlotUrlParams).forEach(function(param){if(typeof oCombinedParams[param]=='undefined'){oCombinedParams[param]=new Array(aSlotUrlParams.length);}
oCombinedParams[param].splice(iIndex,1,oSlotUrlParams[param]);});return oCombinedParams;},{});var re=new RegExp('^([^;]*)(;\\1)+$');Object.keys(oCombinedSlotUrlParams).forEach(function(param){var sValues=oCombinedSlotUrlParams[param].join(';');var match=sValues.match(re);oCombinedSlotUrlParams[param]=match?match[1]:sValues;});return oCombinedSlotUrlParams;}
function getOrderedParams(params){var containsTgV=/^tg_v/;var containsTgI=/^tg_i/;var orderedParams=['account_id','site_id','zone_id','size_id','alt_size_ids','p_pos','gdpr','gdpr_consent','rf','dt.id','dt.keyv','dt.pref','p_geo.latitude','p_geo.longitude','kw',].concat(Object.keys(params).filter(function(item){return containsTgV.test(item);})).concat(Object.keys(params).filter(function(item){return containsTgI.test(item);})).concat(['tk_flint','x_source.tid','p_screen_res','rp_floor','rp_secure','tk_user_key']);return orderedParams.concat(Object.keys(params).filter(function(item){return orderedParams.indexOf(item)===-1;}));}
function masSizeOrdering(sizes){var MAS_SIZE_PRIORITY=[15,2,9];return sizes.sort(function(first,second){var firstPriority=MAS_SIZE_PRIORITY.indexOf(first);var secondPriority=MAS_SIZE_PRIORITY.indexOf(second);if(firstPriority>-1||secondPriority>-1){if(firstPriority===-1){return 1;}
if(secondPriority===-1){return-1;}
return firstPriority-secondPriority;}
return first-second;});}
function getUserSyncs(){var params={};if(typeof gdprConsent.gdprApplies==='boolean'){params['gdpr']=Number(gdprConsent.gdprApplies);}
if(typeof gdprConsent.consentString==='string'){params['gdpr_consent']=gdprConsent.consentString;}
if(uspConsent.usPrivacy){params['us_privacy']=encodeURIComponent(uspConsent.usPrivacy);}
if(gppConsent?.gppString){params['gpp']=gppConsent.gppString;params['gpp_sid']=gppConsent.applicableSections?.toString();}
const qs=ProperMedia.utils.formatQueryString(params);userSyncs.add({type:'iframe',url:SYNC_ENDPOINT+'?'+qs,bidder:bidder,});}
return{send:send,bidderInfo:bidderInfo,getUserSyncs:getUserSyncs,formatRequest:formatRequest,};})();bidAdapters.sharethrough=(function(){var bidderInfo={rev_share:1,demand_type:'display',bid_grouping:'slot',default_bid_ttl:360000,gvlid:80,};var bidder='sharethrough';var ENDPOINT_URL='https://btlr.sharethrough.com/WYu2BXv1/v1';function formatRequest(bidData){var requestData={};if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){for(var i=0;i<data[size].length;i++){var tag_id=data[size][i];if(typeof requestData[tag_id]=='undefined'){requestData[tag_id]={tag_id:tag_id,pkey:tag_id,size:size,slot_name:slot_name,};}}});}}
return requestData;}
function send(bidData){var requestData=formatRequest(bidData);Object.keys(requestData).forEach(function(tag_id){send_slot(requestData[tag_id]);});function send_slot(request_data){var pkey=request_data['pkey'];var size=request_data['size'];var request_cnt=1;var floor=getBidderFloor(bidder,size);var data={placement_key:pkey,bidId:pkey,bidfloor:floor,consent_required:false,instant_play_capable:canAutoPlayHTML5Video(),hbSource:'prebid',hbVersion:'3.0.0',strVersion:'3.2.0',};var{universalIds,uids}=handleUniversalIds();ProperMedia.utils.mergeObject(data,universalIds);if(gdprConsent.consentString){data.consent_string=gdprConsent.consentString;}
data.consent_required=!!gdprConsent.gdprApplies;if(uspConsent.usPrivacy){data.us_privacy=uspConsent.usPrivacy;}
if(properOps.schain){data.schain=JSON.stringify(properOps.schain);}
var query=ProperMedia.utils.formatQueryString(data,true);var request_url=ENDPOINT_URL+'?'+query;properLog.mylog(request_url,bidder);bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({url:request_url,method:'GET',requestType:'cors',bidder:bidder,edge:edge,success:function(json){try{properLog.mylog(json,bidder);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var resp=ProperMedia.utils.safeJsonParse(json);if(resp&&resp.creatives.length>0){var creative=resp.creatives[0];var bidId=resp.bidId||'';var price=creative.cpm||0;var windowLocation='str_response_'+bidId;var bidJsonString=ProperMedia.utils.b64EncodeUnicode(JSON.stringify(resp));var adcode='<div data-str-native-key="'+pkey+'" data-stx-response-name="'+windowLocation+'"></div>';adcode+='<script>var '+windowLocation+' = "'+bidJsonString+'"</script>';adcode+='<script src="//native.sharethrough.com/assets/sfp.js"></script>';let ad=new adObj({bidder:bidder,size:size,price:parseFloat(price),gross:parseFloat(price),adcode:adcode,tag_id:request_data['tag_id'],request_url:request_url,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:bidderInfo.default_bid_ttl,floor:floor,target_slot:request_data['slot_name']||'',uids:uids,});bidData.logBidResponse(ad);}else{let ad=new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:request_url,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,});bidData.logNoBidResponse(ad);}
addUserSyncs(resp);bidData.incrementBidResponseCount(request_cnt);}catch(e){e.bidder=bidder;throw e;}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}}
function canAutoPlayHTML5Video(){var userAgent=navigator.userAgent;if(!userAgent)return false;var isAndroid=/Android/i.test(userAgent);var isiOS=/iPhone|iPad|iPod/i.test(userAgent);var chromeVersion=parseInt((/Chrome\/([0-9]+)/.exec(userAgent)||[0,0])[1]);var chromeiOSVersion=parseInt((/CriOS\/([0-9]+)/.exec(userAgent)||[0,0])[1]);var safariVersion=parseInt((/Version\/([0-9]+)/.exec(userAgent)||[0,0])[1]);if((isAndroid&&chromeVersion>=53)||(isiOS&&(safariVersion>=10||chromeiOSVersion>=53))||!(isAndroid||isiOS)){return true;}else{return false;}}
function handleUniversalIds(){var universalIds={};var uids=[];var idl=userIdAdapters.identityLink.getValue();if(idl){universalIds.idluid=idl;uids.push('idl_env');}
var shd=userIdAdapters.pubCommonId.getValue();if(shd){universalIds.shduid=shd;}
var id5=userIdAdapters.id5Id.getValue();if(id5){universalIds.id5uid={id:id5};var id5link=ProperMedia.utils.deepAccess(userIdAdapters.identityLink,'idObj.id5id.ext.linkType');if(id5link)universalIds.id5uid.linkType=id5link;uids.push('id5id');}
if(!gppConsentModule.isConsentDenied()&&gdprConsentModule.hasPurpose4Consent()){universalIds.pubcid=properUser.pubcid;uids.push('pubcid');}
return{universalIds,uids};}
function addUserSyncs(resp){if(resp&&resp.cookieSyncUrls){var syncs=resp.cookieSyncUrls.map(function(url){return{type:'image',url:url,bidder:bidder,};});userSyncs.add(syncs);}}
return{formatRequest:formatRequest,send:send,bidderInfo:bidderInfo,};})();bidAdapters.sonobi=(function(){var bidderInfo={rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:120000,gvlid:104,};var bidder='sonobi',ENDPOINT_URL='https://apex.go.sonobi.com/trinity.json',SONOBI_DIGITRUST_KEY='fhnS5drwmH';var storageEnfObj={};function formatRequest(bidData,bidder){var requestData={imps:{},data_map:{},request_cnt:0,};if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){for(var i=0;i<data[size].length;i++){var tag_id=data[size][i];if(typeof requestData['imps'][tag_id]=='undefined'){var siteIds=(ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.site_id')||'').split('-');var siteId=(properDevice.isMobile()&&siteIds.length==2?siteIds[1]:siteIds[0])||tag_id;requestData['imps'][tag_id]={bidId:siteId,floor:0,sizes:[],};requestData['data_map'][tag_id]={slot_name:slot_name||'',tag_id:tag_id,floor:0,};}
var floor=getBidderFloor(bidder,size);if(!requestData['imps'][tag_id]['floor']||floor<requestData['imps'][tag_id]['floor']){requestData['imps'][tag_id]['floor']=floor;requestData['data_map'][tag_id]=floor;}
requestData['imps'][tag_id]['sizes'].push(size);requestData['request_cnt']++;}});}}
return requestData;}
function send(bidData){var bidder=bidData.bidder;var bidderInfo=properOps.bidder_info[bidder]||bidderInfo;storageEnfObj={gvlid:bidderInfo.gvlid,bidderCode:bidder,};var requestData=formatRequest(bidData,bidder);var data_map=requestData['data_map']||{};var request_cnt=requestData['request_cnt'];if(request_cnt==0)return false;var payload={key_maker:'',ref:properPage.bidder_page_url,s:ProperMedia.utils.generateUUID(),pv:ProperMedia.utils.generateUUID(),vp:properDevice.device_type,lib_name:'prebid',lib_v:properOps.prebid_version,us:1,ius:1,iqid:JSON.stringify(loadOrCreateFirstPartyData()),};var eids=userIds.getEidsArray();if(eids&&eids.length){payload['eids']=JSON.stringify(eids);}
var uids=Object.keys(ProperMedia.utils.deepAccess(bidData,'auction.uids'));var data={};Object.keys(requestData['imps']).forEach(function(key){var obj=requestData['imps'][key];var bidId=obj['bidId'];var floor=obj['floor'];var sizes=bidderInfo.demand_type=='display'?obj['sizes'].join(','):'';data[key]=bidId+'|'+sizes+'|'+floor;});payload['key_maker']=JSON.stringify(data);var schain=schainCheck(bidder);if(schain!='')payload['schain']=JSON.stringify(schain);ProperMedia.utils.deepSetValue(payload,'coppa',ProperMedia.utils.deepAccess(properSpecialOps,'coppa')?1:0);if(gdprConsent&&typeof gdprConsent.gdprApplies==='boolean'){payload['gdpr']=gdprConsent.gdprApplies.toString();if(gdprConsent.consentString){payload['consent_string']=gdprConsent.consentString;}}
if(uspConsent.usPrivacy){payload['us_privacy']=uspConsent.usPrivacy;}
var qs=ProperMedia.utils.formatQueryString(payload,true);var request_url=ENDPOINT_URL+'?'+qs;properLog.mylog(request_url,bidder);bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({url:request_url,method:'GET',requestType:'cors',bidder:bidder,edge:edge,success:function(resp){try{properLog.mylog(resp,bidder);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);resp=ProperMedia.utils.safeJsonParse(resp)||{};if(resp&&resp.slots&&Object.keys(resp.slots).length>0){var sbi_dc=resp.sbi_dc||'';Object.keys(resp.slots).forEach(function(key){var obj=resp.slots[key];if(Object.keys(obj).length>0){var dealId=obj.sbi_dozer||'',sbi_aid=obj.sbi_aid||'',sbi_ct=obj.sbi_ct||'',crid=obj.sbi_crid||obj.sbi_aid||'';var tagid=key,price=obj.sbi_mouse,size=obj.sbi_size;if(bidderInfo.demand_type=='video'){var reqObj=requestData['imps'][key];size=reqObj.sizes[0];}
var aDomains=[];if(obj.sbi_adomain){aDomains=[obj.sbi_adomain];}
var ad=new adObj({bidder:bidder,size:size,price:parseFloat(price),gross:parseFloat(price),tag_id:tagid,crid:crid,adid:sbi_aid,adomain:aDomains,request_url:request_url,response:obj,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:bidderInfo.default_bid_ttl,floor:ProperMedia.utils.deepAccess(data_map,tagid+'.floor')||0,target_slot:ProperMedia.utils.deepAccess(data_map,tagid+'.slot_name')||'',uids:uids,});if(bidderInfo.demand_type=='video'){ad.type='video';ad.vast_tag='https://'+
sbi_dc+
'apex.go.sonobi.com/vast.xml?vid='+
sbi_aid+
'&ref='+
encodeURIComponent(properPage.bidder_page_url);var tagTypes=ProperMedia.utils.parseVastVpaid(ad.vast_tag);ad.vast_type=tagTypes['vast_type'];ad.vpaid=tagTypes['vpaid'];ad.video_type=bidderInfo.video_type;}else{ad.adcode='<script type="text/javascript" src="https://'+
sbi_dc+
'apex.go.sonobi.com/sbi.js?aid='+
sbi_aid+
'&as=null&ref='+
encodeURIComponent(properPage.bidder_page_url)+
'"></script>';}
bidData.logBidResponse(ad);}else{bidData.logNoBidResponse(new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:request_url,response:obj,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,}));}});addUserSyncs(resp,bidder);}else{var ad=new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:request_url,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,});bidData.logNoBidResponse(ad);}
bidData.incrementBidResponseCount(request_cnt);}catch(e){e.bidder=bidder;throw e;}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}
function addUserSyncs(resp,bidder){if(resp&&resp.sbi_px){var syncs=resp.sbi_px.map(function(entry){return{type:entry.type,url:entry.url,bidder:bidder,};});userSyncs.add(syncs);}}
function loadOrCreateFirstPartyData(){var localStorageEnabled;var FIRST_PARTY_KEY='_iiq_fdata';var readData=function(key){if(properStorage.hasLocalStorage(storageEnfObj)){return window.localStorage.getItem(key);}
return null;};var storeData=function(key,value){try{if(properStorage.hasLocalStorage(storageEnfObj)){window.localStorage.setItem(key,value);}}catch(error){return null;}};var firstPartyData=ProperMedia.utils.safeJsonParse(readData(FIRST_PARTY_KEY));if(!firstPartyData||!firstPartyData.pcid){var firstPartyId=ProperMedia.utils.generateUUID();firstPartyData={pcid:firstPartyId,pcidDate:Date.now()};}else if(firstPartyData&&!firstPartyData.pcidDate){firstPartyData.pcidDate=Date.now();}
storeData(FIRST_PARTY_KEY,JSON.stringify(firstPartyData));return firstPartyData;}
return{formatRequest:formatRequest,send:send,bidderInfo:bidderInfo,};})();bidAdapters.sovrn=(function(){var bidderInfo={rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:90000,gvlid:13,};var bidder='sovrn';var ENDPOINT_URL='https://ap.lijit.com/rtb/bid?src=prebid_prebid_'+properOps.prebid_version;function parseSize(size){var s=size.split('x');return{w:parseInt(s[0]),h:parseInt(s[1]),};}
function formatRequest(bidData,bidder,bidderInfo){var requestData={imps:{},data_map:{},request_cnt:0,};if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){var s=size.split('x');for(var i=0;i<data[size].length;i++){var tag_id=data[size][i];if(typeof requestData['imps'][tag_id]=='undefined'){requestData['imps'][tag_id]={id:tag_id.toString(),banner:{format:[],w:1,h:1,},tagid:tag_id,bidfloor:0,};var deals=addDeals();if(deals.length){requestData['imps'][tag_id].ext=requestData['imps'][tag_id].ext||{};requestData['imps'][tag_id].ext.deals=deals;}
requestData['data_map'][tag_id]={slot_name:slot_name||'',tag_id:tag_id,floor:0,};}
var floor=getBidderFloor(bidder,size);if(!requestData['imps'][tag_id]['bidfloor']||floor<requestData['imps'][tag_id]['bidfloor']){requestData['imps'][tag_id]['bidfloor']=floor;requestData['data_map'][tag_id]['floor']=floor;}
requestData['imps'][tag_id]['banner']['format'].push(parseSize(size));requestData['request_cnt']++;}});}}
return requestData;}
function send(bidData){var bidder=bidData.bidder;var bidderInfo=properOps.bidder_info[bidder]||bidderInfo;var requestData=formatRequest(bidData,bidder,bidderInfo);var imps=ProperMedia.utils.objectValues(requestData['imps'])||[];var data_map=requestData['data_map']||{};var request_cnt=requestData['request_cnt'];if(imps.length==0)return false;var br={id:ProperMedia.utils.generateUUID(),imp:imps,site:{domain:properPage.domain,page:properPage.bidder_page_url,},};var criteoId;var eids=userIds.getEidsArray();if(eids&&eids.length){eids.forEach(function(id){if(id.uids&&id.uids[0]){if(id.source==='criteo.com'){criteoId=id.uids[0].id;}}});ProperMedia.utils.deepSetValue(br,'user.ext.eids',eids);if(criteoId){ProperMedia.utils.deepSetValue(br,'user.ext.prebid_criteoid',criteoId);}}
var uids=Object.keys(ProperMedia.utils.deepAccess(bidData,'auction.uids'));var schain=schainCheck(bidder);if(schain!='')ProperMedia.utils.deepSetValue(br,'source.ext.schain',schain);ProperMedia.utils.deepSetValue(br,'regs.ext.gdpr',Number(gdprConsent.gdprApplies));ProperMedia.utils.deepSetValue(br,'user.ext.consent',gdprConsent.consentString);if(uspConsent.usPrivacy){ProperMedia.utils.deepSetValue(br,'regs.ext.us_privacy',uspConsent.usPrivacy);}
if(gppConsent){ProperMedia.utils.deepSetValue(br,'regs.gpp',gppConsent.gppString);ProperMedia.utils.deepSetValue(br,'regs.gpp_sid',gppConsent.applicableSections);}
properLog.mylog(ENDPOINT_URL,bidder);bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({url:ENDPOINT_URL,method:'POST',requestType:'cors',bidder:bidder,edge:edge,data:JSON.stringify(br),success:function(resp){try{properLog.mylog(resp,bidder);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);resp=ProperMedia.utils.safeJsonParse(resp)||{};if(!resp||!resp.seatbid||resp.seatbid.length==0||!resp.seatbid[0].bid||!resp.seatbid[0].bid.length){properLog.mylog('no sovrn bids found');var ad=new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:ENDPOINT_URL,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,});bidData.logNoBidResponse(ad);}else{var bids=resp.seatbid[0].bid;Object.keys(bids).forEach(function(x){var obj=bids[x],tag_id=obj.impid||'',size=obj.w+'x'+obj.h,cid=obj.cid||'',crid=obj.crid||'',dealid=obj.dealid||'',adomain=obj.adomain||[],price=obj.price||0,adcode=obj.adm||'',nurl=obj.nurl||'',ttl=ProperMedia.utils.deepAccess(obj,'ext.ttl')*1000||bidderInfo.default_bid_ttl;var ad_details={};var n=ProperMedia.utils.getUrlParameters(nurl);if(typeof n.seatid!='undefined')ad_details.seatid=n.seatid;if(typeof n.campaignid!='undefined')ad_details.campaignid=n.campaignid;if(typeof n.bannerid!='undefined')ad_details.bannerid=n.bannerid;if(typeof n.cb!='undefined')ad_details.cb=n.cb;if(typeof n.rpid!='undefined')ad_details.rpid=n.rpid;if(adcode){adcode=decodeURIComponent(adcode);if(nurl){adcode+=ProperMedia.utils.createTrackPixel(nurl);nurl='';}}
var ad=new adObj({bidder:bidder,size:size,price:parseFloat(price),gross:parseFloat(price),adcode:adcode,nurl:nurl,tag_id:tag_id,cid:cid,crid:crid,dealid:dealid,adomain:adomain,request_url:ENDPOINT_URL,response:obj,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:ttl,floor:ProperMedia.utils.deepAccess(data_map,tag_id+'.floor')||0,target_slot:ProperMedia.utils.deepAccess(data_map,tag_id+'.slot_name')||'',uids:uids,});bidData.logBidResponse(ad);});}
addUserSyncs(resp);bidData.incrementBidResponseCount(request_cnt);}catch(e){e.bidder=bidder;throw e;}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}
function addDeals(){var deals=[];var carbon_deal_id=ProperMedia.utils.deepAccess(properSpecialOps,'carbon_deal_id')||'';if(carbon_deal_id){if(ProperMedia.utils.isStr(carbon_deal_id)){carbon_deal_id=carbon_deal_id.split(',');}
deals.concat(carbon_deal_id.map((deal)=>deal.trim()));}
var signal_deal_id=ProperMedia.utils.deepAccess(properSpecialOps,'signal_deal_id')||'';if(signal_deal_id){if(ProperMedia.utils.isStr(signal_deal_id)){signal_deal_id=signal_deal_id.split(',');}
deals.concat(signal_deal_id.map((deal)=>deal.trim()));}
return deals;}
function onBidWon(bid,slot){if(bid.nurl){var img=new Image();img.src=bid.nurl;}
return true;}
function addUserSyncs(serverResponse){try{if(serverResponse&&serverResponse.ext&&serverResponse.ext.iid){var consentString='';if(gdprConsent&&gdprConsent.gdprApplies&&typeof gdprConsent.consentString==='string'){consentString+='&gdpr_consent='+gdprConsent.consentString;}
if(uspConsent.usPrivacy){consentString+='&us_privacy='+uspConsent.usPrivacy;}
userSyncs.add({type:'iframe',url:'//ap.lijit.com/beacon?informer='+serverResponse.ext.iid+consentString,bidder:bidder,});}}catch(e){e.bidder=bidder;throw e;}}
return{send:send,onBidWon:onBidWon,bidderInfo:bidderInfo,formatRequest:formatRequest,};})();bidAdapters.taboola=(function(){var bidderInfo={rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:300000,auto_gen_tag_ids:false,auto_gen_sizes:['1x1','120x600','160x600','300x50','300x100','300x250','300x600','320x100','320x50','336x280','400x300','728x90','970x250','970x90',],gvlid:42,};var ENDPOINT_URL='https://display.bidder.taboola.com/OpenRTB/TaboolaHB/auction',USER_SYNC_IMG_URL='https://trc.taboola.com/sg/prebidJS/1/cm',USER_ID='user-id',STORAGE_KEY=`taboola global:${USER_ID}`,COOKIE_KEY='trc_cookie_storage';var bidder='taboola';var publisherId,storageEnfObj={};function parseSize(size){var s=size.split('x');return{w:parseInt(s[0]),h:parseInt(s[1]),};}
function formatRequest(bidData,bidder,bidderInfo){var requestData={imps:{},data_map:{},request_cnt:0,};if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){for(var i=0;i<data[size].length;i++){var tag_id=data[size][i];if(typeof requestData['imps'][tag_id]=='undefined'){var s=size.split('x');requestData['imps'][tag_id]={id:tag_id,tagid:tag_id+(slot_name?'':'-'+ProperMedia.utils.deepAccess(bidData,'auction.auction_num')),bidfloor:0,bidfloorcur:'USD',};requestData['imps'][tag_id]['banner']={format:[],pos:0,};requestData['data_map'][tag_id]={slot_name:slot_name||'',tag_id:tag_id,floor:0,};}
var floor=getBidderFloor(bidder,size);if(!requestData['imps'][tag_id]['bidfloor']||floor<requestData['imps'][tag_id]['bidfloor']){requestData['imps'][tag_id]['bidfloor']=floor;requestData['data_map'][tag_id]['floor']=floor;}
if(bidderInfo.demand_type=='display'){requestData['imps'][tag_id]['banner']['format'].push(parseSize(size));}
requestData['request_cnt']++;}});}}
return requestData;}
function send(bidData){var bidder=bidData.bidder;var bidderInfo=properOps.bidder_info[bidder]||bidderInfo;publisherId=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.site_id')||tag_id;var requestData=formatRequest(bidData,bidder,bidderInfo);var imps=ProperMedia.utils.objectValues(requestData['imps'])||[];var data_map=requestData['data_map']||{};var request_cnt=requestData['request_cnt'];var request_url=[ENDPOINT_URL,publisherId].join('/');const site=getSiteProperties();const device={ua:navigator.userAgent};const user={buyeruid:userData.getUserId(gdprConsent,uspConsent),ext:{},};const regs={coppa:0,ext:{},};if(gdprConsent.gdprApplies){ProperMedia.utils.deepSetValue(user,'ext.consent',gdprConsent.consentString);ProperMedia.utils.deepSetValue(regs,'ext.gdpr',Number(gdprConsent.gdprApplies));}
if(uspConsent.usPrivacy){ProperMedia.utils.deepSetValue(regs,'ext.us_privacy',uspConsent.usPrivacy);}
if(gppConsent){ProperMedia.utils.deepSetValue(regs,'ext.gpp',gppConsent.gppString);ProperMedia.utils.deepSetValue(regs,'ext.gpp_sid',gppConsent.applicableSections);}
if(ProperMedia.utils.deepAccess(properSpecialOps,'coppa')){regs.coppa=1;}
const request={id:ProperMedia.utils.deepAccess(bidData,'auction.id'),imp:imps,site,device,source:{fd:1},tmax:properOps.tmax,bcat:[],badv:[],wlang:[],user,regs,ext:{pageType:ProperMedia.utils.deepAccess(properPage,'page_meta.page_type')||undefined,},};properLog.mylog(request_url,bidder);bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({url:request_url,method:'POST',requestType:'cors',bidder:bidder,edge:edge,withCredentials:false,data:JSON.stringify(request),success:function(resp){try{resp=ProperMedia.utils.safeJsonParse(resp);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);if(resp&&resp.seatbid&&resp.seatbid.length>0&&resp.seatbid[0].bid&&resp.seatbid[0].bid.length>0){properLog.mylog(resp,bidder);Object.keys(resp.seatbid).forEach(function(x){var obj=resp.seatbid[x].bid[0];var impid=obj.impid||'',price=obj.price||0,width=obj.w||1,height=obj.h||1,adcode=(obj.adm||'').replace(/\$\{AUCTION_PRICE\}/g,price),crid=obj.crid||'',nurl=obj.nurl||'',ttl=obj.exp*1000||bidderInfo.default_bid_ttl;var ad=new adObj({bidder:bidder,adcode:adcode,size:width+'x'+height,price:parseFloat(price),gross:parseFloat(price),tag_id:ProperMedia.utils.deepAccess(data_map,impid+'.tag_id')||impid,crid:crid,nurl:nurl,request_url:request_url,response:obj,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:ttl,floor:ProperMedia.utils.deepAccess(data_map,impid+'.floor')||0,target_slot:ProperMedia.utils.deepAccess(data_map,impid+'.slot_name')||'',});bidData.logBidResponse(ad);});}else{var ad=new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:request_url,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,});bidData.logNoBidResponse(ad);}
bidData.incrementBidResponseCount(request_cnt);}catch(e){e.bidder=bidder;throw e;}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}
const userData={getUserId:()=>{const{getFromLocalStorage,getFromCookie,getFromTRC}=userData;try{return getFromLocalStorage()||getFromCookie()||getFromTRC();}catch(ex){return 0;}},getFromCookie(){if(properStorage.cookiesAreEnabled(storageEnfObj)){const cookieData=properStorage.getCookie(COOKIE_KEY,storageEnfObj);const userId=userData.getCookieDataByKey(cookieData,USER_ID);if(userId){return userId;}}},getCookieDataByKey(cookieData,key){const[,value='']=cookieData.split(`${key}=`);return value;},getFromLocalStorage(){if(properStorage.hasLocalStorage(storageEnfObj)&&properStorage.localStorageIsEnabled(storageEnfObj)){return properStorage.getDataFromLocalStorage(STORAGE_KEY,storageEnfObj);}},getFromTRC(){return window.TRC?window.TRC.user_id:0;},};function getSiteProperties(){return{id:publisherId,name:publisherId,domain:properPage.domain,page:properPage.url,ref:properPage.referrer,publisher:{id:publisherId,},content:{language:navigator.language,},};}
function getUserSyncs(){const syncs=[];const queryParams=[];if(gdprConsent.gdprApplies){queryParams.push(`gdpr=${Number(gdprConsent.gdprApplies&&1)}&gdpr_consent=${encodeURIComponent(gdprConsent.consentString||'')}`);}
if(uspConsent.usPrivacy){queryParams.push('us_privacy='+encodeURIComponent(uspConsent.usPrivacy));}
if(gppConsent){queryParams.push('gpp='+encodeURIComponent(gppConsent.gppString));}
userSyncs.add({type:'image',url:USER_SYNC_IMG_URL+(queryParams.length?'?'+queryParams.join('&'):''),bidder:bidder,});}
function onBidWon(bid,slot){if(bid.nurl){var img=new Image();img.src=bid.nurl.replace(/\$\{AUCTION_PRICE\}/g,bid.price);}
return true;}
return{send:send,onBidWon:onBidWon,bidderInfo:bidderInfo,getUserSyncs:getUserSyncs,formatRequest:formatRequest,};})();bidAdapters.teads=(function(){var bidderInfo={rev_share:1,demand_type:'display',bid_grouping:'page',div_insertion:1,gvlid:132,native_sizes:{native_horizontal:'300x250',native_vertical:'300x250',},};var ENDPOINT='https://a.teads.tv/hb/bid-request',USYNCURL='https://sync.teads.tv/iframe';var bidder='teads';var gdprStatus={GDPR_APPLIES_PUBLISHER:12,GDPR_APPLIES_GLOBAL:11,GDPR_DOESNT_APPLY:0,CMP_NOT_FOUND_OR_ERROR:22,};function formatRequest(bidData,bidder,bidderInfo){var requestData={data:{},data_map:{},request_cnt:0,};var site_id=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.site_id')||0;var auctionId=ProperMedia.utils.deepAccess(bidData,'auction.id');if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){for(var i=0;i<data[size].length;i++){var tag_id=data[size][i];var ids=tag_id.split('-');var placementId;var pageId;if(site_id){pageId=site_id;placementId=ids[0];}else{pageId=ids[0];placementId=ids[1];}
if(!pageId){properLog.mylog('Error: Teads Page ID is Required.');return requestData;}
if(!placementId){properLog.mylog('Error: Teads Placement ID is Required.');return requestData;}
if(typeof requestData['data'][tag_id]=='undefined'){var div_id='teads-'+ProperMedia.utils.generateUUID();requestData['data'][tag_id]={bidId:tag_id,placementId:parseInt(placementId),pageId:parseInt(pageId),adUnitCode:div_id,bidderRequestId:ProperMedia.utils.generateUUID(),transactionId:ProperMedia.utils.generateUUID(),auctionId:auctionId,sizes:[],};requestData['data_map'][tag_id]={sizes:[],tag_id:tag_id,slot_name:slot_name||'',};}
var tmp_size=bidderInfo.native_sizes[size]||size;requestData['data'][tag_id]['sizes'].push(tmp_size);requestData['data_map'][tag_id]['sizes'].push(size);requestData['request_cnt']++;}});}}
return requestData;}
function send(bidData){var bidder=bidData.bidder;var bidderInfo=properOps.bidder_info[bidder]||bidderInfo;var requestData=formatRequest(bidData,bidder,bidderInfo);var bids=ProperMedia.utils.objectValues(requestData['data'])||[];var request_cnt=requestData['request_cnt'];const native_sizes=Object.values(bidderInfo.native_sizes);bids.sort((a,b)=>{const a_native=a.sizes.some((size)=>native_sizes.includes(size))?1:0;const b_native=b.sizes.some((size)=>native_sizes.includes(size))?1:0;return b_native-a_native;});var{sharedViewerIdObject,uids}=getSharedViewerIdParameters();var postData={referrer:properPage.bidder_page_url,deviceWidth:properPage.width,hb_version:properOps.prebid_version,...sharedViewerIdObject,};var schain=schainCheck(bidder);if(schain!='')postData.schain=schain;if(gdprConsent){var isCmp=typeof gdprConsent.gdprApplies==='boolean';var isConsentString=typeof gdprConsent.consentString==='string';var status=isCmp?findGdprStatus(gdprConsent.gdprApplies,gdprConsent.vendorData,gdprConsent.apiVersion):gdprStatus.CMP_NOT_FOUND_OR_ERROR;postData.gdpr_iab={consent:isConsentString?gdprConsent.consentString:'',status:status,apiVersion:gdprConsent.apiVersion,};}
if(uspConsent.usPrivacy){postData.us_privacy=uspConsent.usPrivacy;}
properLog.mylog(ENDPOINT,bidder);bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;const bidChunks=bids.reduce((acc,e,i)=>(i%10?acc[acc.length-1].push(e):acc.push([e]),acc),[]);for(const chunk of bidChunks){postData.data=chunk;$.ajax({url:ENDPOINT,method:'POST',requestType:'cors',bidder:bidder,edge:edge,data:JSON.stringify(postData),success:function(resp){try{resp=ProperMedia.utils.safeJsonParse(resp);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);if(resp&&resp.responses&&resp.responses.length>0){properLog.mylog(resp,bidder);for(var i=0;i<resp.responses.length;i++){var respObj=resp.responses[i];var bidId=respObj.bidId||'',width=respObj.width||1,height=respObj.height||1,price=respObj.cpm||0,adcode=respObj.ad||'',crid=respObj.creativeId||'',ttl=(respObj.ttl||120)*1000;var size='1x1';if(requestData['data_map'][bidId]['sizes'].indexOf(width+'x'+height)!==-1){size=width+'x'+height;}
if(size=='1x1'){size=requestData['data_map'][bidId]['sizes'].pop()||size;}
var ad_code_prepend='';if(properOps.dfp_per_slot==1&&properPage.isolated==0){ad_code_prepend=`<script>
										try {
											const slot_div = window.top.document.getElementById('{PROPER_SLOT_DIV_ID}-iframe')
											.contentWindow
											.document
											.getElementById('{PROPER_SLOT_DIV_ID}');
											const grandParent = document.createElement('div');
											const parent = document.createElement('div');
											const child = document.createElement('div');

											child.setAttribute('id', '${requestData['data'][bidId]['adUnitCode']}');
											parent.appendChild(child);
											grandParent.appendChild(parent);
											slot_div.appendChild(grandParent);
										} catch (e) {
											console.error(e);
										}
									</script>`;}else{ad_code_prepend=`<script>
										try {
											const slot_div = window.top.document.getElementById("{PROPER_SLOT_DIV_ID}");
											const grandParent = document.createElement('div');
											const parent = document.createElement('div');
											const child = document.createElement('div');

											child.setAttribute('id', '${requestData['data'][bidId]['adUnitCode']}');
											parent.appendChild(child);
											grandParent.appendChild(parent);
											slot_div.appendChild(grandParent);
										} catch(e) {
											console.error(e);
										}
									</script>`;}
adcode=ad_code_prepend+adcode;bidData.logBidResponse(new adObj({bidder:bidder,size:size,price:parseFloat(price),gross:parseFloat(price),adcode:adcode,tag_id:bidId,crid:crid,request_url:ENDPOINT,response:respObj,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:ttl,target_slot:ProperMedia.utils.deepAccess(requestData,'data_map.'+bidId+'.slot_name')||'',uids:uids,}));}}else{properLog.mylog('no teads bids returned');bidData.logNoBidResponse(new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:ENDPOINT,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,}));}
bidData.incrementBidResponseCount(request_cnt);}catch(e){e.bidder=bidder;throw e;}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}}
function findGdprStatus(gdprApplies,gdprData,apiVersion){var status=gdprStatus.GDPR_APPLIES_PUBLISHER;if(gdprApplies){if(isGlobalConsent(gdprData,apiVersion))status=gdprStatus.GDPR_APPLIES_GLOBAL;}else status=gdprStatus.GDPR_DOESNT_APPLY;return status;}
function isGlobalConsent(gdprData,apiVersion){return gdprData&&apiVersion===1?gdprData.hasGlobalScope||gdprData.hasGlobalConsent:gdprData&&apiVersion===2?!gdprData.isServiceSpecific:false;}
function getSharedViewerIdParameters(){var sharedViewerIdMapping={unifiedId2:'uid2.id',liveRampId:'idl_env',id5Id:'id5id.uid',yahooConnectId:'connectid',epsilonPublisherLinkId:'publinkId',publisherFirstPartyViewerId:'pubcid',};var uidsObj=userIds.getUIdsObj();var uids=[];var sharedViewerIdObject={};for(var sharedViewerId in sharedViewerIdMapping){var key=sharedViewerIdMapping[sharedViewerId];var value=ProperMedia.utils.deepAccess(uidsObj,key);if(value){sharedViewerIdObject[sharedViewerId]=value;uids.push(key.split('.')[0]);}}
return{sharedViewerIdObject,uids};}
function getUserSyncs(){var params='';if(gdprConsent){var gdprIab={status:findGdprStatus(gdprConsent.gdprApplies,gdprConsent.vendorData),consent:gdprConsent.consentString,};params='?gdprIab='+encodeURIComponent(JSON.stringify(gdprIab));}
userSyncs.add({type:'iframe',url:USYNCURL+params,bidder:bidder,});}
return{send:send,bidderInfo:bidderInfo,getUserSyncs:getUserSyncs,formatRequest:formatRequest,};})();bidAdapters.thirtythreeacross=(function(){var bidderInfo={rev_share:1,demand_type:'display',bid_grouping:'slot',default_bid_ttl:60000,gvlid:58,};var bidder='thirtythreeacross',ENDPOINT_URL='https://ssc.33across.com/api/v1/hb',SYNC_ENDPOINT='https://de.tynt.com/deb/v2?m=xch&rt=html',NON_MEASURABLE='nm';var special_sizes={sticky_horizontal:'1x1',};function parseSize(size){size=special_sizes[size]||size;var s=size.split('x');return{w:parseInt(s[0]),h:parseInt(s[1]),ext:{ttx:{bidfloors:[getBidderFloor(bidder,size)],},},};}
function formatRequest(bidData,bidder,bidderInfo){var requestData={imps:{},data_map:{},};if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){for(var i=0;i<data[size].length;i++){var tag_id=data[size][i];if(typeof requestData['imps'][tag_id]=='undefined'){requestData['imps'][tag_id]={};if(bidderInfo.demand_type=='display'){requestData['imps'][tag_id]['banner']={format:[],};requestData['imps'][tag_id]['product']='siab';}else if(bidderInfo.demand_type=='video'){var s=size.split('x');requestData['imps'][tag_id]['video']={skip:1,skipafter:5,linearity:bidderInfo.video_type=='outstream'?2:1,startdelay:0,minduration:15,maxduration:30,placement:bidderInfo.video_type=='outstream'?3:1,playbackmethod:bidderInfo.video_type=='outstream'?[6]:[3],api:[1,2],mimes:['video/mp4','application/javascript'],protocols:[2,3,5,6],w:parseInt(s[0])||0,h:parseInt(s[1])||0,ext:{ttx:{bidfloors:[getBidderFloor(bidder,size)],},},};requestData['imps'][tag_id]['product']=bidderInfo.video_type;}
requestData['data_map'][tag_id]={slot_name:slot_name||'',tag_id:tag_id,};}
if(bidderInfo.demand_type=='display'){requestData['imps'][tag_id]['banner']['format'].push(parseSize(size));if(size=='sticky_horizontal'){requestData['imps'][tag_id]['product']='inview';requestData['imps'][tag_id]['special_size']=size;}}}});}}
return requestData;}
function send(bidData){var bidder=bidData.bidder;var bidderInfo=properOps.bidder_info[bidder]||bidderInfo;var requestData=formatRequest(bidData,bidder,bidderInfo);var imps=requestData['imps']||{};var data_map=requestData['data_map']||{};Object.keys(imps).forEach(function(tag_id){send_slot(imps[tag_id],tag_id);});function send_slot(request_data,tag_id){var request_cnt=bidderInfo.demand_type=='display'?request_data['banner']['format'].length:1;var site_id=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.site_id')||tag_id.toString().replace(/-\d{1,2}$/,'');var product=request_data['product'];var viewability=product=='inview'?100:NON_MEASURABLE;var request={id:ProperMedia.utils.generateUUID(),site:{id:site_id,page:properPage.url,ref:properPage.referrer,},device:_buildDeviceORTB(),imp:[],ext:{ttx:{caller:[{name:'proper.io',version:'1.0',},],},},user:{ext:{eids:userIds.getEidsArray()||'',},},};var uids=Object.keys(ProperMedia.utils.deepAccess(bidData,'auction.uids'));if(bidderInfo.demand_type=='display'){request.imp.push({banner:request_data.banner,});}else if(bidderInfo.demand_type=='video'){request.imp.push({video:request_data.video,});}
if(request.imp[0]){request.imp[0].ext={ttx:{prod:product,viewability:{amount:isNaN(viewability)?viewability:Math.round(viewability),},},};}
var schain=schainCheck(bidder);if(schain!='')ProperMedia.utils.deepSetValue(request,'source.ext.schain',schain);request.regs={ext:{gdpr:gdprConsent.gdprApplies===true?1:0,},};if(gdprConsent.consentString){ProperMedia.utils.deepSetValue(request,'regs.ext.consent',gdprConsent.consentString);}
if(uspConsent.usPrivacy){ProperMedia.utils.deepSetValue(request,'regs.ext.us_privacy',uspConsent.usPrivacy);}
if(properOps.testing_mode.ids==true){request.test=1;}
properLog.mylog(ENDPOINT_URL,bidder);bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({method:'POST',url:ENDPOINT_URL,requestType:'cors',bidder:bidder,edge:edge,data:JSON.stringify(request),success:function(resp){try{properLog.mylog(resp,bidder);resp=ProperMedia.utils.safeJsonParse(resp);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);if(resp&&resp.seatbid&&resp.seatbid.length>0&&resp.seatbid[0].bid&&resp.seatbid[0].bid.length>0){Object.keys(resp.seatbid).forEach(function(y){var bids=resp.seatbid[y].bid;Object.keys(bids).forEach(function(x){var bid=bids[x];var requestId=resp.bidid||'',price=bid.price||0.0,width=bid.w||1,height=bid.h||1,adid=bid.adid||'',cid=bid.cid||'',crid=bid.crid||'',cat=bid.cat||[],adomain=bid.adomain||[],currency=resp.cur||'USD',adcode=bid.adm||'',ttl=bid.ttl||bidderInfo.default_bid_ttl,size=width+'x'+height;if(product=='inview'&&size=='1x1'){size=request_data['special_size']||size;}
var ad=new adObj({bidder:bidder,size:size,price:parseFloat(price),gross:parseFloat(price),tag_id:tag_id,adid:adid,cid:cid,crid:crid,cat:cat,adomain:adomain,request_url:ENDPOINT_URL,response:bid,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:ttl,floor:getBidderFloor(bidder,size),uids:uids,target_slot:ProperMedia.utils.deepAccess(data_map,tag_id+'.slot_name')||'',});if(bidderInfo.demand_type=='video'){ad.type='video';ad.vast_tag=adcode;var tagTypes=ProperMedia.utils.parseVastVpaid(ad.vast_tag);ad.vast_type=tagTypes['vast_type'];ad.vpaid=tagTypes['vpaid'];ad.video_type=bidderInfo.video_type;}else{ad.adcode=adcode;}
bidData.logBidResponse(ad);});});}else{var ad=new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:ENDPOINT_URL,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,});bidData.logNoBidResponse(ad);}
bidData.incrementBidResponseCount(request_cnt);addUserSyncs(request,resp);}catch(e){e.bidder=bidder;throw e;}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}}
function _buildDeviceORTB(){const win=window.top.self;return{ext:{ttx:{...getScreenDimensions(),pxr:win.devicePixelRatio,vp:getViewportDimensions(),ah:win.screen.availHeight,mtp:win.navigator.maxTouchPoints,},},};}
function getTopMostAccessibleWindow(){let mostAccessibleWindow=window.top.self;try{while(mostAccessibleWindow.parent!==mostAccessibleWindow&&mostAccessibleWindow.parent.document){mostAccessibleWindow=mostAccessibleWindow.parent;}}catch(err){}
return mostAccessibleWindow;}
function getViewportDimensions(){const topWin=getTopMostAccessibleWindow();const documentElement=topWin.document.documentElement;return{w:documentElement.clientWidth,h:documentElement.clientHeight,};}
function getScreenDimensions(){const{innerWidth:windowWidth,innerHeight:windowHeight,screen}=window.top.self;const[biggerDimension,smallerDimension]=[Math.max(screen.width,screen.height),Math.min(screen.width,screen.height)];if(windowHeight>windowWidth){return{w:smallerDimension,h:biggerDimension,};}
return{w:biggerDimension,h:smallerDimension,};}
function addUserSyncs(req,resp){var sync=[{type:'iframe',url:SYNC_ENDPOINT+
'&id='+
req.site.id+
'&gdpr_consent='+
encodeURIComponent(gdprConsent.consentString)+
'&us_privacy='+
encodeURIComponent(uspConsent.usPrivacy),bidder:bidder,},];if(typeof gdprApplies==='boolean'){sync[0].url+='&gdpr='+Number(gdprConsent.gdprApplies);}
userSyncs.add(sync);}
return{formatRequest:formatRequest,send:send,bidderInfo:bidderInfo,};})();bidAdapters.triplelift=(function(){var bidderInfo={rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:300000,gvlid:28,native_sizes:{native_horizontal:'300x250',native_vertical:'300x250',},};var bidder='triplelift';var ENDPOINT_URL='https://tlx.3lift.com/header/auction',SYNC_ENDPOINT='https://eb2.3lift.com/sync?';function parseSize(size){var s=size.split('x');return{w:parseInt(s[0]),h:parseInt(s[1]),};}
function formatRequest(bidData,bidder,bidderInfo){var requestData={imps:{},data_map:{},request_cnt:0,};if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){for(var i=0;i<data[size].length;i++){var tagId=data[size][i];var ids=tagId.split('-');var sizeObj=parseSize(ProperMedia.utils.deepAccess(bidderInfo,'native_sizes.'+size)||size);placementId=ids[0];if(typeof requestData['imps'][tagId]=='undefined'){var imp={id:tagId,tagid:placementId,floor:0,};if(bidderInfo.demand_type=='display'){imp['banner']={format:[sizeObj],};}else if(bidderInfo.demand_type=='video'){imp['video']={mimes:['video/mp4','application/javascript'],w:sizeObj['w'],h:sizeObj['h'],context:bidderInfo.video_type,placement:bidderInfo.video_type=='outstream'?3:1,playbackmethod:bidderInfo.video_type=='outstream'?[6]:[3],};if(bidderInfo.video_type=='instream'){imp['video']['placement']=1;}else{imp['video']['placement']=3;}}
requestData['imps'][tagId]=imp;requestData['data_map'][tagId]={tag_id:tagId,tag_sizes:[],slot_name:slot_name||'',floor:0,};}
var floor=getBidderFloor(bidder,size);if(!requestData['imps'][tagId]['floor']||floor<requestData['imps'][tagId]['floor']){requestData['imps'][tagId]['floor']=floor;ProperMedia.utils.deepSetValue(requestData,'data_map.'+tagId+'.floor',floor);}
requestData['data_map'][tagId]['tag_sizes'].push(size);requestData['request_cnt']++;}});}}
return requestData;}
function send(bidData){var bidder=bidData.bidder;var bidderInfo=properOps.bidder_info[bidder]||bidderInfo;var requestData=formatRequest(bidData,bidder,bidderInfo);var imps=ProperMedia.utils.objectValues(requestData['imps'])||[];var data_map=requestData['data_map']||{};var request_cnt=requestData['request_cnt'];if(imps.length==0){return false;}
var data={imp:imps,};var request_url=ENDPOINT_URL;request_url+='?lib=prebid';request_url+='&v='+properOps.prebid_version;request_url+='&referrer='+encodeURIComponent(properPage.bidder_page_url);request_url+='&tmax='+properOps.tmax;if(ProperMedia.utils.deepAccess(properSpecialOps,'coppa')){request_url+='&coppa='+!!properSpecialOps.coppa;}
if(gdprConsent){if(typeof gdprConsent.gdprApplies!=='undefined'){request_url+='&gdpr='+!!gdprConsent.gdprApplies;}
if(typeof gdprConsent.consentString!=='undefined'){request_url+='&cmp_cs='+encodeURIComponent(gdprConsent.consentString);}}
if(uspConsent&&uspConsent.usPrivacy){request_url+='&us_privacy='+encodeURIComponent(uspConsent.usPrivacy);}
var{eids,uids}=getEidArray();if(eids.length>0){ProperMedia.utils.deepSetValue(data,'user.ext.eids',eids);}
var schain=schainCheck(bidder);if(schain!='')ProperMedia.utils.deepSetValue(data,'ext.schain',schain);properLog.mylog(request_url,bidder);bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({url:request_url,requestType:'cors',method:'POST',bidder:bidder,edge:edge,data:JSON.stringify(data),success:function(resp){try{properLog.mylog(resp,bidder);var responseObj=ProperMedia.utils.safeJsonParse(resp)||{};var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);if(responseObj&&responseObj.bids&&responseObj.bids.length>0){for(var i=0;i<responseObj.bids.length;i++){var bid=responseObj.bids[i];var imp_id=bid.imp_id||0,cpm=bid.cpm||0,adcode=bid.ad||'',width=bid.width||1,height=bid.height||1,iurl=bid.iurl||'',crid=bid.crid||'',adomain=bid.adomain||[],adid=bid.advertiser_name||'';var size='1x1';if(ProperMedia.utils.deepAccess(data_map,imp_id+'.tag_sizes').indexOf(width+'x'+height)!==-1){size=width+'x'+height;}
if(size=='1x1'){size=(ProperMedia.utils.deepAccess(data_map,imp_id+'.tag_sizes')||[size]).pop();}
var price=parseFloat(cpm);var ad=new adObj({bidder:bidder,size:size,price:price,gross:price,tag_id:ProperMedia.utils.deepAccess(data_map,imp_id+'.tag_id')||imp_id,adomain:adomain,crid:crid,adid:adid,request_url:ENDPOINT_URL,response:bid,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:bidderInfo.default_bid_ttl,floor:ProperMedia.utils.deepAccess(data_map,imp_id+'.floor')||0,target_slot:ProperMedia.utils.deepAccess(data_map,imp_id+'.slot_name')||'',uids:uids,});if(bidderInfo.demand_type=='video'){ad.type='video';ad.vast_tag=adcode;var tagTypes=ProperMedia.utils.parseVastVpaid(ad.vast_tag);ad.vast_type=tagTypes['vast_type'];ad.vpaid=tagTypes['vpaid'];ad.video_type=bidderInfo.video_type;}else{ad.adcode=adcode;}
bidData.logBidResponse(ad);}}else{bidData.logNoBidResponse(new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:ENDPOINT_URL,response:responseObj,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,}));}
bidData.incrementBidResponseCount(request_cnt);}catch(e){e.bidder=bidder;throw e;}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}
function getEidArray(){var userIdObj=userIds.getUIdsObj()||{};var eids=[],uids=[];if(Object.keys(userIdObj).length){var idl_eid=getIdentityLinkEids(userIdObj);var pubcid_eid=getPubCommonEids(userIdObj);if(idl_eid){eids.push(idl_eid);uids.push('idl_env');}
if(pubcid_eid){eids.push(pubcid_eid);uids.push('pubcid');}}
return{eids,uids};}
function getIdentityLinkEids(userIdObj){return getEids(userIdObj,'idl_env','liveramp.com','idl');}
function getPubCommonEids(userIdObj){return getEids(userIdObj,'pubcid','pubcid.org','pubcid');}
function getEids(userIdObj,type,source,rtiPartner){if(userIdObj&&userIdObj[type]){return formatEid(userIdObj[type],source,rtiPartner);}
return false;}
function formatEid(userId,source,rtiPartner){return{source:source,uids:[{id:userId.id?userId.id:userId,ext:{rtiPartner:rtiPartner,},},],};}
function getUserSyncs(){var endpoint=SYNC_ENDPOINT;var params=[];if(gdprConsent){if(gdprConsent.gdprApplies){params.push('gdpr='+encodeURIComponent(gdprConsent.gdprApplies));}
if(gdprConsent.consentString){params.push('cmp_cs='+encodeURIComponent(gdprConsent.consentString));}}
if(uspConsent&&uspConsent.usPrivacy){params.push('us_privacy='+encodeURIComponent(uspConsent.usPrivacy));}
if(gppConsent){if(gppConsent.gppString){params.push('gpp='+encodeURIComponent(gppConsent.gppString));}
if(gppConsent.applicableSections&&gppConsent.applicableSections.length!==0){params.push('gpp_sid='+encodeURIComponent(_filterSid(gppConsent.applicableSections)));}}
userSyncs.add({type:'iframe',url:endpoint+params.join('&'),bidder:bidder,});}
function _filterSid(sid){return sid.filter((element)=>{return Number.isInteger(element);}).join(',');}
function removeCreative(slot){try{if(properOps.dfp_per_slot==1){var elements=window.top.document.querySelectorAll('#'+CSS.escape(slot.div_id)+' .tlod');if(elements&&elements.length>0){for(var i=0;i<elements.length;i++){var element=elements[i];element.parentNode.removeChild(element);}}}}catch(e){console.error(e);}}
return{send:send,bidderInfo:bidderInfo,getUserSyncs:getUserSyncs,formatRequest:formatRequest,removeCreative:removeCreative,};})();bidAdapters.undertone=(function(){var bidderInfo={rev_share:0.9,bid_grouping:'page',demand_type:'display',default_bid_ttl:360000,gvlid:677,native_sizes:{desktop:{sticky_horizontal:[[1,1]],native_horizontal:[[1,2]],},mobile:{sticky_horizontal:[[1,1],[320,50],],native_horizontal:[[1,2]],},},};var bidder='undertone',ENDPOINT_URL='https://hb.undertone.com/hb',FRAME_USER_SYNC='https://cdn.undertone.com/js/usersync.html',publisher_id=0;function formatRequest(bidData,bidderInfo){var requestData={imps:{},tag_sizes:{},tag_ids:{},target_slots:{},request_cnt:0,};var device=properDevice.isMobile()?'mobile':'desktop';if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){Object.keys(data).forEach(function(size){for(var i=0;i<data[size].length;i++){var placementId=data[size][i];if(typeof requestData['imps'][placementId]=='undefined'){var bidRequestId=ProperMedia.utils.generateUUID();var bid={bidRequestId:bidRequestId,hbadaptor:'prebid',url:properPage.bidder_page_url,domain:properPage.domain,placementId:typeof placementId!=='undefined'?placementId.toString():null,publisherId:parseInt(publisher_id),sizes:ProperMedia.utils.deepAccess(bidderInfo,'native_sizes.'+device+'.'+size)||[size.split('x').map(function(s){return parseInt(s);}),],params:{placementId:placementId.toString(),publisherId:parseInt(publisher_id),},};if(bidderInfo.demand_type=='video'){bid.video={streamType:bidderInfo.video_type,placement:bidderInfo.video_type=='outstream'?3:1,playbackmethod:bidderInfo.video_type=='outstream'?[6]:[3],maxDuration:30,skippable:true,};bid.mediaType='video';}
if(bid.sizes.length>0){requestData['request_cnt']++;requestData['imps'][placementId]=bid;if(ProperMedia.utils.deepAccess(bidderInfo,'native_sizes.'+device+'.'+size)){requestData['tag_sizes'][bidRequestId]=size;}}
requestData['target_slots'][bidRequestId]=slot_name||'';requestData['tag_ids'][bidRequestId]=placementId;}}});}
return requestData;}
function send(bidData){var bidder=bidData.bidder;var bidderInfo=properOps.bidder_info[bidder]||bidderInfo;publisher_id=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.site_id')||0;if(!publisher_id){properLog.mylog('Error: Undertone Site ID is Required.');return false;}
var url=ENDPOINT_URL+'?pid='+publisher_id+'&domain='+properPage.domain;var requestData=formatRequest(bidData,bidderInfo);var imps=ProperMedia.utils.objectValues(requestData['imps'])||[];var request_cnt=requestData['request_cnt'];if(request_cnt==0){return false;}
var vw=Math.max(document.documentElement.clientWidth,window.innerWidth||0);var vh=Math.max(document.documentElement.clientHeight,window.innerHeight||0);var payload={'x-ut-hb-params':imps,commons:{adapterVersion:properOps.prebid_version,uids:userIds.getUIdsObj()||{},pageSize:vw==0||vh==0?null:[vw,vh],},};var gdprParams=getGdprQueryParams();if(gdprParams){url+='&'+gdprParams;}
if(uspConsent.usPrivacy){url+='&ccpa='+uspConsent.usPrivacy;}
if(gppConsent){const gppString=gppConsent.gppString??'';const ggpSid=gppConsent.applicableSections??'';url+=`&gpp=${gppString}&gpp_sid=${ggpSid}`;}
var bid_sent_ts=ProperMedia.utils.getTimestampMs();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({url:url,method:'POST',requestType:'cors',bidder:bidder,edge:edge,data:JSON.stringify(payload),success:function(resp){try{properLog.mylog(resp,bidder);resp=ProperMedia.utils.safeJsonParse(resp);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);if(resp&&Array.isArray(resp)&&resp.length>0){resp.forEach(function(bidRes){var size='1x1';if(ProperMedia.utils.deepAccess(requestData,'tag_sizes.'+bidRes.bidRequestId)){size=ProperMedia.utils.deepAccess(requestData,'tag_sizes.'+bidRes.bidRequestId);}else if(bidRes.width&&bidRes.height){size=bidRes.width+'x'+bidRes.height;}
var cpm=bidRes.cpm||0,ttl=bidRes.ttl||0,crid=bidRes.adId||'',adid=bidRes.adId||'',tag_id=ProperMedia.utils.deepAccess(requestData,'tag_ids.'+bidRes.bidRequestId)||'';var ad=new adObj({bidder:bidder,size:size,price:parseFloat(cpm),gross:parseFloat(cpm),tag_id:tag_id,crid:crid,adid:adid,ttl:ttl*1000||bidderInfo.default_bid_ttl,request_url:url,response:bidRes,response_ms:bid_response_ms,received_ts:bids_received_ts,uids:Object.keys(ProperMedia.utils.deepAccess(bidData,'auction.uids')),target_slot:ProperMedia.utils.deepAccess(requestData,'target_slots.'+bidRes.bidRequestId)||'',});if(bidderInfo.demand_type=='video'){ad.type='video';ad.vast_tag=bidRes.ad;var tagTypes=ProperMedia.utils.parseVastVpaid(ad.vast_tag);ad.vast_type=tagTypes['vast_type'];ad.vpaid=tagTypes['vpaid'];ad.video_type=bidderInfo.video_type;}else{ad.adcode=bidRes.ad;}
bidData.logBidResponse(ad);});}else{var ad=new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:url,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,});bidData.logNoBidResponse(ad);}
bidData.incrementBidResponseCount(request_cnt);}catch(e){e.bidder=bidder;throw e;}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}
function getGdprQueryParams(){if(!gdprConsent){return null;}
var gdpr=gdprConsent.gdprApplies?'1':'0';var gdprstr=gdprConsent.consentString?gdprConsent.consentString:'';return 'gdpr='+gdpr+'&gdprstr='+gdprstr;}
function getUserSyncs(){var iframePrivacyParams='';var gdprParams=getGdprQueryParams();if(gdprParams){iframePrivacyParams+='?'+gdprParams;}
if(uspConsent.usPrivacy){iframePrivacyParams+=(iframePrivacyParams.length>0?'&':'?')+'ccpa='+uspConsent.usPrivacy;}
userSyncs.add({type:'iframe',url:FRAME_USER_SYNC+iframePrivacyParams,bidder:bidder,});}
return{send:send,bidderInfo:bidderInfo,getUserSyncs:getUserSyncs,formatRequest:formatRequest,};})();bidAdapters.unruly=(function(){const bidderInfo={rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:360000,gvlid:36,};const ENDPOINT_URL='https://targeting.unrulymedia.com/unruly_prebid';let site_id=null;function parseSize(size){return size.split('x').map(function(s){return parseInt(s);});}
function formatRequest(bidData,bidder,bidderInfo){const requestData={imps:{},data_map:{},request_cnt:0,};const auctionId=bidderInfo.auctionId;const schain=schainCheck(bidder);if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){for(let i=0;i<data[size].length;i++){const tag_id=data[size][i];if(typeof requestData['imps'][tag_id]=='undefined'){requestData['imps'][tag_id]={bidder:bidder,params:{siteId:site_id,},mediaTypes:{},adUnitCode:ProperMedia.utils.generateUUID(),transactionId:ProperMedia.utils.generateUUID(),bidId:tag_id,bidderRequestId:ProperMedia.utils.generateUUID(),auctionId:auctionId,src:'client',bidRequestsCount:1,bidderRequestsCount:1,bidderWinsCount:0,userIdAsEids:userIds.getEidsArray(),userId:userIds.getUIdsObj(),};requestData['data_map'][tag_id]={slot_name:slot_name||'',tag_id:tag_id,floor:0,};}
if(schain!='')ProperMedia.utils.deepSetValue(requestData,'imps.'+tag_id+'.schain',schain);let mediaType=bidderInfo.demand_type=='display'?'banner':'video';if(bidderInfo.demand_type=='display'){if(!ProperMedia.utils.deepAccess(requestData,'imps.'+tag_id+'.mediaTypes.banner')){requestData['imps'][tag_id]['mediaTypes']['banner']={sizes:[],floor:0,};}
requestData['imps'][tag_id]['mediaTypes']['banner']['sizes'].push(parseSize(size));}else if(bidderInfo.demand_type=='video'){if(!ProperMedia.utils.deepAccess(requestData,'imps.'+tag_id+'.mediaTypes.video')){requestData['imps'][tag_id]['mediaTypes']['video']={context:bidderInfo.video_type,playerSize:[],floor:0,};}
requestData['imps'][tag_id]['mediaTypes']['video']['playerSize'].push(parseSize(size));}
var floor=getBidderFloor(bidder,size);if(!requestData['imps'][tag_id]['mediaTypes'][mediaType]['floor']||floor<requestData['imps'][tag_id]['mediaTypes'][mediaType]['floor']){requestData['imps'][tag_id]['mediaTypes'][mediaType]['floor']=floor;requestData['data_map'][tag_id]['floor']=floor;}
requestData['request_cnt']++;}});}}
return requestData;}
function send(bidData){const bidder=bidData.bidder;const bidderInfo=properOps.bidder_info[bidder]||bidderInfo;const siteIds=(ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.site_id')||'').toString().split('-')||['',''];site_id=parseInt(properDevice.isMobile()&&siteIds.length==2?siteIds[1]:siteIds[0]);if(!site_id){properLog.mylog('Error: Unruly Site ID is Required.');return false;}
bidderInfo.auctionId=ProperMedia.utils.deepAccess(bidData,'auction.id');const requestData=formatRequest(bidData,bidder,bidderInfo);const imps=ProperMedia.utils.objectValues(requestData['imps'])||[];const data_map=requestData['data_map']||{};const request_cnt=requestData['request_cnt'];const post_data={bidderRequest:{bidderCode:'unruly',auctionId:imps[0].auctionId,bidderRequestId:imps[0].bidderRequestId,auctionStart:Date.now(),timeout:properOps.tmax,refererInfo:{referer:properPage.url,reachedTop:true,numIframes:0,stack:[properPage.url],canonicalUrl:properPage.canonical_url,},start:Date.now(),invalidBidsCount:0,bids:imps,gdprConsent:{},uspConsent:'',gppConsent:{},},};if(gdprConsent){post_data.bidderRequest.gdprConsent={consentString:gdprConsent.consentString||'',vendorData:gdprConsent.vendorData||{},gdprApplies:!!gdprConsent.gdprApplies,};}
if(uspConsent.usPrivacy){post_data.bidderRequest.uspConsent=uspConsent.usPrivacy||'';}
if(gppConsent){post_data.bidderRequest.gppConsent={gppString:gppConsent.gppString,applicableSections:gppConsent.applicableSections,};}
properLog.mylog(ENDPOINT_URL,bidder);bidData.incrementRequestsSent(request_cnt);const bid_sent_ts=ProperMedia.utils.getTimestampMs();$.ajax({url:ENDPOINT_URL,method:'POST',requestType:'cors',headers:{'Content-Type':'application/json'},data:JSON.stringify(post_data),success:function(resp){try{const bids_received_ts=ProperMedia.utils.getTimestampMs();const bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);resp=ProperMedia.utils.safeJsonParse(resp);if(!resp||!resp.bids||resp.bids.length==0){properLog.mylog('Unruly: No bids returned');const ad=new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:ENDPOINT_URL,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,});bidData.logNoBidResponse(ad);}else{properLog.mylog(resp,bidder);for(let i=0;i<resp.bids.length;i++){const bid=resp.bids[i];const price=bid.cpm||0,width=bid.width||0,height=bid.height||0,tag_id=bid.bidId||'',crid=bid.creativeId||'';const ad=new adObj({bidder:bidder,size:width+'x'+height,price:parseFloat(price),gross:parseFloat(price),tag_id:tag_id,crid:crid,request_url:ENDPOINT_URL,response:bid,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:bidderInfo.default_bid_ttl,floor:ProperMedia.utils.deepAccess(data_map,bid.bidId+'.floor')||0,target_slot:ProperMedia.utils.deepAccess(data_map,bid.bidId+'.slot_name')||'',uids:Object.keys(ProperMedia.utils.deepAccess(bidData,'auction.uids')),});const bidMediaType=ProperMedia.utils.deepAccess(bid,'meta.mediaType');if(bidMediaType&&bidMediaType.toLowerCase()==='video'){ad.type='video';ad.vast_tag=bid.vastUrl||'';const tagTypes=ProperMedia.utils.parseVastVpaid(ad.vast_tag);ad.vast_type=tagTypes['vast_type'];ad.vpaid=tagTypes['vpaid'];ad.video_type=ProperMedia.utils.deepAccess(bid,'meta.videoContext');}else if(bidMediaType&&bidMediaType.toLowerCase()==='banner'){ad.adcode=bid.ad;}
bidData.logBidResponse(ad);}}
bidData.incrementBidResponseCount(request_cnt);}catch(e){e.bidder=bidder;throw e;}},error:function(resp){try{bidData.incrementBidResponseCount(request_cnt);const bids_received_ts=ProperMedia.utils.getTimestampMs();const bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);const bidError={bidder:bidder,status:resp.status,statusText:resp.statusText,timeout:resp.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}
return{formatRequest:formatRequest,send:send,bidderInfo:bidderInfo,};})();bidAdapters.vidazoo=(function(){var bidderInfo={rev_share:1,demand_type:'display',bid_grouping:'slot',default_bid_ttl:300000,div_insertion:1,gvlid:744,};var bidder='vidazoo',VERSION='1.0.0',ENDPOINT_URL='https://prebid.cootlogix.com/prebid/multi/',ENDPOINT_TEST='https://demoad.cootlogix.com/prebid/multi/',VIDAZOO_SCRIPT_URL='https://static.vidazoo.com/basev/vwpt.js';var pId='59ac17c192832d0011283fe3';var vidazoo_script_loaded=false;const DEAL_ID_EXPIRY=1000*60*15;const UNIQUE_DEAL_ID_EXPIRY=1000*60*60;const WEBSESSIONID='wsid_'+parseInt(Date.now()*Math.random());const SESSION_ID_KEY='vidSid';const OPT_CACHE_KEY='vdzwopt';let storageEnfObj={gvlid:bidderInfo.gvlid,bidderCode:bidder,};const SUPPORTED_ID_SYSTEMS={id5id:1,idl_env:1,pubcid:1,};function formatRequest(bidData,bidder,bidderInfo){var requestData={imps:{},data_map:{},};if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){for(var i=0;i<data[size].length;i++){var tag_id=data[size][i];if(typeof requestData['imps'][tag_id]=='undefined'){requestData['imps'][tag_id]={sizes:[],floor:0,};requestData['data_map'][tag_id]={slot_name:slot_name||'',tag_id:tag_id,floor:0,};}
requestData['imps'][tag_id]['sizes'].push(size);var floor=getBidderFloor(bidder,size);if(!requestData['imps'][tag_id]['floor']||floor<requestData['imps'][tag_id]['floor']){requestData['imps'][tag_id]['floor']=floor;requestData['data_map'][tag_id]['floor']=floor;}}});}}
return requestData;}
function send(bidData){var bidder=bidData.bidder;var bidderInfo=properOps.bidder_info[bidder]||bidderInfo;pId=(ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.site_id')||'').split('-')[0]||pId;var requestData=formatRequest(bidData,bidder,bidderInfo);var imps=requestData['imps']||{};var data_map=requestData['data_map']||{};Object.keys(imps).forEach(function(tag_id){let cId=tag_id.split('-')[0]||tag_id;send_slot(imps[tag_id],cId,tag_id);});function send_slot(slotData,cId,tag_id){if(!cId||!slotData.sizes.length){return false;}
var request_cnt=slotData.sizes.length;const hashUrl=hashCode(properPage.url);const dealId=getNextDealId(hashUrl);const uniqueDealId=getUniqueDealId(hashUrl);const sId=getVidazooSessionId();const ptrace=getCacheOpt();const isStorageAllowed=properStorage.cookiesAreEnabled(storageEnfObj)||properStorage.localStorageIsEnabled(storageEnfObj);if(ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.account_overrides.enabled')){pId=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.account_overrides.bidder_ids.pId')||pId;}
var mediaTypes={};if(bidderInfo.demand_type=='display'){mediaTypes.banner={sizes:slotData.sizes.map((size)=>size.split('x').map((size)=>parseInt(size)))};}else if(bidderInfo.demand_type=='video'){var playerSize=slotData.sizes[0].split('x').map((size)=>parseInt(size));mediaTypes.video={context:bidderInfo.video_type,mimes:['video/mp4','application/javascript'],playerSize:playerSize,w:playerSize[0],h:playerSize[1],maxduration:30,minduration:10,api:[2],delivery:6,pos:0,placement:bidderInfo.video_type=='outstream'?3:1,playbackmethod:bidderInfo.video_type=='outstream'?[6]:[3],linearity:bidderInfo.video_type=='outstream'?2:1,protocols:[2,3,5,6],startdelay:0,skip:0,};}
var payload={url:encodeURIComponent(properPage.url),uqs:'?'+ProperMedia.utils.formatQueryString(properPage.get_vars,true),cb:Date.now(),bidFloor:slotData.floor,bidId:ProperMedia.utils.generateUUID(),referrer:properPage.referrer,adUnitCode:ProperMedia.utils.generateUUID(),publisherId:pId,sessionId:sId,sizes:slotData.sizes,dealId:dealId,uniqueDealId:uniqueDealId,bidderVersion:VERSION,prebidVersion:properOps.prebid_version,res:screen.width+'x'+screen.height,mediaTypes:mediaTypes,ptrace:ptrace,isStorageAllowed:isStorageAllowed,webSessionId:WEBSESSIONID,};var uids=appendUserIdsToRequestPayload(payload);var schain=schainCheck(bidder);if(schain!='')payload.schain=schain;if(gdprConsent){if(typeof gdprConsent.gdprApplies==='boolean'){payload.gdpr=gdprConsent.gdprApplies?1:0;}
if(gdprConsent.consentString){payload.gdprConsent=gdprConsent.consentString;}}
if(uspConsent&&uspConsent.usPrivacy){payload.usPrivacy=uspConsent.usPrivacy;}
if(gppConsent.gppString){payload.gppString=gppConsent.gppString;payload.gppSid=gppConsent.applicableSections;}
var url=ENDPOINT_URL+cId;if(properOps.testing_mode.ids==true){cId='5e7b4eac063c510017ca44ef';url=ENDPOINT_TEST+cId;}
properLog.mylog(url,bidder);bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({url:url,method:'POST',requestType:'cors',bidder:bidder,edge:edge,data:JSON.stringify(payload),success:function(resp){try{properLog.mylog(resp,bidder);resp=ProperMedia.utils.safeJsonParse(resp);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);if(resp.results&&Array.isArray(resp.results)&&resp.results.length>0){resp.results.forEach(function(bidRes){var ad=new adObj({bidder:bidder,size:bidRes['width']+'x'+bidRes['height'],price:parseFloat(bidRes['price']),gross:parseFloat(bidRes['price']),tag_id:tag_id,ttl:bidRes['exp']*1000||bidderInfo.default_bid_ttl,request_url:url,response:bidRes,response_ms:bid_response_ms,received_ts:bids_received_ts,uids:uids,floor:ProperMedia.utils.deepAccess(data_map,tag_id+'.floor')||0,target_slot:ProperMedia.utils.deepAccess(data_map,tag_id+'.slot_name')||'',});if(bidderInfo.demand_type=='display'){var ad_code_prepend='';if(properOps.dfp_per_slot==1&&properPage.isolated==0){ad_code_prepend='<script>try { var slot_div = window.top.document.getElementById("{PROPER_SLOT_DIV_ID}-iframe").contentWindow.document.getElementById("{PROPER_SLOT_DIV_ID}"); var div = document.createElement(\'div\'); div.setAttribute("id", "'+
payload['adUnitCode']+
'"); slot_div.appendChild(div); } catch(e) { console.error(e); }</script>';}else{ad_code_prepend='<script>try { var slot_div = window.top.document.getElementById("{PROPER_SLOT_DIV_ID}"); var div = document.createElement(\'div\'); div.setAttribute("id", "'+
payload['adUnitCode']+
'"); slot_div.appendChild(div); } catch(e) { console.error(e); }</script>';}
ad.adcode=ad_code_prepend+bidRes['ad'];}else if(bidderInfo.demand_type=='video'){ad.type='video';ad.vast_tag=bidRes.vastXml;var tagTypes=ProperMedia.utils.parseVastVpaid(ad.vast_tag);ad.vast_type=tagTypes['vast_type'];ad.vpaid=tagTypes['vpaid'];ad.video_type=bidderInfo.video_type;}
bidData.logBidResponse(ad);});addUserSyncs(resp);}else{bidData.logNoBidResponse(new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:url,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,}));}
bidData.incrementBidResponseCount(request_cnt);}catch(e){e.bidder=bidder;throw e;}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}}
function hashCode(s,prefix='_'){const l=s.length;let h=0;let i=0;if(l>0){while(i<l){h=((h<<5)-h+s.charCodeAt(i++))|0;}}
return prefix+h;}
function getNextDealId(key){try{const data=getStorageItem(key);let currentValue=0;let timestamp;if(data&&data.value&&Date.now()-data.created<expiry){currentValue=data.value;timestamp=data.created;}
const nextValue=currentValue+1;setStorageItem(key,nextValue,timestamp);return nextValue;}catch(e){return 0;}}
function getUniqueDealId(key,expiry=UNIQUE_DEAL_ID_EXPIRY){const storageKey=`u_${key}`;const now=Date.now();const data=getStorageItem(storageKey);let uniqueId;if(!data||!data.value||now-data.created>expiry){uniqueId=`${key}_${now.toString()}`;setStorageItem(storageKey,uniqueId);}else{uniqueId=data.value;}
return uniqueId;}
function getVidazooSessionId(){return getStorageItem(SESSION_ID_KEY)||'';}
function getCacheOpt(){let data=properStorage.getDataFromLocalStorage(OPT_CACHE_KEY,storageEnfObj);if(!data){data=String(Date.now());properStorage.setDataInLocalStorage(OPT_CACHE_KEY,data,storageEnfObj);}
return data;}
function getStorageItem(key){try{return ProperMedia.utls.safeJsonParse(properStorage.getDataFromLocalStorage(key,storageEnfObj));}catch(e){}
return null;}
function setStorageItem(key,value,timestamp){try{const created=timestamp||Date.now();const data=JSON.stringify({value,created});properStorage.setDataInLocalStorage(key,data,storageEnfObj);}catch(e){}}
function appendUserIdsToRequestPayload(payloadRef){var user_ids=userIds.getUIdsObj();var uids=[];var key;Object.keys(user_ids).forEach(function(idSystemProviderName){if(SUPPORTED_ID_SYSTEMS[idSystemProviderName]){var userId=user_ids[idSystemProviderName];key='uid.'+idSystemProviderName;switch(idSystemProviderName){case 'digitrustid':payloadRef[key]=ProperMedia.utils.deepAccess(userId,'data.id');break;case 'lipb':payloadRef[key]=userId.lipbid;break;case 'parrableId':payloadRef[key]=userId.eid;break;case 'id5id':uids.push(idSystemProviderName);payloadRef[key]=userId.uid;break;default:uids.push(idSystemProviderName);payloadRef[key]=userId;}}});return uids;}
function addUserSyncs(serverResponse){try{var params='?gdpr='+
(gdprConsent.gdprApplies?1:0)+
'&gdpr_consent='+
encodeURIComponent(gdprConsent.consentString||'')+
'&us_privacy='+
encodeURIComponent(uspConsent.usPrivacy||'');userSyncs.add({type:'iframe',url:'https://sync.cootlogix.com/api/sync/iframe'+params,bidder:bidder,});}catch(e){e.bidder=bidder;throw e;}}
function loadScript(bidder,bidderConf){try{let widget_id=(bidderConf.site_id||'').split('-')[1]||'';if(!vidazoo_script_loaded&&widget_id&&ProperMedia.utils.deepAccess(properOps,'bidder_info.'+bidder+'.demand_type')=='display'){var script=document.createElement('script');script.src=VIDAZOO_SCRIPT_URL;script.defer=true;script.setAttribute('data-widget-id',widget_id);script.type='text/javascript';var scpt=document.getElementsByTagName('script')[0];scpt.parentNode.insertBefore(script,scpt);vidazoo_script_loaded=true;}}catch(e){sendError(new Error('Vidazoo: Error placing script'));console.error(e);}}
return{send:send,bidderInfo:bidderInfo,loadInitScripts:loadScript,};})();bidAdapters.yahoo=(function(){var bidderInfo={rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:300000,acceptable_ads:true,gvlid:25,};var INTEGRATION_METHOD='prebid.js';var ADAPTER_VERSION='1.0.1';var DEFAULT_BID_TTL=300000;var TEST_MODE_DCN='8a969516017a7a396ec539d97f540011';var TEST_MODE_BANNER_POS='8a969978017a7aaabab4ab0bc01a0009';var TEST_MODE_VIDEO_POS='8a96958a017a7a57ac375d50c0c700cc';var DEFAULT_RENDERER_TIMEOUT=700000;var SSP_ENDPOINT_DCN_POS='https://c2shb.pubgw.yahoo.com/bidRequest';var SUPPORTED_USER_ID_SOURCES={'id5-sync.com':'id5id','liveramp.com':'idl_env','pubcid.org':'pubcid','yahoo.com':'connectid',};var ENDPOINT_URL=SSP_ENDPOINT_DCN_POS;var bidder='yahoo';function parseSize(size){var s=size.split('x');return{w:parseInt(s[0]),h:parseInt(s[1]),};}
function formatRequest(bidData,bidder,bidderInfo){var requestData={imps:{},data_map:{},request_cnt:0,};if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){for(var i=0;i<data[size].length;i++){var tag_id=data[size][i];if(typeof requestData['imps'][tag_id]=='undefined'){var tagid=tag_id.split('-')[0]||tag_id;if(properOps.testing_mode.ids==1){tagid=bidderInfo.demand_type=='video'?TEST_MODE_VIDEO_POS:TEST_MODE_BANNER_POS;}
requestData['imps'][tag_id]={id:tag_id.toString(),tagid:tagid,secure:properPage.use_ssl?1:0,bidfloor:0,ext:{pos:tagid,},};if(properOps.testing_mode.ids==1){requestData['imps'][tag_id]['ext']['e2eTestMode']=true;}
if(bidderInfo.demand_type=='display'){var mimes=properUser.checkAdBlock()?['text/html','image/jpg']:['text/html','text/javascript','application/javascript','image/jpg'];requestData['imps'][tag_id]['banner']={mimes:mimes,format:[],};}else if(bidderInfo.demand_type=='video'){var playerSize=parseSize(size);requestData['imps'][tag_id].video={mimes:['video/mp4','application/javascript'],w:playerSize.w,h:playerSize.h,maxbitrate:undefined,maxduration:30,minduration:10,api:[2],delivery:6,pos:0,placement:bidderInfo.video_type=='outstream'?3:1,playbackmethod:bidderInfo.video_type=='outstream'?[6]:[3],linearity:bidderInfo.video_type=='outstream'?2:1,protocols:[2,3,5,6],startdelay:0,rewarded:undefined,};}
requestData['data_map'][tag_id]={slot_name:slot_name||'',tag_id:tag_id,floor:0,};}
if(bidderInfo.demand_type=='display'){requestData['imps'][tag_id]['banner']['format'].push(parseSize(size));}
var floor=getBidderFloor(bidder,size);if(!requestData['imps'][tag_id]['bidfloor']||floor<requestData['imps'][tag_id]['bidfloor']){requestData['imps'][tag_id]['bidfloor']=floor;requestData['data_map'][tag_id]['floor']=floor;}
requestData['request_cnt']++;}});}}
return requestData;}
function send(bidData){var bidder=bidData.bidder;var bidderInfo=properOps.bidder_info[bidder]||bidderInfo;var siteIds=(ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.site_id')||'').split('-')||['',''];var site_id=properDevice.isMobile()&&siteIds.length==2?siteIds[1]:siteIds[0];if(properOps.testing_mode.ids==1){site_id=TEST_MODE_DCN;}
if(!site_id){properLog.mylog('Error: Yahoo Site ID is Required.');return false;}
var requestData=formatRequest(bidData,bidder,bidderInfo);var imps=ProperMedia.utils.objectValues(requestData['imps'])||[];var data_map=requestData['data_map']||{};var request_cnt=requestData['request_cnt'];var post_data={id:ProperMedia.utils.generateUUID(),cur:['USD'],imp:[],site:{id:site_id,page:properPage.bidder_page_url,domain:properPage.domain,ref:properPage.referrer,},device:{dnt:0,ua:navigator.userAgent,ip:undefined,w:window.screen.width,h:window.screen.height,},source:{ext:{hb:1,adapterver:ADAPTER_VERSION,prebidver:properOps.prebid_version,integration:{name:INTEGRATION_METHOD,ver:properOps.prebid_version,},},fd:1,},user:{ext:{},},};var eids=getSupportedEids();if(eids.length>0){ProperMedia.utils.deepSetValue(post_data,'user.ext.eids',eids);}
var schain=schainCheck(bidder);if(schain!=''){ProperMedia.utils.deepSetValue(post_data,'source.ext.schain',schain);ProperMedia.utils.deepSetValue(post_data,'source.ext.schain.nodes.0.rid',post_data.id);}
ProperMedia.utils.deepSetValue(post_data,'user.ext.consent',gdprConsent.gdprApplies?gdprConsent.consentString:'');if(typeof gdprConsent.gdprApplies==='boolean'){ProperMedia.utils.deepSetValue(post_data,'regs.ext.gdpr',Number(gdprConsent.gdprApplies));}
ProperMedia.utils.deepSetValue(post_data,'regs.ext.us_privacy',uspConsent.usPrivacy||'');if(gppConsent){post_data.gpp=`${gppConsent.gppString?gppConsent.gppString:''}`;if(Array.isArray(gppConsent.applicableSections)){post_data.gpp_sid=gppConsent.applicableSections.join(',');}}
var withCredentials=properOps.testing_mode.ids==1?false:hasPurpose1Consent();properLog.mylog(ENDPOINT_URL,bidder);imps.forEach(function(imp){sendImp(imp);});function sendImp(imp){post_data.imp=[imp];bidData.incrementRequestsSent(1);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({url:ENDPOINT_URL,method:'POST',requestType:'cors',bidder:bidder,headers:{'x-openrtb-version':'2.5','Content-Type':'application/json'},withCredentials:withCredentials,edge:edge,data:JSON.stringify(post_data),success:function(resp){try{var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);resp=ProperMedia.utils.safeJsonParse(resp);if(resp&&resp.seatbid&&resp.seatbid.length>0&&resp.seatbid[0].bid&&resp.seatbid[0].bid.length>0){properLog.mylog(resp,bidder);Object.keys(resp.seatbid).forEach(function(x){Object.keys(resp.seatbid[x].bid).forEach(function(i){var obj=resp.seatbid[x].bid[i];var id=obj.adId?obj.adId:obj.impid||obj.crid,impid=obj.impid||'',price=obj.ext&&obj.ext.encp?obj.ext.encp:obj.price,width=obj.w||1,height=obj.h||1,adcode=obj.adm||'',nurl=obj.nurl||'',crid=obj.crid||0,dealid=obj.dealId||'';var ad=new adObj({bidder:bidder,size:width+'x'+height,price:parseFloat(price),gross:parseFloat(price),nurl:nurl,tag_id:impid,crid:crid,dealid:dealid,request_url:ENDPOINT_URL,response:obj,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:bidderInfo.default_bid_ttl,floor:ProperMedia.utils.deepAccess(data_map,impid+'.floor')||0,target_slot:ProperMedia.utils.deepAccess(data_map,impid+'.slot_name')||'',});if(bidderInfo.demand_type=='video'){ad.type='video';ad.vast_tag=adcode;if(nurl){ad.vast_tag=nurl;}
var tagTypes=ProperMedia.utils.parseVastVpaid(ad.vast_tag);ad.vast_type=tagTypes['vast_type'];ad.vpaid=tagTypes['vpaid'];ad.video_type=bidderInfo.video_type;}else{ad.adcode=adcode;}
bidData.logBidResponse(ad);});});addUserSyncs(resp);}else{properLog.mylog('no '+bidder+' bids returned');var ad=new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:ENDPOINT_URL,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,});bidData.logNoBidResponse(ad);}
bidData.incrementBidResponseCount(1);}catch(e){e.bidder=bidder;throw e;}},error:function(e){try{bidData.incrementBidResponseCount(1);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}}
function getSupportedEids(){var userIdAsEids=userIds.getEidsArray();var uids=[];var eids=userIdAsEids.filter(function(eid){if(SUPPORTED_USER_ID_SOURCES[eid.source]){uids.push(SUPPORTED_USER_ID_SOURCES[eid.source]);return true;}
return false;});return{uids,eids};}
function hasPurpose1Consent(bidderRequest){if(gdprConsent){if(gdprConsent.gdprApplies&&gdprConsent.apiVersion===2){return!!false;}}
return true;}
function addUserSyncs(resp){try{if(ProperMedia.utils.deepAccess(resp,'ext.pixels')){var pixels=resp.ext.pixels||[];var itemsRegExp=/(img|iframe)[\s\S]*?src\s*=\s*("|')(.*?)\2/gi;var tagNameRegExp=/\w*(?=\s)/;var srcRegExp=/src=("|')(.*?)\1/;var userSyncObjects=[];if(pixels){var matchedItems=pixels.match(itemsRegExp);if(matchedItems){matchedItems.forEach(function(item){var tagName=item.match(tagNameRegExp)[0];var url=item.match(srcRegExp)[2];if(tagName&&url){var tagType=tagName.toLowerCase()==='img'?'image':'iframe';userSyncs.add({type:tagType,url:url,});}});}}}}catch(e){e.bidder=bidder;throw e;}}
return{formatRequest:formatRequest,send:send,bidderInfo:bidderInfo,};})();bidAdapters.s2s=(function(){var bidderInfo={rev_share:1,demand_type:'display',bid_grouping:'page',default_bid_ttl:120000,};var endpoint=properOps.s2s_endpoint;function getOpenRTBBidRequest(bidData){var openRTBObj={id:null,at:1,tmax:properOps.tmax,site:{id:'',page:properPage.bidder_page_url,ref:properPage.referrer,domain:properPage.domain,publisher:{id:properOps.site_name,name:properPage.domain,domain:properPage.domain,},},device:{connectiontype:getConnectionType(),ua:navigator.userAgent,ip:null,dnt:ProperMedia.utils.getDNT()?1:0,js:1,geo:null,os:window.device.os_group,h:properPage.height,w:properPage.width,language:navigator.language.split('-')[0],},user:{buyeruid:null,geo:null,},source:{},regs:{coppa:ProperMedia.utils.deepAccess(properSpecialOps,'coppa')?1:0,ext:{},},ext:{},test:properOps.testing_mode.ids==true?1:0,imp:[],};var eids=userIds.getEidsArray();if(eids&&eids.length){ProperMedia.utils.deepSetValue(openRTBObj,'user.ext.eids',eids);}
if(properOps.schain){ProperMedia.utils.deepSetValue(openRTBObj,'source.ext.schain',properOps.schain);}
if(typeof gdprConsent.gdprApplies==='boolean'){ProperMedia.utils.deepSetValue(openRTBObj,'regs.ext.gdpr',Number(gdprConsent.gdprApplies));}
ProperMedia.utils.deepSetValue(openRTBObj,'user.ext.consent',gdprConsent.consentString);if(uspConsent.usPrivacy){ProperMedia.utils.deepSetValue(openRTBObj,'regs.ext.us_privacy',uspConsent.usPrivacy);}
if(gppConsent){ProperMedia.utils.deepSetValue(openRTBObj,'regs.ext.gpp',gppConsent.gppString);ProperMedia.utils.deepSetValue(openRTBObj,'regs.ext.gpp_sid',gppConsent.applicableSections);}
return openRTBObj;}
function getConnectionType(){return 0;}
function send(bidData){if(!bidData||!bidData.requests){return false;}
var websocket=!!(typeof properSpecialOps.s2s_websockets!=='undefined'?properSpecialOps.s2s_websockets:properOps.s2s_websockets);var sse=!!(typeof properSpecialOps.s2s_sse!=='undefined'?properSpecialOps.s2s_sse:properOps.s2s_sse);endpoint=websocket?properOps.s2s_wss_endpoint:sse?properOps.s2s_sse_endpoint:properOps.s2s_endpoint;var uids=Object.keys(ProperMedia.utils.deepAccess(bidData,'auction.uids'));var device=properDevice.isMobile()?'mobile':'desktop';var floors=ProperMedia.utils.deepCopy(properOps.floors[device]||{backup:0.01,sizes:{}});if(ProperMedia.utils.deepAccess(properSession,'sessionData.bid_avg')){Object.keys(properSession.sessionData.bid_avg).forEach(function(size){if(!ProperMedia.utils.deepAccess(floors,'sizes.'+size)||floors.sizes[size]<properSession.sessionData.bid_avg[size]){ProperMedia.utils.deepSetValue(floors,'sizes.'+size,properSession.sessionData.bid_avg[size]);}});}
var postData={openRTBBidRequest:getOpenRTBBidRequest(bidData),bidder_ids:bidData.requests,proper_uid:cookieMatching.proper_uid,is_secure:properPage.use_ssl?1:0,is_mobile:properDevice.isMobile(),floors:floors,cookies:{},};Object.keys(postData.bidder_ids).forEach(function(bidder){if(gdprEnforcement.userSyncEnforcement(bidder)&&!gppConsentModule.userSyncsDenied()){bidder=bidder.replace('_s2s','');if(cookieMatching.bidderUserSyncValues[bidder]){postData.cookies[bidder]=cookieMatching.bidderUserSyncValues[bidder];}}else{postData.bidder_ids[bidder].cookie_consent=false;}});if(properOps.testing_mode.ids==true){postData.debug=true;}
properLog.mylog(endpoint,'s2s');var request_cnt=Object.keys(bidData.requests).length||0;var resp_cnt=websocket||sse?1:request_cnt;bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.s2s.edge')||false;$.ajax({url:endpoint,method:'POST',requestType:'cors',websocket:websocket,sse:sse,bidder:'s2s',timeout:(websocket||sse)&&properDevice.isMobile()?4000:2000,data:JSON.stringify(postData),success:function(resp){try{resp=ProperMedia.utils.safeJsonParse(resp);var websocket=!!(typeof properSpecialOps.s2s_websockets!=='undefined'?properSpecialOps.s2s_websockets:websocket);var sse=!!(typeof properSpecialOps.s2s_sse!=='undefined'?properSpecialOps.s2s_sse:sse);properLog.mylog(resp,'s2s');var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);if(resp&&resp.bids&&resp.bids.length>0){var device=properDevice.isMobile()?'mobile':'desktop';for(var key=0;key<resp.bids.length;key++){var bid=resp.bids[key],nobid=bid.nobid||false,adcode=bid.adcode||'',vast_tag=bid.vast_tag||'',vast_type=bid.vast_type||'',vpaid=bid.vpaid||false,bidder=bid.bidder+'_s2s',type=bid.media_type||'',price=bid.price||0,impid=bid.impid||'',burl=bid.burl||'',nurl=bid.nurl||'',dealid=bid.dealid||'',adid=bid.adid||'',adomain=bid.adomain||[],cid=bid.cid||'',crid=bid.crid||'',cat=bid.cat||[],ext=bid.ext||{},native=bid.native||{},floor=bid.floor||0,w=parseInt(bid.w||1),h=parseInt(bid.h||1),slot_name=bid.slot_name||'';var tempBidderInfo=ProperMedia.utils.deepAccess(properOps,'bidder_info.'+bidder)||bidderInfo;var ttl=bid.exp||tempBidderInfo.default_bid_ttl||120000;if(type=='display'&&nurl){adcode+='<img src="'+nurl+'" width=1 height=1>';nurl='';}
var size=w+'x'+h;size=ProperMedia.utils.deepAccess(tempBidderInfo,'native_sizes.'+device+'.'+size)||size;var ad=new adObj({bidder:bidder,native:native,nobid:nobid,type:type,size:size,burl:burl,nurl:nurl,price:parseFloat(price),gross:parseFloat(price),tag_id:impid,request_url:endpoint,response:bid,response_ms:bid_response_ms,received_ts:bids_received_ts,dealid:dealid,adid:adid,adomain:adomain,cid:cid,crid:crid,cat:cat,ext:ext,ttl:ttl,floor:floor,target_slot:slot_name,uids:uids,});if(type=='video'){ad.vast_tag=vast_tag;ad.vast_type=vast_type;ad.vpaid=vpaid;ad.video_type=tempBidderInfo.video_type;}else{ad.adcode=adcode;}
bidData.logBidResponse(ad);}
bidData.incrementBidResponseCount(resp_cnt);}else if(!((websocket||sse)&&resp.cookies)){bidData.incrementBidResponseCount(resp_cnt);bidData.logNoBidResponse(new adObj({bidder:'s2s',price:0,gross:0,tag_id:'',request_url:endpoint,response:resp,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,}));}else if((websocket||sse)&&resp.error){if(websocket){let error=new Error('WebSocket Server Error: '+resp.error);sendError(error);}else if(sse){let error=new Error('Server Sent Events Error: '+resp.error);sendError(error);}}
if(resp&&resp.cookies){Object.keys(resp.cookies).map(function(bidder){if(resp.cookies[bidder]){cookieMatching.updateBidderUserSyncData(bidder,resp.cookies[bidder]);}});}}catch(e){e.bidder='s2s';sendError(e);}},error:function(e){try{bidData.incrementBidResponseCount(resp_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:'s2s',status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder='s2s';sendError(e);}},});}
function removeCreative(slot){if(slot.displayed_ad.bidder=='gumgum_s2s'){removeGumGumCreative();}}
function removeGumGumCreative(){try{var element=window.top.document.getElementById('GG_PXS');if(element){var gumgum_top_elem=element.parentNode;if(gumgum_top_elem){gumgum_top_elem.parentNode.removeChild(gumgum_top_elem);}}}catch(e){console.error(e);}}
function onBidWon(bid,slot){if(bid.nurl){var img=new Image();img.src=bid.nurl;}
if(bid.burl){$.ajax({url:bid.burl,method:'GET',withCredentials:true,});}
return true;}
return{send:send,onBidWon:onBidWon,bidderInfo:bidderInfo,removeCreative:removeCreative,};})();bidAdapters.aol_instream=(function(){var bidderInfo={rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'slot',default_bid_ttl:3600000,gvlid:25,};var bidder='aol_instream',ENDPOINT_URL='https://ads.adaptv.advertising.com/rtb/openrtb',SYNC_URLS=['https://cm.g.doubleclick.net/pixel?google_nid=adaptv_dbm&google_cm&google_sc','https://pr-bh.ybp.yahoo.com/sync/adaptv_ortb/{combo_uid}','https://sync-tm.everesttech.net/upi/pid/m7y5t93k?redir=https%3A%2F%2Fsync.adap.tv%2Fsync%3Ftype%3Dgif%26key%3Dtubemogul%26uid%3D%24%7BUSER_ID%7D','https://match.adsrvr.org/track/cmf/generic?ttd_pid=adaptv&ttd_tpi=1',];var SUPPORTED_USER_ID_SOURCES={'id5-sync.com':'id5id','verizonmedia.com':'connectid','liveramp.com':'idl_env',};function send(bidData){var bidder=bidData.bidder;var bidderInfo=properOps.bidder_info[bidder]||bidderInfo;var siteIds=(ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.site_id')||'').toString().split('-')||['',''];var pubId=properDevice.isMobile()&&siteIds.length==2?siteIds[1]:siteIds[0];if(properOps.testing_mode.ids==true){pubId='HBExchange';}
if(!pubId){properLog.mylog('Error: AOL Video Site ID is Required.');return false;}
var request_url=ENDPOINT_URL+'?ext_id='+pubId;var count=0;var requestData=bidData.requests;Object.keys(requestData).forEach(function(size){for(var i=0;i<requestData[size].length;i++){send_slot(size,requestData[size][i],count,'');count++;}});var slotRequestData=bidData.slot_requests||{};if(Object.keys(slotRequestData).length){for(var slot_name in slotRequestData){Object.keys(slotRequestData[slot_name]).forEach(function(size){for(var i=0;i<slotRequestData[slot_name][size].length;i++){send_slot(size,slotRequestData[slot_name][size][i],count,slot_name);count++;}});}}
function send_slot(size,tag_id,imp_id,slot_name){var ad_size=size.split('x');var request_cnt=1;var floor=getBidderFloor(bidder,size);var post_data={id:ProperMedia.utils.generateUUID(),at:2,cur:'USD',imp:[{id:parseInt(imp_id+1).toString(),secure:properPage.use_ssl?1:0,bidfloor:floor,video:{mimes:['video/mp4','application/javascript'],w:parseInt(ad_size[0]),h:parseInt(ad_size[1]),linearity:bidderInfo.video_type=='outstream'?2:1,protocols:[2,5],api:[2],delivery:[6],placement:bidderInfo.video_type=='outstream'?3:1,playbackmethod:bidderInfo.video_type=='outstream'?[6]:[3],minduration:1,maxduration:15,},ext:{hb:1,},},],site:{page:properPage.url,ref:properPage.referrer,},device:{ua:navigator.userAgent,js:1,},tmax:properOps.tmax,};var{eids,uids}=getSupportedEids();if(eids&&eids.length){ProperMedia.utils.deepSetValue(post_data,'user.ext.eids',eids);}
var schain=schainCheck(bidder);if(schain!='')ProperMedia.utils.deepSetValue(post_data,'source.ext.schain',schain);if(typeof gdprConsent.gdprApplies==='boolean'){ProperMedia.utils.deepSetValue(post_data,'regs.ext.gdpr',gdprConsent.gdprApplies);}
ProperMedia.utils.deepSetValue(post_data,'user.ext.consent',gdprConsent.consentString);if(uspConsent.usPrivacy){ProperMedia.utils.deepSetValue(post_data,'regs.ext.us_privacy',uspConsent.usPrivacy);}
properLog.mylog(request_url,bidder);properLog.mylog(bidder+': sending bid request');bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({method:'POST',requestType:'cors',bidder:bidder,edge:edge,data:JSON.stringify(post_data),url:request_url,success:function(data){properLog.mylog('AOL Video: parsing response');try{var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);data=ProperMedia.utils.safeJsonParse(data);if(data&&ProperMedia.utils.deepAccess(data,'seatbid.bid')&&data.seatbid.bid.length>0){properLog.mylog(data,bidder);data.seatbid.forEach(function(seatbid){(seatbid.bid||[]).forEach(function(bid){var width=bid['w']||ad_size[0],height=bid['h']||ad_size[1],price=bid['price']||0,vast_tag=bid['adm']||'',crid=bid['crid']||'',dealid=bid['dealid']||'',adomain=bid['adomain']||[];var tagTypes=ProperMedia.utils.parseVastVpaid(vast_tag);var ad=new adObj({bidder:bidder,type:'video',size:width+'x'+height,price:parseFloat(price),gross:parseFloat(price),vast_tag:vast_tag,vast_type:tagTypes['vast_type'],vpaid:tagTypes['vpaid'],video_type:bidderInfo.video_type,tag_id:tag_id,crid:crid,dealid:dealid,adomain:adomain,request_url:request_url,response:bid,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:bidderInfo.default_bid_ttl,floor:floor,target_slot:slot_name||'',});bidData.logBidResponse(ad);});});}else{properLog.mylog(bidder+': no bid returned');var ad=new adObj({bidder:bidder,price:0,gross:0,tag_id:tag_id,request_url:request_url,response:data,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,floor:floor,uids:uids,});bidData.logNoBidResponse(ad);}
bidData.incrementBidResponseCount(request_cnt);}catch(e){properLog.mylog(bidder+': unknown error with parsing response - '+e);e.bidder=bidder;throw e;}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});addUserSyncs();}
function getSupportedEids(){var userIdAsEids=userIds.getEidsArray();var uids=[];var eids=userIdAsEids.filter(function(eid){if(SUPPORTED_USER_ID_SOURCES[eid.source]){uids.push(SUPPORTED_USER_ID_SOURCES[eid.source]);return true;}
return false;});return{eids,uids};}
function addUserSyncs(){var syncs=SYNC_URLS.map(function(url){return{type:'image',url:url,demand_type:'video',bidder:bidder,};});userSyncs.add(syncs);}}
return{send:send,bidderInfo:bidderInfo,};})();bidAdapters.beachfront_instream=(function(){var bidderInfo={rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'slot',default_bid_ttl:300000,gvlid:335,};var bidder='beachfront_instream',ENDPOINT_URL='https://reachms.bfmio.com/bid.json',SYNC_ENDPOINT='https://sync.bfmio.com/sync_iframe',pubId='',adpos=1;var eIdAdapters={identityLink:{adapter:userIdAdapters.identityLink,rtiPartner:'idl',},};function send(bidData){var bidder=bidData.bidder;var bidderInfo=properOps.bidder_info[bidder]||bidderInfo;pubId=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.site_id')||0;if(properOps.testing_mode.ids==true){pubId='11bc5dd5-7421-4dd8-c926-40fa653bec76';}
if(!pubId){properLog.mylog('Error: Beachfront Video Site ID is Required.');return false;}
var request_url=ENDPOINT_URL+'?exchange_id='+pubId;var requestData=bidData.requests;Object.keys(requestData).forEach(function(size){for(var i=0;i<requestData[size].length;i++){send_slot(size,requestData[size][i],'');}});var slotRequestData=bidData.slot_requests||{};if(Object.keys(slotRequestData).length){for(var slot_name in slotRequestData){Object.keys(slotRequestData[slot_name]).forEach(function(size){for(var i=0;i<slotRequestData[slot_name][size].length;i++){send_slot(size,slotRequestData[slot_name][size][i],slot_name);}});}}
function send_slot(size,tag_id,slot_name){var ad_size=size.split('x');var request_cnt=1;var floor=getBidderFloor(bidder,size);var post_data={isPrebid:true,appId:pubId,domain:properPage.domain,id:ProperMedia.utils.generateUUID(),imp:[{video:{w:parseInt(ad_size[0]),h:parseInt(ad_size[1]),mimes:['video/mp4','application/javascript'],placement:bidderInfo.video_type=='outstream'?3:1,playbackmethod:bidderInfo.video_type=='outstream'?[6]:[3],},bidfloor:floor,secure:properPage.use_ssl?1:0,},],site:{page:properPage.url,domain:properPage.domain,},device:{ua:navigator.userAgent,language:navigator.language,devicetype:properDevice.isMobile()?1:isConnectedTV()?3:2,dnt:ProperMedia.utils.getDNT()?1:0,js:1,geo:{},},regs:{ext:{},},user:{ext:{},},cur:['USD'],};var eids=getEids();if(eids){ProperMedia.utils.deepSetValue(post_data,'user.ext.eids',eids);}
if(gdprConsent){ProperMedia.utils.deepSetValue(post_data,'regs.ext.gdpr',gdprConsent.gdprApplies?1:0);ProperMedia.utils.deepSetValue(post_data,'user.ext.consent',gdprConsent.consentString);}
if(uspConsent.usPrivacy){ProperMedia.utils.deepSetValue(post_data,'regs.ext.us_privacy',uspConsent.usPrivacy);}
properLog.mylog(request_url,bidder);properLog.mylog(bidder+': sending bid request');bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({method:'POST',requestType:'cors',bidder:bidder,edge:edge,data:JSON.stringify(post_data),url:request_url,success:function(data){properLog.mylog(bidder+': parsing response');try{var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);data=ProperMedia.utils.safeJsonParse(data);if(data&&data.url&&data.url!=''){var price=data.bidPrice||0,vast_tag=data.url||data.vast||'',crid=data.crid||data.cmpId||'',cmpid=data.cmpId||'';var tagTypes=ProperMedia.utils.parseVastVpaid(vast_tag);let ad=new adObj({bidder:bidder,type:'video',size:size,price:parseFloat(price),gross:parseFloat(price),vast_tag:vast_tag,vast_type:tagTypes['vast_type'],vpaid:tagTypes['vpaid'],video_type:bidderInfo.video_type,tag_id:tag_id,crid:crid,cid:cmpid,request_url:request_url,response:data,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:bidderInfo.default_bid_ttl,floor:floor,target_slot:slot_name||'',});bidData.logBidResponse(ad);}else{properLog.mylog(bidder+': no bid returned');let ad=new adObj({bidder:bidder,price:0,gross:0,tag_id:tag_id,request_url:request_url,response:data,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,floor:floor,});bidData.logNoBidResponse(ad);}
bidData.incrementBidResponseCount(request_cnt);}catch(e){properLog.mylog(bidder+': unknown error with parsing response - '+e);e.bidder=bidder;throw e;}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}}
function getEids(){var eids=[];Object.keys(eIdAdapters).forEach(function(name){var obj=eIdAdapters[name];if(ProperMedia.utils.deepAccess(obj,'adapter.config.enabled')){var eid=formatEid(obj.adapter.getValue(),obj.adapter.source,obj.rtiPartner);eids.push(eid);}});return eids;}
function formatEid(id,source,rtiPartner){return{source:source,uids:[{id:id,ext:{rtiPartner:rtiPartner,},},],};}
function getUserSyncs(){var gdpr=0,gc='',gce=1,uspc='1---';gdpr=gdprConsent.gdprApplies?1:0;gc=encodeURIComponent(gdprConsent.consentString||'');if(uspConsent.usPrivacy){uspc=encodeURIComponent(uspConsent.usPrivacy);}
var syncurl=SYNC_ENDPOINT+'?ifg=1&id='+pubId+'&gdpr='+gdpr+'&gc='+gc+'&gce='+gce+'&us_privacy='+uspc;userSyncs.add({type:'iframe',url:syncurl,demand_type:'video',bidder:bidder,});}
function isConnectedTV(){return /(smart[-]?tv|hbbtv|appletv|googletv|hdmi|netcast\.tv|viera|nettv|roku|\bdtv\b|sonydtv|inettvbrowser|\btv\b)/i.test(navigator.userAgent);}
return{send:send,bidderInfo:bidderInfo,getUserSyncs:getUserSyncs,};})();bidAdapters.pubmatic_instream=(function(){var bidderInfo={rev_share:0.81,demand_type:'video',video_type:'instream',bid_grouping:'page',default_bid_ttl:300000,gvlid:76,};var bidder='pubmatic_instream';var ENDPOINT_URL='https://hbopenbid.pubmatic.com/translator?source=prebid-client';var SYNC_URL='https://ads.pubmatic.com/AdServer/js/showad.js#PIX&kdntuid=1&p=';var pubId='109126';var alias_pubId='159475';function formatRequest(bidData,bidder,bidderInfo){var requestData={imps:[],data_map:{},};var impid=1;if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){for(var i=0;i<data[size].length;i++){var tag_id=data[size][i];if(properOps.testing_mode.ids==true){tag_id=properDevice.isMobile()?'2124083':'2124082';}
var ad_size=size.split('x');var floor=getBidderFloor(bidder,size);requestData['imps'].push({id:impid.toString(),tagid:tag_id,secure:properPage.use_ssl?1:0,ext:{},bidfloor:floor,bidfloorcur:'USD',video:{mimes:['video/mp4','application/javascript'],minduration:1,maxduration:15,startdelay:0,api:[2],protocols:[2,3,5,6],w:parseInt(ad_size[0]),h:parseInt(ad_size[1]),linearity:1,placement:bidderInfo.video_type=='outstream'?3:1,playbackmethod:bidderInfo.video_type=='outstream'?[6]:[3],ext:{video_skippable:1,},},});requestData['data_map'][impid]={floor:floor,tag_id:tag_id,slot_name:slot_name,size:ad_size[0]+'x'+ad_size[1],};impid++;}});}}
return requestData;}
function send(bidData){var bidder=bidData.bidder;var bidderInfo=properOps.bidder_info[bidder]||bidderInfo;var requestData=formatRequest(bidData,bidder,bidderInfo);var imps=requestData['imps']||[];var data_map=requestData['data_map']||{};var request_cnt=requestData['imps'].length;pubId=bidderInfo.alias?alias_pubId:pubId;if(ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.account_overrides.enabled')){pubId=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.account_overrides.bidder_ids.pubId')||pubId;}
if(properOps.testing_mode.ids==1){pubId='157593';}
if(request_cnt==0){return false;}
var payload={id:''+new Date().getTime(),at:1,cur:['USD'],imp:imps,site:{page:properPage.url,ref:document.referrer,publisher:{id:pubId.toString(),},domain:properPage.domain,},device:{ua:navigator.userAgent,js:1,dnt:ProperMedia.utils.getDNT()?1:0,h:screen.height,w:screen.width,language:navigator.language,geo:{},},user:{geo:{},},ext:{wrapper:{wv:'prebid_prebid_'+properOps.prebid_version,transactionId:ProperMedia.utils.generateUUID(),wp:'pbjs',},},tmax:properOps.tmax,};if(properOps.testing_mode.enabled){payload.test=1;}
payload.device.language=payload.device.language&&payload.device.language.split('-')[0];var eids=userIds.getEidsArray();if(eids&&eids.length){ProperMedia.utils.deepSetValue(payload,'user.eids',eids);}
var uids=Object.keys(ProperMedia.utils.deepAccess(bidData,'auction.uids'));var schain=schainCheck(bidder);if(schain!='')ProperMedia.utils.deepSetValue(payload,'source.ext.schain',schain);if(ProperMedia.utils.deepAccess(properSpecialOps,'coppa')){ProperMedia.utils.deepSetValue(payload,'regs.coppa',1);}
if(gdprConsent){ProperMedia.utils.deepSetValue(payload,'user.ext.consent',gdprConsent.consentString||'');ProperMedia.utils.deepSetValue(payload,'regs.ext.gdpr',gdprConsent.gdprApplies?1:0);}
if(uspConsent.usPrivacy){ProperMedia.utils.deepSetValue(payload,'regs.ext.us_privacy',uspConsent.usPrivacy);}
properLog.mylog(ENDPOINT_URL,bidder);properLog.mylog(bidder+': sending bid request');bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({method:'POST',requestType:'cors',bidder:bidder,edge:edge,data:JSON.stringify(payload),url:ENDPOINT_URL,success:function(data){properLog.mylog(bidder+': parsing response');try{var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);data=ProperMedia.utils.safeJsonParse(data);if(data&&data.seatbid&&data.seatbid.length>0&&data.seatbid[0].bid&&data.seatbid[0].bid.length>0){data.seatbid.forEach(function(seatbid){(seatbid.bid||[]).forEach(function(bid){var impid=bid.impid||'',vast_tag=bid.adm||'',price=bid.price||0,width=bid.w||0,height=bid.h||0,adomain=bid.adomain||[],cid=bid.cid||'',crid=bid.crid||'',size=width+'x'+height;if(!width||!height){size=ProperMedia.utils.deepAccess(data_map,impid+'.size')||(properDevice.isMobile()?'400x300':'640x480');}
var tagTypes=ProperMedia.utils.parseVastVpaid(vast_tag);var ad=new adObj({bidder:bidder,type:'video',size:size,price:parseFloat(price),gross:parseFloat(price),vast_tag:vast_tag,vast_type:tagTypes['vast_type'],vpaid:tagTypes['vpaid'],video_type:bidderInfo.video_type,tag_id:ProperMedia.utils.deepAccess(data_map,impid+'.tag_id')||impid,adomain:adomain,cid:cid,crid:crid,request_url:ENDPOINT_URL,response:bid,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:bidderInfo.default_bid_ttl,floor:ProperMedia.utils.deepAccess(data_map,impid+'.floor')||getBidderFloor(bidder,size),target_slot:ProperMedia.utils.deepAccess(data_map,impid+'.slot_name')||'',uids:uids,});bidData.logBidResponse(ad);});});}else{var ad=new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:ENDPOINT_URL,response:data,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,});bidData.logNoBidResponse(ad);}
bidData.incrementBidResponseCount(request_cnt);}catch(e){properLog.mylog(bidder+': unknown error with parsing response - '+e);}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}
function getUserSyncs(){var syncurl=SYNC_URL+pubId;if(gdprConsent){syncurl+='&gdpr='+(gdprConsent.gdprApplies?1:0);syncurl+='&gdpr_consent='+encodeURIComponent(gdprConsent.consentString||'');}
if(uspConsent.usPrivacy){syncurl+='&us_privacy='+encodeURIComponent(uspConsent.usPrivacy);}
userSyncs.add({type:'iframe',url:syncurl,demand_type:'video',bidder:bidder,});}
return{send:send,bidderInfo:bidderInfo,getUserSyncs:getUserSyncs,formatRequest:formatRequest,};})();bidAdapters.rubicon_instream=(function(){var bidderInfo={rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'page',default_bid_ttl:300000,gvlid:52,};var bidder='rubicon_instream';(accountId=8777),(alias_accountId=15380);var player_size=[640,480];var ENDPOINT_URL='https://prebid-server.rubiconproject.com/openrtb2/auction';var SYNC_URL='https://eus.rubiconproject.com/usync.html';function formatRequest(bidData,bidder,bidderInfo){var requestData={imps:[],data_map:{},};var siteIds=(ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.site_id')||'').toString().split('-')||['',''];var siteId=properDevice.isMobile()&&siteIds.length==2?siteIds[1]:siteIds[0];accountId=bidderInfo.alias?alias_accountId:accountId;if(ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.account_overrides.enabled')){accountId=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.account_overrides.bidder_ids.accountId')||accountId;}
if(!siteId){properLog.mylog('Error: Rubicon Video Site ID is Required.');return requestData;}
var impid=1;if(bidData.requests){formatTagIds(bidData.requests,'');}
if(bidData.slot_requests){for(var slot_name in bidData.slot_requests){formatTagIds(bidData.slot_requests[slot_name],slot_name);}}
function formatTagIds(data,slot_name){if(Object.keys(data).length>0){Object.keys(data).forEach(function(size){for(var i=0;i<data[size].length;i++){var zoneId=data[size][i];var ad_size=size.split('x');var floor=getBidderFloor(bidder,size);requestData['imps'].push({id:impid.toString(),secure:properPage.use_ssl?1:0,bidfloor:floor,ext:{rubicon:{accountId:parseInt(accountId),siteId:parseInt(siteId),zoneId:parseInt(zoneId),position:'btf',floor:floor,video:{language:'en',size_id:bidderInfo.video_type=='outstream'?203:201,playerWidth:parseInt(ad_size[0]),playerHeight:parseInt(ad_size[1]),},prebid:{auctiontimestamp:new Date().getTime(),},},},video:{playerSize:[parseInt(ad_size[0]),parseInt(ad_size[1])],placement:bidderInfo.video_type=='outstream'?3:1,playbackmethod:bidderInfo.video_type=='outstream'?[6]:[3],context:bidderInfo.video_type,mimes:['video/mp4','application/javascript'],protocols:[2,5],w:parseInt(ad_size[0]),h:parseInt(ad_size[1]),maxduration:60,linearity:1,api:[2],pos:3,},});requestData['data_map'][impid]={floor:floor,tag_id:zoneId,slot_name:slot_name,size:ad_size[0]+'x'+ad_size[1],};impid++;}});}}
return requestData;}
function send(bidData){var bidder=bidData.bidder;var bidderInfo=properOps.bidder_info[bidder]||bidderInfo;var requestData=formatRequest(bidData,bidder,bidderInfo);var imps=requestData['imps']||[];var data_map=requestData['data_map']||{};var request_cnt=requestData['imps'].length;if(request_cnt==0){return false;}
var post_data={id:ProperMedia.utils.generateUUID(),test:properOps.testing_mode.ids==true?1:0,cur:['USD'],source:{tid:ProperMedia.utils.generateUUID(),},tmax:properOps.tmax,imp:imps,ext:{prebid:{cache:{vastxml:{returnCreative:false,},},targeting:{includewinners:true,includebidderkeys:false,pricegranularity:{ranges:[{max:20,increment:0.01,},],},},bidders:{rubicon:{integration:'pbjs',},},},},site:{page:properPage.url,content:{language:'en',},},};var eids=userIds.getEidsArray();if(eids&&eids.length){ProperMedia.utils.deepSetValue(post_data,'user.ext.eids',eids);}
var uids=Object.keys(ProperMedia.utils.deepAccess(bidData,'auction.uids'));var schain=schainCheck(bidder);if(schain!='')ProperMedia.utils.deepSetValue(post_data,'source.ext.schain',schain);if(ProperMedia.utils.deepAccess(properSpecialOps,'coppa')){ProperMedia.utils.deepSetValue(post_data,'regs.coppa',1);}
if(gdprConsent){ProperMedia.utils.deepSetValue(post_data,'user.ext.consent',gdprConsent.consentString);if(typeof gdprConsent.gdprApplies==='boolean'){ProperMedia.utils.deepSetValue(post_data,'regs.ext.gdpr',Number(gdprConsent.gdprApplies));}}
if(uspConsent.usPrivacy){ProperMedia.utils.deepSetValue(post_data,'regs.ext.us_privacy',uspConsent.usPrivacy);}
properLog.mylog(ENDPOINT_URL,bidder);properLog.mylog(bidder+': sending bid request');bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({method:'POST',requestType:'cors',bidder:bidder,edge:edge,data:JSON.stringify(post_data),url:ENDPOINT_URL,success:function(data){properLog.mylog(bidder+': parsing response');try{var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);data=ProperMedia.utils.safeJsonParse(data);if(data&&data.seatbid&&data.seatbid.length>0&&data.seatbid[0].bid&&data.seatbid[0].bid.length>0){properLog.mylog(data,bidder);data.seatbid.forEach(function(seatbid){(seatbid.bid||[]).forEach(function(bid){var impid=bid.impid||'',price=bid.price||0,width=bid.w||0,height=bid.h||0,adomain=bid.adomain||[],cid=bid.cid||'',crid=bid.crid||'',size=width+'x'+height;if(!width||!height){size=ProperMedia.utils.deepAccess(data_map,impid+'.size')||(properDevice.isMobile()?'400x300':'640x480');}
var vast_xml='',vast_tag='',nurl='';var extPrebidTargeting=ProperMedia.utils.deepAccess(bid,'ext.prebid.targeting')||{};if(ProperMedia.utils.deepAccess(bid,'ext.prebid.cache.vastXml.url')){vast_tag=ProperMedia.utils.deepAccess(bid,'ext.prebid.cache.vastXml.url');}else if(extPrebidTargeting&&extPrebidTargeting.hb_uuid&&extPrebidTargeting.hb_cache_host&&extPrebidTargeting.hb_cache_path){vast_tag='https://'+
extPrebidTargeting.hb_cache_host+
extPrebidTargeting.hb_cache_path+
'?uuid='+
extPrebidTargeting.hb_uuid;}
if(bid.adm){vast_tag=bid.adm;}
if(bid.nurl){nurl=bid.nurl;}
if(!vast_tag&&bid.nurl){vast_tag=bid.nurl;}
var tagTypes=ProperMedia.utils.parseVastVpaid(vast_tag);var ad=new adObj({bidder:bidder,type:'video',size:size,price:parseFloat(price),gross:parseFloat(price),vast_tag:vast_tag,vast_type:tagTypes['vast_type'],vpaid:tagTypes['vpaid'],video_type:bidderInfo.video_type,nurl:nurl,tag_id:ProperMedia.utils.deepAccess(data_map,impid+'.tag_id'),adomain:adomain,cid:cid,crid:crid,request_url:ENDPOINT_URL,response:bid,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:bid.ttl*1000||bidderInfo.default_bid_ttl,floor:ProperMedia.utils.deepAccess(data_map,impid+'.floor')||getBidderFloor(bidder,size),target_slot:ProperMedia.utils.deepAccess(data_map,impid+'.slot_name')||'',uids:uids,});bidData.logBidResponse(ad);});});}else{properLog.mylog(bidder+': no bid returned');var ad=new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:ENDPOINT_URL,response:data,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,});bidData.logNoBidResponse(ad);}
bidData.incrementBidResponseCount(request_cnt);}catch(e){properLog.mylog(bidder+": can't parse bid response - "+e);}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}
function getUserSyncs(){userSyncs.add({type:'iframe',url:SYNC_URL,demand_type:'video',bidder:bidder,});}
return{send:send,bidderInfo:bidderInfo,getUserSyncs:getUserSyncs,formatRequest:formatRequest,};})();bidAdapters.spotx_instream=(function(){var bidderInfo={rev_share:1,demand_type:'video',video_type:'instream',bid_grouping:'slot',default_bid_ttl:360000,gvlid:165,};var bidder='spotx_instream';var ENDPOINT_URL='https://search.spotxchange.com/openrtb/2.3/dados/';function send(bidData){var bidder=bidData.bidder;var bidderInfo=properOps.bidder_info[bidder]||bidderInfo;var siteIds=(ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.site_id')||'').split('-')||['',''];var pubId=properDevice.isMobile()&&siteIds.length==2?siteIds[1]:siteIds[0];if(properOps.testing_mode.ids==true){pubId='79391';}
if(!pubId){properLog.mylog('Error: SpotX Site ID is Required.');return false;}
var request_url=ENDPOINT_URL+pubId;var requestData=bidData.requests;Object.keys(requestData).forEach(function(size){for(var i=0;i<requestData[size].length;i++){send_slot(size,requestData[size][i],'');}});var slotRequestData=bidData.slot_requests||{};if(Object.keys(slotRequestData).length){for(var slot_name in slotRequestData){Object.keys(slotRequestData[slot_name]).forEach(function(size){for(var i=0;i<slotRequestData[slot_name][size].length;i++){send_slot(size,slotRequestData[slot_name][size][i],slot_name);}});}}
function send_slot(size,tagId,slot_name){var request_cnt=1;var ad_size=size.split('x');var floor=getBidderFloor(bidder,size);var post_data={id:pubId,imp:{id:ProperMedia.utils.generateUUID(),secure:properPage.use_ssl?true:false,bidfloor:floor,video:{w:parseInt(ad_size[0]),h:parseInt(ad_size[1]),ext:{sdk_name:'Prebid 1+',versionOrtb:properOps.prebid_version,ad_unit:bidderInfo.video_type,},mimes:['video/mp4','application/javascript'],placement:bidderInfo.video_type=='outstream'?3:1,playbackmethod:bidderInfo.video_type=='outstream'?[6]:[3],},},site:{id:'',page:properPage.url,content:'content',},device:{h:parseInt(properPage.height),w:parseInt(properPage.width),dnt:ProperMedia.utils.getDNT()?1:0,language:'en',make:navigator.vendor?navigator.vendor:'',ua:navigator.userAgent,},ext:{wrap_response:1,},user:{ext:{},},};var eidsArr=userIds.getEidsArray();if(eidsArr.length){ProperMedia.utils.deepSetValue(post_data,'user.ext.eids',eidsArr);}
var uids=Object.keys(ProperMedia.utils.deepAccess(bidData,'auction.uids'));if(!gppConsentModule.isConsentDenied()&&gdprConsentModule.hasPurpose4Consent()){ProperMedia.utils.deepSetValue(post_data,'user.ext.fpc',properUser.pubcid);}
var schain=schainCheck(bidder);if(schain!='')ProperMedia.utils.deepSetValue(post_data,'source.ext.schain',schain);if(gdprConsent){if(typeof gdprConsent.gdprApplies==='boolean'){ProperMedia.utils.deepSetValue(post_data,'regs.ext.gdpr',gdprConsent.gdprApplies?1:0);}
ProperMedia.utils.deepSetValue(post_data,'user.ext.consent',gdprConsent.consentString);}
if(uspConsent.usPrivacy){ProperMedia.utils.deepSetValue(post_data,'regs.ext.us_privacy',uspConsent.usPrivacy);}
properLog.mylog(request_url,bidder);properLog.mylog(bidder+': sending bid request');bidData.incrementRequestsSent(request_cnt);var bid_sent_ts=ProperMedia.utils.getTimestampMs();var startTime=new Date();var edge=ProperMedia.utils.deepAccess(properOps,'bidders.header.'+bidder+'.edge')||false;$.ajax({method:'POST',requestType:'cors',bidder:bidder,edge:edge,data:JSON.stringify(post_data),url:request_url,success:function(data){properLog.mylog(bidder+': parsing response');try{var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);data=ProperMedia.utils.safeJsonParse(data);if(data&&data.seatbid&&data.seatbid.length>0&&data.seatbid[0].bid&&data.seatbid[0].bid.length>0){data.seatbid.forEach(function(seatbid){(seatbid.bid||[]).forEach(function(bid){var price=bid.price||0,width=ad_size[0]||(properDevice.isMobile()?400:640),height=ad_size[1]||(properDevice.isMobile()?300:480),adomain=bid.adomain||[],cid=bid.cid||'',crid=bid.crid||'',cache_key=ProperMedia.utils.deepAccess(bid,'ext.cache_key');var vast_tag='https://search.spotxchange.com/ad/vast.html?key='+cache_key;var tagTypes=ProperMedia.utils.parseVastVpaid(vast_tag);var ad=new adObj({bidder:bidder,type:'video',size:width+'x'+height,price:parseFloat(price),gross:parseFloat(price),vast_tag:vast_tag,vast_type:tagTypes['vast_type'],vpaid:tagTypes['vpaid'],video_type:bidderInfo.video_type,tag_id:tagId||bid.impid,adomain:adomain,cid:cid,crid:crid,request_url:request_url,response:bid,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:bidderInfo.default_bid_ttl,floor:floor,uids:uids,target_slot:slot_name||'',});bidData.logBidResponse(ad);});});}else{properLog.mylog(bidder+': no bid returned');var ad=new adObj({bidder:bidder,price:0,gross:0,tag_id:'',request_url:request_url,response:data,response_ms:bid_response_ms,received_ts:bids_received_ts,ttl:0,});bidData.logNoBidResponse(ad);}
bidData.incrementBidResponseCount(request_cnt);}catch(e){properLog.mylog(bidder+': unknown error with parsing response - '+e);}},error:function(e){try{bidData.incrementBidResponseCount(request_cnt);var bids_received_ts=ProperMedia.utils.getTimestampMs();var bid_response_ms=ProperMedia.utils.calcResponseMs(bid_sent_ts,bids_received_ts);var bidError={bidder:bidder,status:e.status,statusText:e.statusText,timeout:e.timeout,response_ms:bid_response_ms,};bidData.logBidResponseError(bidError);}catch(e){e.bidder=bidder;throw e;}},});}}
return{send:send,bidderInfo:bidderInfo,};})();function buildNativeAdCode(slot,ad){var clickUrl=ProperMedia.utils.deepAccess(ad,'native.link.url')||'',assets=ProperMedia.utils.deepAccess(ad,'native.assets')||[],image_url='',icon_url='',title='',sponsored='',desc='',displayurl='',ctatext='';if(assets.length){assets.forEach(function(asset){if(asset.title){title=ProperMedia.utils.deepAccess(asset,'title.text')||'';}else if(asset.img){var img_type=ProperMedia.utils.deepAccess(asset,'img.type')||'';if(img_type==1){image_url=ProperMedia.utils.deepAccess(asset,'img.url')||'';}else if(img_type==2){icon_url=ProperMedia.utils.deepAccess(asset,'img.url')||'';}}else if(asset.type==1){sponsored=asset.value;}else if(asset.type==2){desc=asset.value;}else if(asset.type==11){displayurl=asset.value;}else if(asset.type==12){ctatext=asset.value;}});}
var css=getNativeCss();var html=css+
'<div class="proper-ad-unit native">'+
'<div class="inner">'+
'<div class="c1">'+
'<div class="img" style="background-image:url('+image_url+')"></div>'+
'</div>'+
'<div class="c2">'+
'<div class="txt">'+
'<h1 class="title">'+title+'</h1>'+
'<p>'+desc+'</p>'+
'</div>'+
'<div class="cta">'+
'<span>'+
'<img src="'+icon_url+'" style="max-width:14px; max-height: 14px; margin-right:4px;"/>'+
sponsored+
'</span>'+
'<div class="btn">'+
'<a href="#cta" onclick="fireTrackers(\'click\')">'+ctatext+'</a>'+
'</div>'+
'</div>'+
'</div>'+
'</div>'+
'</div>';html+='<script>'+
'function fireTrackers(action) {'+
'var message = { message: "Proper Native", slotName:  + "'+slot.name+'" };'+
'if (action === "click") { message.action = "click"; }'+
'window.parent.postMessage(JSON.stringify(message), "*");'+
'window.open("'+clickUrl+'", \'_blank\').focus();'+
'}'+
'</script>';ad.adcode=html;}
function getNativeCss(){var css="a,abbr,acronym,address,applet,article,aside,audio,b,big,blockquote,body,canvas,caption,center,cite,code,dd,del,details,dfn,div,dl,dt,em,embed,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,html,i,iframe,img,ins,kbd,label,legend,li,mark,menu,nav,object,ol,output,p,pre,q,ruby,s,samp,section,small,span,strike,strong,sub,summary,sup,table,tbody,td,tfoot,th,thead,time,tr,tt,u,ul,var,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}body,html{height:100%}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:after,blockquote:before,q:after,q:before{content:\'\';content:none}table{border-collapse:collapse;border-spacing:0}input{border-radius:0}hr{border:none;height:1px;margin:0}.ds-all *{box-shadow:inset 0 0 0 1px red}iframe{border:none}.btn a{background:#EE2C1D !important;box-shadow:inset 0 -1px 0 0 rgba(0, 0, 0, 0.3) !important}body{background:white;color:black;font-family:\"HelveticaNeue-Light\", \"Helvetica Neue Light\", \"Helvetica Neue\", Helvetica, Arial, \"Lucida Grande\", sans-serif;padding:0;margin:0}body *{box-sizing:border-box}body > h1{font-weight:bold;padding-bottom:3px;border-bottom:solid 1px black;margin-bottom:7px}body > h1:not(:first-of-type){margin-top:50px}.proper-ad-unit.native{display:flex;width:100vw;height:100vh;background:white;border-radius:4px;overflow:hidden;box-shadow:inset 0 0 0 1px #cccccc}.proper-ad-unit.native .inner{max-height:100%;flex:1 1 100%;display:flex;flex-wrap:wrap}.proper-ad-unit.native .c1{flex:1 1 300px;box-shadow:inset 0 0 0 1px #cccccc}.proper-ad-unit.native .c2{flex:1 0 50%;min-width:calc(100% - 300px);display:flex;flex-direction:column;justify-content:center}.proper-ad-unit.native .img{width:100%;height:100%;min-height:55px;background-repeat:no-repeat;background-size:contain;background-position:center;transform:scale(0.94, 0.94)}.proper-ad-unit.native .txt{max-height:200px;padding:0 3vw 1vw;line-height:0.94em}.proper-ad-unit.native .title{font-weight:bold;font-size:1.25em;line-height:1.1em;margin-bottom:0.25em;position:relative}.proper-ad-unit.native p{font-size:0.9em}.proper-ad-unit.native .cta{flex:1;display:flex;flex-wrap:wrap}.proper-ad-unit.native span{color:#333;letter-spacing:0.05em;font-size:0.7em;flex:1 1 160px;padding:0 0 4px 3vw;display:flex;align-items:flex-end}.proper-ad-unit.native .btn{flex:1 1 160px;align-self:flex-end;border:solid 4px rgba(0, 0, 0, 0);margin:1px;position:relative;min-height:32px;min-width:158px}.proper-ad-unit.native a{position:absolute;bottom:0;right:0;width:100%;max-width:300px;text-decoration:none;white-space:nowrap;color:white;background:#0437dd;display:flex;justify-content:center;align-items:center;height:28px;border-radius:4px}@media screen and (max-height: 240px){.proper-ad-unit.native .c1{flex:0 1 100vh}.proper-ad-unit.native .txt{padding:3vh}.proper-ad-unit.native .title{margin-bottom:1vh !important}.proper-ad-unit.native span{padding-left:3vh}}@media screen and (max-width: 240px){.proper-ad-unit.native .inner{flex-direction:column}.proper-ad-unit.native .c1{flex:0 1 100vw}.proper-ad-unit.native .cta{flex-direction:column}.proper-ad-unit.native span{flex:0 0 20px}}@media screen and (min-height: 240px) and (min-width: 320px){.proper-ad-unit.native .cta{flex:0}}";if(properSpecialOps.extra_native_css){css+=properSpecialOps.extra_native_css;}
var styleHtml='<style type="text/css">'+css+'</style>';return styleHtml;}
function listenMessagesFromCreative(){window.addEventListener('message',receiveMessage,false);}
function receiveMessage(ev){var key=ev.message?'message':'data';var data=ProperMedia.utils.safeJsonParse(ev[key]);if(data.slotName){var slot=properPage.getSlotFromPageObject(data.slotName,['display']);if(slot&&slot.displayed_ad instanceof adObj&&slot.displayed_ad.type=='native'&&data.message==='Proper Native'){var trackerType=fireNativeTrackers(data.auction,slot.displayed_ad);}}}
function fireNativeTrackers(action,adObject){try{var trackers=[];if(action==='click'){trackers=ProperMedia.utils.deepAccess(adObject,'native.clickTrackers')||ProperMedia.utils.deepAccess(adObject,'native.link.clickTrackers');}else{trackers=ProperMedia.utils.deepAccess(adObject,'native.imptrackers');if(ProperMedia.utils.deepAccess(adObject,'native.jstracker')){if(ProperMedia.utils.isArray(adObject.native.jstracker)){(adObject.native.jstracker||[]).forEach(Propermedia.utils.insertHtmlIntoIframe);}else if(ProperMedia.utils.isStr(adObject.native.jstracker)){Propermedia.utils.insertHtmlIntoIframe(adObject.native.jstracker);}}
if(ProperMedia.utils.deepAccess(adObject,'native.eventtrackers')){(adObject.native.eventtrackers||[]).forEach(function(eventtracker){if(eventtracker.event==1){trackers.push(eventtracker.url);}else if(eventtracker.event==2){var elem=document.createElement('script');elem.src=eventtracker.url;elem.async=true;elem.type="text/javascript";var scpt=document.getElementsByTagName('script')[0];scpt.parentNode.insertBefore(elem,scpt);}});}}
(trackers||[]).forEach(Propermedia.utils.triggerPixel);}catch(e){properLog.mylog("Error firing NativeTrackers: "+JSON.stringify(e));}}
window.addEventListener('unload',function(){properLog.proper_tracker();});function init(){propertag.cmd.push=function(cmd){consentManager.ready(cmd);};propertag.cmd.unshift=function(cmd){cmd.call();};if(propertag.cmd.length){propertag.cmd.shift().call();}
while(propertag.cmd.length){consentManager.ready(propertag.cmd.shift());}}
function set_options(settings){if(settings.extra_js){settings.extra_js='try {\n'+settings.extra_js+'\n} catch(e) { console.error(e); }';Function('"use strict"; '+settings.extra_js.replace(/\\n|\\r/g,' '))();}
setBidAdapterSettings();settings=sortAdSlotsByNumber(settings);setThirdPartyAdManagerSettings(settings);setConfigSettings(settings);validateConfigSettings();gdprEnforcement.setEnforcementConfig(properOps);audiencePixels.controller.init(properOps.audience_segments,properOps.audience_pixels);addStyleSheet();properPage.setPageVariables();consentManager.ready(function(){userIdAdapters.pubCommonId.init();properUser.init();cookieMatching.init();cookieMatching.cookieMatch();userIds.init();},'unshift');properPage.init();var properLoadEvent=new Event('proper-has-been-loaded');window.dispatchEvent(properLoadEvent);}
function get_options(){return ProperMedia.utils.deepCopy(properOps);}
function schainCheck(bidder){var bid_adapter_name=bidderToAdapterName(bidder);var header_s2s=bid_adapter_name=='s2s'?'s2s':'header';if(properOps.schain&&!ProperMedia.utils.deepAccess(properOps,'bidders.'+header_s2s+'.'+bidder+'.account_overrides.enabled')){return properOps.schain;}
return '';}
function setBidAdapterSettings(){if(typeof bidAdapters!=='undefined'){for(var bidder in bidAdapters){properOps.bidder_info[bidder]=bidAdapters[bidder].bidderInfo;}}}
function setConfigSettings(settings){ProperMedia.utils.mergeObject(properOps,settings);}
function validateConfigSettings(){if(!properOps.dfp_id){properOps.dfp_id=properOps.proper_dfp_id;}
if(!properOps.google_advertiser){properOps.google_advertiser=properOps.dfp_advertiser_ids.google;}
if(!properOps.proper_advertiser){properOps.proper_advertiser=properOps.dfp_advertiser_ids.proper;}
if(!properOps.adsense_advertiser){properOps.adsense_advertiser=properOps.dfp_advertiser_ids.adsense;}}
function setThirdPartyAdManagerSettings(settings){if(settings.remote_gam){settings.thirdPartyAdManager=true;}
if(properSpecialOps.dfp_id){settings.dfp_id=properSpecialOps.dfp_id;settings.thirdPartyAdManager=true;}
if(properSpecialOps.google_advertiser){settings.google_advertiser=properSpecialOps.google_advertiser;settings.thirdPartyAdManager=true;}
if(properSpecialOps.proper_advertiser){settings.proper_advertiser=properSpecialOps.proper_advertiser;settings.thirdPartyAdManager=true;}
if(properSpecialOps.adsense_advertiser){settings.adsense_advertiser=properSpecialOps.adsense_advertiser;settings.thirdPartyAdManager=true;}}
function sortAdSlotsByNumber(settings){Object.keys(settings.ad_slots).forEach(function(slot_type){settings.ad_slots[slot_type]=ProperMedia.utils.sortProperties(settings.ad_slots[slot_type],'number',true,false);});return settings;}
function addStyleSheet(){var style=document.createElement('style');style.type='text/css';var css=":root {--slider_mobile_adjustment_size: 1;}.proper-ad-unit {margin: auto;position: relative;display: block;min-width: 100px;text-align: center;box-sizing: border-box !important;}.proper-ad-unit * {box-sizing: border-box !important;}.proper-ad-unit.in-content-slider-cont {display: block !important;flex-direction: column;margin: auto;background-color: #ededed;overflow: unset !important;}.proper-ad-unit.in-content-slider-cont > .in-content-slider-unit {position: sticky;top: 0px;margin: 0px auto;}.proper-ad-unit > div:first-of-type:not(.sticky-inner):not(.in-content-slider-unit) {position: relative;margin: auto;}.proper-ad-unit > div:first-of-type:not(.sticky-inner).active-highlight:after {content: \'\';margin: auto;position: absolute;top: 0;right: 0;bottom: 0;left: 0;pointer-events: none;background: none;border: 5px solid rgba(218, 48, 48, 0.85);}.proper-ad-unit > div:first-of-type:not(.sticky-inner) > .noad {background-color: #c2c2c2;}.proper-ad-unit .report-ad {position: relative !important;display: block !important;font-family: sans-serif;left: 0;right: 0;color: #999 !important;font-size: 12px;line-height: 23px;white-space: nowrap;text-decoration: none !important;-webkit-font-smoothing: antialiased;}.proper-ad-unit .report-ad:hover {color: black;text-decoration: underline !important;}.proper-ad-unit .disclosure_box {font-size: 12px;text-transform: uppercase;text-decoration: none;width: 100%;text-align: center;color: #828282;}.proper-ad-unit.ad-sticky {width: 100%;text-align: center;z-index: 10000000;pointer-events: none;position: fixed;}.proper-ad-unit.ad-sticky.close {display: none !important;}.proper-ad-unit.ad-sticky, .proper-ad-unit.ad-sticky .sticky-inner {pointer-events: none;}.proper-ad-unit.ad-sticky .sticky-inner > * {pointer-events: all;}.proper-ad-unit.ad-sticky .close {pointer-events: all;cursor: pointer;}.proper-ad-unit.ad-sticky .close::after {content: \'\\00d7\';color: black;font-size: 21px !important;font-family: \'Futura\', sans-serif !important;line-height: 31px !important;border-radius: 500px;display: block;width: 32px;height: 32px;margin: 9px 0 0 9px;box-shadow: inset 0 0 0 2px #ccc;}.proper-ad-unit.ad-sticky:not(.for-mobile).close:hover:after {box-shadow: inset 0 0 0 2px #333;}.proper-ad-unit.ad-sticky #propervideo-video_container iframe {background-color: transparent !important;}.proper-ad-unit.ad-sticky iframe {background-color: white;pointer-events: all;vertical-align: bottom;position: relative;cursor: pointer;z-index: 2;}.proper-ad-unit.ad-sticky .brand {display: none;cursor: pointer;pointer-events: all;position: absolute;width: 100%;height: 100%;top: 0;left: 0;}.proper-ad-unit.ad-sticky .brand:after {content: \'\';position: relative;width: 100%;height: 15px;display: block;background: no-repeat center;background-size: 42px 15px;background-image: url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAAAgCAYAAADtwH1UAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA25pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDYuMC1jMDAyIDExNi4xNjQ2NTUsIDIwMjEvMDEvMjYtMTU6NDE6MjAgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6MjY1YmM5NTctOTliMS00YjRjLWJlYTMtOWZhMThjZWYyYzEwIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjk1NUQzREZFM0I2RTExRUM4QjhCQUE4QkI1MERBNDIxIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjk1NUQzREZEM0I2RTExRUM4QjhCQUE4QkI1MERBNDIxIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCAyMS4yIChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OTk0MzY2NzlCRjBFMTFFQUJBOTU5NzBBQTVBNDdDOEIiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OTk0MzY2N0FCRjBFMTFFQUJBOTU5NzBBQTVBNDdDOEIiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5Y6CFxAAACJ0lEQVR42uxavUpDMRS+kVaqQv0BB7s5WCku4qqTk7jr5Fh8Cl/EoYOzD+DoYHFwl6IPoOJS1EmtxkTOlRDyc5Lbm0p7Pjjk9uacQ5ovOT+ljHOeEUaHKdoCIoAIIBABRACBCCACCETAxKGCVWy1WvnjqZBjpBnr9XqqrcSdkKbD5l7Iev4B7F3dIhNinRf2DNbPsfYImx0hXYuvv3UPlQBA0bYZY98EPZboEMZ8p67DV9C6U4YgnpjsscsBrivMMkJQ6CnjBjBNtpGn2UUel/kjj8kOWzmemOK/tPf4UOP+ryBsLkH33ZArv8oi4MJxM3LpK3rXSNJ8JOhJ3IazSLss3/QA7MJYK3qoQ5T3EToLQvYUQnyoamMRHEWGDBYaNhTMJytDMSVfBGaEfMLow8Cz3q2YBQSefB1zo2jEJAmHSN0bz/yrNrqwaXh3pTwfmGr5kvFgeNdPkYTPDUnXFpJceNFGV6i4tTRExsoj9GRLHwVCkX6rSyOAG8SFNRjblvk6+Khb5tuIDeWeTtmnY/sePhtbdVcLCdPDKENdRDzC2In03YkJK4nCT/JGLAYNZL2P6g+wYUXoLRoS+MQRwAKbrqwAWb5EWPmvBKAXBgkqamO05MaQp9hFzoqQJ+gf8h/ABlCXT1tsGhASq0rIlO8/hGwYbKSfJSHPio2UWeVGrYLPb/AlS+plIW/oU0r/CxrvHEAgAogAAhFABBCIACKAYMCPAAMAOUmeBNC2HO0AAAAASUVORK5CYII=\");}.proper-ad-unit.ad-sticky .sticky-inner > div:last-of-type {display: inline-block;}.proper-ad-unit.sticky-btm {bottom: 0;left: 0;}.proper-ad-unit.sticky-btm:before {content: \'\';position: absolute;width: 100%;height: 50%;top: 50%;left: 0;background: rgba(255, 255, 255, 0.79);pointer-events: all;box-shadow: 0 0 4px 0 rgba(0, 0, 0, 0.3);}.proper-ad-unit.sticky-btm .sticky-inner {height: inherit;display: inline-block;}.proper-ad-unit.sticky-btm .inner-left, .proper-ad-unit.sticky-btm .inner-right {height: 100%;width: 48px;display: block;}.proper-ad-unit.sticky-btm .inner-left {float: left;}.proper-ad-unit.sticky-btm .inner-right {float: right;position: inherit;}.proper-ad-unit.sticky-btm .brand {position: absolute;width: 48px;height: 16px;left: 0;top: 50%;}.proper-ad-unit.sticky-btm .close {display: none;position: absolute;bottom: 0;right: 0;width: 48px;height: 48px;}.proper-ad-unit[class*=\'sticky-corner-\']:before, .proper-ad-unit.sticky-right:before, .proper-ad-unit.sticky-left:before, .proper-ad-unit.sticky-btm.for-mobile:before {top: -2px;left: 0;height: 200%;background: white;box-shadow: 0 0 0 2px #ccc;}.proper-ad-unit[class*=\'sticky-corner-\'] .inner-left, .proper-ad-unit[class*=\'sticky-corner-\'] .inner-right, .proper-ad-unit.sticky-right .inner-left, .proper-ad-unit.sticky-right .inner-right, .proper-ad-unit.sticky-left .inner-left, .proper-ad-unit.sticky-left .inner-right, .proper-ad-unit.sticky-btm.for-mobile .inner-left, .proper-ad-unit.sticky-btm.for-mobile .inner-right {height: 0;position: initial;}.proper-ad-unit[class*=\'sticky-corner-\'] .brand, .proper-ad-unit[class*=\'sticky-corner-\'] .close, .proper-ad-unit.sticky-right .brand, .proper-ad-unit.sticky-right .close, .proper-ad-unit.sticky-left .brand, .proper-ad-unit.sticky-left .close, .proper-ad-unit.sticky-btm.for-mobile .brand, .proper-ad-unit.sticky-btm.for-mobile .close {bottom: 100%;top: auto;}.proper-ad-unit[class*=\'sticky-corner-\'] .brand, .proper-ad-unit.sticky-right .brand, .proper-ad-unit.sticky-left .brand, .proper-ad-unit.sticky-btm.for-mobile .brand {top: -18px;width: 48px;background-color: white;border-radius: 0 6px 0 0;border: solid 2px #ccc;border-left: none;border-bottom: none;}.proper-ad-unit[class*=\'sticky-corner-\'] .brand:after, .proper-ad-unit.sticky-right .brand:after, .proper-ad-unit.sticky-left .brand:after, .proper-ad-unit.sticky-btm.for-mobile .brand:after {background-position: 1px 0px;}.proper-ad-unit[class*=\'sticky-corner-\'] .close:after, .proper-ad-unit.sticky-right .close:after, .proper-ad-unit.sticky-left .close:after, .proper-ad-unit.sticky-btm.for-mobile .close:after {position: absolute;bottom: 2px;right: 0;box-shadow: none;border-radius: 11px 0 0 0;background: #ffffff;border: solid 2px #ccc;border-right: none;border-bottom: none;}.proper-ad-unit[class*=\'sticky-corner-\'], .proper-ad-unit.sticky-left, .proper-ad-unit.sticky-right {right: 0;width: auto;top: 0;height: 100% !important;display: table;}.proper-ad-unit[class*=\'sticky-corner-\'] .sticky-inner, .proper-ad-unit.sticky-left .sticky-inner, .proper-ad-unit.sticky-right .sticky-inner {display: table-cell;vertical-align: middle;}.proper-ad-unit[class*=\'sticky-corner-\'] .inner-left, .proper-ad-unit[class*=\'sticky-corner-\'] .inner-right, .proper-ad-unit.sticky-left .inner-left, .proper-ad-unit.sticky-left .inner-right, .proper-ad-unit.sticky-right .inner-left, .proper-ad-unit.sticky-right .inner-right {position: relative;}.proper-ad-unit[class*=\'sticky-corner-\'] .brand, .proper-ad-unit.sticky-left .brand, .proper-ad-unit.sticky-right .brand {height: 14px;width: 52px;top: -12px;border-left: solid 2px #ccc;border-radius: 4px 4px 0 0;}.proper-ad-unit[class*=\'sticky-corner-\'] .brand:after, .proper-ad-unit.sticky-left .brand:after, .proper-ad-unit.sticky-right .brand:after {background-position: 2px 0px;}.proper-ad-unit[class*=\'sticky-corner-\'] .close:after, .proper-ad-unit.sticky-left .close:after, .proper-ad-unit.sticky-right .close:after {bottom: -2px;}.proper-ad-unit[class*=\'sticky-corner-\'] .sticky-inner > div:last-of-type, .proper-ad-unit.sticky-left .sticky-inner > div:last-of-type, .proper-ad-unit.sticky-right .sticky-inner > div:last-of-type {border: solid 2px #ccc;border-right: none;padding: 4px;padding-right: 0;background: white;border-radius: 0 0 0 4px;}.proper-ad-unit.sticky-corner-left, .proper-ad-unit.sticky-left {right: auto;left: 0;}.proper-ad-unit.sticky-corner-left .close:after, .proper-ad-unit.sticky-left .close:after {border-radius: 6px 6px 0 0;border-right: solid 2px #ccc;}.proper-ad-unit.sticky-corner-left .sticky-inner > div:last-of-type, .proper-ad-unit.sticky-left .sticky-inner > div:last-of-type {border-left: none;padding: 4px;padding-left: 0;border-right: solid 2px #ccc;border-radius: 0 0 4px 0;}.proper-ad-unit.sticky-left .brand {border-left: none;border-radius: 0 4px 0 0;width: 48px;}.proper-ad-unit.sticky-left .brand:after {background-position: 1px 0px;}.proper-ad-unit[class*=\'sticky-corner-\'] {padding: 15px;}.proper-ad-unit[class*=\'sticky-corner-\'] .sticky-inner {vertical-align: bottom;}.proper-ad-unit[class*=\'sticky-corner-\'] .brand {border-left: solid 2px #ccc;}.proper-ad-unit[class*=\'sticky-corner-\'] .brand:after {background-position: 2px 0px;}.proper-ad-unit[class*=\'sticky-corner-\'] .close:after {border-radius: 6px 6px 0 0;border-right: solid 2px #ccc;}.proper-ad-unit[class*=\'sticky-corner-\'] .sticky-inner > div:last-of-type {padding: 4px;border: solid 2px #ccc;border-radius: 3px;}.slider_unit.slider_position_right > div:first-of-type > :not(div[data-outstream]) {right: 25px;left: unset;}.slider_unit.slider_position_right .close_button {right: 25px;left: unset;}.slider_unit.slider_position_left > div:first-of-type > :not(div[data-outstream]) {left: 25px;right: unset;}.slider_unit.slider_position_left .close_button {left: 314px;right: unset;}.slider_unit.slider_position_top > div:first-of-type > :not(div[data-outstream]) {top: 100px;bottom: unset;}.slider_unit.slider_position_top .close_button {top: 75px;bottom: unset;}.slider_unit.slider_position_bottom > div:first-of-type > :not(div[data-outstream]) {bottom: 100px;top: unset;}.slider_unit.slider_position_bottom .close_button {bottom: 350px;top: unset;}.slider_unit > div:first-of-type > :not(div[data-outstream]) {min-width: 300px;min-height: 250px;position: fixed;z-index: 10000;}@media only screen and (max-width: 480px) {.slider_unit > div:first-of-type > div > div[id=\'propervideo-super_outer_container\'] > div[id=\'propervideo-main_container\'] > div[class=\'propervideo-bottom_player\'] {zoom: var(--slider_mobile_adjustment_size);}}.slider_unit #close_button {display: none;}.slider_unit .close_button {position: fixed;z-index: 10000;color: #afafaf;font-size: 22px;display: block !important;}.slider_unit .close_button:hover {cursor: pointer;}.proper-flex-wrapper {text-align: center;width: 100%;margin-bottom: 20px;}.proper-flex-wrapper .proper-flex {text-align: center;display: inline-block;}.proper-flex-wrapper .proper-flex:first-of-type {margin-bottom: 20px;}.proper-flex-wrapper .proper-flex:empty {display: none;}";if(properOps.extra_css){css+=properOps.extra_css;}
if(properOps.slot_wrapper_class!=='proper-ad-unit'){css=css.replace(/proper-ad-unit/gi,properOps.slot_wrapper_class);}
if(style.styleSheet){style.styleSheet.cssText=css;}else{style.appendChild(document.createTextNode(css));}
document.getElementsByTagName('head')[0].appendChild(style);}
function checkProperDebugConsole(){if(typeof properPage.get_vars.proper_debug_console!=='undefined'||window.location.hash.includes('proper_debug_console')){debugObj.createDebugConsole();}else if(typeof properPage.get_vars.proper_debug_console!=='undefined'||window.location.hash.includes('proper_overlay')){debugObj.createDebugOverlays();}}
window.addEventListener('hashchange',checkProperDebugConsole,false);function checkKillAllAds(){if(properSpecialOps.kill_all_ads||properPage.dont_send_bids){properLog.mylog('Kill All Ads enabled! Good bye!');return true;}
return false;}
function bidderToAdapterName(bidder){var bidderAdapterName=bidder;if(ProperMedia.utils.deepAccess(properOps,'bidder_info.'+bidder+'.adapter_name')){bidderAdapterName=ProperMedia.utils.deepAccess(properOps,'bidder_info.'+bidder+'.adapter_name');}
return bidderAdapterName;}
function getBidderFloor(bidder,sizeList,s2s){try{if(properOps.testing_mode.enabled)return 0.01;var type=s2s?'s2s':'header';var device_type=properDevice.isMobile()?'mobile':'desktop';var bidder_floors=ProperMedia.utils.deepCopy(ProperMedia.utils.deepAccess(properOps,'bidders.'+type+'.'+bidder+'.floors.'+device_type)||{});var floors=ProperMedia.utils.deepCopy(properOps.floors[device_type]||{});var floor=bidder_floors.backup||floors.backup||0;var sizes=[];if(ProperMedia.utils.isStr(sizeList)){sizes=sizeList.split(',');}else if(ProperMedia.utils.isArray(sizeList)){sizes=sizeList;}
if(sizes.length>0){var floorList=new Array();for(var x=0;x<sizes.length;x++){var size_bid_avg=properSpecialOps.dynamicFloors||ProperMedia.utils.deepAccess(properOps,'dynamic_floors.'+device_type+'.enabled')?ProperMedia.utils.deepAccess(properSession,'sessionData.bid_avg.'+sizes[x])||0:0;if(bidder_floors.sizes&&bidder_floors.sizes[sizes[x]]){const temp_floor=Math.max(bidder_floors.sizes[sizes[x]],size_bid_avg);floorList.push(temp_floor);}else if(floors.sizes&&floors.sizes[sizes[x]]){const temp_floor=Math.max(floors.sizes[sizes[x]],size_bid_avg);floorList.push(temp_floor);}else if(size_bid_avg){floorList.push(size_bid_avg);}}
if(floorList.length>0){floor=Math.min.apply(null,floorList);}}
if(ProperMedia.utils.deepAccess(properOps,'bidder_info.'+bidder+'.rev_share')){floor=parseFloat((floor/ProperMedia.utils.deepAccess(properOps,'bidder_info.'+bidder+'.rev_share')).toFixed(2));}}catch(e){console.error(e);floor=bidder_floors.backup||floors.backup||0;sendError(TraceKit.computeStackTrace(e));}
return ProperMedia.utils.round(floor,2);}
function roundPriceToDfpBucket(price){if(properOps.thirdPartyAdManager){if(properOps.site_name=='reference'||properOps.site_name=='simpli'||properOps.site_name=='bloglines'||properOps.site_name=='informationvine'||properOps.site_name=='faqtoids'||properOps.site_name=='smarter'||properOps.site_name=='directhit'||properOps.site_name=='theanswerhub'||properOps.site_name=='top10answers'||properOps.site_name=='answerroot'||properOps.site_name=='allquestionsanswered'){if(price>40.0){price=40.0;}else{price=(Math.ceil(price*20)/20).toFixed(2);}}else{if(price>800.0){price=800.0;}else if(price>100){price=(Math.ceil(price/5)*5).toFixed(2);}else if(price>20){price=(Math.ceil(price*20)/20).toFixed(2);}else{price=price.toFixed(2);}}}else{if(price>800.0){price=800.0;}else if(price>100){price=Math.ceil(price).toFixed(2);}else{price=(Math.ceil(price*20)/20).toFixed(2);}}
return price;}
function round_floor(val){val=parseFloat(val);var device_type=properDevice.isMobile()?'mobile':'desktop';var floors=ProperMedia.utils.deepCopy(properOps.floors[device_type]||{});if(!val||val=='')val=floors.backup;else if(val<=0.1)val=0.1;else if(val<=0.25)val=0.25;else if(val<=0.4)val=0.4;else if(val<=2.0)val=(Math.ceil(val*4)/4).toFixed(2);else if(val<=5.0)val=(Math.ceil(val*2)/2).toFixed(2);else val=5.0;return ProperMedia.utils.round(val,2);}
function setDfpPageTargeting(googletagObj){if(typeof properPage.post_id=='undefined'||properPage.post_id==null||properPage.post_id=='')properPage.post_id='unknown';googletagObj.setTargeting('post_id',properPage.post_id.toString());if(typeof properOps.member=='undefined'||properOps.member==null||properOps.member=='')properOps.member='no';googletagObj.setTargeting('member',properOps.member.toString());googletagObj.setTargeting('category',ProperMedia.utils.deepAccess(properPage,'page_meta.category').toString());googletagObj.setTargeting('split_version',properOps.rtp_file_version.toString());googletagObj.setTargeting('proper_site',properOps.site_name.toString());googletagObj.setTargeting('proper_page',ProperMedia.utils.deepAccess(properPage,'spa_settings.page_number').toString());googletagObj.setTargeting('s_depth',ProperMedia.utils.deepAccess(properSession,'sessionData.depth').toString());if(properUser.checkAdBlockDetected()){googletagObj.setTargeting('adblock','true');}else if(googletagObj.getTargeting('adblock').length>0){googletagObj.clearTargeting('adblock');}
if(Object.keys(properPage.dfp_targeting).length){Object.keys(properPage.dfp_targeting).forEach(function(key){if(properPage.dfp_targeting[key]){googletagObj.clearTargeting(key);delete properPage.dfp_targeting[key];}});}
if(ProperMedia.utils.deepAccess(properPage,'page_meta.tags')&&properPage.page_meta.tags.length){googletagObj.setTargeting('tags',[properPage.page_meta.tags.toString()]);properPage.dfp_targeting['tags']=1;}
if(ProperMedia.utils.deepAccess(properPage,'page_meta.dfp_kv')&&Object.keys(properPage.page_meta.dfp_kv).length){Object.keys(properPage.page_meta.dfp_kv).forEach(function(key){var value=ProperMedia.utils.deepAccess(properPage,'page_meta.dfp_kv.'+key);if(typeof value!=='undefined'){if(ProperMedia.utils.isArray(value)){value=value.map(function(val){return val.toString();});}else{value=value.toString();}
googletagObj.setTargeting(key,value);properPage.dfp_targeting[key]=1;}});}
if(ProperMedia.utils.deepAccess(properPage,'page_meta.custom.set_as_kv_to_gam')&&Object.keys(properPage.page_meta.custom).length){Object.keys(properPage.page_meta.custom).forEach(function(key){if(key.match(/^dimension_([1-9]|10)$/)){var new_key='page_meta.custom.'+key;var value=ProperMedia.utils.deepAccess(properPage,new_key);if(value=='')return;googletagObj.setTargeting(key,value.toString());properPage.dfp_targeting[key]=1;}});}}
function proper_display(id){let slot_id=id||'';if(checkKillAllAds()){properLog.mylog('Kill All Ads enabled! Goodbye!');return false;}
if(typeof slot_id=='undefined'){try{const scriptTag=document.scripts[document.scripts.length-1];slot_id=scriptTag.parentNode.id;if(typeof scriptTag.parentNode=='undefined'||typeof slot_id=='undefined')return;slot_id=ProperMedia.utils.extractSlotName(slot_id);}catch(e){console.error(e);sendError(TraceKit.computeStackTrace(e));}
if(typeof slot_id=='undefined'||!slot_id){return false;}}
var slot_name=ProperMedia.utils.extractSlotName(slot_id);if(slot_name){var slot=properPage.buildSlot('display',slot_name);if(slot&&slot instanceof slotObj&&slot.slot_level_auction){properAdPool.sendAuction(true,[slot]);}}else{properLog.mylog("Couldn't find slot from id: "+slot_id);return false;}}
function showWinningAd(slot){if(!slot.getElement()){return false;}
var isEmpty=1;if(slot.hasWinningBid()){isEmpty=0;}else if(properOps.testing_mode.enabled==true){if(typeof slot.default_size=='undefined'||slot.default_size=='0x0'){return false;}
isEmpty=0;var test_ad=new adObj({bidder:'unfilled',size:slot.default_size.join('x'),adcode:'<div style="text-align:center;width:'+
slot.default_size[0]+
'px;height:'+
slot.default_size[1]+
'px;background:#ccc;color:#000;padding-top:10px;">-- no ad found --</div>',});slot.winning_ad=test_ad;}
if(isEmpty==0){proper_render(slot.getElement(),slot.number,1);}else{log_unfilled(slot);}
return true;}
function proper_render_isolated(doc,slot,winning_ad,render_size){doc.innerHTML='';var iframe=document.createElement('iframe');iframe.id=slot.properIframeId;iframe.frameBorder=0;iframe.scrolling='no';iframe.marginWidth='0';iframe.marginHeight='0';iframe.width=render_size[0];iframe.height=render_size[1];iframe.style.overflow='hidden';iframe.style.border='0px';iframe.style.verticalAlign='bottom';iframe.onload=function(){console.log('Proper isolated slotOnload: '+slot.name);if(properOps.testing_mode.enabled==true&&properOps.testing_mode.bidder=='unfilled'&&winning_ad.bidder=='unfilled'){slot.dispatchCustomEvent('proper-unfilled');}else{slot.dispatchCustomEvent('proper-ads-fired',{cpm:ProperMedia.utils.deepAccess(slot,'displayed_ad.price'),size:ProperMedia.utils.deepAccess(slot,'displayed_ad.size'),ad_type:ProperMedia.utils.deepAccess(slot,'displayed_ad.type'),});}};if(properOps.sandbox_iframe)iframe.sandbox=properOps.sandbox_options.join(' ')||'';iframe.src='javascript:"<!DOCTYPE html><html><body style=\'background:transparent\'></body></html>"';doc.appendChild(iframe);var html='<!DOCTYPE html><html><body>'+winning_ad.adcode+'</body></html>';if(ProperMedia.utils.deepAccess(properOps,'adlightning.enabled')||ProperMedia.utils.deepAccess(properSpecialOps,'adlightning.enabled')){adLightningWrapper.wrapTag(slot,iframe.contentWindow,ProperMedia.utils.mergeObject({},winning_ad,{adcode:html}));}else if(ProperMedia.utils.deepAccess(properOps,'geoedge.enabled')||ProperMedia.utils.deepAccess(properSpecialOps,'geoedge.enabled')){geoEdgeWrapper.wrapTag(slot,iframe.contentWindow.document,ProperMedia.utils.mergeObject({},winning_ad,{adcode:html}));}else if(ProperMedia.utils.deepAccess(properOps,'confiant.enabled')||ProperMedia.utils.deepAccess(properSpecialOps,'confiant.enabled')){confiantWrapper.wrapTag(slot,iframe.contentWindow.document,ProperMedia.utils.mergeObject({},winning_ad,{adcode:html}));}else{iframe.contentWindow.document.open();iframe.contentWindow.document.write(html);iframe.contentWindow.document.close();}
if(render_size[1]=='auto'){ProperMedia.utils.onElementHeightChange(iframe,function(newHeight){if(newHeight>0){iframe.style.height=newHeight+'px';}});}}
function proper_render_bidder_order(doc,slot,winning_ad,render_size){var iobj=window.top.document.getElementById(slot.properIframeId);if(iobj){iobj.style.width=formatCssSize(render_size[0]);iobj.style.height=formatCssSize(render_size[1]);}
if(doc.defaultView&&doc.defaultView.frameElement){var elementWidth=render_size[0],elementHeight=render_size[1];doc.defaultView.frameElement.width=elementWidth;doc.defaultView.frameElement.height=elementHeight;}
if(ProperMedia.utils.deepAccess(properOps,'geoedge.enabled')||ProperMedia.utils.deepAccess(properSpecialOps,'geoedge.enabled')){geoEdgeWrapper.wrapTag(slot,doc,winning_ad);}else if(ProperMedia.utils.deepAccess(properOps,'confiant.enabled')||ProperMedia.utils.deepAccess(properSpecialOps,'confiant.enabled')){confiantWrapper.wrapTag(slot,doc,winning_ad);}else{doc.write(winning_ad.adcode);}
if(render_size[1]=='auto'){if(iobj){var iobj2=iobj.contentWindow.document.getElementById(slot.dfpIframeId);if(iobj2){ProperMedia.utils.onElementHeightChange(iobj2,function(newHeight){if(newHeight>0){iobj2.style.height=newHeight+'px';iobj.style.height=newHeight+'px';}});}else{ProperMedia.utils.onElementHeightChange(iobj,function(newHeight){if(newHeight>0){iobj.style.height=newHeight+'px';}});}}else{iobj=window.top.document.getElementById(slot.dfpIframeId);if(iobj){ProperMedia.utils.onElementHeightChange(iobj,function(newHeight){if(newHeight>0){iobj.style.height=newHeight+'px';}});}}}}
function proper_render(doc,id,type,price){var slot=properPage.getSlotByNumber(id,['display']);if(!slot){properLog.mylog("Couldn't find slot with number: "+id);return false;}
if(slot.hasFlexSlot()){slot.removeFlexSlot();}
type=type||0;var render_size=[0,0];var winning_ad;var runner_up;if(type==2){if(slot.hasWinningAmazonBid()){winning_ad=slot.winning_amazon_ad;}else if(slot.getWinningAmazonBid()){winning_ad=slot.winning_amazon_ad;}
runner_up=(slot.winning_ad?.price??0)+(slot.flex_ad?.price??0);}else if(slot.getWinningBid()){winning_ad=slot.winning_ad;runner_up=slot.getRunnerUp();}
if((winning_ad&&winning_ad instanceof adObj)||(properOps.testing_mode.enabled&&winning_ad instanceof adObj)){slot.clearNonWinningBid(winning_ad);if(slot.flex_enabled&&slot.flex_map?.[winning_ad.size]&&slot.flex_map[winning_ad.size]>1){slot.addFlexSlot(winning_ad.size);}
if(slot.videoAdCheck()){slot.removeCreative();slot.dispalyVideoAd();}else{winning_ad.displayed=1;render_size=winning_ad.size.split('x');if(winning_ad.size=='1x1'||properOps.native_sizes[winning_ad.size]){render_size=['100%','auto'];}
if(ProperMedia.utils.deepAccess(bidAdapters,winning_ad.bid_adapter_name+'.bidderInfo.div_insertion')){winning_ad.adcode=winning_ad.adcode.replace(/{PROPER_SLOT_DIV_ID}/g,slot.div_id);}
if(winning_ad.type=='native'){buildNativeAdCode(slot,winning_ad);}
slot.removeCreative();if(type==1){proper_render_isolated(doc,slot,winning_ad,render_size);}else if(type==0||type==2){proper_render_bidder_order(doc,slot,winning_ad,render_size);}
winning_ad.onBidWon(slot);properLog.mylog('displayed! ('+slot.name+', bidder='+winning_ad.bidder+', size='+winning_ad.size+', price='+winning_ad.price+')');var auction_ms=ProperMedia.utils.getTimePassed(slot.auction_started_ts);var corrected_price=_0x59ab84(winning_ad.price,winning_ad.bid_adapter_name);var corrected_gross=_0x59ab84(winning_ad.gross,winning_ad.bid_adapter_name);var corrected_runner_up=_0x59ab84(runner_up,'sovrn_runner_up');var hem_data=userIds.getEmailHashes()||{};properSession.setSessionRevenue(winning_ad.price);properLog.saved_data[slot.name]={bidder:winning_ad.bidder,cpm:corrected_price,size:winning_ad.size,slot:slot.dfp_name,request_url:winning_ad.request_url,request_response:winning_ad.response,adcode:winning_ad.adcode,ad_details:winning_ad.ad_details,};ProperMedia.utils.deepSetValue(properLog,'bid_data.ad_slots.'+slot.name,{slot_name:ProperMedia.utils.validateValue(slot.dfp_name,{type:'string',max_len:50,}),bidder:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'bidder'),{type:'string',max_len:30,}),runner_up:corrected_runner_up,gross:corrected_gross,price:corrected_price,size:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'size'),{type:'string',max_len:10,}),refresh_cnt:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(slot,'refresh.count'),{type:'number',max:999,}),line_item_id:'',response_ms:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'response_ms'),{type:'number',max:999999,}),auction_duration:ProperMedia.utils.validateValue(auction_ms,{type:'number',max:999999}),precent_bids_ready:ProperMedia.utils.validateValue(100,{type:'number',max:100}),tag_id:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'tag_id'),{type:'string',max_len:50,}),adid:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'adid'),{type:'string',max_len:50,}),adomain:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'adomain.0'),{type:'string',max_len:50,}),cid:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'cid'),{type:'string',max_len:50,}),crid:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'crid'),{type:'string',max_len:50,}),dealid:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'dealid'),{type:'string',max_len:50,}),floor:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'floor'),{type:'number',max:999,max_len:15,}),publisher_demand:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'pub_demand'),{type:'boolean'}),fabrickId:ProperMedia.utils.validateValue((ProperMedia.utils.deepAccess(winning_ad,'uids')||[]).indexOf('fabrickId')!==-1,{type:'boolean'}),id5id:ProperMedia.utils.validateValue((ProperMedia.utils.deepAccess(winning_ad,'uids')||[]).indexOf('id5id')!==-1,{type:'boolean'}),idl_env:ProperMedia.utils.validateValue((ProperMedia.utils.deepAccess(winning_ad,'uids')||[]).indexOf('idl_env')!==-1,{type:'boolean'}),publinkId:ProperMedia.utils.validateValue((ProperMedia.utils.deepAccess(winning_ad,'uids')||[]).indexOf('publinkId')!==-1,{type:'boolean'}),'33acrossId':ProperMedia.utils.validateValue((ProperMedia.utils.deepAccess(winning_ad,'uids')||[]).indexOf('33acrossId')!==-1,{type:'boolean'}),connectid:ProperMedia.utils.validateValue((ProperMedia.utils.deepAccess(winning_ad,'uids')||[]).indexOf('connectid')!==-1,{type:'boolean'}),pubcid:ProperMedia.utils.validateValue((ProperMedia.utils.deepAccess(winning_ad,'uids')||[]).indexOf('pubcid')!==-1,{type:'boolean'}),hem_sha256:ProperMedia.utils.validateValue(!!ProperMedia.utils.deepAccess(hem_data,'sha256'),{type:'boolean'}),hem_sha1:ProperMedia.utils.validateValue(!!ProperMedia.utils.deepAccess(hem_data,'sha1'),{type:'boolean'}),hem_md5:ProperMedia.utils.validateValue(!!ProperMedia.utils.deepAccess(hem_data,'md5'),{type:'boolean'}),});slot.displayed_ad=new adObj(ProperMedia.utils.deepCopy(winning_ad));properAdPool.displayed_ads.push(ProperMedia.utils.deepCopy(slot.displayed_ad));proper_inview(0,slot.name,winning_ad.size,0,0,0);clearTimeout(properLog.tracker_timeout);properLog.tracker_timeout=null;properLog.tracker_timeout=properSetTimeout.setTimeout.call(properPage,function(){properLog.proper_tracker();},properLog.tracker_wait);}}else{log_unfilled(slot);}}
function proper_render_dfp_interstitial(slot){if(ProperMedia.utils.deepAccess(properLog,'interstitial_bid_data.'+slot.name)){ProperMedia.utils.deepSetValue(properLog,'bid_data.ad_slots.'+slot.name,ProperMedia.utils.deepAccess(properLog,'interstitial_bid_data.'+slot.name));clearTimeout(properLog.tracker_timeout);properLog.tracker_timeout=null;properLog.tracker_timeout=properSetTimeout.setTimeout.call(properPage,function(){properLog.proper_tracker();},properLog.tracker_wait);}}
function proper_render_dfp(slot_name,event){var slot=properPage.getSlotFromPageObject(slot_name,['display','interstitial']);if(!slot){return;}
if(slot.hasFlexSlot()){slot.removeFlexSlot();}
if(!slot.interstitial){slot.removeCreative();var iobj=window.top.document.getElementById(slot.properIframeId);if(iobj){iobj.style.width=formatCssSize(event.size[0]);iobj.style.height=formatCssSize(event.size[1]);}}
var creative_size=event.size[0]+'x'+event.size[1];if(slot.flex_enabled&&slot.flex_map?.[creative_size]&&slot.flex_map[creative_size]>1){properLog.mylog('Adding flex slot for '+slot.name+' - dfp ad: ('+creative_size+')');slot.addFlexSlot(creative_size);}
var tagId=event.advertiserId;var bidder='dfp';if(event.advertiserId==properOps.amazon_advertiser){bidder='a9';}else if(event.advertiserId==properOps.adsense_advertiser){bidder='adsense';}else if(event.advertiserId==properOps.google_advertiser||event.advertiserId==1||event.advertiserId==0||event.advertiserId==null||event.yieldGroupIds!=null){bidder='adx';}
slot.advertiserId=event.advertiserId;var cpm=0.0;if(bidder=='adx'||bidder=='adsense'){var floor_size=slot.interstitial?'interstitial':creative_size;var floor=slot.getFloor(floor_size);if(slot.dfp_bid_price&&parseFloat(slot.dfp_bid_price)>floor){cpm=parseFloat(slot.dfp_bid_price)+0.01;}else{cpm=parseFloat(floor)+0.01;}}
var bid_floor=Math.max(cpm-0.01,0);properLog.mylog('displayed! DFP ('+slot.name+', bidder='+bidder+', size='+creative_size+', price: '+cpm+')');var auction_ms=ProperMedia.utils.getTimePassed(slot.auction_started_ts);properSession.setSessionRevenue(cpm);const runner_up=(slot.winning_ad?.price??0)+(slot.flex_ad?.price??0);var bid_data={slot_name:ProperMedia.utils.validateValue(slot.dfp_name,{type:'string',max_len:50,}),bidder:ProperMedia.utils.validateValue(bidder,{type:'string',max_len:30}),price:ProperMedia.utils.validateValue(cpm,{type:'number',max:1000}),runner_up:ProperMedia.utils.validateValue(runner_up,{type:'number',max:1000}),gross:ProperMedia.utils.validateValue(cpm,{type:'number',max:1000}),size:ProperMedia.utils.validateValue(creative_size,{type:'string',max_len:10}),refresh_cnt:ProperMedia.utils.validateValue(slot.refresh.count,{type:'number',max:999}),line_item_id:ProperMedia.utils.validateValue(event.lineItemId,{type:'string',max_len:15}),response_ms:ProperMedia.utils.validateValue(auction_ms,{type:'number',max:999999}),auction_duration:ProperMedia.utils.validateValue(auction_ms,{type:'number',max:999999}),precent_bids_ready:ProperMedia.utils.validateValue(100,{type:'number',max:100}),tag_id:ProperMedia.utils.validateValue(tagId,{type:'string',max_len:50}),adid:ProperMedia.utils.validateValue(event.advertiserId,{type:'string',max_len:50}),adomain:ProperMedia.utils.validateValue('',{type:'string',max_len:50}),cid:ProperMedia.utils.validateValue(event.campaignId,{type:'string',max_len:50}),crid:ProperMedia.utils.validateValue(event.creativeId,{type:'string',max_len:50}),dealid:ProperMedia.utils.validateValue('',{type:'string',max_len:50}),floor:ProperMedia.utils.validateValue(bid_floor,{type:'number',max:1000}),publisher_demand:ProperMedia.utils.validateValue(!!properOps.remote_gam,{type:'boolean'}),};if(slot.interstitial){properLog.interstitial_bid_data[slot.name]=bid_data;}else{ProperMedia.utils.deepSetValue(properLog,'bid_data.ad_slots.'+slot.name,bid_data);}
slot.displayed_ad=new adObj({type:'display',price:cpm,gross:cpm,dfp_price:cpm,bidder:bidder,size:creative_size,adCode:'',tag_id:tagId,response_ms:auction_ms,displayed:1,adid:event.advertiserId,cid:event.campaignId,crid:event.creativeId,floor:floor,});properAdPool.displayed_ads.push(ProperMedia.utils.deepCopy(slot.displayed_ad));properLog.saved_data[slot.name]={bidder:bidder,cpm:cpm,size:creative_size,slot:slot.dfp_name,request_url:'',request_response:'',adcode:'',ad_details:{},};clearTimeout(properLog.tracker_timeout);properLog.tracker_timeout=null;properLog.tracker_timeout=properSetTimeout.setTimeout.call(properPage,function(){properLog.proper_tracker();},properLog.tracker_wait);}
function proper_inview(isEmpty,slot_name,size,bidder,creativeId,lineItemId,advertiserId){setTimeout(userSyncs.start,3000);var sticky_class=".ad-sticky[class*='"+slot_name+"']";var slot=properPage.getSlotFromPageObject(slot_name,['display']);if(slot){if(!isEmpty){slot.size=size;properLog.ad_info[slot.name]={creative_id:creativeId,line_item_id:lineItemId,size:size,};}
size=properOps.native_sizes[size]||size;if(slot.sticky){if(isEmpty){if(properSpecialOps.sliderHeader){slot.deleteSlot(true);}else if(slot.refresh.count==0){$(sticky_class).hide();}}else{slot.displayed=1;if(ProperMedia.utils.deepAccess(slot,'sticky_settings.freq_cap_enabled')&&slot.refresh.count==0){properUser.stickyFreqCapHandler.incrementStickyUnitImps();}
if(typeof slot.displayed_ad.bidder=='undefined'||slot.displayed_ad.displayed==0||(slot.displayed_ad.displayed==1&&typeof properOps.native_sizes[slot.displayed_ad.size]=='undefined')){$(sticky_class).removeClass('sticky-right');$(sticky_class).removeClass('sticky-left');$(sticky_class).removeClass('sticky-btm');$(sticky_class).removeClass('slider');$(sticky_class).removeClass('slider-with-video');$(sticky_class).removeClass('slider-with-static');var size_wh=size.split('x');var w=parseInt(size_wh[0]);var h=parseInt(size_wh[1]);if((w==300&&h==250)||(w==336&&h==280)){$(sticky_class).addClass('sticky-corner-'+slot.sticky_settings.position);}else if(w<h){$(sticky_class).addClass('sticky-'+slot.sticky_settings.position);}else{$(sticky_class).addClass('sticky-btm');}
if(properSpecialOps.sliderHeader){$(sticky_class).addClass('slider');if(slot.displayed_ad.type=='video'&&slot.displayed_ad.displayed==1){$(sticky_class).addClass('slider-with-video');$(sticky_class).attr('data-ad-height','110px');}else{$(sticky_class).addClass('slider-with-static');}}
if(size!=='1x1'){$(sticky_class+' .sticky-inner .inner-left').show();$(sticky_class+' .sticky-inner .inner-right').show();$(sticky_class).attr('style','height: '+h+'px');}else{$(sticky_class).hide();}
$(sticky_class+' .sticky-inner').attr('style','');if(!window.innerWidth||window.innerWidth<=720||window.innerWidth<=w-96){$(sticky_class).addClass('for-mobile');}}else if(slot.displayed_ad.bidder=='gumgum'||slot.displayed_ad.bidder=='gumgum_s2s'){$(sticky_class+' .sticky-inner .inner-left,.inner-right').hide();$(sticky_class).addClass('sticky-btm');$(sticky_class).obj.style.background='none';}else{$(sticky_class).hide();}}}else if(!isEmpty){if(slot.slider&&slot.slider_settings.close_button){$('.slider_unit #close_button').addClass('close_button');}
if(slot.min_width>1&&slot.min_height>1){const target=slot.flex_enabled||slot.is_flex_slot?slot.getFlexWrapper():'#'+CSS.escape(slot.div_id);$(target).obj.style.width='';$(target).obj.style.height='';$(target).obj.style.minWidth=slot.min_width+'px';$(target).obj.style.minHeight=slot.min_height+'px';}
if(ProperMedia.utils.deepAccess(slot,'advertisement_disclosure.enabled')&&!$('#'+CSS.escape(slot.div_id)).obj.parentNode.querySelector('.disclosure_box')){var disclosure_box=document.createElement('p');disclosure_box.setAttribute('class','disclosure_box');disclosure_box.innerHTML='Advertisement';if(ProperMedia.utils.deepAccess(slot,'advertisement_disclosure.location')=='above'){$('#'+CSS.escape(slot.div_id)).obj.closest('.proper-ad-unit').insertBefore(disclosure_box,$('#'+CSS.escape(slot.div_id)).obj);}else{$('#'+CSS.escape(slot.div_id)).obj.closest('.proper-ad-unit').append(disclosure_box);}}
slot.displayed=1;}
if(slot.displayed==1&&!isEmpty){slot.last_displayed_ts=ProperMedia.utils.getTimestampMs();slot.tracking_times.creative_on_page=ProperMedia.utils.getTimestampMs();if(ProperMedia.utils.deepAccess(slot,'displayed_ad.displayed')==1&&(ProperMedia.utils.deepAccess(properOps,'bidder_info.'+slot.displayed_ad.bidder+'.dont_refresh')==1||(ProperMedia.utils.deepAccess(properPage,'takeover.bidder')!=''&&ProperMedia.utils.deepAccess(slot,'displayed_ad.bidder')==ProperMedia.utils.deepAccess(properPage,'takeover.bidder'))||checkDisableDirectAdRefresh(slot.displayed_ad)||checkDisableCampaignAdRefresh(slot.displayed_ad))){slot.disableSlotRefresh();}
var eventType=slot.refresh.count==0?'displayed':'refreshed';}
if(slot.refresh.enabled==1&&slot.refresh.count<slot.refresh.max){slot.setRefreshInterval();}
if(debugObj.enabled==true){debugObj.addSlotOverlay(slot);}
slot.clearWinningBid();slot.clearWinningAmazonBid();}}
function checkDisableDirectAdRefresh(displayed_ad){return!!(displayed_ad.adid&&displayed_ad.bidder=='dfp'&&((properSpecialOps.disableRefreshByAdvertiserId&&properSpecialOps.disableRefreshByAdvertiserId.indexOf(displayed_ad.adid)!==-1)||(properOps.disableRefreshByAdvertiserId&&properOps.disableRefreshByAdvertiserId.indexOf(displayed_ad.adid)!==-1)));}
function checkDisableCampaignAdRefresh(displayed_ad){return!!(displayed_ad.cid&&displayed_ad.bidder=='dfp'&&((properSpecialOps.disableRefreshByCampaignId&&properSpecialOps.disableRefreshByCampaignId.indexOf(displayed_ad.cid)!==-1)||(properOps.disableRefreshByCampaignId&&properOps.disableRefreshByCampaignId.indexOf(displayed_ad.cid)!==-1)));}
function log_unfilled(slot){proper_inview(1,slot.name,'0x0',0,0,0);if(slot.type=='display'&&slot.refresh.count>0)return;var auction_ms=ProperMedia.utils.getTimePassed(slot.auction_started_ts);var floor=slot.getFloor();var hem_data=userIds.getEmailHashes()||{};ProperMedia.utils.deepSetValue(properLog,'bid_data.ad_slots.'+slot.name,{slot_name:ProperMedia.utils.validateValue(slot.dfp_name,{type:'string',max_len:50}),bidder:'unfilled',price:0,gross:0,size:ProperMedia.utils.validateValue(slot.default_size,{type:'string',max_len:10}),refresh_cnt:ProperMedia.utils.validateValue(slot.refresh.count,{type:'number',max:999}),line_item_id:'',response_ms:ProperMedia.utils.validateValue(auction_ms,{type:'number',max:999999}),auction_duration:ProperMedia.utils.validateValue(auction_ms,{type:'number',max:999999}),precent_bids_ready:ProperMedia.utils.validateValue(100,{type:'number',max:100}),tag_id:'',adid:'',adomain:'',cid:'',crid:'',dealid:'',floor:ProperMedia.utils.validateValue(floor,{type:'number',max:1000}),publisher_demand:ProperMedia.utils.validateValue(false,{type:'boolean'}),hem_sha256:ProperMedia.utils.validateValue(!!ProperMedia.utils.deepAccess(hem_data,'sha256'),{type:'boolean'}),hem_sha1:ProperMedia.utils.validateValue(!!ProperMedia.utils.deepAccess(hem_data,'sha1'),{type:'boolean'}),hem_md5:ProperMedia.utils.validateValue(!!ProperMedia.utils.deepAccess(hem_data,'md5'),{type:'boolean'}),});slot.displayed_ad=new adObj({price:0,gross:0,dfp_price:0,bidder:'unfilled',size:slot.default_size.join('x'),adCode:'',tag_id:'',response_ms:auction_ms,floor:floor,});properAdPool.displayed_ads.push(ProperMedia.utils.deepCopy(slot.displayed_ad));slot.dispatchCustomEvent('proper-unfilled');clearTimeout(properLog.tracker_timeout);properLog.tracker_timeout=null;properLog.tracker_timeout=properSetTimeout.setTimeout.call(properPage,function(){properLog.proper_tracker();},properLog.tracker_wait);}
function proper_debug_console(){debugObj.createDebugConsole();}
function proper_debug_overlay(){debugObj.createDebugOverlays();}
function formatCssSize(size){return typeof size=='string'&&(size.indexOf('%')!==-1||size=='auto')?size:size+'px';}
function getReportAdInfo(obj){var retData={};if(typeof obj.site_name!=='undefined'&&obj.site_name==1){retData.site_name=properOps.site_name;}
if(typeof obj.split_version!=='undefined'&&obj.rtp_file_version==1){retData.split_version=properOps.rtp_file_version;}
if(typeof obj.slot_id!=='undefined'){var slot_name=ProperMedia.utils.extractSlotName(obj.slot_id);if(properLog.autoplay_html[obj.slot_id]){retData.autoplay_html=properLog.autoplay_html[obj.slot_id];}
if(typeof properLog.log_lines!=='undefined'){retData.log_lines=properLog.log_lines;}
if(typeof properLog.saved_data[slot_name]!=='undefined'){retData.saved_data=properLog.saved_data[slot_name];}
if(typeof properLog.ad_info[slot_name]!=='undefined'){retData.ad_info=properLog.ad_info[slot_name];}}
return retData;}
function logMatchingResponse(bidder,proper_uid,bidder_uid){cookieMatching.logMatchingResponse(bidder,proper_uid,bidder_uid);}
function getAdSlots(){return Object.keys(properPage.slots['display']).concat(properPage.slots['video']);}
function refreshSlotByName(slot_name){var slot=properPage.getSlotFromPageObject(slot_name,['display']);if(slot){slot.removeRefreshTimeout();slot.refreshSlot(true);return true;}
return false;}
function disableSlotRefresh(slot_name){var slot=properPage.getSlotFromPageObject(slot_name,['display']);if(slot){slot.disableSlotRefresh();return true;}
return false;}
function spaNewPage(){propertag.cmd.push(function(){properPage.SpaNextPage();});}
function spaNewSection(ignore_ids){propertag.cmd.push(function(){properLog.mylog('========== New SPA Section ==========');properPage.init_slots_build=0;properPage.rebuildSlots(ignore_ids);properAdPool.startNewAuction();});}
function spaNewPageReset(){propertag.cmd.push(function(){properLog.mylog('========== New SPA Page With Dyanmic Reset ==========');properPage.deleteDynamicSlots();properPage.resetDynamicSlotInstanceCount();properPage.SpaNextPage();});}
function newPageView(){propertag.cmd.push(function(){properLog.mylog('========== New Pageview ==========');properPage.newPageView();});}
function infScrollNewPage(){propertag.cmd.push(function(){properPage.InfScrollNextPage();});}
function buildSlots(){propertag.cmd.push(function(){properLog.mylog('Build slots called');properPage.buildSlots();});}
function deleteSlot(slot_name){var slot=properPage.getSlotFromPageObject(slot_name,['display']);if(slot){slot.deleteSlot(true);return true;}
return false;}
function destroyDfpSlot(slot_name){var slot=properPage.getSlotFromPageObject(slot_name,['display']);if(slot){slot.destroyDfpSlot();return true;}
return false;}
function closeSliderSlot(slot_name){var slot=properPage.getSlotFromPageObject(slot_name,['display']);if(slot){slot.closeSliderSlot();return true;}
return false;}
function getVideoPlayerOps(slot_name){var slot=properPage.getSlotFromPageObject(slot_name);if(slot&&slot.video_player instanceof videoPlayer){return slot.video_player.player_settings||{};}
return{};}
function createVideoSlot(slot_name){try{properLog.mylog('Create video slot for: '+slot_name);properPage.video_enabled=true;propertag.cmd.push(function(){var slot=properPage.getSlotFromPageObject(slot_name,['video'])?properPage.getSlotFromPageObject(slot_name,['video']):properPage.buildSlot('video',slot_name);if(properAdPool.vid_auction_count==0){properAdPool.startNewVideoAuction(slot.video_player.player_settings.video_type,[slot]);}});return true;}catch(e){return false;}}
function runVideoAuction(slot_name){propertag.cmd.push(function(){var slot=properPage.getSlotFromPageObject(slot_name);if(slot&&slot.video_player instanceof videoPlayer){properAdPool.startNewVideoAuction(slot.video_player.player_settings.video_type);return true;}else{return false;}});}
function runNewAuction(){propertag.cmd.push(function(){properAdPool.auction_refresh=true;properAdPool.startNewAuction(true);return true;});}
function disableAuctionRefresh(){propertag.cmd.push(function(){properLog.mylog('AdPool: Disable Auction Refresh');properAdPool.auction_refresh=false;properAdPool.clearNextAuctionTimeout();return true;});}
function getVideoAd(slot_name){var slot=properPage.getSlotFromPageObject(slot_name);if(slot&&slot.video_player instanceof videoPlayer){var video_type=slot.video_player.player_settings.video_type;var auciton_times=properAdPool.getTimeLeftOnRunningAuctions();var auction_finished=!!(properAdPool.auction_count>0&&auciton_times.length==0);var auction_time_remaining=!auction_finished&&auciton_times.length>0?Math.min(auciton_times):0;slot.getWinningBid(['video'],video_type);slot.getWinningAmazonBid(['video'],video_type);if(slot.hasWinningBid()||slot.hasWinningAmazonBid()){var winning_ad=_0x432f92(slot);slot.clearNonWinningBid(winning_ad);var winning_ad_copy=ProperMedia.utils.deepCopy(winning_ad);slot.tracking_times.dfp_sent_ts=ProperMedia.utils.getTimestampMs();return{auction:{finished:auction_finished,time_remaining:auction_time_remaining,},ad:winning_ad_copy,};}else if(slot.type=='video'){slot.tracking_times.dfp_sent_ts=ProperMedia.utils.getTimestampMs();return{auction:{finished:auction_finished,time_remaining:auction_time_remaining,},ad:{price:slot.getFloor('dfp_floor'),bidder:'dfp_floor',vast_tag:'',vast_type:'',vpaid:'',video_type:video_type,ad_details:'',},};}else if(slot.displayed!==1&&slot.type=='display'&&auction_finished){var slot_settings=ProperMedia.utils.deepAccess(properOps,'ad_slots'+'.'+slot.type+'.'+slot.name)||{};slot.video_player.removePlayer();slot.setRefresh(slot_settings);slot.getWinningBid(['display','native']);slot.getWinningAmazonBid(['display','native']);showWinningAd(slot);}}
return false;}
function destroyVideoPlayer(slot_name){var slot=properPage.getSlotFromPageObject(slot_name);if(slot&&slot.video_player instanceof videoPlayer){slot.video_player.destroyVideoPlayer();}}
function logOutstreamAdSuccess(slot_name,winning_ad){var slot=properPage.getSlotFromPageObject(slot_name);if(slot&&slot.video_player instanceof videoPlayer&&ProperMedia.utils.isPlainObject(winning_ad)&&winning_ad.id&&winning_ad.bidder&&winning_ad.price){if(slot.hasWinningAmazonBid()){if(slot.winning_amazon_ad.id==winning_ad.id){winning_ad=slot.winning_amazon_ad;}else{slot.clearWinningAmazonBid();}}else if(slot.hasWinningBid()){if(slot.winning_ad.id==winning_ad.id){winning_ad=slot.winning_ad;}else{slot.clearWinningBid();}}
var corrected_price=_0x59ab84(winning_ad.price,winning_ad.bid_adapter_name);var corrected_gross=_0x59ab84(winning_ad.gross,winning_ad.bid_adapter_name);var corrected_runner_up=_0x59ab84(slot.getRunnerUp(),'sovrn_runner_up');var hem_data=userIds.getEmailHashes()||{};var auction_ms=ProperMedia.utils.getTimePassed(slot.auction_started_ts);var video_ad={slot_name:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(slot,'dfp_name'),{type:'string',max_len:50,}),bidder:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'bidder'),{type:'string',max_len:30,}),gross:corrected_gross,price:corrected_price,runner_up:corrected_runner_up,size:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'size'),{type:'string',max_len:10,}),refresh_cnt:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(slot,'refresh.count'),{type:'number',max:999,}),line_item_id:'',response_ms:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'response_ms'),{type:'number',max:999999,}),auction_duration:ProperMedia.utils.validateValue(auction_ms,{type:'number',max:999999}),precent_bids_ready:ProperMedia.utils.validateValue(100,{type:'number',max:100}),tag_id:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'tag_id'),{type:'string',max_len:50,}),adid:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'adid'),{type:'string',max_len:50,}),adomain:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'adomain.0'),{type:'string',max_len:50,}),cid:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'cid'),{type:'string',max_len:50,}),crid:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'crid'),{type:'string',max_len:50,}),dealid:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'dealid'),{type:'string',max_len:50,}),floor:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'floor'),{type:'number',max:999,max_len:15,}),publisher_demand:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'pub_demand'),{type:'boolean'}),fabrickId:ProperMedia.utils.validateValue((ProperMedia.utils.deepAccess(winning_ad,'uids')||[]).indexOf('fabrickId')!==-1,{type:'boolean'}),id5id:ProperMedia.utils.validateValue((ProperMedia.utils.deepAccess(winning_ad,'uids')||[]).indexOf('id5id')!==-1,{type:'boolean'}),idl_env:ProperMedia.utils.validateValue((ProperMedia.utils.deepAccess(winning_ad,'uids')||[]).indexOf('idl_env')!==-1,{type:'boolean'}),publinkId:ProperMedia.utils.validateValue((ProperMedia.utils.deepAccess(winning_ad,'uids')||[]).indexOf('publinkId')!==-1,{type:'boolean'}),'33acrossId':ProperMedia.utils.validateValue((ProperMedia.utils.deepAccess(winning_ad,'uids')||[]).indexOf('33acrossId')!==-1,{type:'boolean'}),connectid:ProperMedia.utils.validateValue((ProperMedia.utils.deepAccess(winning_ad,'uids')||[]).indexOf('connectid')!==-1,{type:'boolean'}),pubcid:ProperMedia.utils.validateValue((ProperMedia.utils.deepAccess(winning_ad,'uids')||[]).indexOf('pubcid')!==-1,{type:'boolean'}),hem_sha256:ProperMedia.utils.validateValue(!!ProperMedia.utils.deepAccess(hem_data,'sha256'),{type:'boolean'}),hem_sha1:ProperMedia.utils.validateValue(!!ProperMedia.utils.deepAccess(hem_data,'sha1'),{type:'boolean'}),hem_md5:ProperMedia.utils.validateValue(!!ProperMedia.utils.deepAccess(hem_data,'md5'),{type:'boolean'}),};winning_ad.displayed=1;slot.size=winning_ad.size;slot.displayed_ad=new adObj(ProperMedia.utils.deepCopy(winning_ad));winning_ad.onBidWon(slot);slot.displayed=1;slot.refresh.count++;slot.last_displayed_ts=ProperMedia.utils.getTimestampMs();slot.tracking_times.dfp_returned_ts=ProperMedia.utils.getTimestampMs();slot.tracking_times.creative_on_page=ProperMedia.utils.getTimestampMs();slot.dispatchCustomEvent('video-ad-played');slot.dispatchCustomEvent('proper-ads-fired',{cpm:video_ad.price,size:video_ad.size,ad_type:ProperMedia.utils.deepAccess(slot,'displayed_ad.video_type'),});properSession.setSessionRevenue(video_ad.price);properAdPool.displayed_ads.push(ProperMedia.utils.deepCopy(slot.displayed_ad));ProperMedia.utils.deepSetValue(properLog,'bid_data.ad_slots.'+slot.dfp_name,video_ad);if(slot.sticky){proper_inview(0,slot.name,winning_ad.size,winning_ad.crid,0,winning_ad.adid);}
clearTimeout(properLog.tracker_timeout);properLog.tracker_timeout=null;properLog.tracker_timeout=properSetTimeout.setTimeout.call(properPage,function(){properLog.proper_tracker();},properLog.tracker_wait);properLog.mylog('displayed! ('+slot.name+', bidder='+video_ad.bidder+', size='+video_ad.size+', price='+video_ad.price+')');}
return true;}
function logVideoAdSuccess(slot_name,dfp_won,winning_ad){var slot=properPage.getSlotFromPageObject(slot_name);if(slot&&slot.video_player instanceof videoPlayer){var auction_ms=ProperMedia.utils.getTimePassed(slot.auction_started_ts);var size=properDevice.isMobile()?'640x480':'400x300';var video_ad=null;if(dfp_won){var bidder='dfp_video';var cpm=parseFloat(dfp_won)+0.01;const corrected_runner_up=_0x59ab84(slot.winning_ad?.price,slot.winning_ad?.bid_adapter_name);video_ad={slot_name:ProperMedia.utils.validateValue(slot.dfp_name,{type:'string',max_len:50}),bidder:ProperMedia.utils.validateValue(bidder,{type:'string',max_len:30}),gross:ProperMedia.utils.validateValue(cpm,{type:'number',max:999,max_len:15}),price:ProperMedia.utils.validateValue(cpm,{type:'number',max:999,max_len:15}),runner_up:corrected_runner_up,size:ProperMedia.utils.validateValue(size,{type:'string',max_len:10}),refresh_cnt:ProperMedia.utils.validateValue(slot.refresh.count,{type:'number',max:999}),line_item_id:'',response_ms:ProperMedia.utils.validateValue(auction_ms,{type:'number',max:999999}),auction_duration:ProperMedia.utils.validateValue(auction_ms,{type:'number',max:999999}),precent_bids_ready:ProperMedia.utils.validateValue(100,{type:'number',max:100}),tag_id:ProperMedia.utils.validateValue('',{type:'string',max_len:50}),floor:ProperMedia.utils.validateValue(dfp_won,{type:'number',max:999,max_len:15}),publisher_demand:ProperMedia.utils.validateValue(!!properOps.remote_gam,{type:'boolean'}),};slot.displayed_ad=new adObj({type:'video',price:cpm,gross:cpm,dfp_price:cpm,bidder:bidder,size:size,adCode:'',tag_id:'',response_ms:auction_ms,displayed:1,video_type:slot.video_type,floor:dfp_won,});slot.clearWinningBid();}else if(slot&&slot.video_player instanceof videoPlayer&&ProperMedia.utils.isPlainObject(winning_ad)&&winning_ad.id&&winning_ad.bidder&&winning_ad.price){if(slot.hasWinningAmazonBid()){if(slot.winning_amazon_ad.id==winning_ad.id){winning_ad=slot.winning_amazon_ad;}else{slot.clearWinningAmazonBid();}}else if(slot.hasWinningBid()){if(slot.winning_ad.id==winning_ad.id){winning_ad=slot.winning_ad;}else{slot.clearWinningBid();}}
var corrected_price=_0x59ab84(winning_ad.price,winning_ad.bid_adapter_name);var corrected_gross=_0x59ab84(winning_ad.gross,winning_ad.bid_adapter_name);var corrected_runner_up=_0x59ab84(slot.getRunnerUp(),'sovrn_runner_up');var hem_data=userIds.getEmailHashes()||{};video_ad={slot_name:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(slot,'dfp_name'),{type:'string',max_len:50,}),bidder:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'bidder'),{type:'string',max_len:30,}),gross:corrected_gross,price:corrected_price,runner_up:corrected_runner_up,size:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'size'),{type:'string',max_len:10,}),refresh_cnt:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(slot,'refresh.count'),{type:'number',max:999,}),line_item_id:'',response_ms:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'response_ms'),{type:'number',max:999999,}),auction_duration:ProperMedia.utils.validateValue(auction_ms,{type:'number',max:999999}),precent_bids_ready:ProperMedia.utils.validateValue(100,{type:'number',max:100}),tag_id:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'tag_id'),{type:'string',max_len:50,}),adid:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'adid'),{type:'string',max_len:50,}),adomain:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'adomain.0'),{type:'string',max_len:50,}),cid:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'cid'),{type:'string',max_len:50,}),crid:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'crid'),{type:'string',max_len:50,}),dealid:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'dealid'),{type:'string',max_len:50,}),floor:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'floor'),{type:'number',max:999,max_len:15,}),publisher_demand:ProperMedia.utils.validateValue(ProperMedia.utils.deepAccess(winning_ad,'pub_demand'),{type:'boolean'}),fabrickId:ProperMedia.utils.validateValue((ProperMedia.utils.deepAccess(winning_ad,'uids')||[]).indexOf('fabrickId')!==-1,{type:'boolean'}),id5id:ProperMedia.utils.validateValue((ProperMedia.utils.deepAccess(winning_ad,'uids')||[]).indexOf('id5id')!==-1,{type:'boolean'}),idl_env:ProperMedia.utils.validateValue((ProperMedia.utils.deepAccess(winning_ad,'uids')||[]).indexOf('idl_env')!==-1,{type:'boolean'}),publinkId:ProperMedia.utils.validateValue((ProperMedia.utils.deepAccess(winning_ad,'uids')||[]).indexOf('publinkId')!==-1,{type:'boolean'}),'33acrossId':ProperMedia.utils.validateValue((ProperMedia.utils.deepAccess(winning_ad,'uids')||[]).indexOf('33acrossId')!==-1,{type:'boolean'}),connectid:ProperMedia.utils.validateValue((ProperMedia.utils.deepAccess(winning_ad,'uids')||[]).indexOf('connectid')!==-1,{type:'boolean'}),pubcid:ProperMedia.utils.validateValue((ProperMedia.utils.deepAccess(winning_ad,'uids')||[]).indexOf('pubcid')!==-1,{type:'boolean'}),hem_sha256:ProperMedia.utils.validateValue(!!userIds.getEmailHashes(),{type:'boolean'}),hem_sha1:ProperMedia.utils.validateValue(!!userIds.getEmailHashes(),{type:'boolean'}),hem_md5:ProperMedia.utils.validateValue(!!userIds.getEmailHashes(),{type:'boolean'}),};winning_ad.displayed=1;slot.size=winning_ad.size;slot.displayed_ad=new adObj(ProperMedia.utils.deepCopy(winning_ad));winning_ad.onBidWon(slot);}
if(video_ad){slot.displayed=1;slot.refresh.count++;slot.last_displayed_ts=ProperMedia.utils.getTimestampMs();slot.tracking_times.dfp_returned_ts=ProperMedia.utils.getTimestampMs();slot.tracking_times.creative_on_page=ProperMedia.utils.getTimestampMs();slot.dispatchCustomEvent('video-ad-played');slot.dispatchCustomEvent('proper-ads-fired',{cpm:video_ad.price,size:video_ad.size,ad_type:ProperMedia.utils.deepAccess(slot,'displayed_ad.video_type'),});properSession.setSessionRevenue(video_ad.price);properAdPool.displayed_ads.push(ProperMedia.utils.deepCopy(slot.displayed_ad));ProperMedia.utils.deepSetValue(properLog,'bid_data.ad_slots.'+slot.dfp_name,video_ad);clearTimeout(properLog.tracker_timeout);properLog.tracker_timeout=null;properLog.tracker_timeout=properSetTimeout.setTimeout.call(properPage,function(){properLog.proper_tracker();},properLog.tracker_wait);properLog.mylog('displayed! ('+slot.name+', bidder='+video_ad.bidder+', size='+video_ad.size+', price='+video_ad.price+')');}}
return true;}
function logVideoUnfilled(slot_name){var slot=properPage.getSlotFromPageObject(slot_name);if(slot){log_unfilled(slot);}}
function logVideoAdError(slot_name,error_obj,max_fails_reached){var error=new Error(JSON.stringify(error_obj.msg));error.bidder=error_obj.bidder;if(error_obj.stack){error.stack=error_obj.stack;}
error.event_type='video_exception';sendError(error);var slot=properPage.getSlotFromPageObject(slot_name);if(slot){if(slot.hasWinningBid()&&error_obj.bidder!=='dfp'){delete slot.winning_ad;slot.winning_ad={};}
if(slot.hasWinningAmazonBid()&&error_obj.bidder!=='dfp'){delete slot.winning_amazon_ad;slot.winning_amazon_ad={};}
if(max_fails_reached===true&&slot.type=='display'){var slot_settings=ProperMedia.utils.deepAccess(properOps,'ad_slots'+'.'+slot.type+'.'+slot.name)||{};slot.setRefresh(slot_settings);slot.refreshSlot();}}}
function proper_remnant(doc,id){var slot=properPage.getSlotByNumber(id,['display']);if(!slot){properLog.mylog("Couldn't find slot with number: "+id);return false;}
proper_render(doc,id,0);return;}
function runATS(email){if(userIdAdapters.identityLink){userIdAdapters.identityLink.runATS(email);}}
function publisherAudiencesOptOut(optOut){if(ProperMedia.utils.deepAccess(bidAdapters,'a9.updateOptOut')){bidAdapters.a9.updateOptOut(optOut);}}
function testRps(rps){try{if(!rps||!parseFloat(rps))return;ProperMedia.utils.deepSetValue(properSession,'sessionData.last_threshold',parseFloat(rps-0.01));ProperMedia.utils.deepSetValue(properSession,'sessionData.revenue',0.001);properSession.setSessionRevenue(rps*1000);if(ProperMedia.utils.isFn(audiencePixels.controller.checkThresholds)){audiencePixels.controller.checkThresholds();}}catch(e){}}
function refreshAuctionAndSlotsByName(arrayOfSlotNames){try{if(ProperMedia.utils.isArray(arrayOfSlotNames)&&arrayOfSlotNames.length>0)properAdPool.size_override=arrayOfSlotNames;runNewAuction();arrayOfSlotNames.forEach(function(slotName){refreshSlotByName(slotName);});}catch(e){}}
function getUserIdsAsEids(){return ProperMedia.utils.deepCopy(userIds.getEidsArray());}
var _0x31ef75=_0x1cff;(function(_0x5d5dfd,_0xc353bc){var _0x183cf9=_0x1cff,_0x4a7b90=_0x5d5dfd();while(!![]){try{var _0x54e36a=-parseInt(_0x183cf9(0xa7))/0x1+-parseInt(_0x183cf9(0xc9))/0x2+-parseInt(_0x183cf9(0xb8))/0x3*(parseInt(_0x183cf9(0xdb))/0x4)+parseInt(_0x183cf9(0xb9))/0x5*(parseInt(_0x183cf9(0xcc))/0x6)+-parseInt(_0x183cf9(0xb6))/0x7*(parseInt(_0x183cf9(0xb1))/0x8)+-parseInt(_0x183cf9(0xc7))/0x9*(-parseInt(_0x183cf9(0xd6))/0xa)+parseInt(_0x183cf9(0xba))/0xb;if(_0x54e36a===_0xc353bc)
break;else
_0x4a7b90['push'](_0x4a7b90['shift']());}catch(_0x19655a){_0x4a7b90['push'](_0x4a7b90['shift']());}}}(_0x377e,0x3f16a));function _0x377e(){var _0x4c6863=['isStr','_0x4c1310','12dolzDy','safeJsonParse','undefined','WyIxdTc2MjlzIiwiY3hjMHNnIiwiMWNmdzFzMCIsImxzejExYyIsIjFsYmoyMHciLCI0MXAwamsiLCIxM2s5MWo0IiwiejRmamVvIiwiMXltemtlOCIsImpyVUdMSmwiLCJHaGRUMDFIIiwidXpITXFIWCIsIkRVbXNEaDIiLCJ2UkhuYzdEIiwiY1VDYWJmdSIsIklaSE8zMTkiLCIxSzA5bVQ0IiwiRnduYWdnNCIsIlFTYWNyV0kiLCJGZVpPQVFjIiwiUnI1UDhMZSIsIkZjRHpENjQiLCJQYTdaRkdxIiwiREkwbkVMTSIsIjR2bTFiZmwiLCJIaEIwNTZxIiwiaG9jZ2tqZiIsIm9WcVRmTXEiLCJFMDQ0WHg5IiwiWDJtc3VnQyIsIjYxVkhzNDIiLCJJU0JQbHJaIiwicDZISGQ1cSIsInhodmhMaTMiLCJZZ0FUTzFuIiwiMWliY2RuOSIsIkdxZGFuSXoiLCJUYUQ2WEFNIiwib0E4VUtJNyIsInRoaVp4SXIiLCI0T3ViTzJIIiwiVTVPMnZRVCIsIkVwMXFPTU0iLCJHQlgwYW5ZIiwiTTR2RVlXaCIsIkpvaE51OFgiLCJNRTdZejAzIiwicHJwZWd4VCIsImVzZmhocDAiLCI3T3J2VTBsIiwiSE1tc3dVdyIsInFDQ2NVR3oiLCJFNGpERlZXIiwiemZ6aWc1ZSIsIm9EZUIwZ2EiLCJCbXhuNEtqIiwiTVR1NmFTaSIsInF3VW9xeE8iLCJ3dG56U2dQIiwicTdxRWl5biIsIkhoeW1hT1ciLCJFNU03dE9DIiwiMlJBVzdKNSIsIlVUdFFiWEQiLCJ2SDJQMU9BIiwiTjhydGN6dyIsIlFGSG1OSngiLCJMNUJEYjlOIiwiOVBuNmd5USIsIkZZQThIeUsiLCJUODJZdVRLIiwiT3czWTd2NyIsIno2UFJGUTkiLCJQMlpJYWVMIiwiZ1FoUWljMyIsIjFBYlo1WEMiLCJEY3R3TjFDIiwiSXc1cDZsVSIsIjV1OWVKTE0iLCI4VzhjNTVjIiwiSlQ1NWNkeCIsIlYyM3lYS1oiLCJxVWhCa0FkIiwiWmhoQ1VFWSIsImZvaXpnaDEiLCJXckVJenFXIiwiNkpNcElTZCIsIjZOczBvQkkiLCJrMGdZVmdaIiwiOGl2c3RlYyIsIldDem1QcFEiLCJkeU4yTkllIiwid1l0WXYyMyIsInl5dlpSRE4iLCJTODY1SXZWIiwidnJNTnd6TCIsIktsZm4xdnciLCJTQWNiQ1NBIiwieEZHaERIZSIsInFDNVFiUHciLCJNUkhaQXZpIiwiWHllQjMybiIsInpldEtpRWUiLCJRSWNBWlRQIiwiTDBldEF3SiIsImV4cXJiZlkiLCJGR2xubFB4IiwiaTl1YzlLYSIsImd3d05qSTQiLCJtWmVyZ3hzIiwiNHJSWG0zTCIsIncwM3pNaU8iLCJSUk5SWU84IiwickxKWjJDTCIsIlNYOWExek4iLCJ2TWdEMmpJIiwicnpSd2lFMiIsInB1R3pUdEwiLCJONzJUYVZCIiwiaGo5TFg4RCIsIjlPb25sazEiLCJMR0NlTEZoIiwiV0lEYzI0cyIsIkxCbjF1d1IiLCJtUjVMejVmIiwiSjVtcEs2MyIsIlhUUDhFYjYiLCJ3dndTN2Y3IiwiNVpVaEZhOSIsIlBiM29OSGciLCJPenlocVNWIiwiRGhXTFBieCIsIm8zZzBXSHMiLCJxUzI3THhHIiwiYlFBeTFWTCIsIkxlUWpEWHYiLCJiUFBiUnlZIiwiYWdsSm5UdyIsIkFyTVhraE8iLCJTNGZuOXpkIiwiUFNkZExubyIsIkxJeU5icXUiLCJwbDlLd3VZIiwiV0dLUGhNVCIsIlpwajJrc2UiLCJjMHhUV2VEIiwiSnhyZHNKRSIsImZtTmZvS3QiLCJNenNpVWUwIiwiRGh3N0l1ZyIsImNkajkzcTciLCI5MFdncjJsIiwiSkhoRll3eCIsIjJjMFllWUoiLCJISDF4Y29iIiwidFNqTHltMCIsInVtSE04dDgiLCJIenpXUElRIiwid0RiUDF2MCIsIkE4TlFJUWoiLCJzREdhYUU3IiwiU3pUOFB0YyIsInc5WWZCMUwiLCI4cXliMkhSIiwiZEZKWlB6dSIsInBsUGZhQnMiLCJuUHREdEpjIiwiODZ1OWQ0UiIsIk04WGgxT2EiLCJSTm5XTmJNIiwiQU5KQ1RScyIsIkdzdUY4QzkiLCJkOHFmQXZFIiwiU2F0OVA5biIsIk5Namp0ZlMiLCJlczRHYTVYIiwiRVV5Z1NmOSIsIjZrM2RkV2giLCJLVmdxQzJ5IiwiekhtSHdFciIsIjVPaDZwYmEiLCJLcWllaE5PIiwiaFF6NVRCaCIsIjhHM2cycjkiLCJwbDBIbVVwIiwiZ0hGUHo3YSIsIk1HZHFVVjkiLCI4OFA5OHcwIiwiNW0wd2x2RiIsIkZ4c25SYTkiLCJBZjFYb1JVIiwiYkxnQUo5SyIsIm9CRFdNbmQiLCJFalQ5UWdPIiwib3V3NnNqaiIsIjlBU1cyREUiLCJwM1JZQlFwIiwicEdjdDlIYyIsImgyeE5oYkMiLCJrRnFpUmMxIiwiVHpQTnFoNiIsIjRQdUo5b0kiLCJxM3d6RkJhIiwiWElKSUZxMiIsInFnNlR5NEoiLCJkVnZpWFFuIiwid1pNUGdLYSIsIkNiMWFaR0QiLCJPS0hMN0F6IiwiMmRJd3l2UyIsImhVbkFEYXkiLCJqRjZYOEI2Iiwialp6QzhNaSIsIndVVldzZ2UiLCJRZjFub29mIiwiTGpKaEZhRiIsIkoxTDZmM20iLCJMTlFTemtKIiwiUTZxTENiRiIsIkd3WnREYVAiLCJXVzFPSG1lIiwiaEtHdHMzQSIsIjFCaElOTm0iLCJuN3VEUUNGIiwiY0lIMFM4QiIsIjdxY1NKeWMiLCJUWGZtbVdwIiwiWER4bkJ1ZSIsInVGbUUyOFEiLCJjTE1FOG1QIiwibmJUZU5ldSIsIjFBY09RQTYiLCJ5dzlDaGJqIiwiMlg5ZktSSSIsInN4Y2lyQmgiLCJkSFdiU3FOIiwiZU5sVjZJRiIsIlNwbkViSVYiLCJNY3A4TzdEIiwicFhJRW96TiIsIk1PamdYQlYiLCI5M3p5QVdNIiwiZ1pmekVHTCIsIlhJTEJzcTMiLCJlUndwdGxUIiwiek96d0hqbyIsInVEWjRuTlgiLCJiQTc3TE5MIiwidUpsS2J5WCIsIktWSVFyOU8iLCJiYXpLZlBZIiwibTh1YXdYZiIsImV2UjFPNEgiLCJBVUwzaXdaIiwiWkFmWHFGZiIsIjFWNDFRbkMiLCJiRXZvVGVnIiwiVFZ1Nmh0YSIsIlhhc0ROOUciLCJTdEc3VU1uIiwiR3NYbnJMYSIsIkJIQlBoVTYiLCJLN1hDSVlZIiwieWI1Z01oQSIsIk1US2RkQWQiLCJFbkRJZ0lVIiwiYUE3N0l5MSIsIk5nNWwyTEEiLCJCSndIeW1WIiwiVmoxdTh6MyIsIk1sQTUxelAiLCJGRFA2YnZ4IiwiNThicllYeCIsIjliN21jSlkiLCIzN2UxamM0IiwiQ0xCbDRpYiIsInRMb01GTDciLCJaWlQ3SjJpIiwiR1NFblRCYSIsIkxGQkFLTzgiLCJSdjBoMzFXIiwiRzhlSFR0WiIsImxpZEQ5NVQiLCJaWEZjeHlVIiwiNE9URVo4bSIsImF0TmY5Z1UiLCJZck5FaHlhIiwiOGVST1ZxZSIsImVWdnl1S0YiLCI3eDk4em1MIiwiOVhFT2tNViIsIk1sRFRxM1MiLCJjQ01lNjhIIiwiWHF2MExiUSIsInZhVm0xMk0iLCI2ZWdGUWExIiwiUG1MODYwaCIsIkM0dGd3YVIiLCJlbnhFN05GIiwiOG9xTmZtWSIsIkhoakEwWU8iLCJ1dTIxTnd6IiwidExOaURRVyIsIk8zYldyNVQiLCIxWTI4TENVIiwibjFNd0pvNyIsIkVMVGVyNUQiLCJZb1Y1OU51Iiwic056SW5heCIsIlVGVXdDTHYiLCJPczNuTzFIIiwiWUJSRTVUdyIsIkl0S2c0R1UiLCJOUDRRTU9uIiwibEFPNmxnbyIsIm1ieHlEeTMiLCJDNGJKclduIiwiMHhGc1NDVSIsIlF0SkplU1EiLCJsSVBMRlp5IiwiVzZNUUprNiIsIjhNQlhYZWciLCJUR0w4RzdHIiwidmVwb3RVUyIsIjRwV2M1R3kiLCJNaDZBand6IiwiQ2x1Z21oUSIsIjQ2ZHRoZFUiLCJ1eGYzS28yIiwiSU5KTG53QSIsIjc4UEhSWHkiLCJvNzNyRExFIiwiT2VkV3Q2MSIsInhkc3RVMDMiLCI0V1Z3S08wIiwiSXV2aWZqUiIsIm9JNDBsb04iLCJ2eFp3Z3pmIiwiT1psRGlzNiIsIlRJcTVoVTUiLCJXUWZXUERKIiwiNnlDaXlGZCIsImlsNHltS2wiLCJtdGtvdUZmIiwiR0VQZnJqQSIsIlhwRXdyV2QiLCIyMDQyMHdUIiwicHRjTzViYSIsIlB0QU9Ub28iLCJ3aGhkWGFPIiwicnJFMW83ZyIsIkFDeEFoTEUiLCJzeGR5cWhpIiwiZFJPWTZENiIsInJLRm12RE8iLCJZeEpHNkxBIiwidENOUVFoQiIsIkVXanNJQW8iLCJUUUZLVzRvIiwiS2xzdjN2MCIsImlOQ3k4eE0iLCJYeFJJOG1pIiwiWmZ3dW82TSIsIjc2ck9PcmoiLCJTQThSWmZDIiwiUU4weUJxdSIsIlRJY2JCbTQiLCJvUFNnSUNlIiwiYWRiaWMyayIsIkRjWnpISkkiLCI0ODVzVTR4IiwiM2RrbGpYNSIsIktuNzVjR0giLCJBSWpQSzlXIiwiZWFyNTlGVyIsIko3QTBmMUQiLCJzQTRYUzhoIiwiRjNqQ0FjQyIsIjhBakRPekoiLCJJU3YxekZHIiwiMjVmczFldCIsImxsWEM3ZUUiLCJWSmFHRXpoIiwiRGwwd2ZWbyIsImVGOTZEQ3IiLCJoTUQ5MzJ1IiwiVTFDb0ltSiIsIkFhQnJ1ekUiLCJ6RTlaYnUzIiwiTzdRZXNpaCIsInhESHd1bDkiLCJXaU1mU2l5IiwiMG9FaDRlTiIsImZrZXRzbE0iLCJxbVRMQktlIiwiQWtldnZoSSIsImRncjdWaGEiLCJRYVpJbzdLIiwiTktXNjJmcSIsInpqQXdua2EiLCJhS2Q1b3FpIiwic2JWV0NDZiIsImtrOFVnUDUiLCJHRDVKeEhDIiwienlEbW1lVyIsIlU4WjdTbWYiLCI4MzBNbk1yIiwiZG5pWHJzSCIsIkdEaXI2NnYiLCJkekJPelN4IiwiWkR1eUppSCIsIjAxb2tlcmIiLCI1eU1hWnB0IiwiVWhvUUFxWSIsIjZPc1k1OGgiLCIzeUY0MGNNIiwiV1BtcEgyMiIsIm5tS3kxNGEiLCJraEJVbHBzIiwiZlpDTmYyMiIsIjJxcENOTWUiLCJuT28yRlN4Iiwiakc2ODdXTyIsIkFCMEdxVUIiLCIxZ21xTnRrIiwiY0JMOVlsUCIsIkFTS0Z6Mm8iLCJrN05QSVVmIiwiUnN1SmI3TCIsIlliTFB1TXMiLCI1YVk4SktoIiwiYUhWWlpuRCIsIlNra1k1RVYiLCIyYUN1SWNyIiwiaTVzUEo4ciIsIm1WNTk5a0YiLCJVMVA3SnNtIiwibXo4QWFEZCIsIm0zeDIybU4iLCJ0ZXN0QmlkIl0=','length','sort','round','hasWinningAmazonBid','_0x4d3546','winning_amazon_ad','3855590xzSVnd','_0x59ab84','winning_ad.dfp_price','WyIxZ3Vib3FvIiwiejMxbzh3IiwiMXlsbHA4ZyIsIjhnNG5pOCIsIjE3eW9vaHMiLCJxN2VvMDAiLCIxcHB5b3prIiwiY3Z5NW1vIiwiMWNlaTZtOCIsInVuODY0ZyIsIjF1NXM3NDAiLCI0MGI1ZHMiLCIxM2l2NmRjIiwibHJsNXZrIiwiMWxhNTZ2NCIsImYzdXdvdyIsIjFlbWV4b2ciLCJ3djR4Nm8iLCIxd2RveTY4IiwiNjg3d2cwIiwiMTVxcnhmayIsIm56aHd4cyIsIjFuaTF4eGMiLCJhbzFla2ciLCIxYTZsZmswIiwic2ZiZjI4IiwiMXJ4dmcxcyIsIjFzZWViayIsIjExYXlmYjQiLCJqam9ldGMiLCIxajI4ZnN3IiwiZzd0YTgwIiwiMWZxZGI3ayIsInh6M2FwcyIsIjF4aG5icGMiLCI3YzY5ejQiLCIxNnVxYXlvIiwicDNnYWd3IiwiMW9tMGJnZyIsImJyenMzayIsIjFiYWp0MzQiLCJ0ajlzbGMiLCIxdDF0dGt3IiwiMndjcnVvIiwiMTJld3N1OCIsImtubXNjZyIsIjFrNjZ0YzAiLCJkendqNXMiLCIxZGlnazVjIiwidnI2am5rIiwiMXY5cWtuNCIsIjU0OWl3dyIsIjE0bXRqd2ciLCJtdmpqZW8iLCIxbWUza2U4IiwiOWszMTFjIiwiMTkybjIwdyIsInJiZDFqNCIsIjFxdHgyaW8iLCJvZzBzZyIsIjEwNzAxczAiLCJpZnExYTgiLCIxaHlhMjlzIiwiZ3JzZ3prIiwiMWdhY2h6NCIsInlqMmhoYyIsIjF5MW1pZ3ciLCI3dzVncW8iLCIxN2VwaHE4IiwicG5maDhnIiwiMXA1emk4MCIsImNieXl2NCIsIjFidWl6dW8iLCJ1Mzh6Y3ciLCIxdGx0MGNnIiwiM2dieW04IiwiMTJ5dnpscyIsImw3bHo0MCIsIjFrcTYwM2siLCJlanZweGMiLCIxZTJmcXd3Iiwid2I1cWY0IiwiMXZ0cHJlbyIsIjVvOHBvZyIsIjE1NnNxbzAiLCJuZmlxNjgiLCIxbXkycjVzIiwiYTQyN3N3IiwiMTltbThzZyIsInJ2YzhhbyIsIjFyZHc5YTgiLCIxOGY3azAiLCIxMHF6OGprIiwiaXpwODFzIiwiMWlpOTkxYyIsImZudTNnZyIsIjFmNmU0ZzAiLCJ4ZjQzeTgiLCIxd3hvNHhzIiwiNnM3MzdrIiwiMTZhcjQ3NCIsIm9qaDNwYyIsIjFvMjE0b3ciLCJiODBsYzAiLCIxYXFrbWJrIiwic3phbHRzIiwiMXNodW10YyIsIjJjZGwzNCIsIjExdXhtMm8iLCJrM25sa3ciLCIxam03bWtnIiwiZGZ4Y2U4IiwiMWN5aGRkcyIsInY3N2N3MCIsIjF1cHJkdmsiLCI0a2FjNWMiLCIxNDJ1ZDR3IiwibWJrY240IiwiMWx1NGRtbyIsIjkwM3U5cyIsIjE4aW52OWMiLCJxcmR1cmsiLCIxcTl4dnI0IiwiNGd1MHciLCJ6bjB2MGciLCJodnF1aW8iLCIxaGVhdmk4IiwiaGxyOTR3IiwiMWg0YmE0ZyIsInpkMTltbyIsIjF5dmxhbTgiLCI4cTQ4dzAiLCIxODhvOXZrIiwicWhlOWRzIiwiMXB6eWFkYyIsImQ1eHIwZyIsIjFjb2hzMDAiLCJ1eDdyaTgiLCIxdWZyc2hzIiwiNGFhcXJrIiwiMTNzdXJyNCIsIm0xa3I5YyIsIjFsazRzOHciLCJmZHVpMm8iLCIxZXdlajI4IiwieDU0aWtnIiwiMXdub2prMCIsIjZpN2h0cyIsIjE2MHJpdGMiLCJvOWhpYmsiLCIxbnMxamI0IiwiYXkwenk4IiwiMWFnbDB4cyIsInNwYjBnMCIsIjFzN3YxZmsiLCIyMmR6cGMiLCIxMWt5MG93IiwianRvMDc0IiwiMWpjODE2byIsImdoc3ZscyIsIjFnMGN3bGMiLCJ5OTJ3M2siLCIxeHJteDM0IiwiN201dmN3IiwiMTc0cHdjZyIsInBkZnZ1byIsIjFvdnp3dTgiLCJjMXpkaGMiLCIxYmtqZWd3IiwidHQ5ZHo0IiwiMXRidGV5byIsIjM2Y2Q4ZyIsIjEyb3dlODAiLCJreG1kcTgiLCIxa2c2ZXBzIiwiZTl3NGprIiwiMWRzZzVqNCIsIncxNjUxYyIsIjF2anE2MHciLCI1ZTk0YW8iLCIxNHd0NWE4IiwibjVqNHNnIiwiMW1vMzVzMCIsIjl1Mm1mNCIsIjE5Y21uZW8iLCJybGNtd3ciLCIxcjN3bndnIiwieWZtNjgiLCIxMGd6bjVzIiwiaXBwbW8wIiwiMWk4OW5uayIsImgxczJkYyIsIjFna2MzY3ciLCJ5dDIydjQiLCIxeWJtM3VvIiwiODY1MjRnIiwiMTdvcDM0MCIsInB4ZjJtOCIsIjFwZnozbHMiLCJjbHlrOHciLCIxYzRpbDhnIiwidWQ4a3FvIiwiMXR2c2xxOCIsIjNxYmswMCIsIjEzOHZremsiLCJsaGxraHMiLCIxbDA1bGhjIiwiZXR2YmI0IiwiMWVjZmNhbyIsIndsNWJzdyIsIjF3M3Bjc2ciLCI1eThiMjgiLCIxNWdzYzFzIiwibnBpYmswIiwiMW44MmNqayIsImFlMXQ2byIsIjE5d2x1NjgiLCJzNWJ0b2ciLCIxcm52dW8wIiwiMWllc3hzIiwiMTEweXR4YyIsImo5b3RmayIsIjFpczh1ZjQiLCJmeHRvdTgiLCIxZmdkcHRzIiwieHAzcGMwIiwiMXg3bnFiayIsIjcyNm9sYyIsIjE2a3Fwa3ciLCJvdGdwMzQiLCIxb2MwcTJvIiwiYmkwNnBzIiwiMWIwazdwYyIsInQ5YTc3ayIsIjFzcnU4NzQiLCIybWQ2Z3ciLCIxMjR4N2dnIiwia2RuNnlvIiwiMWp3Nzd5OCIsImRwd3hzMCIsIjFkOGd5cmsiLCJ2aDZ5OXMiLCIxdXpxejljIiwiNHU5eGo0IiwiMTRjdHlpbyIsIm1sankwdyIsIjFtNDN6MGciLCI5YTNmbmsiLCIxOHNuZ240IiwicjFkZzVjIiwiMXFqeGg0dyIsImVnZmVvIiwiengwZ2U4IiwiaTVxZndnIiwiMWhvYWd3MCIsImhncmdnMCIsIjFnemJoZmsiLCJ6ODFneHMiLCIxeXFsaHhjIiwiOGw0Zzc0IiwiMTgzb2g2byIsInFjZWdvdyIsIjFwdXlob2ciLCJkMHh5YmsiLCIxY2poemI0IiwidXM3eXRjIiwiMXVhcnpzdyIsIjQ1YXkybyIsIjEzbnV6MjgiLCJsd2t5a2ciLCIxbGY0emswIiwiZjh1cGRzIiwiMWVyZXFkYyIsIngwNHB2ayIsIjF3aW9xdjQiLCI2ZDdwNHciLCIxNXZycTRnIiwibzRocG1vIiwiMW5uMXFtOCIsImF0MTc5YyIsIjFhYmw4OHciLCJza2I3cjQiLCIxczJ2OHFvIiwiMXhlNzBnIiwiMTFmeTgwMCIsImpvbzdpOCIsIjFqNzg4aHMiLCJnY3Qyd3ciLCIxZnZkM3dnIiwieTQzM2VvIiwiMXhtbjRlOCIsIjdoNjJvMCIsIjE2enEzbmsiLCJwOGczNXMiLCIxb3IwNDVjIiwiYnd6a3NnIiwiMWJmamxzMCIsInRvOWxhOCIsIjF0NnRtOXMiLCIzMWNramsiLCIxZG5nY3U4IiwibjBqYzNrIiwiMXF5d3Y3ayIsImd3czlvZyIsIjE3anBhZjQiLCJ1ODhzMXMiLCIxa3Y1c3NnIiwiNXQ4aWRjIiwiMTlybTFoYyIsImo0cDBxbyIsIjF4Mm54bW8iLCJiZDBlMHciLCIxMXp4ZXJrIiwidmM3NWt3IiwiMWx6NDZiayIsIjlnbXBzIiwiMWg5YjJ0YyIsInFtZTIybyIsIjF1a3JsNm8iLCJmaXVhcmsiLCIxNjVyYmk4Iiwic3VhdDR3IiwiMWpoN3R2ayIsIjdyNW8xcyIsIjFicGo3NXMiLCJsMm02ZjQiLCIxdm9weXBzIiwiOXoyZjQwIiwiMTBsemZ1byIsInl5MXZrMCIsIjFwa3l3YW8iLCIzdmJjb3ciLCIxZWhmNHprIiwibnVpNDh3IiwiMXJzdm5jdyIsImcydGhqNCIsIjE2cHFpOXMiLCJ0ZTl6d2ciLCIxazE3MG40IiwiNHo5cTgwIiwiMTh4bjljMCIsImlhcThsYyIsIjF5ajNzdzAiLCJjdGc5YTgiLCIxM2dkYTB3Iiwid3NuMHU4IiwiMW5mazFrdyIsIjFwd2h6NCIsIjFmbnZldjQiLCJwMHllNGciLCIxc3pieDhnIiwiZHhlbXRjIiwiMTRrYm5rMCIsInI4djU2byIsIjFodnM1eGMiLCI3dG5rZTgiLCIxYnMxM2k4IiwibDU0MnJrIiwiMXZyN3YyOCIsImExa2JnZyIsIjEwb2hjNzQiLCJ4Y203bHMiLCIxbnpqOGNnIiwiMjl2b3FvIiwiMWN2emgxYyIsIm05MmdhbyIsIjFxN2Z6ZW8iLCJoajljc2ciLCIxODY2ZGo0IiwidXVwdjVzIiwiMWxobXZ3ZyIsIjZmcGxoYyIsIjFhZTM0bGMiLCJqcjYzdW8iLCIxeHA1MHFvIiwiYnpoaDR3IiwiMTJtZWh2ayIsInZ5bzhvdyIsIjFtbGw5ZmsiLCJ2eHB0cyIsIjFnaHU3MGciLCJwdXg2OXMiLCIxdHRhcGRzIiwiZXJkZXlvIiwiMTVlYWZwYyIsInMydHhjMCIsIjFpcHF5Mm8iLCI2em9zOHciLCIxYXkyYmN3Iiwia2I1YW04IiwiMXV4OTJ3dyIsIjk3bGpiNCIsInp1aWsxcyIsIno1amtsYyIsIjFwc2dsYzAiLCI0MnQxcTgiLCIxZW93dTB3IiwibzF6dGE4IiwiMXMwZGNlOCIsImdhYjZrZyIsIndkbm1yayIsIjhzbTU4ZyIsIm44MTE0dyIsImJraTMyOCIsInNlMmd3MCIsIjNmMzBnMCIsImh1aHdjZyIsImU4bjZkYyIsInhudXI1cyIsIjZieXF5byIsInByNmJyNCIsIjkzdW9zZyIsInR4MDhocyIsIjFtNW5nZyIsImxudWJjdyIsImdvMW1ndyIsInYzZ2lkYyIsIjdpZjB1OCIsIm5scmgxYyIsImN4NzNzdyIsInJjbHpwYyIsIjJkbWo5YyIsImp1d3lkYyIsImV2NDloYyIsIjUzbjF0cyIsImF4ZWl2NCIsImR0eWJrIiwiZnM3ZjI4IiwiOGFpZHE4IiwiYm92ZW8wIiwiNDc2ZGMwIiwiZG1za2NnIiwiNXE0NHhzIiwiOXZ5MW9nIiwiMXFpejI4IiwiaGp2dHZrIiwiNzBiOWMwIiwiY2YzY2FvIiwiMzlncW8wIiwiZXpobDM0IiwiNGZ4MGprIiwiYTlvaGt3IiwicDJodmsiLCJnaWZjb3ciLCI4Z2Z3MXMiLCJiOGJ0dmsiLCIzcW1zamsiLCJlNTdrZTgiLCI2bmlqMjgiLCI5ZmVndzAiLCIxNjhqcjQiLCJnemxla2ciLCI3ZXpldjQiLCJkOHF2d2ciXQ','floor','1237044iCorim','202979GybynE','bid_mapping_error','_0x4f6067','min','number','log','_0x359c5d','size','amazon_ads','max','3000IVPvTe','dfp_bid_price','_0x2b21de','winning_ad','validateValue','1407ciqhgK','AMZN_BID_KEYS','3xqbonw','515640ToVYwZ','5864188UthvEz','_0x1530b1','toString','deepAccess','hasWinningBid','event_type','isNumber','indexOf','string','Error\x20mapping\x20bid\x20to\x20master\x20list:\x20','utils','sizes','b64DecodeUnicode','9lZUFJi','price','557796cgRvLP'];_0x377e=function(){return _0x4c6863;};return _0x377e();}
var _0x4d3546,kjasdg923,_0x4c1310=()=>{var _0x22bab7=_0x1cff;try{if(properOps[_0x22bab7(0xd4)])
kjasdg923??=ProperMedia[_0x22bab7(0xc4)][_0x22bab7(0xcd)](ProperMedia[_0x22bab7(0xc4)]['b64DecodeUnicode'](properOps[_0x22bab7(0xd4)]));}catch(_0x1cccde){console[_0x22bab7(0xac)](_0x22bab7(0xcb),_0x1cccde);}
return kjasdg923;},_0xef5ca=ProperMedia[_0x31ef75(0xc4)][_0x31ef75(0xcd)](ProperMedia[_0x31ef75(0xc4)][_0x31ef75(0xc6)](_0x31ef75(0xcf)));function _0x1530b1(){var _0x1f6328=_0x31ef75;try{return!_0x4d3546&&(properSpecialOps[_0x1f6328(0xb7)]?_0x4d3546=ProperMedia[_0x1f6328(0xc4)][_0x1f6328(0xcd)](ProperMedia['utils'][_0x1f6328(0xc6)](properSpecialOps['AMZN_BID_KEYS'])):_0x4d3546=ProperMedia[_0x1f6328(0xc4)]['safeJsonParse'](ProperMedia[_0x1f6328(0xc4)]['b64DecodeUnicode'](_0x1f6328(0xd9)))),_0x4d3546;}catch(_0x4fb154){return console[_0x1f6328(0xac)](_0x1f6328(0xbb),_0x4fb154),[];}}
function hag92nga9(_0x4f5c9f){var _0x16bc25=_0x31ef75;if(_0x4f5c9f<0x3)
return Math[_0x16bc25(0xda)](_0x4f5c9f*0x64)-0x1;else{if(_0x4f5c9f<0x8)
return Math[_0x16bc25(0xda)](0x12b+(_0x4f5c9f-0x3)*0x64/0x5);else{if(_0x4f5c9f<0x14)
return Math[_0x16bc25(0xda)](0x18f+(_0x4f5c9f-0x8)*0xa/0x5);else{if(_0x4f5c9f<=0x23)
return Math[_0x16bc25(0xda)](0x1a7+(_0x4f5c9f-0x14));else{if(_0x4f5c9f<0x64)
return 0x1b6;else{if(_0x4f5c9f===0x64)
return 0x1b7;}}}}}}
function _0x59ab84(_0x51d5b5,_0x3a44f9){var _0x2bd561=_0x31ef75;try{var _0xfbcabe=_0x1530b1();if(_0x3a44f9=='a9'){_0x51d5b5=_0x51d5b5[_0x2bd561(0xbc)]();var _0x444aeb=_0x4c1310()?hag92nga9(_0x51d5b5):_0xfbcabe[_0x2bd561(0xc1)](_0x51d5b5);if(_0x444aeb!==-0x1&&_0xef5ca[_0x444aeb])
return _0x51d5b5=_0xef5ca[_0x444aeb],ProperMedia[_0x2bd561(0xc4)][_0x2bd561(0xb5)](_0x51d5b5,{'type':_0x2bd561(0xc2),'max_len':0xf});throw new Error(_0x2bd561(0xc3)+_0x51d5b5);}
return ProperMedia[_0x2bd561(0xc4)][_0x2bd561(0xb5)](_0x51d5b5,{'type':_0x2bd561(0xab),'max':0x3e7,'max_len':0xf});}catch(_0x1d0d7a){return console['log'](_0x2bd561(0xd7),_0x1d0d7a),_0x1d0d7a['bidder']=_0x3a44f9||'',_0x1d0d7a[_0x2bd561(0xbf)]=_0x2bd561(0xa8),sendError(_0x1d0d7a),0x0;}}
function _0x2b21de(_0x379c59){var _0x2eb73c=_0x31ef75;try{var _0x217839=_0x1530b1();return _0x379c59[_0x2eb73c(0xd1)](function(_0x34028b,_0x1b4206){var _0x39b53f=_0x2eb73c,_0x24b232=(_0x4c1310()||{})[_0x34028b['price']]||_0x217839[_0x39b53f(0xc1)](_0x34028b[_0x39b53f(0xc8)]),_0xff6692=(_0x4c1310()||{})[_0x1b4206['price']]||_0x217839[_0x39b53f(0xc1)](_0x1b4206[_0x39b53f(0xc8)]);return _0xff6692-_0x24b232;}),_0x379c59;}catch(_0x3b5ae8){return console[_0x2eb73c(0xac)](_0x2eb73c(0xb3),_0x3b5ae8),_0x379c59||[];}}
function _0x1cff(_0x1a445f,_0x528e76){var _0x377e76=_0x377e();return _0x1cff=function(_0x1cff4b,_0x75544b){_0x1cff4b=_0x1cff4b-0xa7;var _0x2e0cd2=_0x377e76[_0x1cff4b];return _0x2e0cd2;},_0x1cff(_0x1a445f,_0x528e76);}
function _0x4f6067(_0x2f54cb){var _0x1e21f7=_0x31ef75;try{var _0x4ec32e=parseFloat(ProperMedia[_0x1e21f7(0xc4)][_0x1e21f7(0xbd)](_0x2f54cb,_0x1e21f7(0xd8)))||0x0,_0xd357ae=_0x2f54cb[_0x1e21f7(0xd3)]()?_0x3aa07a(_0x2f54cb[_0x1e21f7(0xd5)]['price']):0x0,_0x54ac82=parseFloat(_0x2f54cb[_0x1e21f7(0xb2)]||0x0);return Math[_0x1e21f7(0xb0)](_0x4ec32e,_0xd357ae,_0x54ac82);}catch(_0x43dc59){return console[_0x1e21f7(0xac)](_0x1e21f7(0xa9),_0x43dc59),0x0;}}
function _0x432f92(_0x3bfbc4){var _0x21fdfc=_0x31ef75;try{if(_0x3bfbc4[_0x21fdfc(0xbe)]()||_0x3bfbc4[_0x21fdfc(0xd3)]()){var _0x2b362c=parseFloat(ProperMedia[_0x21fdfc(0xc4)][_0x21fdfc(0xbd)](_0x3bfbc4,_0x21fdfc(0xd8)))||0x0,_0x4adcc6=_0x3bfbc4[_0x21fdfc(0xd3)]()?_0x3aa07a(_0x3bfbc4[_0x21fdfc(0xd5)][_0x21fdfc(0xc8)]):0x0;return _0x2b362c>=_0x4adcc6?_0x3bfbc4[_0x21fdfc(0xb4)]:_0x3bfbc4['winning_amazon_ad'];}else
return![];}catch(_0x4468ed){return console['log']('_0x432f92',_0x4468ed),![];}}
function _0x359c5d(_0x3311fd,_0x3f320b,_0x340035,_0x3cff54,_0x289596){var _0x15e606=_0x31ef75;try{return _0x3311fd[_0x15e606(0xaf)]&&_0x3311fd[_0x15e606(0xaf)]['length']&&_0x3311fd[_0x15e606(0xaf)]['forEach'](function(_0x1fa6d0){var _0x3368dd=_0x15e606;typeof _0x3f320b[_0x1fa6d0[_0x3368dd(0xae)]]==_0x3368dd(0xce)&&(_0x340035[_0x1fa6d0[_0x3368dd(0xae)]]=Math[_0x3368dd(0xaa)](Math[_0x3368dd(0xd2)]((_0x3311fd[_0x3368dd(0xc5)][_0x1fa6d0['size']]===0x63?0x4:_0x3311fd[_0x3368dd(0xc5)][_0x1fa6d0['size']])*_0x3cff54),_0x289596),_0x3f320b[_0x1fa6d0[_0x3368dd(0xae)]]=[]);var _0x1bf7c2=_0x3aa07a(_0x1fa6d0[_0x3368dd(0xc8)])||0x0;_0x3f320b[_0x1fa6d0[_0x3368dd(0xae)]]['push'](_0x1bf7c2),_0x3f320b[_0x1fa6d0['size']][_0x3368dd(0xd0)]>_0x340035[_0x1fa6d0[_0x3368dd(0xae)]]&&(_0x3f320b[_0x1fa6d0[_0x3368dd(0xae)]][_0x3368dd(0xd1)](function(_0x185103,_0xb395a1){return parseFloat(_0xb395a1)-parseFloat(_0x185103);}),_0x3f320b[_0x1fa6d0['size']]=_0x3f320b[_0x1fa6d0[_0x3368dd(0xae)]]['splice'](_0x340035[_0x1fa6d0[_0x3368dd(0xae)]]-0x1));}),_0x3f320b;}catch(_0x401fea){return console[_0x15e606(0xac)](_0x15e606(0xad),_0x401fea),_0x3f320b||[];}}
function _0x3aa07a(_0x577cfd){var _0x2b74c1=_0x31ef75;try{var _0xb8030c=_0x1530b1(),_0x583608=0x0;if(ProperMedia[_0x2b74c1(0xc4)][_0x2b74c1(0xca)](_0x577cfd)){var _0x3ac755=_0x577cfd['replace'](/(o_|v_)/,'');if(_0x3ac755=='testBid')
return 0x64;else{if(_0x4c1310()&&_0x4c1310()[_0x3ac755])
return _0x4c1310()[_0x3ac755];}
var _0x1e73fa=_0xb8030c[_0x2b74c1(0xc1)](_0x3ac755);if(_0x1e73fa!==-0x1){if(_0x1e73fa<0x12c)
_0x583608=(_0x1e73fa+0x1)/0x64;else{if(_0x1e73fa<0x190)
_0x583608=0x3+(_0x1e73fa-0x12b)*0x5/0x64;else{if(_0x1e73fa<0x1a8)
_0x583608=0x8+(_0x1e73fa-0x18f)*0x5/0xa;else
_0x1e73fa<0x1c6&&(_0x583608=0x14+(_0x1e73fa-0x1a7));}}}}else
ProperMedia[_0x2b74c1(0xc4)][_0x2b74c1(0xc0)](_0x577cfd)&&(_0x583608=_0x577cfd);return parseFloat(_0x583608);}catch(_0x16256f){return console[_0x2b74c1(0xac)]('_0x3aa07a',_0x16256f),0x0;}}
return{init:init,set_options:set_options,get_options:get_options,proper_log:properLog.proper_log,proper_debug_console:proper_debug_console,proper_debug_overlay:proper_debug_overlay,proper_display:proper_display,proper_render:proper_render,logMatchingResponse:logMatchingResponse,disableSlotRefresh:disableSlotRefresh,getReportAdInfo:getReportAdInfo,getAdSlots:getAdSlots,refreshSlotByName:refreshSlotByName,refreshAuctionAndSlotsByName:refreshAuctionAndSlotsByName,sendError:sendError,spaNewPage:spaNewPage,spaNewSection:spaNewSection,spaNewPageReset:spaNewPageReset,newPageView:newPageView,runNewAuction:runNewAuction,disableAuctionRefresh:disableAuctionRefresh,infScrollNewPage:infScrollNewPage,buildSlots:buildSlots,deleteSlot:deleteSlot,destroyDfpSlot:destroyDfpSlot,getVideoPlayerOps:getVideoPlayerOps,createVideoSlot:createVideoSlot,runVideoAuction:runVideoAuction,getVideoAd:getVideoAd,destroyVideoPlayer:destroyVideoPlayer,logOutstreamAdSuccess:logOutstreamAdSuccess,logVideoAdSuccess:logVideoAdSuccess,logVideoUnfilled:logVideoUnfilled,logVideoAdError:logVideoAdError,proper_remnant:proper_remnant,runATS:runATS,cookieMatching:cookieMatching,publisherAudiencesOptOut:publisherAudiencesOptOut,getUserIdsAsEids:getUserIdsAsEids,closeSliderSlot:closeSliderSlot,testRps:testRps,};})(window,document);var proper_log=ProperMedia.ad_project.proper_log;var proper_debug_console=ProperMedia.ad_project.proper_debug_console;var proper_debug_overlay=ProperMedia.ad_project.proper_debug_overlay;var proper_display=ProperMedia.ad_project.proper_display;var proper_render=ProperMedia.ad_project.proper_render;var disableSlotRefresh=ProperMedia.ad_project.disableSlotRefresh;var logMatchingResponse=ProperMedia.ad_project.logMatchingResponse;var properSpaNewPage=ProperMedia.ad_project.spaNewPage;var properSpaNewSection=ProperMedia.ad_project.spaNewSection;var properSpaNewPageView=ProperMedia.ad_project.newPageView;var properSpaNewPageReset=ProperMedia.ad_project.spaNewPageReset;var properInfNewPage=ProperMedia.ad_project.infScrollNewPage;var properBuildSlots=ProperMedia.ad_project.buildSlots;var properDeleteSlot=ProperMedia.ad_project.deleteSlot;var properDestroyDfpSlot=ProperMedia.ad_project.destroyDfpSlot;var proper_remnant=ProperMedia.ad_project.proper_remnant;var runATS=ProperMedia.ad_project.runATS;var publisherAudiencesOptOut=ProperMedia.ad_project.publisherAudiencesOptOut;var refreshAuctionAndSlotsByName=ProperMedia.ad_project.refreshAuctionAndSlotsByName;ProperMedia.ad_project.init();